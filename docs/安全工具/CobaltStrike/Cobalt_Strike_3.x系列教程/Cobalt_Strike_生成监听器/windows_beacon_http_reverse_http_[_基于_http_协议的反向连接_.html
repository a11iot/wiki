<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8" /><title>
		</title>
		<style type="text/css">
			.cs868C439D{text-align:left;text-indent:0pt;margin:10pt 0pt 0pt 0pt;page-break-after:avoid;page-break-inside:avoid}
			.csB2D98684{color:#4F81BD;background-color:transparent;font-family:Calibri;font-size:14pt;font-weight:bold;font-style:normal;}
			.cs83F14626{color:#4F81BD;background-color:transparent;font-family:Microsoft YaHei UI;font-size:14pt;font-weight:bold;font-style:normal;}
			.cs6FD73CFB{text-align:left;text-indent:0pt;margin:5pt 24pt 5pt 24pt}
			.cs9C1B1871{color:#000000;background-color:transparent;font-family:Microsoft YaHei UI;font-size:12pt;font-weight:normal;font-style:normal;}
			.cs8926E06{color:#000000;background-color:transparent;font-family:Calibri;font-size:12pt;font-weight:normal;font-style:normal;}
			.cs40DD2BC9{text-align:left;text-indent:0pt;margin:9pt 0pt 9pt 0pt}
		</style>
	</head>
	<body>
		<h2 class="cs868C439D">
			<a name="Xf0fa074a06ad155bce943e4147a516d2bc1247e"><span class="csB2D98684">windows/beacon_http/reverse_http [ </span><span class="cs83F14626">基于</span><span class="csB2D98684"> http </span><span class="cs83F14626">协议的反向连接</span><span class="csB2D98684"> ]</span></a></h2>
		<p class="cs6FD73CFB"><span class="cs9C1B1871">特别说明下</span><span class="cs8926E06">,</span><span class="cs9C1B1871">大家大可不必觉得</span><span class="cs8926E06">,</span><span class="cs9C1B1871">一听到什么协议就感觉很高精尖一样</span><span class="cs8926E06">,</span><span class="cs9C1B1871">其实并不然</span><span class="cs8926E06">,</span><span class="cs9C1B1871">所谓基于</span><span class="cs8926E06"> http,</span><span class="cs9C1B1871">说通俗点</span><span class="cs8926E06">,</span><span class="cs9C1B1871">无非就是把木马回连的流量</span><span class="cs8926E06">,</span><span class="cs9C1B1871">严格按照</span><span class="cs8926E06"> http </span><span class="cs9C1B1871">协议的数据格式进行正常封装收发</span><span class="cs8926E06">[ </span><span class="cs9C1B1871">数据交换</span><span class="cs8926E06"> ],</span><span class="cs9C1B1871">专业点叫</span><span class="cs8926E06"> </span><span class="cs9C1B1871">模拟</span><span class="cs8926E06"> http </span><span class="cs9C1B1871">协议</span><span class="cs8926E06"> </span><span class="cs9C1B1871">进行传输</span><span class="cs8926E06">,</span><span class="cs9C1B1871">之所以要用</span><span class="cs8926E06"> http </span><span class="cs9C1B1871">协议</span><span class="cs8926E06">,</span><span class="cs9C1B1871">无非就是因为它对防火墙的穿透效果相对于其它协议稍好一点</span></p><p class="cs6FD73CFB"><span class="cs9C1B1871">此外</span><span class="cs8926E06">,</span><span class="cs9C1B1871">由于我们所使用的是</span><span class="cs8926E06"> CobaltStrike </span><span class="cs9C1B1871">的试用版</span><span class="cs8926E06">,</span><span class="cs9C1B1871">所以监听器的创建个数是有限制的</span><span class="cs8926E06">,</span><span class="cs9C1B1871">默认同时只能创建一个</span><span class="cs8926E06">,</span><span class="cs9C1B1871">不过后期可自行反编译代码</span><span class="cs8926E06">,</span><span class="cs9C1B1871">破除这种限制</span><span class="cs8926E06">,</span><span class="cs9C1B1871">此处暂时先不多说</span><span class="cs8926E06">,</span><span class="cs9C1B1871">来看下具体使用</span><span class="cs8926E06">,</span><span class="cs9C1B1871">其实非常简单</span><span class="cs8926E06">,</span><span class="cs9C1B1871">直接选中该协议监听器</span><span class="cs8926E06">,</span><span class="cs9C1B1871">指定</span><span class="cs8926E06"> ip[ </span><span class="cs9C1B1871">即</span><span class="cs8926E06"> vps ip ]</span><span class="cs9C1B1871">端口和监听器名称</span><span class="cs8926E06">,</span><span class="cs9C1B1871">点击</span><span class="cs8926E06">&quot;save&quot;</span></p><p class="cs40DD2BC9"><span><img src="安全工具/CobaltStrike/Cobalt_Strike_3.x系列教程/Cobalt_Strike_生成监听器/windows_beacon_http_reverse_http%20[%20%e5%9f%ba%e4%ba%8e%20http%20%e5%8d%8f%e8%ae%ae%e7%9a%84%e5%8f%8d%e5%90%91%e8%bf%9e%e6%8e%a5%20_files/image0.png" width="560" height="291" alt="" style="border-width:0px;" /></span></p><p class="cs6FD73CFB"><span class="cs9C1B1871">紧接着</span><span class="cs8926E06">,</span><span class="cs9C1B1871">再利用上面监听器生成</span><span class="cs8926E06"> payload,</span><span class="cs9C1B1871">注意</span><span class="cs8926E06">,</span><span class="cs9C1B1871">此处是直接生成</span><span class="cs8926E06"> 64 </span><span class="cs9C1B1871">位的</span><span class="cs8926E06"> exe payload,</span><span class="cs9C1B1871">实战中的具体位数要根据目标系统的实际位数来确定</span><span class="cs8926E06">,</span><span class="cs9C1B1871">当然啦</span><span class="cs8926E06">,</span><span class="cs9C1B1871">实战中也不可能就直接这样生成着去用</span><span class="cs8926E06">,</span><span class="cs9C1B1871">因为这种方式生成的</span><span class="cs8926E06">payload </span><span class="cs9C1B1871">很显然是不可能免杀的</span><span class="cs8926E06">,</span><span class="cs9C1B1871">不过此处仅作为入门学习</span><span class="cs8926E06">,</span><span class="cs9C1B1871">暂时大可不必管那么多</span></p><p class="cs40DD2BC9"><span><img src="安全工具/CobaltStrike/Cobalt_Strike_3.x系列教程/Cobalt_Strike_生成监听器/windows_beacon_http_reverse_http%20[%20%e5%9f%ba%e4%ba%8e%20http%20%e5%8d%8f%e8%ae%ae%e7%9a%84%e5%8f%8d%e5%90%91%e8%bf%9e%e6%8e%a5%20_files/image1.png" width="560" height="158" alt="" style="border-width:0px;" /></span></p><p class="cs40DD2BC9"><span><img src="安全工具/CobaltStrike/Cobalt_Strike_3.x系列教程/Cobalt_Strike_生成监听器/windows_beacon_http_reverse_http%20[%20%e5%9f%ba%e4%ba%8e%20http%20%e5%8d%8f%e8%ae%ae%e7%9a%84%e5%8f%8d%e5%90%91%e8%bf%9e%e6%8e%a5%20_files/image2.png" width="560" height="353" alt="" style="border-width:0px;" /></span></p><p class="cs6FD73CFB"><span class="cs9C1B1871">之后</span><span class="cs8926E06">,</span><span class="cs9C1B1871">将上面生成好的</span><span class="cs8926E06"> exe payload </span><span class="cs9C1B1871">丢到目标机器上去执行</span><span class="cs8926E06">,</span><span class="cs9C1B1871">稍等片刻便能看到</span><span class="cs8926E06"> beacon shell </span><span class="cs9C1B1871">被正常弹回</span><span class="cs8926E06">,</span><span class="cs9C1B1871">正如我们预期的那样</span><span class="cs8926E06">,payload 10 </span><span class="cs9C1B1871">秒发一次心跳数据</span></p><p class="cs40DD2BC9"><span><img src="安全工具/CobaltStrike/Cobalt_Strike_3.x系列教程/Cobalt_Strike_生成监听器/windows_beacon_http_reverse_http%20[%20%e5%9f%ba%e4%ba%8e%20http%20%e5%8d%8f%e8%ae%ae%e7%9a%84%e5%8f%8d%e5%90%91%e8%bf%9e%e6%8e%a5%20_files/image3.png" width="560" height="118" alt="" style="border-width:0px;" /></span></p><p class="cs6FD73CFB"><span class="cs9C1B1871">要特别注意下的是</span><span class="cs8926E06">,CobaltStrike </span><span class="cs9C1B1871">的</span><span class="cs8926E06"> exe payload </span><span class="cs9C1B1871">默认执行以后在目标系统中就一个进程</span><span class="cs8926E06">,</span><span class="cs9C1B1871">一旦对方手动把这个进程给</span><span class="cs8926E06"> kill </span><span class="cs9C1B1871">掉</span><span class="cs8926E06">,</span><span class="cs9C1B1871">你的</span><span class="cs8926E06"> beacon shell </span><span class="cs9C1B1871">也就掉了</span></p><p class="cs40DD2BC9"><span><img src="安全工具/CobaltStrike/Cobalt_Strike_3.x系列教程/Cobalt_Strike_生成监听器/windows_beacon_http_reverse_http%20[%20%e5%9f%ba%e4%ba%8e%20http%20%e5%8d%8f%e8%ae%ae%e7%9a%84%e5%8f%8d%e5%90%91%e8%bf%9e%e6%8e%a5%20_files/image4.png" width="560" height="68" alt="" style="border-width:0px;" /></span></p><p class="cs6FD73CFB"><span class="cs9C1B1871">最后</span><span class="cs8926E06">,</span><span class="cs9C1B1871">我们再用</span><span class="cs8926E06"> wireshark </span><span class="cs9C1B1871">来简单看下</span><span class="cs8926E06"> reverse_http </span><span class="cs9C1B1871">监听器的数据收发过程</span><span class="cs8926E06">,</span><span class="cs9C1B1871">正如我刚才在上面所说</span><span class="cs8926E06">,</span><span class="cs9C1B1871">它就是按照</span><span class="cs8926E06"> http </span><span class="cs9C1B1871">的数据格式来进行数据交换的</span><span class="cs8926E06">,</span><span class="cs9C1B1871">当然</span><span class="cs8926E06">,</span><span class="cs9C1B1871">此处我们用的仍然是自定义</span><span class="cs8926E06"> profile,</span><span class="cs9C1B1871">关于收发过程</span><span class="cs8926E06">,</span><span class="cs9C1B1871">其实在之前的文章中也已经看过了</span><span class="cs8926E06">,</span><span class="cs9C1B1871">这儿就不多说了</span><span class="cs8926E06">,</span><span class="cs9C1B1871">还不了解</span><span class="cs8926E06"> http </span><span class="cs9C1B1871">协议的弟兄</span><span class="cs8926E06">,</span><span class="cs9C1B1871">可自行再单独去好好补充下这方面的知识</span></p><p class="cs40DD2BC9"><span><img src="安全工具/CobaltStrike/Cobalt_Strike_3.x系列教程/Cobalt_Strike_生成监听器/windows_beacon_http_reverse_http%20[%20%e5%9f%ba%e4%ba%8e%20http%20%e5%8d%8f%e8%ae%ae%e7%9a%84%e5%8f%8d%e5%90%91%e8%bf%9e%e6%8e%a5%20_files/image5.png" width="560" height="109" alt="" style="border-width:0px;" /></span></p><p class="cs40DD2BC9"><span class="cs8926E06">image</span></p></body>
</html>
