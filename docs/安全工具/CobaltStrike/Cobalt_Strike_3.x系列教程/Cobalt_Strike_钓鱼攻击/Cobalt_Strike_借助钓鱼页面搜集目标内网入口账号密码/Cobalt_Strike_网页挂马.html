<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8" /><title>
		</title>
		<style type="text/css">
			.csAD577193{text-align:left;text-indent:0pt;margin:24pt 0pt 0pt 0pt;page-break-after:avoid;page-break-inside:avoid}
			.csDE05BCC{color:#4F81BD;background-color:transparent;font-family:Calibri;font-size:16pt;font-weight:bold;font-style:normal;}
			.csECDA2D3{color:#4F81BD;background-color:transparent;font-family:Microsoft YaHei UI;font-size:16pt;font-weight:bold;font-style:normal;}
			.cs868C439D{text-align:left;text-indent:0pt;margin:10pt 0pt 0pt 0pt;page-break-after:avoid;page-break-inside:avoid}
			.cs83F14626{color:#4F81BD;background-color:transparent;font-family:Microsoft YaHei UI;font-size:14pt;font-weight:bold;font-style:normal;}
			.csB2D98684{color:#4F81BD;background-color:transparent;font-family:Calibri;font-size:14pt;font-weight:bold;font-style:normal;}
			.cs6FD73CFB{text-align:left;text-indent:0pt;margin:5pt 24pt 5pt 24pt}
			.cs9C1B1871{color:#000000;background-color:transparent;font-family:Microsoft YaHei UI;font-size:12pt;font-weight:normal;font-style:normal;}
			.cs40DD2BC9{text-align:left;text-indent:0pt;margin:9pt 0pt 9pt 0pt}
			.cs8926E06{color:#000000;background-color:transparent;font-family:Calibri;font-size:12pt;font-weight:normal;font-style:normal;}
			.cs3A447A38{text-align:left;text-indent:0pt;margin:0pt 0pt 10pt 0pt}
			.cs9FB05234{color:#000000;background-color:transparent;font-family:Consolas;font-size:11pt;font-weight:normal;font-style:normal;}
		</style>
	</head>
	<body>
		<h1 class="csAD577193">
			<a name="cobalt-strike-网页挂马"><span class="csDE05BCC">Cobalt Strike </span><span class="csECDA2D3">网页挂马</span></a></h1>
		<h2 class="cs868C439D">
			<a name="第一步先准备好木马--即-payload--链接"><span class="cs83F14626">第一步</span><span class="csB2D98684">,</span><span class="cs83F14626">先准备好木马</span><span class="csB2D98684"> [ </span><span class="cs83F14626">即</span><span class="csB2D98684"> payload ] </span><span class="cs83F14626">链接</span></a></h2>
		<p class="cs6FD73CFB"><span class="cs9C1B1871">创建监听器</span></p><p class="cs40DD2BC9"><span><img src="安全工具/CobaltStrike/Cobalt_Strike_3.x系列教程/Cobalt_Strike_钓鱼攻击/Cobalt_Strike_借助钓鱼页面搜集目标内网入口账号密码/Cobalt%20Strike%20%e7%bd%91%e9%a1%b5%e6%8c%82%e9%a9%ac_files/image0.png" width="560" height="155" alt="" style="border-width:0px;" /></span></p><p class="cs6FD73CFB"><span class="cs9C1B1871">由于是网页挂马</span><span class="cs8926E06">,</span><span class="cs9C1B1871">所以此处我们就直接生成一个</span><span class="cs8926E06"> hta </span><span class="cs9C1B1871">的</span><span class="cs8926E06"> payload, &quot;Method &quot;</span><span class="cs9C1B1871">选择用</span><span class="cs8926E06"> &quot;PowerShell&quot; [ win7 </span><span class="cs9C1B1871">之后的系统建议直接用</span><span class="cs8926E06">&quot;powershell&quot;],</span><span class="cs9C1B1871">默认的</span><span class="cs8926E06">&quot;Executable&quot;</span><span class="cs9C1B1871">是利用</span><span class="cs8926E06"> vbs </span><span class="cs9C1B1871">执行</span><span class="cs8926E06"> shellcode[</span><span class="cs9C1B1871">这对于一些老系统也许还行</span><span class="cs8926E06">,</span><span class="cs9C1B1871">但对于</span><span class="cs8926E06"> win7 </span><span class="cs9C1B1871">之后的系统执行会有些问题</span><span class="cs8926E06">] ,</span><span class="cs9C1B1871">生成过程如下</span></p><p class="cs40DD2BC9"><span><img src="安全工具/CobaltStrike/Cobalt_Strike_3.x系列教程/Cobalt_Strike_钓鱼攻击/Cobalt_Strike_借助钓鱼页面搜集目标内网入口账号密码/Cobalt%20Strike%20%e7%bd%91%e9%a1%b5%e6%8c%82%e9%a9%ac_files/image1.png" width="560" height="391" alt="" style="border-width:0px;" /></span></p><p class="cs6FD73CFB"><span class="cs9C1B1871">接着</span><span class="cs8926E06">,</span><span class="cs9C1B1871">利用</span><span class="cs8926E06"> CobaltStrike </span><span class="cs9C1B1871">自带的</span><span class="cs8926E06">&quot;host file&quot; [ </span><span class="cs9C1B1871">其实就相当于</span><span class="cs8926E06"> CobaltStrike </span><span class="cs9C1B1871">自带的一个</span><span class="cs8926E06"> web </span><span class="cs9C1B1871">服务器</span><span class="cs8926E06"> ] </span><span class="cs9C1B1871">功能</span><span class="cs8926E06">,</span><span class="cs9C1B1871">把刚刚生成好的</span><span class="cs8926E06"> hta payload </span><span class="cs9C1B1871">挂上去</span><span class="cs8926E06">,</span><span class="cs9C1B1871">生成钓鱼链接</span><span class="cs8926E06">,</span><span class="cs9C1B1871">当然啦</span><span class="cs8926E06">,</span><span class="cs9C1B1871">你也可以不用</span><span class="cs8926E06"> hta,</span><span class="cs9C1B1871">利用前几天爆的那个</span><span class="cs8926E06"> winrar</span><span class="cs9C1B1871">的目录穿越漏洞挂个带马的</span><span class="cs8926E06"> rar </span><span class="cs9C1B1871">压缩包上去也是一样的</span><span class="cs8926E06">,</span><span class="cs9C1B1871">都是一些实际利用思路</span><span class="cs8926E06">,</span><span class="cs9C1B1871">作为入门</span><span class="cs8926E06">,</span><span class="cs9C1B1871">我们大可先不用考虑那么多</span><span class="cs8926E06">,</span><span class="cs9C1B1871">还是那句话</span><span class="cs8926E06">,</span><span class="cs9C1B1871">先把工具走通</span><span class="cs8926E06">,</span><span class="cs9C1B1871">然后再学会变通</span><span class="cs8926E06">,</span><span class="cs9C1B1871">后面自然就游刃有余</span></p><p class="cs40DD2BC9"><span><img src="安全工具/CobaltStrike/Cobalt_Strike_3.x系列教程/Cobalt_Strike_钓鱼攻击/Cobalt_Strike_借助钓鱼页面搜集目标内网入口账号密码/Cobalt%20Strike%20%e7%bd%91%e9%a1%b5%e6%8c%82%e9%a9%ac_files/image2.png" width="560" height="314" alt="" style="border-width:0px;" /></span></p><p class="cs6FD73CFB"><span class="cs9C1B1871">最终生成的</span><span class="cs8926E06"> payload </span><span class="cs9C1B1871">链接如下</span></p><p class="cs3A447A38"><span class="cs9FB05234">http://71.26.83.17:80/update.hta</span></p><h2 class="cs868C439D">
			<a name="第二步准备钓鱼页面"><span class="cs83F14626">第二步</span><span class="csB2D98684">,</span><span class="cs83F14626">准备钓鱼页面</span></a></h2>
		<p class="cs6FD73CFB"><span class="cs9C1B1871">具体步骤还还跟之前一样</span><span class="cs8926E06">,</span><span class="cs9C1B1871">只不过</span><span class="cs8926E06">,</span><span class="cs9C1B1871">这里多了一点</span><span class="cs8926E06">,</span><span class="cs9C1B1871">需要你在</span><span class="cs8926E06">&quot;Attack &quot;</span><span class="cs9C1B1871">那里</span><span class="cs8926E06">,</span><span class="cs9C1B1871">选择刚刚上面生成的那个</span><span class="cs8926E06"> payload </span><span class="cs9C1B1871">链接</span><span class="cs8926E06">,</span><span class="cs9C1B1871">因为我们的最终目的是要挂马</span></p><p class="cs40DD2BC9"><span><img src="安全工具/CobaltStrike/Cobalt_Strike_3.x系列教程/Cobalt_Strike_钓鱼攻击/Cobalt_Strike_借助钓鱼页面搜集目标内网入口账号密码/Cobalt%20Strike%20%e7%bd%91%e9%a1%b5%e6%8c%82%e9%a9%ac_files/image3.png" width="560" height="168" alt="" style="border-width:0px;" /></span></p><p class="cs6FD73CFB"><span class="cs9C1B1871">最终生成的钓鱼页面链接如下</span></p><p class="cs3A447A38"><span class="cs9FB05234">http://23.16.73.89:80</span></p><h2 class="cs868C439D">
			<a name="第三步想办法把这个-payload-链接发给目标"><span class="cs83F14626">第三步</span><span class="csB2D98684">,</span><span class="cs83F14626">想办法把这个</span><span class="csB2D98684"> payload </span><span class="cs83F14626">链接发给目标</span></a></h2>
		<p class="cs6FD73CFB"><span class="cs9C1B1871">当目标一打开我们发给它的链接之后</span><span class="cs8926E06">,</span><span class="cs9C1B1871">就会自动提示下载</span><span class="cs8926E06"> payload,</span><span class="cs9C1B1871">实际效果如下</span></p><p class="cs40DD2BC9"><span><img src="安全工具/CobaltStrike/Cobalt_Strike_3.x系列教程/Cobalt_Strike_钓鱼攻击/Cobalt_Strike_借助钓鱼页面搜集目标内网入口账号密码/Cobalt%20Strike%20%e7%bd%91%e9%a1%b5%e6%8c%82%e9%a9%ac_files/image4.png" width="560" height="361" alt="" style="border-width:0px;" /></span></p><p class="cs6FD73CFB"><span class="cs9C1B1871">如果此时目标由于粗心或者误操作</span><span class="cs8926E06">,</span><span class="cs9C1B1871">万一真的就执行了我们的</span><span class="cs8926E06"> hta payload,</span><span class="cs9C1B1871">那后果可想而知</span><span class="cs8926E06">,</span><span class="cs9C1B1871">实战中</span><span class="cs8926E06">,</span><span class="cs9C1B1871">我们肯定也不会去直接用</span><span class="cs8926E06"> bat,hta,vbs </span><span class="cs9C1B1871">或者</span><span class="cs8926E06"> exe </span><span class="cs9C1B1871">之类的敏感后缀</span><span class="cs8926E06">,</span><span class="cs9C1B1871">现在是个浏览器都会弹个很醒目的框提示你风险</span><span class="cs8926E06">,</span><span class="cs9C1B1871">这样目标一看到很可能就不会去点了</span><span class="cs8926E06">,</span><span class="cs9C1B1871">实际上弄个压缩包都比这个好</span><span class="cs8926E06">,</span><span class="cs9C1B1871">当然啦</span><span class="cs8926E06">,</span><span class="cs9C1B1871">我们此处的目的还是为了让大家对一些基础钓鱼流程有个最简单的认知即可</span><span class="cs8926E06">,</span><span class="cs9C1B1871">照顾到一些新手朋友</span><span class="cs8926E06">,</span><span class="cs9C1B1871">暂时不去涉及的太多</span></p><p class="cs40DD2BC9"><span><img src="安全工具/CobaltStrike/Cobalt_Strike_3.x系列教程/Cobalt_Strike_钓鱼攻击/Cobalt_Strike_借助钓鱼页面搜集目标内网入口账号密码/Cobalt%20Strike%20%e7%bd%91%e9%a1%b5%e6%8c%82%e9%a9%ac_files/image5.png" width="560" height="198" alt="" style="border-width:0px;" /></span></p><p class="cs6FD73CFB"><span class="cs9C1B1871">特别注意</span><span class="cs8926E06">,</span><span class="cs9C1B1871">如果目标是像上面那样执行的</span><span class="cs8926E06"> payload,</span><span class="cs9C1B1871">那么弹回的这个</span><span class="cs8926E06"> beacon shell </span><span class="cs9C1B1871">默认是没有被</span><span class="cs8926E06"> bypassUAC </span><span class="cs9C1B1871">的</span><span class="cs8926E06">,</span><span class="cs9C1B1871">也就是说</span><span class="cs8926E06">,</span><span class="cs9C1B1871">接下来会有很多特权操作我们是没法做的</span><span class="cs8926E06">,</span><span class="cs9C1B1871">比如</span><span class="cs8926E06">,</span><span class="cs9C1B1871">抓个明文密码或者</span><span class="cs8926E06"> hash,</span><span class="cs9C1B1871">所以</span><span class="cs8926E06">,</span><span class="cs9C1B1871">得想办法先</span><span class="cs8926E06"> bypass</span><span class="cs9C1B1871">一下</span><span class="cs8926E06"> UAC </span><span class="cs9C1B1871">才行</span><span class="cs8926E06">,</span><span class="cs9C1B1871">此处可以直接用</span><span class="cs8926E06"> cobaltstrike </span><span class="cs9C1B1871">自带的</span><span class="cs8926E06"> bypassUAC </span><span class="cs9C1B1871">功能来尝试弹回一个有真正管理权限的</span><span class="cs8926E06"> beacon shell,</span><span class="cs9C1B1871">当然啦</span><span class="cs8926E06">,</span><span class="cs9C1B1871">因为是入门学习</span><span class="cs8926E06">,</span><span class="cs9C1B1871">目标机器上没有任何防护杀毒</span><span class="cs8926E06">,</span><span class="cs9C1B1871">直接这样</span><span class="cs8926E06"> bypas </span><span class="cs9C1B1871">就可以把</span><span class="cs8926E06"> beacon </span><span class="cs9C1B1871">弹回来</span><span class="cs8926E06">,</span><span class="cs9C1B1871">但实战中</span><span class="cs8926E06">,</span><span class="cs9C1B1871">几乎是不可能的</span><span class="cs8926E06">,</span><span class="cs9C1B1871">杀软肯定会拦截类似的权限提升操作</span><span class="cs8926E06">,</span><span class="cs9C1B1871">弟兄们知道便可</span><span class="cs8926E06">,</span><span class="cs9C1B1871">先不用想那么多</span><span class="cs8926E06">,</span><span class="cs9C1B1871">如下</span></p><p class="cs40DD2BC9"><span><img src="安全工具/CobaltStrike/Cobalt_Strike_3.x系列教程/Cobalt_Strike_钓鱼攻击/Cobalt_Strike_借助钓鱼页面搜集目标内网入口账号密码/Cobalt%20Strike%20%e7%bd%91%e9%a1%b5%e6%8c%82%e9%a9%ac_files/image6.png" width="560" height="335" alt="" style="border-width:0px;" /></span></p><p class="cs6FD73CFB"><span class="cs9C1B1871">最后</span><span class="cs8926E06">,</span><span class="cs9C1B1871">我们不妨再来简单看下这个</span><span class="cs8926E06"> hta payload </span><span class="cs9C1B1871">里到底都是些什么东西</span><span class="cs8926E06">,</span><span class="cs9C1B1871">如下已经很明显了</span><span class="cs8926E06">,</span><span class="cs9C1B1871">其实就是利用</span><span class="cs8926E06"> vbs </span><span class="cs9C1B1871">来执行</span><span class="cs8926E06"> powershell payload,</span><span class="cs9C1B1871">跟我直接生成的</span><span class="cs8926E06"> powershell payload </span><span class="cs9C1B1871">并没有太大差别</span></p><p class="cs40DD2BC9"><span class="cs8926E06">&nbsp;</span></p></body>
</html>
