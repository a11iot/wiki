<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8" /><title>
		</title>
		<style type="text/css">
			.csAD577193{text-align:left;text-indent:0pt;margin:24pt 0pt 0pt 0pt;page-break-after:avoid;page-break-inside:avoid}
			.csDE05BCC{color:#4F81BD;background-color:transparent;font-family:Calibri;font-size:16pt;font-weight:bold;font-style:normal;}
			.csECDA2D3{color:#4F81BD;background-color:transparent;font-family:Microsoft YaHei UI;font-size:16pt;font-weight:bold;font-style:normal;}
			.cs868C439D{text-align:left;text-indent:0pt;margin:10pt 0pt 0pt 0pt;page-break-after:avoid;page-break-inside:avoid}
			.cs83F14626{color:#4F81BD;background-color:transparent;font-family:Microsoft YaHei UI;font-size:14pt;font-weight:bold;font-style:normal;}
			.cs40DD2BC9{text-align:left;text-indent:0pt;margin:9pt 0pt 9pt 0pt}
			.cs9C1B1871{color:#000000;background-color:transparent;font-family:Microsoft YaHei UI;font-size:12pt;font-weight:normal;font-style:normal;}
			.cs8926E06{color:#000000;background-color:transparent;font-family:Calibri;font-size:12pt;font-weight:normal;font-style:normal;}
			.cs3A447A38{text-align:left;text-indent:0pt;margin:0pt 0pt 10pt 0pt}
			.cs9FB05234{color:#000000;background-color:transparent;font-family:Consolas;font-size:11pt;font-weight:normal;font-style:normal;}
			.cs7FFD2630{color:#000000;background-color:transparent;font-family:Microsoft JhengHei UI;font-size:11pt;font-weight:normal;font-style:normal;}
			.cs508254C{color:#000000;background-color:transparent;font-family:Calibri;font-size:12pt;font-weight:normal;font-style:normal;text-decoration: none;}
			.cs4B51D5E4{color:#4F81BD;background-color:transparent;font-family:Calibri;font-size:12pt;font-weight:normal;font-style:normal;}
		</style>
	</head>
	<body>
		<h1 class="csAD577193">
			<a name="usualtoolcms-80-系统重装漏洞"><span class="csDE05BCC">UsualToolcms 8.0 </span><span class="csECDA2D3">系统重装漏洞</span></a></h1>
		<h2 class="cs868C439D">
			<a name="一、漏洞简介"><span class="cs83F14626">一、漏洞简介</span></a></h2>
		<p class="cs40DD2BC9"><span class="cs9C1B1871">无验证</span><span class="cs8926E06">, </span><span class="cs9C1B1871">在安装</span><span class="cs8926E06">cms</span><span class="cs9C1B1871">完成后</span><span class="cs8926E06"> </span><span class="cs9C1B1871">并不会自动删除文件</span><span class="cs8926E06"> </span><span class="cs9C1B1871">又不会生成</span><span class="cs8926E06">lock</span><span class="cs9C1B1871">来判断是否安装过了。</span><span class="cs8926E06"> </span><span class="cs9C1B1871">导致了可以直接重装过</span><span class="cs8926E06"> setup/index.php </span><span class="cs9C1B1871">安装地址</span></p><h2 class="cs868C439D">
			<a name="二、漏洞影响"><span class="cs83F14626">二、漏洞影响</span></a></h2>
		<p class="cs40DD2BC9"><span class="cs8926E06">UsualToolCMS</span><span class="cs9C1B1871">大众版</span><span class="cs8926E06">5.0</span></p><p class="cs40DD2BC9"><span class="cs8926E06">UsualToolcms 8.0</span></p><h2 class="cs868C439D">
			<a name="三、复现过程"><span class="cs83F14626">三、复现过程</span></a></h2>
		<p class="cs3A447A38"><span class="cs9FB05234">&lt;?php</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">$t=$_GET[&quot;t&quot;];</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">$l=$_GET[&quot;l&quot;];</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">$dbcontent=file_get_contents(&quot;../sql_db.php&quot;);</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">if($t==&quot;db&quot;){</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">$sqlcontent=$_POST[&quot;sqlcontent&quot;];</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">file_put_contents(&quot;../sql_db.php&quot;,$sqlcontent);</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">echo &quot;&lt;script&gt;alert(&#39;</span><span class="cs7FFD2630">数据库设置成功</span><span class="cs9FB05234">!&#39;);window.location.href=&#39;?l=sql&#39;&lt;/script&gt;&quot;;</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">}</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">if($t==&quot;testdb&quot;){</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">$dbhost=$_POST[&quot;dbhost&quot;];</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">$dbname=$_POST[&quot;dbname&quot;];</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">$dbuser=$_POST[&quot;dbuser&quot;];</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">$dbpass=$_POST[&quot;dbpass&quot;];</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">$mysqli=new mysqli($dbhost,$dbuser,$dbpass,$dbname);</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">echo &quot;&lt;script&gt;alert(&#39;</span><span class="cs7FFD2630">测试完成</span><span class="cs9FB05234">!&quot;.$mysqli-&gt;connect_error.&quot;&#39;);window.location.href=&#39;?l=sqlback&#39;&lt;/script&gt;&quot;;</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">}</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">if($t==&quot;sqlback&quot;){</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">include(&#39;../sql_db.php&#39;);</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">$sqlcontent=$_POST[&#39;sqlcontent&#39;];</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">$res=$mysqli -&gt; multi_query($sqlcontent);</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">echo &quot;&lt;script&gt;alert(&#39;</span><span class="cs7FFD2630">数据库结构规划完成</span><span class="cs9FB05234">!&#39;);window.location.href=&#39;?l=setup&#39;&lt;/script&gt;&quot;;</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">}</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">if($t==&quot;update&quot;){</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">include(&#39;../sql_db.php&#39;);</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">$authcode=$_POST[&quot;authcode&quot;];$webname=$_POST[&quot;webname&quot;];</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">$weblogo=$_POST[&quot;weblogo&quot;];</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">$weburl=$_POST[&quot;weburl&quot;];</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">$template=$_POST[&quot;template&quot;];</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">$webisclose=$_POST[&quot;webisclose&quot;];</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">$develop=$_POST[&quot;develop&quot;];</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">$articlelistnum=$_POST[&quot;articlelistnum&quot;];</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">$indexarticlenum=$_POST[&quot;indexarticlenum&quot;];</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">$indexarticlerenum=$_POST[&quot;indexarticlerenum&quot;];</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">$articlehitnum=$_POST[&quot;articlehitnum&quot;];</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">$goodslistnum=$_POST[&quot;goodslistnum&quot;];</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">$indexgoodsnum=$_POST[&quot;indexgoodsnum&quot;];</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">$indexgoodsrenum=$_POST[&quot;indexgoodsrenum&quot;];</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">$goodshitnum=$_POST[&quot;goodshitnum&quot;];</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">$article=$_POST[&quot;article&quot;];</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">$goods=$_POST[&quot;goods&quot;];</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">$messagebook=$_POST[&quot;messagebook&quot;];</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">$orders=$_POST[&quot;orders&quot;];</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">$members=$_POST[&quot;members&quot;];</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">$usercookname=$_POST[&quot;usercookname&quot;];</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">$sqls=&quot;INSERT INTO `cms_setup` (authcode,webname,weblogo,weburl,template,webisclose,develop,articlelistnum,indexarticlenum, indexarticlerenum,articlehitnum,goodslistnum,indexgoodsnum,indexgoodsrenum,goodshitnum,article,goods,messagebook,orders,members,usercookname,installtime) VALUES (&#39;$authcode&#39;,&#39;$webname&#39;,&#39;$weblogo&#39;,&#39;$weburl&#39;,&#39;$template&#39;,&#39;$webisclose&#39;,&#39;$develop&#39;,&#39;$articlelistnum&#39;,&#39;$indexarticlenum&#39;,&#39;$indexarticlerenum&#39;,&#39;$articlehitnum&#39;,&#39;$goodslistnum&#39;,&#39;$indexgoodsnum&#39;,&#39;$indexgoodsrenum&#39;,&#39;$goodshitnum&#39;,&#39;$article&#39;,&#39;$goods&#39;,&#39;$messagebook&#39;,&#39;$orders&#39;,&#39;$members&#39;,&#39;$usercookname&#39;,now())&quot;;</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">if ($mysqli-&gt;query($sqls) == TRUE) {</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">echo &quot;&lt;script&gt;alert(&#39;</span><span class="cs7FFD2630">基础设置完成</span><span class="cs9FB05234">!&#39;);window.location.href=&#39;?l=welcome&#39;&lt;/script&gt;&quot;;</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">}else{</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">echo &quot;&lt;script&gt;alert(&#39;</span><span class="cs7FFD2630">未设置成功</span><span class="cs9FB05234">!</span><span class="cs7FFD2630">请重填</span><span class="cs9FB05234">!&#39;);window.location.href=&#39;?l=setup&#39;&lt;/script&gt;&quot;;</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">}</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">}?&gt;</span></p><p class="cs40DD2BC9"><span class="cs8926E06">UsualToolcsm</span><span class="cs9C1B1871">需要先设置数据库账号密码才可以安装</span><span class="cs8926E06">sql_db.php</span><span class="cs9C1B1871">文件。</span></p><p class="cs40DD2BC9"><span class="cs9C1B1871">这边是判断数据库连接是否成功，</span></p><p class="cs40DD2BC9"><span class="cs9C1B1871">如果成功执行下一步，</span></p><p class="cs40DD2BC9"><span class="cs9C1B1871">如果不成功反回未设置成功</span><span class="cs8926E06">!</span><span class="cs9C1B1871">请重填</span></p><p class="cs40DD2BC9"><span class="cs8926E06">p:437-438</span></p><p class="cs40DD2BC9"><span class="cs9C1B1871">成功安装以后反回一个默认账号密码</span></p><p class="cs3A447A38"><span class="cs9FB05234">echo&quot;&lt;li&gt;&lt;span&gt;</span><span class="cs7FFD2630">后台默认账号</span><span class="cs9FB05234">: &lt;/span&gt;usualtool&lt;/li&gt;&quot;;</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">echo&quot;&lt;li&gt;&lt;span&gt;</span><span class="cs7FFD2630">后台默认密码</span><span class="cs9FB05234">: &lt;/span&gt;123456&lt;/li&gt;&quot;;</span></p><p class="cs40DD2BC9"><span class="cs9C1B1871">直接下一步就可以因为</span><span class="cs8926E06">sql_db.php</span><span class="cs9C1B1871">是提前设置好账号密码的</span></p><p class="cs40DD2BC9"><span class="cs8926E06"><a class="cs508254C" href="http://0-sec.org/UsualToolCMS/setup/"><span class="cs4B51D5E4">http://0-sec.org/UsualToolCMS/setup/</span></a></span></p><p class="cs40DD2BC9"><span class="cs8926E06">image</span></p></body>
</html>
