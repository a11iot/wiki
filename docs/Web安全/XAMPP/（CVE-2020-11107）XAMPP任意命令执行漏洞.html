<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8" /><title>
		</title>
		<style type="text/css">
			.csAD577193{text-align:left;text-indent:0pt;margin:24pt 0pt 0pt 0pt;page-break-after:avoid;page-break-inside:avoid}
			.csECDA2D3{color:#4F81BD;background-color:transparent;font-family:Microsoft YaHei UI;font-size:16pt;font-weight:bold;font-style:normal;}
			.csDE05BCC{color:#4F81BD;background-color:transparent;font-family:Calibri;font-size:16pt;font-weight:bold;font-style:normal;}
			.cs868C439D{text-align:left;text-indent:0pt;margin:10pt 0pt 0pt 0pt;page-break-after:avoid;page-break-inside:avoid}
			.cs83F14626{color:#4F81BD;background-color:transparent;font-family:Microsoft YaHei UI;font-size:14pt;font-weight:bold;font-style:normal;}
			.cs40DD2BC9{text-align:left;text-indent:0pt;margin:9pt 0pt 9pt 0pt}
			.cs9C1B1871{color:#000000;background-color:transparent;font-family:Microsoft YaHei UI;font-size:12pt;font-weight:normal;font-style:normal;}
			.cs8926E06{color:#000000;background-color:transparent;font-family:Calibri;font-size:12pt;font-weight:normal;font-style:normal;}
			.csE3F655E4{color:#000000;background-color:transparent;font-family:Microsoft YaHei UI;font-size:12pt;font-weight:bold;font-style:normal;}
			.cs1773D91F{text-align:left;margin:2pt 0pt 2pt 0pt;list-style-type:disc;color:#000000;background-color:transparent;font-family:Calibri;font-size:12pt;font-weight:normal;font-style:normal}
			.csD6CA00D2{color:#4F81BD;background-color:transparent;font-family:Microsoft YaHei UI;font-size:12pt;font-weight:bold;font-style:normal;}
			.cs5BEC2C28{color:#000000;background-color:transparent;font-family:Calibri;font-size:12pt;font-weight:bold;font-style:normal;}
			.cs6FD73CFB{text-align:left;text-indent:0pt;margin:5pt 24pt 5pt 24pt}
			.cs3A447A38{text-align:left;text-indent:0pt;margin:0pt 0pt 10pt 0pt}
			.cs9FB05234{color:#000000;background-color:transparent;font-family:Consolas;font-size:11pt;font-weight:normal;font-style:normal;}
		</style>
	</head>
	<body>
		<h1 class="csAD577193">
			<a name="cve-2020-11107xampp任意命令执行漏洞"><span class="csECDA2D3">（</span><span class="csDE05BCC">CVE-2020-11107</span><span class="csECDA2D3">）</span><span class="csDE05BCC">XAMPP</span><span class="csECDA2D3">任意命令执行漏洞</span></a></h1>
		<h2 class="cs868C439D">
			<a name="一漏洞简介"><span class="cs83F14626">一、漏洞简介</span></a></h2>
		<p class="cs40DD2BC9"><span class="cs9C1B1871">在</span><span class="cs8926E06">windows</span><span class="cs9C1B1871">下，</span><span class="cs8926E06">XAMPP</span><span class="cs9C1B1871">允许非管理员账号访问和修改其编辑器和浏览器的配置，编辑器的默认配置为</span><span class="cs8926E06">notepad.exe</span><span class="cs9C1B1871">，一旦修改配置后，则对应的每个可以访问</span><span class="cs8926E06">XAMPP</span><span class="cs9C1B1871">控制面板的用户都更改了配置。当攻击者将编辑器的值设置为恶意的</span><span class="cs8926E06">.exe</span><span class="cs9C1B1871">文件或</span><span class="cs8926E06">.bat</span><span class="cs9C1B1871">文件，与此同时如果有管理员账号通过</span><span class="cs8926E06">XAMPP</span><span class="cs9C1B1871">控制面板查看</span><span class="cs8926E06">apache</span><span class="cs9C1B1871">的日志文件，便会执行恶意的</span><span class="cs8926E06">.exe</span><span class="cs9C1B1871">文件或</span><span class="cs8926E06">.bat</span><span class="cs9C1B1871">文件，以此达到任意命令执行。</span></p><p class="cs40DD2BC9"><span class="csE3F655E4">利用条件</span></p><ul style="margin-top:0;margin-bottom:0;">
			<li class="cs1773D91F"><span class="cs8926E06">1</span><span class="cs9C1B1871">：</span><span class="cs8926E06">windows</span><span class="cs9C1B1871">系统、</span></li><li class="cs1773D91F"><span class="cs8926E06">2</span><span class="cs9C1B1871">：装有</span><span class="cs8926E06">XAMPP</span><span class="cs9C1B1871">、</span></li><li class="cs1773D91F"><span class="cs8926E06">3</span><span class="cs9C1B1871">：拥有系统普通账户、</span></li><li class="cs1773D91F"><span class="cs8926E06">4</span><span class="cs9C1B1871">：管理员账户通过</span><span class="cs8926E06">XAMPP</span><span class="cs9C1B1871">面板查看</span><span class="cs8926E06">logs</span><span class="cs9C1B1871">文件。</span></li></ul>
		<h2 class="cs868C439D">
			<a name="二漏洞影响"><span class="cs83F14626">二、漏洞影响</span></a></h2>
		<p class="cs40DD2BC9"><span class="cs8926E06">Apache Friends XAMPP &lt;7.2.29</span></p><p class="cs40DD2BC9"><span class="cs8926E06">Apache Friends XAMPP 7.3.*</span><span class="cs9C1B1871">，</span><span class="cs8926E06">&lt;7.3.16</span></p><p class="cs40DD2BC9"><span class="cs8926E06">Apache Friends XAMPP 7.4.*</span><span class="cs9C1B1871">，</span><span class="cs8926E06">&lt;7.4.4</span></p><h2 class="cs868C439D">
			<a name="三复现过程"><span class="cs83F14626">三、复现过程</span></a></h2>
		<h3 class="cs868C439D">
			<a name="环境安装"><span class="csD6CA00D2">环境安装</span></a></h3>
		<p class="cs40DD2BC9"><span class="csE3F655E4">第一部分：首先以管理员身份登录到</span><span class="cs5BEC2C28">windows10</span><span class="csE3F655E4">：</span></p><p class="cs6FD73CFB"><span class="cs9C1B1871">运行</span><span class="cs8926E06">cmd</span><span class="cs9C1B1871">查看当前用户，这里的</span><span class="cs8926E06">Scarlett</span><span class="cs9C1B1871">即登录的有管理员权限的账户：</span></p><p class="cs40DD2BC9"><span><img src="Web安全/XAMPP/%ef%bc%88CVE-2020-11107%ef%bc%89XAMPP%e4%bb%bb%e6%84%8f%e5%91%bd%e4%bb%a4%e6%89%a7%e8%a1%8c%e6%bc%8f%e6%b4%9e_files/image0.png" width="560" height="526" alt="" style="border-width:0px;" /></span></p><p class="cs6FD73CFB"><span class="cs9C1B1871">安装</span><span class="cs8926E06">XAMPP</span><span class="cs9C1B1871">，注意要使用管理员权限进行安装，根据提示不要装在</span><span class="cs8926E06">C</span><span class="cs9C1B1871">盘，本次复现安装在</span><span class="cs8926E06">D</span><span class="cs9C1B1871">盘，其他按照默认安装即可，最后安装完成如下图所示：</span></p><p class="cs40DD2BC9"><span><img src="Web安全/XAMPP/%ef%bc%88CVE-2020-11107%ef%bc%89XAMPP%e4%bb%bb%e6%84%8f%e5%91%bd%e4%bb%a4%e6%89%a7%e8%a1%8c%e6%bc%8f%e6%b4%9e_files/image1.png" width="560" height="373" alt="" style="border-width:0px;" /></span></p><p class="cs6FD73CFB"><span class="cs9C1B1871">运行</span><span class="cs8926E06">cmd</span><span class="cs9C1B1871">，输入如下命令：</span><span class="cs8926E06">powershell start-process cmd -verb runas </span><span class="cs9C1B1871">（用</span><span class="cs8926E06">powershell</span><span class="cs9C1B1871">启动管理员权限的</span><span class="cs8926E06">cmd</span><span class="cs9C1B1871">进程），在管理员权限的</span><span class="cs8926E06">cmd</span><span class="cs9C1B1871">上，输入：</span><span class="cs8926E06">net user lowuser /add</span><span class="cs9C1B1871">，创建一个普通账号</span><span class="cs8926E06">lowuser</span><span class="cs9C1B1871">，通过</span><span class="cs8926E06">net user lowuser </span><span class="cs9C1B1871">可知为普通权限账号：</span></p><p class="cs40DD2BC9"><span><img src="Web安全/XAMPP/%ef%bc%88CVE-2020-11107%ef%bc%89XAMPP%e4%bb%bb%e6%84%8f%e5%91%bd%e4%bb%a4%e6%89%a7%e8%a1%8c%e6%bc%8f%e6%b4%9e_files/image2.png" width="560" height="568" alt="" style="border-width:0px;" /></span></p><p class="cs6FD73CFB"><span class="cs9C1B1871">输入命令</span><span class="cs8926E06">net user lowuser * </span><span class="cs9C1B1871">为</span><span class="cs8926E06">lowuser</span><span class="cs9C1B1871">设置密码：</span></p><p class="cs40DD2BC9"><span><img src="Web安全/XAMPP/%ef%bc%88CVE-2020-11107%ef%bc%89XAMPP%e4%bb%bb%e6%84%8f%e5%91%bd%e4%bb%a4%e6%89%a7%e8%a1%8c%e6%bc%8f%e6%b4%9e_files/image3.png" width="560" height="166" alt="" style="border-width:0px;" /></span></p><p class="cs6FD73CFB"><span class="cs9C1B1871">关闭</span><span class="cs8926E06">cmd</span><span class="cs9C1B1871">命令窗口，注销管理员权限的</span><span class="cs8926E06">Scarlett</span><span class="cs9C1B1871">账户。</span></p><p class="cs40DD2BC9"><span><img src="Web安全/XAMPP/%ef%bc%88CVE-2020-11107%ef%bc%89XAMPP%e4%bb%bb%e6%84%8f%e5%91%bd%e4%bb%a4%e6%89%a7%e8%a1%8c%e6%bc%8f%e6%b4%9e_files/image4.png" width="475" height="543" alt="" style="border-width:0px;" /></span></p><h3 class="cs868C439D">
			<a name="漏洞复现"><span class="csD6CA00D2">漏洞复现</span></a></h3>
		<p class="cs40DD2BC9"><span class="csE3F655E4">以普通账号</span><span class="cs5BEC2C28">lowuser</span><span class="csE3F655E4">登录到</span><span class="cs5BEC2C28">windows10</span><span class="csE3F655E4">：</span></p><p class="cs6FD73CFB"><span class="cs9C1B1871">输入上面第</span><span class="cs8926E06">4</span><span class="cs9C1B1871">步设置的密码，登录</span><span class="cs8926E06">lowuser</span><span class="cs9C1B1871">账户：</span></p><p class="cs40DD2BC9"><span><img src="Web安全/XAMPP/%ef%bc%88CVE-2020-11107%ef%bc%89XAMPP%e4%bb%bb%e6%84%8f%e5%91%bd%e4%bb%a4%e6%89%a7%e8%a1%8c%e6%bc%8f%e6%b4%9e_files/image5.png" width="560" height="339" alt="" style="border-width:0px;" /></span></p><p class="cs6FD73CFB"><span class="cs9C1B1871">设置显示文件扩展名和隐藏项目：</span></p><p class="cs40DD2BC9"><span><img src="Web安全/XAMPP/%ef%bc%88CVE-2020-11107%ef%bc%89XAMPP%e4%bb%bb%e6%84%8f%e5%91%bd%e4%bb%a4%e6%89%a7%e8%a1%8c%e6%bc%8f%e6%b4%9e_files/image6.png" width="560" height="94" alt="" style="border-width:0px;" /></span></p><p class="cs6FD73CFB"><span class="cs9C1B1871">创建</span><span class="cs8926E06">command.bat</span><span class="cs9C1B1871">文件，输入命令如下，其作用是将</span><span class="cs8926E06">lowuser</span><span class="cs9C1B1871">账号加入管理员权限：</span></p><p class="cs3A447A38"><span class="cs9FB05234">@echo off </span><span class="cs8926E06"><br/></span><span class="cs9FB05234">net localgroup administrators lowuser /add</span></p><p class="cs40DD2BC9"><span><img src="Web安全/XAMPP/%ef%bc%88CVE-2020-11107%ef%bc%89XAMPP%e4%bb%bb%e6%84%8f%e5%91%bd%e4%bb%a4%e6%89%a7%e8%a1%8c%e6%bc%8f%e6%b4%9e_files/image7.png" width="560" height="153" alt="" style="border-width:0px;" /></span></p><p class="cs6FD73CFB"><span class="cs9C1B1871">运行</span><span class="cs8926E06">xampp</span><span class="cs9C1B1871">，并在控制面板上找到</span><span class="cs8926E06">config</span><span class="cs9C1B1871">配置。</span></p><p class="cs40DD2BC9"><span><img src="Web安全/XAMPP/%ef%bc%88CVE-2020-11107%ef%bc%89XAMPP%e4%bb%bb%e6%84%8f%e5%91%bd%e4%bb%a4%e6%89%a7%e8%a1%8c%e6%bc%8f%e6%b4%9e_files/image8.png" width="560" height="380" alt="" style="border-width:0px;" /></span></p><p class="cs6FD73CFB"><span class="cs9C1B1871">修改编辑器的默认配置，更改为刚才创建的</span><span class="cs8926E06">command.bat</span><span class="cs9C1B1871">文件，添加并应用，如下图所示：</span></p><p class="cs40DD2BC9"><span><img src="Web安全/XAMPP/%ef%bc%88CVE-2020-11107%ef%bc%89XAMPP%e4%bb%bb%e6%84%8f%e5%91%bd%e4%bb%a4%e6%89%a7%e8%a1%8c%e6%bc%8f%e6%b4%9e_files/image9.png" width="560" height="249" alt="" style="border-width:0px;" /></span></p><p class="cs6FD73CFB"><span class="cs9C1B1871">查看</span><span class="cs8926E06">lowuser</span><span class="cs9C1B1871">的用户组，还是普通权限，注销</span><span class="cs8926E06">lowuser</span><span class="cs9C1B1871">账户。</span></p><p class="cs40DD2BC9"><span><img src="Web安全/XAMPP/%ef%bc%88CVE-2020-11107%ef%bc%89XAMPP%e4%bb%bb%e6%84%8f%e5%91%bd%e4%bb%a4%e6%89%a7%e8%a1%8c%e6%bc%8f%e6%b4%9e_files/image10.png" width="560" height="381" alt="" style="border-width:0px;" /></span></p><p class="cs40DD2BC9"><span class="csE3F655E4">再次以管理员（</span><span class="cs5BEC2C28">Scarlett</span><span class="csE3F655E4">）登录到</span><span class="cs5BEC2C28">windows10</span><span class="csE3F655E4">：</span></p><p class="cs6FD73CFB"><span class="cs9C1B1871">打开</span><span class="cs8926E06">XAMPP</span><span class="cs9C1B1871">控制面板，点击查看</span><span class="cs8926E06">logs</span><span class="cs9C1B1871">文件：</span></p><p class="cs40DD2BC9"><span><img src="Web安全/XAMPP/%ef%bc%88CVE-2020-11107%ef%bc%89XAMPP%e4%bb%bb%e6%84%8f%e5%91%bd%e4%bb%a4%e6%89%a7%e8%a1%8c%e6%bc%8f%e6%b4%9e_files/image0.gif" width="560" height="348" alt="" style="border-width:0px;" /></span></p><p class="cs40DD2BC9"><span class="csE3F655E4">切换到</span><span class="cs5BEC2C28">lowuser</span><span class="csE3F655E4">账户：</span></p><p class="cs6FD73CFB"><span class="cs9C1B1871">运行</span><span class="cs8926E06">cmd</span><span class="cs9C1B1871">，查看</span><span class="cs8926E06">lowuser</span><span class="cs9C1B1871">用户组，发现已经提升为</span><span class="cs8926E06">administators</span><span class="cs9C1B1871">组：</span></p><p class="cs40DD2BC9"><span><img src="Web安全/XAMPP/%ef%bc%88CVE-2020-11107%ef%bc%89XAMPP%e4%bb%bb%e6%84%8f%e5%91%bd%e4%bb%a4%e6%89%a7%e8%a1%8c%e6%bc%8f%e6%b4%9e_files/image11.png" width="560" height="528" alt="" style="border-width:0px;" /></span></p><h2 class="cs868C439D">
			<a name="参考链接"><span class="cs83F14626">参考链接</span></a></h2>
		<p class="cs6FD73CFB"><span class="cs8926E06">https://mp.weixin.qq.com/s?__biz=MzU1ODg3NTMyMQ==&amp;mid=2247490782&amp;idx=1&amp;sn=3c5843a34f4415e25bc0c21388c0e03a&amp;chksm=fc1e8b08cb69021e7da183a3c9e0750cf51f9856fb647eea1f103f41bea609c64f10c9553364&amp;mpshare=1&amp;scene=1&amp;srcid=&amp;sharer_sharetime=1587143054964&amp;sharer_shareid=346bf064ccfaeb680ec3e1af3a4fc9a8&amp;key=64daf1adc09d7c6e5cfb777986ec80c9619f47ef9565c6f0252270416251ea412f230e87b1ec8f3435bc4fb2a9a7b5cfaef4e5e24f07f4ca67b17c37a019205e77237996ec31a74ff713a0436cb2a3a9&amp;ascene=1&amp;uin=MTU0OTU5NDkzMA==&amp;devicetype=Windows+10+x64&amp;version=6209005d&amp;lang=zh_CN&amp;exportkey=AWykz1/C4yy1gXuSSIh8VsI=&amp;pass_ticket=CsmWLKOnF5M0Q2QFomZUfTPJMWXGf5jEVxKfIZtVeWb8bpfTluZvRRNsuVmT2X9Z</span></p></body>
</html>
