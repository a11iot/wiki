<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8" /><title>
		</title>
		<style type="text/css">
			.csAD577193{text-align:left;text-indent:0pt;margin:24pt 0pt 0pt 0pt;page-break-after:avoid;page-break-inside:avoid}
			.csECDA2D3{color:#4F81BD;background-color:transparent;font-family:Microsoft YaHei UI;font-size:16pt;font-weight:bold;font-style:normal;}
			.csDE05BCC{color:#4F81BD;background-color:transparent;font-family:Calibri;font-size:16pt;font-weight:bold;font-style:normal;}
			.cs868C439D{text-align:left;text-indent:0pt;margin:10pt 0pt 0pt 0pt;page-break-after:avoid;page-break-inside:avoid}
			.cs83F14626{color:#4F81BD;background-color:transparent;font-family:Microsoft YaHei UI;font-size:14pt;font-weight:bold;font-style:normal;}
			.cs40DD2BC9{text-align:left;text-indent:0pt;margin:9pt 0pt 9pt 0pt}
			.cs9C1B1871{color:#000000;background-color:transparent;font-family:Microsoft YaHei UI;font-size:12pt;font-weight:normal;font-style:normal;}
			.cs8926E06{color:#000000;background-color:transparent;font-family:Calibri;font-size:12pt;font-weight:normal;font-style:normal;}
			.csD6CA00D2{color:#4F81BD;background-color:transparent;font-family:Microsoft YaHei UI;font-size:12pt;font-weight:bold;font-style:normal;}
			.cs3A447A38{text-align:left;text-indent:0pt;margin:0pt 0pt 10pt 0pt}
			.cs9FB05234{color:#000000;background-color:transparent;font-family:Consolas;font-size:11pt;font-weight:normal;font-style:normal;}
			.cs7FFD2630{color:#000000;background-color:transparent;font-family:Microsoft JhengHei UI;font-size:11pt;font-weight:normal;font-style:normal;}
		</style>
	</head>
	<body>
		<h1 class="csAD577193">
			<a name="ssv-97074dedecms-前台任意用户密码修改"><span class="csECDA2D3">（</span><span class="csDE05BCC">SSV-97074</span><span class="csECDA2D3">）</span><span class="csDE05BCC">DeDecms </span><span class="csECDA2D3">前台任意用户密码修改</span></a></h1>
		<h2 class="cs868C439D">
			<a name="一漏洞简介"><span class="cs83F14626">一、漏洞简介</span></a></h2>
		<p class="cs40DD2BC9"><span class="cs9C1B1871">无</span><span class="cs8926E06">CVE</span><span class="cs9C1B1871">，</span><span class="cs8926E06"> SSV-97074</span><span class="cs9C1B1871">，提交时间：</span><span class="cs8926E06">20180110</span></p><p class="cs40DD2BC9"><span class="cs9C1B1871">在用户密码重置功能处，</span><span class="cs8926E06">php</span><span class="cs9C1B1871">存在弱类型比较，导致如果用户没有设置密保问题的情况下可以绕过验证密保问题，直接修改密码</span><span class="cs8926E06">(</span><span class="cs9C1B1871">管理员账户默认不设置密保问题</span><span class="cs8926E06">)</span><span class="cs9C1B1871">。值得注意的是修改的密码是</span><span class="cs8926E06">member</span><span class="cs9C1B1871">表中的密码，即使修改了管理员密码也是</span><span class="cs8926E06">member</span><span class="cs9C1B1871">表中的管理员密码，仍是无法进入管理</span></p><h2 class="cs868C439D">
			<a name="二漏洞影响"><span class="cs83F14626">二、漏洞影响</span></a></h2>
		<h2 class="cs868C439D">
			<a name="三复现过程"><span class="cs83F14626">三、复现过程</span></a></h2>
		<h3 class="cs868C439D">
			<a name="代码分析"><span class="csD6CA00D2">代码分析</span></a></h3>
		<p class="cs40DD2BC9"><span class="cs8926E06">php</span><span class="cs9C1B1871">弱类型比较问题很常见，在不同类型比较时，如果使用的是</span><span class="cs8926E06">==</span><span class="cs9C1B1871">，</span><span class="cs8926E06">php</span><span class="cs9C1B1871">会将其中一个数据进行强制转换为另一个，比如</span><span class="cs8926E06">&rsquo;123a&rsquo;</span><span class="cs9C1B1871">就会被强制转换成</span><span class="cs8926E06">123</span><span class="cs9C1B1871">。这样就出现了弱类型比较问题，当然如果使用</span><span class="cs8926E06">===</span><span class="cs9C1B1871">判断比较就不会出现问题了。常见比较如下</span></p><p class="cs3A447A38"><span class="cs9FB05234">&#39;&#39; == 0 == false &#39;123&#39; == 123 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&#39;123&#39;</span><span class="cs7FFD2630">强制转换为</span><span class="cs9FB05234">123 </span><span class="cs8926E06"><br/></span><span class="cs9FB05234">&#39;abc&#39; == 0</span><span class="cs7FFD2630">　</span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//intval(&#39;abc&#39;)==0 </span><span class="cs8926E06"><br/></span><span class="cs9FB05234">&#39;123a&#39; == 123 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//intval(&#39;123a&#39;)==123 </span><span class="cs8926E06"><br/></span><span class="cs9FB05234">&#39;0x01&#39; == 1 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//</span><span class="cs7FFD2630">被识别为十六进制</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">&#39;0e123456789&#39; == &#39;0e987654321&#39;</span><span class="cs7FFD2630">　　</span><span class="cs9FB05234">//</span><span class="cs7FFD2630">被识别为科学计数法</span><span class="cs9FB05234"> </span><span class="cs8926E06"><br/></span><span class="cs9FB05234">[false] == [0] == [NULL] == [&#39;&#39;] </span><span class="cs8926E06"><br/></span><span class="cs9FB05234">NULL == false == 0 </span><span class="cs8926E06"><br/></span><span class="cs9FB05234">true == 1</span></p><p class="cs40DD2BC9"><span class="cs8926E06">dedecms</span><span class="cs9C1B1871">的</span><span class="cs8926E06">/member/resetpassword.php</span><span class="cs9C1B1871">就是用来处理用户密码重置的问题，问题出在</span><span class="cs8926E06">75</span><span class="cs9C1B1871">行开始处理验证密保问题处。</span></p><p class="cs3A447A38"><span class="cs9FB05234">else if($dopost == &quot;safequestion&quot;)</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">{</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;$mid = preg_replace(&quot;#[^0-9]#&quot;, &quot;&quot;, $id);</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;$sql = &quot;SELECT safequestion,safeanswer,userid,email FROM #@__member WHERE mid = &#39;$mid&#39;&quot;;</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;$row = $db-&gt;GetOne($sql);</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;if(empty($safequestion)) $safequestion = &#39;&#39;;</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> </span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;if(empty($safeanswer)) $safeanswer = &#39;&#39;;</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> </span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;if($row[&#39;safequestion&#39;] == $safequestion &amp;&amp; $row[&#39;safeanswer&#39;] == $safeanswer)</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;{</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sn($mid, $row[&#39;userid&#39;], $row[&#39;email&#39;], &#39;N&#39;);</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;exit();</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;}</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;else</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;{</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ShowMsg(&quot;</span><span class="cs7FFD2630">对不起，您的安全问题或答案回答错误</span><span class="cs9FB05234">&quot;,&quot;-1&quot;);</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;exit();</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;}</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> </span><span class="cs8926E06"><br/></span><span class="cs9FB05234">}</span></p><p class="cs40DD2BC9"><span class="cs9C1B1871">可以看到，这段代码先是从数据库取出相关用户的密保问题及密保答案，在对用户输入做了一些处理后，进行了关键性的判断</span><span class="cs8926E06">if($row[&#39;safequestion&#39;] == $safequestion &amp;&amp; $row[&#39;safeanswer&#39;] == $safeanswer) </span><span class="cs9C1B1871">，就在这里用了弱类型判断</span><span class="cs8926E06">==</span><span class="cs9C1B1871">。</span></p><p class="cs40DD2BC9"><span class="cs9C1B1871">首先我们知道，如果没有设置密保的话</span><span class="cs8926E06">safequestion</span><span class="cs9C1B1871">从数据库取出默认为</span><span class="cs8926E06">&rsquo;0&rsquo;</span><span class="cs9C1B1871">，</span><span class="cs8926E06">safeanswer</span><span class="cs9C1B1871">为空。根据</span><span class="cs8926E06">empty</span><span class="cs9C1B1871">函数特性，</span><span class="cs8926E06">&rsquo;0&rsquo;</span><span class="cs9C1B1871">会被判断为空，会进入重新将</span><span class="cs8926E06">$safequestion</span><span class="cs9C1B1871">赋值为</span><span class="cs8926E06">&rsquo;&rsquo;</span><span class="cs9C1B1871">。而</span><span class="cs8926E06">&#39;0&#39; != &#39;&#39; </span><span class="cs9C1B1871">，所以我们需要一个输入即不使</span><span class="cs8926E06">empty</span><span class="cs9C1B1871">为空，且弱类型等于</span><span class="cs8926E06">&rsquo;0&rsquo;</span><span class="cs9C1B1871">的字符串。</span><span class="cs8926E06">&#39;00&#39;</span><span class="cs9C1B1871">、</span><span class="cs8926E06">&#39;000&#39;</span><span class="cs9C1B1871">、</span><span class="cs8926E06">&#39;0.0&#39;</span><span class="cs9C1B1871">以上这些都是可以的。</span></p><p class="cs40DD2BC9"><span class="cs9C1B1871">接下来</span><span class="cs8926E06">safeanswer</span><span class="cs9C1B1871">既然本来就为空，那么不输入正好也就相等了。跟踪</span><span class="cs8926E06">sn</span><span class="cs9C1B1871">函数</span></p><p class="cs3A447A38"><span class="cs9FB05234">function sn($mid,$userid,$mailto, $send = &#39;Y&#39;)</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">{</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;global $db;</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;$tptim= (60*10);</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;$dtime = time();</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;$sql = &quot;SELECT * FROM #@__pwd_tmp WHERE mid = &#39;$mid&#39;&quot;;</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;$row = $db-&gt;GetOne($sql);</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;if(!is_array($row))</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;{</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//</span><span class="cs7FFD2630">发送新邮件；</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;newmail($mid,$userid,$mailto,&#39;INSERT&#39;,$send);</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;}</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;//10</span><span class="cs7FFD2630">分钟后可以再次发送新验证码；</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;elseif($dtime - $tptim &gt; $row[&#39;mailtime&#39;])</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;{</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;newmail($mid,$userid,$mailto,&#39;UPDATE&#39;,$send);</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;}</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;//</span><span class="cs7FFD2630">重新发送新的验证码确认邮件；</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;else</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;{</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return ShowMsg(&#39;</span><span class="cs7FFD2630">对不起，请</span><span class="cs9FB05234">10</span><span class="cs7FFD2630">分钟后再重新申请</span><span class="cs9FB05234">&#39;, &#39;login.php&#39;);</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;}</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">}</span></p><p class="cs40DD2BC9"><span class="cs9C1B1871">跟踪</span><span class="cs8926E06">newmail</span></p><p class="cs3A447A38"><span class="cs9FB05234">function newmail($mid, $userid, $mailto, $type, $send)</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">{</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;global $db,$cfg_adminemail,$cfg_webname,$cfg_basehost,$cfg_memberurl;</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;$mailtime = time();</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;$randval = random(8);</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;$mailtitle = $cfg_webname.&quot;:</span><span class="cs7FFD2630">密码修改</span><span class="cs9FB05234">&quot;;</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;$mailto = $mailto;</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;$headers = &quot;From: &quot;.$cfg_adminemail.&quot;\r\nReply-To: $cfg_adminemail&quot;;</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;$mailbody = &quot;</span><span class="cs7FFD2630">亲爱的</span><span class="cs9FB05234">&quot;.$userid.&quot;</span><span class="cs7FFD2630">：</span><span class="cs9FB05234">\r\n</span><span class="cs7FFD2630">您好！感谢您使用</span><span class="cs9FB05234">&quot;.$cfg_webname.&quot;</span><span class="cs7FFD2630">网。</span><span class="cs9FB05234">\r\n&quot;.$cfg_webname.&quot;</span><span class="cs7FFD2630">应您的要求，重新设置密码：（注：如果您没有提出申请，请检查您的信息是否泄漏。）</span><span class="cs9FB05234">\r\n</span><span class="cs7FFD2630">本次临时登陆密码为：</span><span class="cs9FB05234">&quot;.$randval.&quot; </span><span class="cs7FFD2630">请于三天内登陆下面网址确认修改。</span><span class="cs9FB05234">\r\n&quot;.$cfg_basehost.$cfg_memberurl.&quot;/resetpassword.php?dopost=getpasswd&amp;id=&quot;.$mid;</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;if($type == &#39;INSERT&#39;)</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;{</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$key = md5($randval);</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$sql = &quot;INSERT INTO `#@__pwd_tmp` (`mid` ,`membername` ,`pwd` ,`mailtime`)VALUES (&#39;$mid&#39;, &#39;$userid&#39;, &nbsp;&#39;$key&#39;, &#39;$mailtime&#39;);&quot;;</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if($db-&gt;ExecuteNoneQuery($sql))</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if($send == &#39;Y&#39;)</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sendmail($mailto,$mailtitle,$mailbody,$headers);</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return ShowMsg(&#39;EMAIL</span><span class="cs7FFD2630">修改验证码已经发送到原来的邮箱请查收</span><span class="cs9FB05234">&#39;, &#39;login.php&#39;,&#39;&#39;,&#39;5000&#39;);</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} else if ($send == &#39;N&#39;)</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return ShowMsg(&#39;</span><span class="cs7FFD2630">稍后跳转到修改页</span><span class="cs9FB05234">&#39;, $cfg_basehost.$cfg_memberurl.&quot;/resetpassword.php?dopost=getpasswd&amp;amp;id=&quot;.$mid.&quot;&amp;amp;key=&quot;.$randval);</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return ShowMsg(&#39;</span><span class="cs7FFD2630">对不起修改失败，请联系管理员</span><span class="cs9FB05234">&#39;, &#39;login.php&#39;);</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;}</span></p><p class="cs40DD2BC9"><span class="cs9C1B1871">可见在</span><span class="cs8926E06">sn</span><span class="cs9C1B1871">函数中将</span><span class="cs8926E06">send</span><span class="cs9C1B1871">参数设置了</span><span class="cs8926E06">&rsquo;N&rsquo;</span><span class="cs9C1B1871">，其实就是生成了暂时密码并插入了数据库中，并进行跳转：</span></p><p class="cs3A447A38"><span class="cs9FB05234">else if ($send == &#39;N&#39;)</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">{</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;return ShowMsg(&#39;</span><span class="cs7FFD2630">稍后跳转到修改页</span><span class="cs9FB05234">&#39;, $cfg_basehost.$cfg_memberurl.&quot;/resetpassword.php?dopost=getpasswd&amp;amp;id=&quot;.$mid.&quot;&amp;amp;key=&quot;.$randval);</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">}</span></p><h3 class="cs868C439D">
			<a name="复现"><span class="csD6CA00D2">复现</span></a></h3>
		<p class="cs40DD2BC9"><span class="cs9C1B1871">在找回密码处，点击通过安全问题取回。</span></p><p class="cs40DD2BC9"><span><img src="Web安全/Dedecms/%e3%80%90%e5%bc%80%e5%90%af%e4%bc%9a%e5%91%98%e6%b3%a8%e5%86%8c%e3%80%91%ef%bc%88SSV-97074%ef%bc%89DeDecms%20%e5%89%8d%e5%8f%b0%e4%bb%bb%e6%84%8f%e7%94%a8%e6%88%b7%e5%af%86%e7%a0%81%e4%bf%ae%e6%94%b9_files/image0.png" width="560" height="382" alt="" style="border-width:0px;" /></span></p><p class="cs40DD2BC9"><span class="cs9C1B1871">填写信息并抓包，修改</span><span class="cs8926E06">id</span><span class="cs9C1B1871">和</span><span class="cs8926E06">userid</span><span class="cs9C1B1871">为想要重置密码的对象，再加上以上分析内容，发包即可得到修改密码</span><span class="cs8926E06">url</span></p><p class="cs40DD2BC9"><span><img src="Web安全/Dedecms/%e3%80%90%e5%bc%80%e5%90%af%e4%bc%9a%e5%91%98%e6%b3%a8%e5%86%8c%e3%80%91%ef%bc%88SSV-97074%ef%bc%89DeDecms%20%e5%89%8d%e5%8f%b0%e4%bb%bb%e6%84%8f%e7%94%a8%e6%88%b7%e5%af%86%e7%a0%81%e4%bf%ae%e6%94%b9_files/image1.png" width="560" height="491" alt="" style="border-width:0px;" /></span></p><p class="cs40DD2BC9"><span class="cs9C1B1871">进入该</span><span class="cs8926E06">url</span><span class="cs9C1B1871">，修改密码。</span></p><p class="cs40DD2BC9"><span><img src="Web安全/Dedecms/%e3%80%90%e5%bc%80%e5%90%af%e4%bc%9a%e5%91%98%e6%b3%a8%e5%86%8c%e3%80%91%ef%bc%88SSV-97074%ef%bc%89DeDecms%20%e5%89%8d%e5%8f%b0%e4%bb%bb%e6%84%8f%e7%94%a8%e6%88%b7%e5%af%86%e7%a0%81%e4%bf%ae%e6%94%b9_files/image2.png" width="560" height="232" alt="" style="border-width:0px;" /></span></p></body>
</html>
