<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8" /><title>
		</title>
		<style type="text/css">
			.csAD577193{text-align:left;text-indent:0pt;margin:24pt 0pt 0pt 0pt;page-break-after:avoid;page-break-inside:avoid}
			.csECDA2D3{color:#4F81BD;background-color:transparent;font-family:Microsoft YaHei UI;font-size:16pt;font-weight:bold;font-style:normal;}
			.csDE05BCC{color:#4F81BD;background-color:transparent;font-family:Calibri;font-size:16pt;font-weight:bold;font-style:normal;}
			.cs868C439D{text-align:left;text-indent:0pt;margin:10pt 0pt 0pt 0pt;page-break-after:avoid;page-break-inside:avoid}
			.cs83F14626{color:#4F81BD;background-color:transparent;font-family:Microsoft YaHei UI;font-size:14pt;font-weight:bold;font-style:normal;}
			.cs40DD2BC9{text-align:left;text-indent:0pt;margin:9pt 0pt 9pt 0pt}
			.cs9C1B1871{color:#000000;background-color:transparent;font-family:Microsoft YaHei UI;font-size:12pt;font-weight:normal;font-style:normal;}
			.cs8926E06{color:#000000;background-color:transparent;font-family:Calibri;font-size:12pt;font-weight:normal;font-style:normal;}
			.csD6CA00D2{color:#4F81BD;background-color:transparent;font-family:Microsoft YaHei UI;font-size:12pt;font-weight:bold;font-style:normal;}
			.cs3A447A38{text-align:left;text-indent:0pt;margin:0pt 0pt 10pt 0pt}
			.cs9FB05234{color:#000000;background-color:transparent;font-family:Consolas;font-size:11pt;font-weight:normal;font-style:normal;}
			.cs7FFD2630{color:#000000;background-color:transparent;font-family:Microsoft JhengHei UI;font-size:11pt;font-weight:normal;font-style:normal;}
		</style>
	</head>
	<body>
		<h1 class="csAD577193">
			<a name="Xc7754b28755867a5b77da8b55ad1eb9c11984e1"><span class="csECDA2D3">（</span><span class="csDE05BCC">CVE-2019-18622</span><span class="csECDA2D3">）</span><span class="csDE05BCC">Phpmyadmin xss</span></a></h1>
		<h2 class="cs868C439D">
			<a name="一、漏洞简介"><span class="cs83F14626">一、漏洞简介</span></a></h2>
		<p class="cs40DD2BC9"><span class="cs9C1B1871">官方公布的是</span><span class="cs8926E06">sql</span><span class="cs9C1B1871">注入漏洞，但是实际是</span><span class="cs8926E06">xss</span><span class="cs9C1B1871">漏洞</span></p><h2 class="cs868C439D">
			<a name="二、漏洞影响"><span class="cs83F14626">二、漏洞影响</span></a></h2>
		<p class="cs40DD2BC9"><span class="cs8926E06">Phpmyadmin &lt;=4.9.2</span><span class="cs9C1B1871">，至少影响到</span><span class="cs8926E06">4.7.7</span><span class="cs9C1B1871">。</span></p><h2 class="cs868C439D">
			<a name="三、复现过程"><span class="cs83F14626">三、复现过程</span></a></h2>
		<h3 class="cs868C439D">
			<a name="漏洞分析"><span class="csD6CA00D2">漏洞分析</span></a></h3>
		<p class="cs40DD2BC9"><span class="cs9C1B1871">首先看官方修复的方式：</span></p><p class="cs40DD2BC9"><span><img src="Web安全/Phpmyadmin/%ef%bc%88CVE-2019-18622%ef%bc%89Phpmyadmin%20xss_files/image0.png" width="560" height="379" alt="" style="border-width:0px;" /></span></p><p class="cs40DD2BC9"><span class="cs9C1B1871">如上图，先关注</span><span class="cs8926E06">/js/designer/move.js</span><span class="cs9C1B1871">文件，可以看到单纯的修改了取值方式，最终的值通过</span><span class="cs8926E06">POST </span><span class="cs9C1B1871">方式提交到</span><span class="cs8926E06">db_desingner.php</span><span class="cs9C1B1871">文件，关键内容如下：</span></p><p class="cs3A447A38"><span class="cs9FB05234">if (isset($_POST[&#39;dialog&#39;])) {</span><span class="cs8926E06"><br/><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;....</span><span class="cs8926E06"><br/><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;} elseif ($_POST[&#39;dialog&#39;] == &#39;add_table&#39;) {</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// Pass the db and table to the getTablesInfo so we only have the table we asked for</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$script_display_field = $designerCommon-&gt;getTablesInfo($_POST[&#39;db&#39;], $_POST[&#39;table&#39;]);</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;...</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">}</span></p><p class="cs40DD2BC9"><span class="cs9C1B1871">传到了</span><span class="cs8926E06">getTablesInfo()</span><span class="cs9C1B1871">函数中，该函数内容主要如下：</span></p><p class="cs3A447A38"><span class="cs9FB05234">public function getTablesInfo($db = null, $table = null)</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;{</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.....</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;foreach ($tables as $one_table) {</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$DF = $this-&gt;relation-&gt;getDisplayField($db, $one_table[&#39;TABLE_NAME&#39;]);</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$DF = is_string($DF) ? $DF : &#39;&#39;;</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$DF = ($DF !== &#39;&#39;) ? $DF : null;</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$designerTables[] = new DesignerTable(</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$db,</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$one_table[&#39;TABLE_NAME&#39;],</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$one_table[&#39;ENGINE&#39;],</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$DF</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;);</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span><span class="cs8926E06"><br/><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return $designerTables;</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;}</span></p><p class="cs40DD2BC9"><span class="cs9C1B1871">跟进</span><span class="cs8926E06">getDisplayField()</span><span class="cs9C1B1871">，内容如下：</span></p><p class="cs3A447A38"><span class="cs9FB05234">public function getDisplayField($db, $table)</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;{</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$cfgRelation = $this-&gt;getRelationsParam();</span><span class="cs8926E06"><br/><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/**</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* Try to fetch the display field from DB.</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if ($cfgRelation[&#39;displaywork&#39;]) {</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$disp_query = &#39;</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SELECT `display_field`</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;FROM &#39; . Util::backquote($cfgRelation[&#39;db&#39;])</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;. &#39;.&#39; . Util::backquote($cfgRelation[&#39;table_info&#39;]) . &#39;</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WHERE `db_name` &nbsp;&nbsp;&nbsp;= \&#39;&#39; . $GLOBALS[&#39;dbi&#39;]-&gt;escapeString($db) . &#39;\&#39;</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AND `table_name` = \&#39;&#39; . $GLOBALS[&#39;dbi&#39;]-&gt;escapeString($table)</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;. &#39;\&#39;&#39;;</span><span class="cs8926E06"><br/><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$row = $GLOBALS[&#39;dbi&#39;]-&gt;fetchSingleRow(</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$disp_query, &#39;ASSOC&#39;, DatabaseInterface::CONNECT_CONTROL</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;);</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (isset($row[&#39;display_field&#39;])) {</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return $row[&#39;display_field&#39;];</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;....</span></p><p class="cs40DD2BC9"><span class="cs9C1B1871">通过</span><span class="cs8926E06">escapeString</span><span class="cs9C1B1871">过滤</span><span class="cs8926E06"> table </span><span class="cs9C1B1871">名，查看该过滤函数：</span></p><p class="cs3A447A38"><span class="cs9FB05234">public function escapeString($link, $str)</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;{</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return mysql_real_escape_string($str, $link);</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;}</span></p><p class="cs40DD2BC9"><span class="cs9C1B1871">引入了</span><span class="cs8926E06">mysql_real_escape_string()</span><span class="cs9C1B1871">函数</span></p><p class="cs40DD2BC9"><span class="cs9C1B1871">这个函数类似于</span><span class="cs8926E06">addslashes()</span><span class="cs9C1B1871">函数，当编码不当的时候，可能导致宽字节注入</span></p><p class="cs40DD2BC9"><span class="cs9C1B1871">但真的那么简单吗？继续往下看</span></p><p class="cs40DD2BC9"><span class="cs9C1B1871">这里获得的</span><span class="cs8926E06">table_name </span><span class="cs9C1B1871">参数会传入以下语句：</span></p><p class="cs3A447A38"><span class="cs9FB05234">SELECT *, `COLUMN_NAME` AS `Field`, `COLUMN_TYPE` AS `Type`, `COLLATION_NAME` AS `Collation`, `IS_NULLABLE` AS `Null`, `COLUMN_KEY` AS `Key`, `COLUMN_DEFAULT` AS `Default`, `EXTRA` AS `Extra`, `PRIVILEGES` AS `Privileges`, `COLUMN_COMMENT` AS `Comment` FROM `information_schema`.`COLUMNS` WHERE `TABLE_SCHEMA` = &#39;day1&#39; AND `TABLE_NAME` = &#39;$table_name&#39;;</span></p><p class="cs40DD2BC9"><span class="cs9C1B1871">这里的</span><span class="cs8926E06">$table_name</span><span class="cs9C1B1871">在</span><span class="cs8926E06"> db_designer.php</span><span class="cs9C1B1871">中可控，然而当环境准备好，语句配置好后，却出现了以下错误：</span></p><p class="cs40DD2BC9"><span><img src="Web安全/Phpmyadmin/%ef%bc%88CVE-2019-18622%ef%bc%89Phpmyadmin%20xss_files/image1.png" width="560" height="264" alt="" style="border-width:0px;" /></span></p><p class="cs3A447A38"><span class="cs9FB05234">JSON encoding failed: Malformed UTF-8 characters, possibly incorrectly encoded</span></p><p class="cs40DD2BC9"><span class="cs9C1B1871">提示是因为编码问题，因此我们重新将</span><span class="cs8926E06"> payload url </span><span class="cs9C1B1871">编码后再传入：</span></p><p class="cs40DD2BC9"><span><img src="Web安全/Phpmyadmin/%ef%bc%88CVE-2019-18622%ef%bc%89Phpmyadmin%20xss_files/image2.png" width="560" height="334" alt="" style="border-width:0px;" /></span></p><p class="cs40DD2BC9"><span class="cs9C1B1871">这次无误，查看执行的语句：</span></p><p class="cs40DD2BC9"><span><img src="Web安全/Phpmyadmin/%ef%bc%88CVE-2019-18622%ef%bc%89Phpmyadmin%20xss_files/image3.png" width="560" height="145" alt="" style="border-width:0px;" /></span></p><p class="cs40DD2BC9"><span class="cs8926E06">%df%27</span><span class="cs9C1B1871">并没有按照我们想法闭合单引号，到底是什么原因呢？</span></p><p class="cs40DD2BC9"><span><img src="Web安全/Phpmyadmin/%ef%bc%88CVE-2019-18622%ef%bc%89Phpmyadmin%20xss_files/image4.png" width="560" height="260" alt="" style="border-width:0px;" /></span></p><p class="cs40DD2BC9"><span class="cs9C1B1871">在数据库连接的时候，</span><span class="cs8926E06">phpmyadmin</span><span class="cs9C1B1871">会将默认的字符格式设置为</span><span class="cs8926E06"> utf8mb4</span><span class="cs9C1B1871">，而我们宽字节注入必须要求编码为</span><span class="cs8926E06">g bk</span><span class="cs9C1B1871">，因此其实这里不存在宽字节注入。</span></p><p class="cs40DD2BC9"><span class="cs9C1B1871">说明这里的修复对</span><span class="cs8926E06">SQL </span><span class="cs9C1B1871">漏洞并无多大关系（其实从修复文件上看，就知道了），继续看下一处修复。</span></p><p class="cs3A447A38"><span class="cs9FB05234">/templates/database/designer/database_tables.twig</span><span class="cs7FFD2630">处</span></p><p class="cs40DD2BC9"><span class="cs8926E06">diff </span><span class="cs9C1B1871">如下：</span></p><p class="cs3A447A38"><span class="cs9FB05234">- &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{{ designerTable.getTableName()|raw }}</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">+ &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{{ designerTable.getTableName() }}</span></p><p class="cs40DD2BC9"><span class="cs9C1B1871">可以看到，唯一的差别就是删除了</span><span class="cs8926E06">|raw</span><span class="cs9C1B1871">，这种写法是</span><span class="cs8926E06">Twig</span><span class="cs9C1B1871">模板语言的写法，</span><span class="cs8926E06">raw </span><span class="cs9C1B1871">的作用就是让数据在</span><span class="cs8926E06"> autoescape</span><span class="cs9C1B1871">过滤器里失效，可以安装一个</span><span class="cs8926E06"> twig </span><span class="cs9C1B1871">模板看看实例。</span></p><p class="cs3A447A38"><span class="cs9FB05234">composer require &quot;twig/twig:^3.0&quot;</span></p><p class="cs40DD2BC9"><span><img src="Web安全/Phpmyadmin/%ef%bc%88CVE-2019-18622%ef%bc%89Phpmyadmin%20xss_files/image5.png" width="560" height="60" alt="" style="border-width:0px;" /></span></p><p class="cs40DD2BC9"><span class="cs9C1B1871">运行命令后该目录下会生成</span><span class="cs8926E06">2</span><span class="cs9C1B1871">个文件：</span><span class="cs8926E06">composer.json</span><span class="cs9C1B1871">、</span><span class="cs8926E06">composer.lock</span><span class="cs9C1B1871">以及一个目录</span><span class="cs8926E06">vendor</span></p><p class="cs40DD2BC9"><span class="cs9C1B1871">然后在同目录下创建文件夹</span><span class="cs8926E06">templates</span><span class="cs9C1B1871">、</span><span class="cs8926E06">tmp</span></p><p class="cs40DD2BC9"><span class="cs9C1B1871">进入</span><span class="cs8926E06">templates</span><span class="cs9C1B1871">目录下创建</span><span class="cs8926E06">index.html.twig</span><span class="cs9C1B1871">文件，内容如下</span></p><p class="cs3A447A38"><span class="cs9FB05234">&lt;!DOCTYPE html&gt;</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">&lt;html lang=&quot;en&quot;&gt;</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">&lt;head&gt;</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&lt;meta charset=&quot;UTF-8&quot;&gt;</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&lt;title&gt;twig&lt;/title&gt;</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">&lt;/head&gt;</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">&lt;body&gt;</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">&lt;h1&gt;test&lt;/h1&gt;&lt;br&gt;</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> {{ name |raw}}</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">&lt;br&gt;</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">{{ name }}</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">&lt;/body&gt;</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">&lt;/html&gt;</span></p><p class="cs40DD2BC9"><span class="cs9C1B1871">根目录下创建</span><span class="cs8926E06">index.php</span><span class="cs9C1B1871">，内容如下：</span></p><p class="cs3A447A38"><span class="cs9FB05234">require_once &#39;vendor/autoload.php&#39;;</span><span class="cs8926E06"><br/><br/></span><span class="cs9FB05234">$loader = new \Twig\Loader\FilesystemLoader(&#39;templates&#39;);</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">$twig = new \Twig\Environment($loader, [</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&#39;cache&#39; =&gt; &#39;/Library/WebServer/Documents/twig/tmp&#39;,</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">]);</span><span class="cs8926E06"><br/><br/></span><span class="cs9FB05234">echo $twig-&gt;render(&#39;index.html.twig&#39;, [&#39;name&#39; =&gt; &#39;panda\&#39; union select 1,2, from a&#39;]);</span></p><p class="cs40DD2BC9"><span class="cs9C1B1871">访问</span><span class="cs8926E06">index.php</span><span class="cs9C1B1871">可以发现：</span></p><p class="cs40DD2BC9"><span><img src="Web安全/Phpmyadmin/%ef%bc%88CVE-2019-18622%ef%bc%89Phpmyadmin%20xss_files/image6.png" width="560" height="308" alt="" style="border-width:0px;" /></span></p><p class="cs40DD2BC9"><span class="cs9C1B1871">单引号被转义成了实体字符</span></p><p class="cs40DD2BC9"><span class="cs9C1B1871">修复的</span><span class="cs8926E06"> SQL </span><span class="cs9C1B1871">漏洞点在这里吗？</span></p><p class="cs40DD2BC9"><span class="cs9C1B1871">并不是。这里修复的仅仅是前端显示字符串的问题，与后端的</span><span class="cs8926E06"> sql </span><span class="cs9C1B1871">注入也并无关系。</span></p><p class="cs40DD2BC9"><span class="cs9C1B1871">前文中提到的</span><span class="cs8926E06">move.js</span><span class="cs9C1B1871">修复的也是前端的内容，其实也和后端的</span><span class="cs8926E06"> sql </span><span class="cs9C1B1871">注入并无关系。</span></p><p class="cs40DD2BC9"><span class="cs9C1B1871">那么这个修复方式和</span><span class="cs8926E06"> sql </span><span class="cs9C1B1871">注入到底是什么关系呢？</span></p><p class="cs40DD2BC9"><span class="cs9C1B1871">可能没关系吧。</span></p><p class="cs40DD2BC9"><span class="cs9C1B1871">考虑到该修复内容全部为前端的内容，于是将表名改为</span><span class="cs8926E06"> XSS </span><span class="cs9C1B1871">的</span><span class="cs8926E06"> payload</span><span class="cs9C1B1871">：</span></p><p class="cs3A447A38"><span class="cs9FB05234">&lt;script&gt;alert(0)&lt;/script&gt;</span></p><p class="cs40DD2BC9"><span class="cs9C1B1871">果然，和当初想的一样，触发了</span><span class="cs8926E06"> XSS </span><span class="cs9C1B1871">漏洞。</span></p><p class="cs40DD2BC9"><span><img src="Web安全/Phpmyadmin/%ef%bc%88CVE-2019-18622%ef%bc%89Phpmyadmin%20xss_files/image7.png" width="560" height="238" alt="" style="border-width:0px;" /></span></p><p class="cs40DD2BC9"><span><img src="Web安全/Phpmyadmin/%ef%bc%88CVE-2019-18622%ef%bc%89Phpmyadmin%20xss_files/image8.png" width="560" height="324" alt="" style="border-width:0px;" /></span></p><p class="cs40DD2BC9"><span class="cs9C1B1871">然后看</span><span class="cs8926E06">v4.9.2</span><span class="cs9C1B1871">版本的</span><span class="cs8926E06"> phpmyadmin</span><span class="cs9C1B1871">：</span></p><p class="cs40DD2BC9"><span><img src="Web安全/Phpmyadmin/%ef%bc%88CVE-2019-18622%ef%bc%89Phpmyadmin%20xss_files/image9.png" width="560" height="153" alt="" style="border-width:0px;" /></span></p><p class="cs40DD2BC9"><span><img src="Web安全/Phpmyadmin/%ef%bc%88CVE-2019-18622%ef%bc%89Phpmyadmin%20xss_files/image10.png" width="560" height="464" alt="" style="border-width:0px;" /></span></p><p class="cs40DD2BC9"><span class="cs9C1B1871">转义成实体字符，无法触发</span><span class="cs8926E06"> XSS</span></p></body>
</html>
