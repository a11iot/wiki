<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8" /><title>
		</title>
		<style type="text/css">
			.cs868C439D{text-align:left;text-indent:0pt;margin:10pt 0pt 0pt 0pt;page-break-after:avoid;page-break-inside:avoid}
			.csB2D98684{color:#4F81BD;background-color:transparent;font-family:Calibri;font-size:14pt;font-weight:bold;font-style:normal;}
			.cs6FD73CFB{text-align:left;text-indent:0pt;margin:5pt 24pt 5pt 24pt}
			.cs8926E06{color:#000000;background-color:transparent;font-family:Calibri;font-size:12pt;font-weight:normal;font-style:normal;}
			.cs9C1B1871{color:#000000;background-color:transparent;font-family:Microsoft YaHei UI;font-size:12pt;font-weight:normal;font-style:normal;}
			.cs40DD2BC9{text-align:left;text-indent:0pt;margin:9pt 0pt 9pt 0pt}
			.cs9FB05234{color:#000000;background-color:transparent;font-family:Consolas;font-size:11pt;font-weight:normal;font-style:normal;}
			.cs3A447A38{text-align:left;text-indent:0pt;margin:0pt 0pt 10pt 0pt}
			.csE3F655E4{color:#000000;background-color:transparent;font-family:Microsoft YaHei UI;font-size:12pt;font-weight:bold;font-style:normal;}
			.cs508254C{color:#000000;background-color:transparent;font-family:Calibri;font-size:12pt;font-weight:normal;font-style:normal;text-decoration: none;}
			.cs4B51D5E4{color:#4F81BD;background-color:transparent;font-family:Calibri;font-size:12pt;font-weight:normal;font-style:normal;}
		</style>
	</head>
	<body>
		<h2 class="cs868C439D">
			<a name="amcache--recentfilecachebcf"><span class="csB2D98684">Amcache / RecentFileCache.bcf</span></a></h2>
		<p class="cs6FD73CFB"><span class="cs8926E06">Windows</span><span class="cs9C1B1871">中的使用这两个文件来跟踪具有不同可执行文件的应用程序兼容性问题，它可用于确定可执行文件首次运行的时间和最后修改时间。</span></p><p class="cs40DD2BC9"><span class="cs9FB05234">win7</span><span class="cs9C1B1871">、</span><span class="cs9FB05234">windows server 2008R2</span><span class="cs9C1B1871">等系统保存位置：</span></p><p class="cs6FD73CFB"><span class="cs9C1B1871">只包含了程序的创建时间、上次修改时间、上次访问时间和文件名</span></p><p class="cs3A447A38"><span class="cs9FB05234">C:\Windows\AppCompat\Programs\RecentFileCache.bcf</span></p><p class="cs40DD2BC9"><span class="cs9FB05234">win8</span><span class="cs9C1B1871">、</span><span class="cs9FB05234">win10</span><span class="cs9C1B1871">、</span><span class="cs9FB05234">windows server 2012</span><span class="cs9C1B1871">等系统保存位置：</span></p><p class="cs6FD73CFB"><span class="cs9C1B1871">包含了文件大小、版本、</span><span class="cs8926E06">sha1</span><span class="cs9C1B1871">、二进制文件类型等等信息</span></p><p class="cs40DD2BC9"><span class="csE3F655E4">注</span><span class="cs9C1B1871">：</span><span class="cs8926E06">Win7</span><span class="cs9C1B1871">系统安装</span><span class="cs9FB05234">KB2952664</span><span class="cs9C1B1871">后，也会支持</span><span class="cs8926E06">Amcache.hve</span></p><p class="cs3A447A38"><span class="cs9FB05234">C:\Windows\AppCompat\Programs\Amcache.hve</span></p><p class="cs40DD2BC9"><span class="cs9FB05234">RecentFileCache.bcf</span><span class="cs9C1B1871">解析工具</span></p><p class="cs40DD2BC9"><span class="cs9FB05234">c#</span><span class="cs9C1B1871">版：</span><span class="cs8926E06"><a class="cs508254C" href="https://github.com/ianxtianxt/RecentFileCacheParser"><span class="cs4B51D5E4">https://github.com/ianxtianxt/RecentFileCacheParser</span></a></span></p><p class="cs40DD2BC9"><span class="cs9C1B1871">用法实例：</span></p><p class="cs3A447A38"><span class="cs9FB05234">RecentFileCacheParser.exe -f &quot;C:\Windows\AppCompat\Programs\RecentFileCache.bcf&quot; --csv &quot;c:\temp&quot;</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">RecentFileCacheParser.exe -f &quot;C:\Windows\AppCompat\Programs\RecentFileCache.bcf&quot; --json &quot;D:\jsonOutput&quot; --jsonpretty</span></p><p class="cs40DD2BC9"><span><img src="安全技术/电子取证/Windows取证/从文件中取证/Amcache%20_%20RecentFileCache.bcf_files/image0.png" width="560" height="413" alt="" style="border-width:0px;" /></span></p><p class="cs40DD2BC9"><span class="cs9C1B1871">结果</span></p><p class="cs40DD2BC9"><span><img src="安全技术/电子取证/Windows取证/从文件中取证/Amcache%20_%20RecentFileCache.bcf_files/image1.png" width="560" height="325" alt="" style="border-width:0px;" /></span></p><p class="cs40DD2BC9"><span class="cs9FB05234">python</span><span class="cs9C1B1871">版：</span><span class="cs8926E06"><a class="cs508254C" href="https://github.com/ianxtianxt/recentfilecache-parser"><span class="cs4B51D5E4">https://github.com/ianxtianxt/recentfilecache-parser</span></a></span></p><p class="cs40DD2BC9"><span class="cs9C1B1871">用法</span></p><p class="cs3A447A38"><span class="cs9FB05234">rfcparse.py -f C:\Windows\AppCompat\Programs\RecentFileCache.bcf</span></p><p class="cs40DD2BC9"><span class="cs9FB05234">Amcache.hve</span><span class="cs9C1B1871">解析工具</span></p><p class="cs40DD2BC9"><span class="cs9FB05234">c#</span><span class="cs9C1B1871">版</span><span class="cs8926E06">: <a class="cs508254C" href="https://github.com/ianxtianxt/AmcacheParser"><span class="cs4B51D5E4">https://github.com/ianxtianxt/AmcacheParser</span></a></span></p><p class="cs40DD2BC9"><span class="cs9FB05234">python</span><span class="cs9C1B1871">版</span><span class="cs8926E06">:</span></p><p class="cs3A447A38"><span class="cs9FB05234">#!/usr/bin/python</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"># &nbsp;&nbsp;&nbsp;This file is part of python-registry.</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">#</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"># &nbsp;&nbsp;Copyright 2015 Will Ballenthin &lt;william.ballenthin@mandiant.com&gt;</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"># &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;while at Mandiant &lt;http://www.mandiant.com&gt;Exe</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">#</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"># &nbsp;&nbsp;Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"># &nbsp;&nbsp;you may not use this file except in compliance with the License.</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"># &nbsp;&nbsp;You may obtain a copy of the License at</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">#</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"># &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;http://www.apache.org/licenses/LICENSE-2.0</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">#</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"># &nbsp;&nbsp;Unless required by applicable law or agreed to in writing, software</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"># &nbsp;&nbsp;distributed under the License is distributed on an &quot;AS IS&quot; BASIS,</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"># &nbsp;&nbsp;WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"># &nbsp;&nbsp;See the License for the specific language governing permissions and</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"># &nbsp;&nbsp;limitations under the License.</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">import sys</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">import logging</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">import datetime</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">from collections import namedtuple</span><span class="cs8926E06"><br/><br/></span><span class="cs9FB05234">import argparse</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">import unicodecsv</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">from Registry import Registry</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">from Registry.RegistryParse import parse_windows_timestamp as _parse_windows_timestamp</span><span class="cs8926E06"><br/><br/><br/></span><span class="cs9FB05234">g_logger = logging.getLogger(&quot;amcache&quot;)</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">Field = namedtuple(&quot;Field&quot;, [&quot;name&quot;, &quot;getter&quot;])</span><span class="cs8926E06"><br/><br/><br/></span><span class="cs9FB05234">def make_value_getter(value_name):</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&quot;&quot;&quot; return a function that fetches the value from the registry key &quot;&quot;&quot;</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;def _value_getter(key):</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;try:</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return key.value(value_name).value()</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;except Registry.RegistryValueNotFoundException:</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return None</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;return _value_getter</span><span class="cs8926E06"><br/><br/><br/></span><span class="cs9FB05234">def make_windows_timestamp_value_getter(value_name):</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&quot;&quot;&quot;</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;return a function that fetches the value from the registry key</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;as a Windows timestamp.</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&quot;&quot;&quot;</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;f = make_value_getter(value_name)</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;def _value_getter(key):</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;try:</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return parse_windows_timestamp(f(key) or 0)</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;except ValueError:</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return datetime.datetime.min</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;return _value_getter</span><span class="cs8926E06"><br/><br/><br/></span><span class="cs9FB05234">def parse_unix_timestamp(qword):</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;return datetime.datetime.fromtimestamp(qword)</span><span class="cs8926E06"><br/><br/><br/></span><span class="cs9FB05234">def parse_windows_timestamp(qword):</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;try:</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return _parse_windows_timestamp(qword)</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;except ValueError:</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return datetime.datetime.min</span><span class="cs8926E06"><br/><br/><br/></span><span class="cs9FB05234">def make_unix_timestamp_value_getter(value_name):</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&quot;&quot;&quot;</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;return a function that fetches the value from the registry key</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;as a UNIX timestamp.</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&quot;&quot;&quot;</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;f = make_value_getter(value_name)</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;def _value_getter(key):</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;try:</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return parse_unix_timestamp(f(key) or 0)</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;except ValueError:</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return datetime.datetime.min</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;return _value_getter</span><span class="cs8926E06"><br/><br/><br/></span><span class="cs9FB05234">UNIX_TIMESTAMP_ZERO = parse_unix_timestamp(0)</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">WINDOWS_TIMESTAMP_ZERO = parse_windows_timestamp(0)</span><span class="cs8926E06"><br/><br/><br/></span><span class="cs9FB05234"># via: http://www.swiftforensics.com/2013/12/amcachehve-in-windows-8-goldmine-for.html</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">#Product Name &nbsp;&nbsp;&nbsp;UNICODE string</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">#==============================================================================</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">#0 &nbsp;&nbsp;Product Name &nbsp;&nbsp;&nbsp;UNICODE string</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">#1 &nbsp;&nbsp;Company Name &nbsp;&nbsp;&nbsp;UNICODE string</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">#2 &nbsp;&nbsp;File version number only &nbsp;&nbsp;&nbsp;UNICODE string</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">#3 &nbsp;&nbsp;Language code (1033 for en-US) &nbsp;DWORD</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">#4 &nbsp;&nbsp;SwitchBackContext &nbsp;&nbsp;QWORD</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">#5 &nbsp;&nbsp;File Version &nbsp;&nbsp;&nbsp;UNICODE string</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">#6 &nbsp;&nbsp;File Size (in bytes) &nbsp;&nbsp;&nbsp;DWORD</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">#7 &nbsp;&nbsp;PE Header field - SizeOfImage &nbsp;&nbsp;DWORD</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">#8 &nbsp;&nbsp;Hash of PE Header (unknown algorithm) &nbsp;&nbsp;UNICODE string</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">#9 &nbsp;&nbsp;PE Header field - Checksum &nbsp;DWORD</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">#a &nbsp;&nbsp;Unknown QWORD</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">#b &nbsp;&nbsp;Unknown QWORD</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">#c &nbsp;&nbsp;File Description &nbsp;&nbsp;&nbsp;UNICODE string</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">#d &nbsp;&nbsp;Unknown, maybe Major &amp; Minor OS version DWORD</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">#f &nbsp;&nbsp;Linker (Compile time) Timestamp DWORD - Unix time</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">#10 &nbsp;Unknown DWORD</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">#11 &nbsp;Last Modified Timestamp FILETIME</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">#12 &nbsp;Created Timestamp &nbsp;&nbsp;FILETIME</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">#15 &nbsp;Full path to file &nbsp;&nbsp;UNICODE string</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">#16 &nbsp;Unknown DWORD</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">#17 &nbsp;Last Modified Timestamp 2 &nbsp;&nbsp;FILETIME</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">#100 Program ID &nbsp;UNICODE string</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">#101 SHA1 hash of file</span><span class="cs8926E06"><br/><br/><br/></span><span class="cs9FB05234"># note: order here implicitly orders CSV column ordering cause I&#39;m lazy</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">FIELDS = [</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;Field(&quot;path&quot;, make_value_getter(&quot;15&quot;)),</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;Field(&quot;sha1&quot;, make_value_getter(&quot;101&quot;)),</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;Field(&quot;size&quot;, make_value_getter(&quot;6&quot;)),</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;Field(&quot;file_description&quot;, make_value_getter(&quot;c&quot;)),</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;Field(&quot;source_key_timestamp&quot;, lambda key: key.timestamp()),</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;Field(&quot;created_timestamp&quot;, make_windows_timestamp_value_getter(&quot;12&quot;)),</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;Field(&quot;modified_timestamp&quot;, make_windows_timestamp_value_getter(&quot;11&quot;)),</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;Field(&quot;modified_timestamp2&quot;, make_windows_timestamp_value_getter(&quot;17&quot;)),</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;Field(&quot;linker_timestamp&quot;, make_unix_timestamp_value_getter(&quot;f&quot;)),</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;Field(&quot;product&quot;, make_value_getter(&quot;0&quot;)),</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;Field(&quot;company&quot;, make_value_getter(&quot;1&quot;)),</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;Field(&quot;pe_sizeofimage&quot;, make_value_getter(&quot;7&quot;)),</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;Field(&quot;version_number&quot;, make_value_getter(&quot;2&quot;)),</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;Field(&quot;version&quot;, make_value_getter(&quot;5&quot;)),</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;Field(&quot;language&quot;, make_value_getter(&quot;3&quot;)),</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;Field(&quot;header_hash&quot;, make_value_getter(&quot;8&quot;)),</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;Field(&quot;pe_checksum&quot;, make_value_getter(&quot;9&quot;)),</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;Field(&quot;id&quot;, make_value_getter(&quot;100&quot;)),</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;Field(&quot;switchbackcontext&quot;, make_value_getter(&quot;4&quot;)),</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">]</span><span class="cs8926E06"><br/><br/><br/></span><span class="cs9FB05234">ExecutionEntry = namedtuple(&quot;ExecutionEntry&quot;, map(lambda e: e.name, FIELDS))</span><span class="cs8926E06"><br/><br/><br/></span><span class="cs9FB05234">def parse_execution_entry(key):</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;return ExecutionEntry(**dict((e.name, e.getter(key)) for e in FIELDS))</span><span class="cs8926E06"><br/><br/><br/><br/></span><span class="cs9FB05234">class NotAnAmcacheHive(Exception):</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;pass</span><span class="cs8926E06"><br/><br/><br/></span><span class="cs9FB05234">def parse_execution_entries(registry):</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;try:</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;volumes = registry.open(&quot;Root\\File&quot;)</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;except Registry.RegistryKeyNotFoundException:</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;raise NotAnAmcacheHive()</span><span class="cs8926E06"><br/><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;ret = []</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;for volumekey in volumes.subkeys():</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for filekey in volumekey.subkeys():</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ret.append(parse_execution_entry(filekey))</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;return ret</span><span class="cs8926E06"><br/><br/><br/></span><span class="cs9FB05234">TimelineEntry = namedtuple(&quot;TimelineEntry&quot;, [&quot;timestamp&quot;, &quot;type&quot;, &quot;entry&quot;])</span><span class="cs8926E06"><br/><br/><br/></span><span class="cs9FB05234">def main(argv=None):</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;if argv is None:</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;argv = sys.argv</span><span class="cs8926E06"><br/><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;parser = argparse.ArgumentParser(</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;description=&quot;Parse program execution entries from the Amcache.hve Registry hive&quot;)</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;parser.add_argument(&quot;registry_hive&quot;, type=str,</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;help=&quot;Path to the Amcache.hve hive to process&quot;)</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;parser.add_argument(&quot;-v&quot;, action=&quot;store_true&quot;, dest=&quot;verbose&quot;,</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;help=&quot;Enable verbose output&quot;)</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;parser.add_argument(&quot;-t&quot;, action=&quot;store_true&quot;, dest=&quot;do_timeline&quot;,</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;help=&quot;Output in simple timeline format&quot;)</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;args = parser.parse_args(argv[1:])</span><span class="cs8926E06"><br/><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;if args.verbose:</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;logging.basicConfig(level=logging.DEBUG)</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;else:</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;logging.basicConfig(level=logging.INFO)</span><span class="cs8926E06"><br/><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;if sys.platform == &quot;win32&quot;:</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;import os, msvcrt</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;msvcrt.setmode(sys.stdout.fileno(), os.O_BINARY)</span><span class="cs8926E06"><br/><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;r = Registry.Registry(args.registry_hive)</span><span class="cs8926E06"><br/><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;try:</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ee = parse_execution_entries(r)</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;except NotAnAmcacheHive:</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;g_logger.error(&quot;doesn&#39;t appear to be an Amcache.hve hive&quot;)</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return</span><span class="cs8926E06"><br/><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;if args.do_timeline:</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;entries = []</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for e in ee:</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for t in [&quot;source_key_timestamp&quot;, &quot;created_timestamp&quot;, &quot;modified_timestamp&quot;,</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;modified_timestamp2&quot;, &quot;linker_timestamp&quot;]:</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ts = getattr(e, t)</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if ts == UNIX_TIMESTAMP_ZERO:</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;continue</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if ts == WINDOWS_TIMESTAMP_ZERO:</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;continue</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if ts == datetime.datetime.min:</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;continue</span><span class="cs8926E06"><br/><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;entries.append(TimelineEntry(ts, t, e))</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;w = unicodecsv.writer(sys.stdout, delimiter=&quot;|&quot;, quotechar=&quot;\&quot;&quot;,</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;quoting=unicodecsv.QUOTE_MINIMAL, encoding=&quot;utf-8&quot;)</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;w.writerow([&quot;timestamp&quot;, &quot;timestamp_type&quot;, &quot;path&quot;, &quot;sha1&quot;])</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for e in sorted(entries, key=lambda e: e.timestamp):</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;w.writerow([e.timestamp, e.type, e.entry.path, e.entry.sha1])</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;else:</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;w = unicodecsv.writer(sys.stdout, delimiter=&quot;|&quot;, quotechar=&quot;\&quot;&quot;,</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;quoting=unicodecsv.QUOTE_MINIMAL, encoding=&quot;utf-8&quot;)</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;w.writerow(map(lambda e: e.name, FIELDS))</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for e in ee:</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;w.writerow(map(lambda i: getattr(e, i.name), FIELDS))</span><span class="cs8926E06"><br/><br/><br/></span><span class="cs9FB05234">if __name__ == &quot;__main__&quot;:</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;main(argv=sys.argv)</span></p><p class="cs40DD2BC9"><span class="cs9FB05234">powershell</span><span class="cs9C1B1871">版</span><span class="cs8926E06">:</span></p><p class="cs3A447A38"><span class="cs9FB05234">function Get-Amcache</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">{</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">#Requires -Version 3.0</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">&lt;#</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">.SYNOPSIS</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">This script loads the AMCache hive from the default Windows location and</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">prints relevant data.</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">Author: Joff Thyer, Penetration Tester and Security Researcher</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Black Hills Information Security</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Copyright (c) October 2015</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">.DESCRIPTION</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">This script loads the AMCache hive from the default Windows location and</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">prints relevant data.</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">.PARAMETER RegHive</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">The Amcache registry hive file to load. &nbsp;Defaults to \Windows\AppCompat\Programs\Amcache.hve</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">.PARAMETER DestRegKey</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">The destination registry key to load the registry hive to. &nbsp;Defaults to HKLM:\amcache</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">.PARAMETER Since</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">The historic cutoff date used to select the registry hive objects. &nbsp;&nbsp;All objects are</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">selected from that date up through today.</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">.PARAMETER Ext</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">Specify what file extension you want to match.</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">.EXAMPLE</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">PS C:\&gt; Get-Amcache -Since 9/1/2015 -Ext exe</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">PS C:\&gt; Get-Amcache -Since 9/1/2015 -Filename *install* -Ext exe</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">#&gt;</span><span class="cs8926E06"><br/><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;[CmdletBinding()]</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Param (</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[Parameter(HelpMessage=&quot;Location of Amcache.hve file&quot;)]</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[String]$RegHive = $env:SYSTEMROOT + &quot;\AppCompat\Programs\Amcache.hve&quot;,</span><span class="cs8926E06"><br/><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[Parameter(HelpMessage=&quot;Destination registry key to load amcache hive to&quot;)]</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[String]$DestRegKey = &quot;HKLM\amcache&quot;,</span><span class="cs8926E06"><br/><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[Parameter(HelpMessage=&quot;Amount of amcache history cutoff date. &nbsp;Defaults to 90 days back.&quot;)]</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[ValidatePattern(&quot;^\d{1,2}/\d{1,2}/\d{4}$&quot;)]</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[String]$Since = (Get-Date).AddDays(-90).ToString(&#39;MM/dd/yyyy&#39;),</span><span class="cs8926E06"><br/><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[Parameter(HelpMessage=&quot;Specify the file extension to match. &nbsp;Matches all by default.&quot;)]</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[ValidatePattern(&quot;^exe|dll|sys$&quot;)]</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[String]$Ext = &quot;*&quot;,</span><span class="cs8926E06"><br/><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[Parameter(HelpMessage=&quot;Specify a filename to match.&quot;)]</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[String]$Filename=&quot;*&quot;,</span><span class="cs8926E06"><br/><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[Switch]$Descending = $false</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)</span><span class="cs8926E06"><br/><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;try {</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;reg.exe load $DestRegKey $RegHive | Out-Null</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$rootfile = $DestRegKey.replace(&quot;\&quot;, &quot;:&quot;) + &quot;\Root\File&quot;</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (-not [IO.Path]::GetExtension($Filename)) { $Filename = $Filename + &quot;*&quot;}</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$sortparams = @{ Property = &quot;TimestampLastModified&quot; }</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if ($Descending) { $sortparams.Descending = $true }</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Get-ChildItem -Recurse -Path $rootfile | Get-ItemProperty | `</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;foreach {</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$ts_created = &quot;&quot;</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$ts_lastmodified = &quot;&quot;</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$ts_compile = &quot;&quot;</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if ($_.f) {</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$origin = [TimeZone]::CurrentTimeZone.ToLocalTime([datetime]&#39;1/1/1970&#39;)</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$ts_compile = $origin.AddSeconds($_.f)</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if ($_.12) { $ts_created = [DateTime]::FromFileTime($_.12) }</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if ($_.17) { $ts_lastmodified = [DateTime]::FromFileTime($_.17)}</span><span class="cs8926E06"><br/><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if ([IO.Path]::GetExtension($_.15) -like &quot;.&quot; + $Ext `</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-and [IO.Path]::GetFilename($_.15) -like $Filename) {</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;New-Object psobject -Property @{</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ProductName = $_.0</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CompanyName = $_.1</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;FileVersionNo = $_.2</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LangCode = $_.3</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SwitchBackContext = $_.4</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;FileVersion = $_.5</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;FileSize = $_.6</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PEHeaderImageSize = $_.7</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PEHeaderHash = $_.8</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PEHeaderChecksum = $_.9</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;FileDescription = $_.c</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TimestampCompile = $ts_compile</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TimestampCreated = $ts_created</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;FilePath = $_.15</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TimestampLastModified = $ts_lastmodified</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ProgramID = $_.100</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SHA1Hash = $_.101</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} | Where { $_.TimestampLastModified -gt $Since } `</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| Sort-Object @sortparams</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;}</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;catch {</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$ErrorMessage = $_.Exception.Message</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Write-Output $ErrorMessage</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;break</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;}</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;finally {</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[gc]::collect()</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[gc]::WaitForPendingFinalizers()</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;reg.exe unload $DestRegKey | Out-Null</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;}</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">}</span></p><p class="cs40DD2BC9"><span class="cs9C1B1871">用法示例：</span></p><p class="cs3A447A38"><span class="cs9FB05234">AmcacheParser.exe -f &quot;C:\Windows\AppCompat\Programs\Amcache.hve&quot; --csv C:\temp</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">AmcacheParser.exe -f &quot;C:\Windows\AppCompat\Programs\Amcache.hve&quot; -i on --csv C:\temp</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">AmcacheParser.exe -f &quot;C:\Windows\AppCompat\Programs\Amcache.hve&quot; -w &quot;c:\temp\whitelist.txt&quot; --csv C:\temp</span></p><p class="cs40DD2BC9"><span class="cs9C1B1871">如果我们直接执行的话，会提示：</span><span class="cs8926E06">&quot;</span><span class="cs9C1B1871">正由另一进程使用，因此该进程无法访问此文件</span><span class="cs8926E06">&quot;</span></p><p class="cs40DD2BC9"><span><img src="安全技术/电子取证/Windows取证/从文件中取证/Amcache%20_%20RecentFileCache.bcf_files/image2.png" width="560" height="140" alt="" style="border-width:0px;" /></span></p><p class="cs40DD2BC9"><span class="cs9C1B1871">解决方法是把</span><span class="cs9FB05234">Amcache.hve</span><span class="cs9C1B1871">复制到其它目录，我们可以使用</span><span class="cs9FB05234">shadow copy</span><span class="cs9C1B1871">把</span><span class="cs9FB05234">Amcache.hve</span><span class="cs9C1B1871">复制到当前目录，然后再执行就可以了</span></p><p class="cs40DD2BC9"><span><img src="安全技术/电子取证/Windows取证/从文件中取证/Amcache%20_%20RecentFileCache.bcf_files/image3.png" width="560" height="117" alt="" style="border-width:0px;" /></span></p><p class="cs40DD2BC9"><span class="cs9C1B1871">结果</span></p><p class="cs40DD2BC9"><span class="cs8926E06">&nbsp;</span></p></body>
</html>
